function S0(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in n)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(n,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function T0(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var vh={exports:{}},Po={},xh={exports:{}},ee={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gs=Symbol.for("react.element"),L0=Symbol.for("react.portal"),R0=Symbol.for("react.fragment"),A0=Symbol.for("react.strict_mode"),w0=Symbol.for("react.profiler"),C0=Symbol.for("react.provider"),I0=Symbol.for("react.context"),D0=Symbol.for("react.forward_ref"),k0=Symbol.for("react.suspense"),b0=Symbol.for("react.memo"),_0=Symbol.for("react.lazy"),$c=Symbol.iterator;function P0(n){return n===null||typeof n!="object"?null:(n=$c&&n[$c]||n["@@iterator"],typeof n=="function"?n:null)}var Eh={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Sh=Object.assign,Th={};function jr(n,e,t){this.props=n,this.context=e,this.refs=Th,this.updater=t||Eh}jr.prototype.isReactComponent={};jr.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};jr.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function Lh(){}Lh.prototype=jr.prototype;function Su(n,e,t){this.props=n,this.context=e,this.refs=Th,this.updater=t||Eh}var Tu=Su.prototype=new Lh;Tu.constructor=Su;Sh(Tu,jr.prototype);Tu.isPureReactComponent=!0;var jc=Array.isArray,Rh=Object.prototype.hasOwnProperty,Lu={current:null},Ah={key:!0,ref:!0,__self:!0,__source:!0};function wh(n,e,t){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)Rh.call(e,r)&&!Ah.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=t;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];s.children=l}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:Gs,type:n,key:i,ref:o,props:s,_owner:Lu.current}}function N0(n,e){return{$$typeof:Gs,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function Ru(n){return typeof n=="object"&&n!==null&&n.$$typeof===Gs}function O0(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var Gc=/\/+/g;function sa(n,e){return typeof n=="object"&&n!==null&&n.key!=null?O0(""+n.key):e.toString(36)}function Ai(n,e,t,r,s){var i=typeof n;(i==="undefined"||i==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case Gs:case L0:o=!0}}if(o)return o=n,s=s(o),n=r===""?"."+sa(o,0):r,jc(s)?(t="",n!=null&&(t=n.replace(Gc,"$&/")+"/"),Ai(s,e,t,"",function(u){return u})):s!=null&&(Ru(s)&&(s=N0(s,t+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(Gc,"$&/")+"/")+n)),e.push(s)),1;if(o=0,r=r===""?".":r+":",jc(n))for(var a=0;a<n.length;a++){i=n[a];var l=r+sa(i,a);o+=Ai(i,e,t,l,s)}else if(l=P0(n),typeof l=="function")for(n=l.call(n),a=0;!(i=n.next()).done;)i=i.value,l=r+sa(i,a++),o+=Ai(i,e,t,l,s);else if(i==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Xs(n,e,t){if(n==null)return n;var r=[],s=0;return Ai(n,r,"","",function(i){return e.call(t,i,s++)}),r}function F0(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var We={current:null},wi={transition:null},M0={ReactCurrentDispatcher:We,ReactCurrentBatchConfig:wi,ReactCurrentOwner:Lu};function Ch(){throw Error("act(...) is not supported in production builds of React.")}ee.Children={map:Xs,forEach:function(n,e,t){Xs(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return Xs(n,function(){e++}),e},toArray:function(n){return Xs(n,function(e){return e})||[]},only:function(n){if(!Ru(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};ee.Component=jr;ee.Fragment=R0;ee.Profiler=w0;ee.PureComponent=Su;ee.StrictMode=A0;ee.Suspense=k0;ee.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=M0;ee.act=Ch;ee.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=Sh({},n.props),s=n.key,i=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=Lu.current),e.key!==void 0&&(s=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)Rh.call(e,l)&&!Ah.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:Gs,type:n.type,key:s,ref:i,props:r,_owner:o}};ee.createContext=function(n){return n={$$typeof:I0,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:C0,_context:n},n.Consumer=n};ee.createElement=wh;ee.createFactory=function(n){var e=wh.bind(null,n);return e.type=n,e};ee.createRef=function(){return{current:null}};ee.forwardRef=function(n){return{$$typeof:D0,render:n}};ee.isValidElement=Ru;ee.lazy=function(n){return{$$typeof:_0,_payload:{_status:-1,_result:n},_init:F0}};ee.memo=function(n,e){return{$$typeof:b0,type:n,compare:e===void 0?null:e}};ee.startTransition=function(n){var e=wi.transition;wi.transition={};try{n()}finally{wi.transition=e}};ee.unstable_act=Ch;ee.useCallback=function(n,e){return We.current.useCallback(n,e)};ee.useContext=function(n){return We.current.useContext(n)};ee.useDebugValue=function(){};ee.useDeferredValue=function(n){return We.current.useDeferredValue(n)};ee.useEffect=function(n,e){return We.current.useEffect(n,e)};ee.useId=function(){return We.current.useId()};ee.useImperativeHandle=function(n,e,t){return We.current.useImperativeHandle(n,e,t)};ee.useInsertionEffect=function(n,e){return We.current.useInsertionEffect(n,e)};ee.useLayoutEffect=function(n,e){return We.current.useLayoutEffect(n,e)};ee.useMemo=function(n,e){return We.current.useMemo(n,e)};ee.useReducer=function(n,e,t){return We.current.useReducer(n,e,t)};ee.useRef=function(n){return We.current.useRef(n)};ee.useState=function(n){return We.current.useState(n)};ee.useSyncExternalStore=function(n,e,t){return We.current.useSyncExternalStore(n,e,t)};ee.useTransition=function(){return We.current.useTransition()};ee.version="18.3.1";xh.exports=ee;var _=xh.exports;const Ih=T0(_),U0=S0({__proto__:null,default:Ih},[_]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var B0=_,$0=Symbol.for("react.element"),j0=Symbol.for("react.fragment"),G0=Object.prototype.hasOwnProperty,H0=B0.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,V0={key:!0,ref:!0,__self:!0,__source:!0};function Dh(n,e,t){var r,s={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)G0.call(e,r)&&!V0.hasOwnProperty(r)&&(s[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:$0,type:n,key:i,ref:o,props:s,_owner:H0.current}}Po.Fragment=j0;Po.jsx=Dh;Po.jsxs=Dh;vh.exports=Po;var S=vh.exports,nl={},kh={exports:{}},lt={},bh={exports:{}},_h={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(U,O){var P=U.length;U.push(O);e:for(;0<P;){var K=P-1>>>1,H=U[K];if(0<s(H,O))U[K]=O,U[P]=H,P=K;else break e}}function t(U){return U.length===0?null:U[0]}function r(U){if(U.length===0)return null;var O=U[0],P=U.pop();if(P!==O){U[0]=P;e:for(var K=0,H=U.length,ne=H>>>1;K<ne;){var ae=2*(K+1)-1,xe=U[ae],ce=ae+1,Ne=U[ce];if(0>s(xe,P))ce<H&&0>s(Ne,xe)?(U[K]=Ne,U[ce]=P,K=ce):(U[K]=xe,U[ae]=P,K=ae);else if(ce<H&&0>s(Ne,P))U[K]=Ne,U[ce]=P,K=ce;else break e}}return O}function s(U,O){var P=U.sortIndex-O.sortIndex;return P!==0?P:U.id-O.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],u=[],c=1,d=null,f=3,m=!1,h=!1,p=!1,y=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(U){for(var O=t(u);O!==null;){if(O.callback===null)r(u);else if(O.startTime<=U)r(u),O.sortIndex=O.expirationTime,e(l,O);else break;O=t(u)}}function L(U){if(p=!1,x(U),!h)if(t(l)!==null)h=!0,V(T);else{var O=t(u);O!==null&&te(L,O.startTime-U)}}function T(U,O){h=!1,p&&(p=!1,g(I),I=-1),m=!0;var P=f;try{for(x(O),d=t(l);d!==null&&(!(d.expirationTime>O)||U&&!F());){var K=d.callback;if(typeof K=="function"){d.callback=null,f=d.priorityLevel;var H=K(d.expirationTime<=O);O=n.unstable_now(),typeof H=="function"?d.callback=H:d===t(l)&&r(l),x(O)}else r(l);d=t(l)}if(d!==null)var ne=!0;else{var ae=t(u);ae!==null&&te(L,ae.startTime-O),ne=!1}return ne}finally{d=null,f=P,m=!1}}var A=!1,R=null,I=-1,M=5,D=-1;function F(){return!(n.unstable_now()-D<M)}function Y(){if(R!==null){var U=n.unstable_now();D=U;var O=!0;try{O=R(!0,U)}finally{O?$():(A=!1,R=null)}}else A=!1}var $;if(typeof v=="function")$=function(){v(Y)};else if(typeof MessageChannel<"u"){var X=new MessageChannel,Q=X.port2;X.port1.onmessage=Y,$=function(){Q.postMessage(null)}}else $=function(){y(Y,0)};function V(U){R=U,A||(A=!0,$())}function te(U,O){I=y(function(){U(n.unstable_now())},O)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(U){U.callback=null},n.unstable_continueExecution=function(){h||m||(h=!0,V(T))},n.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<U?Math.floor(1e3/U):5},n.unstable_getCurrentPriorityLevel=function(){return f},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(U){switch(f){case 1:case 2:case 3:var O=3;break;default:O=f}var P=f;f=O;try{return U()}finally{f=P}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(U,O){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var P=f;f=U;try{return O()}finally{f=P}},n.unstable_scheduleCallback=function(U,O,P){var K=n.unstable_now();switch(typeof P=="object"&&P!==null?(P=P.delay,P=typeof P=="number"&&0<P?K+P:K):P=K,U){case 1:var H=-1;break;case 2:H=250;break;case 5:H=1073741823;break;case 4:H=1e4;break;default:H=5e3}return H=P+H,U={id:c++,callback:O,priorityLevel:U,startTime:P,expirationTime:H,sortIndex:-1},P>K?(U.sortIndex=P,e(u,U),t(l)===null&&U===t(u)&&(p?(g(I),I=-1):p=!0,te(L,P-K))):(U.sortIndex=H,e(l,U),h||m||(h=!0,V(T))),U},n.unstable_shouldYield=F,n.unstable_wrapCallback=function(U){var O=f;return function(){var P=f;f=O;try{return U.apply(this,arguments)}finally{f=P}}}})(_h);bh.exports=_h;var K0=bh.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var z0=_,at=K0;function B(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Ph=new Set,xs={};function er(n,e){kr(n,e),kr(n+"Capture",e)}function kr(n,e){for(xs[n]=e,n=0;n<e.length;n++)Ph.add(e[n])}var rn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),rl=Object.prototype.hasOwnProperty,W0=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Hc={},Vc={};function Y0(n){return rl.call(Vc,n)?!0:rl.call(Hc,n)?!1:W0.test(n)?Vc[n]=!0:(Hc[n]=!0,!1)}function q0(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function X0(n,e,t,r){if(e===null||typeof e>"u"||q0(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Ye(n,e,t,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var Ue={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Ue[n]=new Ye(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Ue[e]=new Ye(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Ue[n]=new Ye(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Ue[n]=new Ye(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Ue[n]=new Ye(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Ue[n]=new Ye(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Ue[n]=new Ye(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Ue[n]=new Ye(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Ue[n]=new Ye(n,5,!1,n.toLowerCase(),null,!1,!1)});var Au=/[\-:]([a-z])/g;function wu(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(Au,wu);Ue[e]=new Ye(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(Au,wu);Ue[e]=new Ye(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(Au,wu);Ue[e]=new Ye(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Ue[n]=new Ye(n,1,!1,n.toLowerCase(),null,!1,!1)});Ue.xlinkHref=new Ye("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Ue[n]=new Ye(n,1,!1,n.toLowerCase(),null,!0,!0)});function Cu(n,e,t,r){var s=Ue.hasOwnProperty(e)?Ue[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(X0(e,t,s,r)&&(t=null),r||s===null?Y0(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):s.mustUseProperty?n[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,r=s.attributeNamespace,t===null?n.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var ln=z0.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Qs=Symbol.for("react.element"),ur=Symbol.for("react.portal"),cr=Symbol.for("react.fragment"),Iu=Symbol.for("react.strict_mode"),sl=Symbol.for("react.profiler"),Nh=Symbol.for("react.provider"),Oh=Symbol.for("react.context"),Du=Symbol.for("react.forward_ref"),il=Symbol.for("react.suspense"),ol=Symbol.for("react.suspense_list"),ku=Symbol.for("react.memo"),fn=Symbol.for("react.lazy"),Fh=Symbol.for("react.offscreen"),Kc=Symbol.iterator;function qr(n){return n===null||typeof n!="object"?null:(n=Kc&&n[Kc]||n["@@iterator"],typeof n=="function"?n:null)}var ve=Object.assign,ia;function is(n){if(ia===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);ia=e&&e[1]||""}return`
`+ia+n}var oa=!1;function aa(n,e){if(!n||oa)return"";oa=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(n,[],e)}else{try{e.call()}catch(u){r=u}n.call(e.prototype)}else{try{throw Error()}catch(u){r=u}n()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var l=`
`+s[o].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=o&&0<=a);break}}}finally{oa=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?is(n):""}function Q0(n){switch(n.tag){case 5:return is(n.type);case 16:return is("Lazy");case 13:return is("Suspense");case 19:return is("SuspenseList");case 0:case 2:case 15:return n=aa(n.type,!1),n;case 11:return n=aa(n.type.render,!1),n;case 1:return n=aa(n.type,!0),n;default:return""}}function al(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case cr:return"Fragment";case ur:return"Portal";case sl:return"Profiler";case Iu:return"StrictMode";case il:return"Suspense";case ol:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case Oh:return(n.displayName||"Context")+".Consumer";case Nh:return(n._context.displayName||"Context")+".Provider";case Du:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case ku:return e=n.displayName||null,e!==null?e:al(n.type)||"Memo";case fn:e=n._payload,n=n._init;try{return al(n(e))}catch{}}return null}function J0(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return al(e);case 8:return e===Iu?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Dn(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Mh(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Z0(n){var e=Mh(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,i=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function Js(n){n._valueTracker||(n._valueTracker=Z0(n))}function Uh(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=Mh(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function Wi(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function ll(n,e){var t=e.checked;return ve({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function zc(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=Dn(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Bh(n,e){e=e.checked,e!=null&&Cu(n,"checked",e,!1)}function ul(n,e){Bh(n,e);var t=Dn(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?cl(n,e.type,t):e.hasOwnProperty("defaultValue")&&cl(n,e.type,Dn(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function Wc(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function cl(n,e,t){(e!=="number"||Wi(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var os=Array.isArray;function Tr(n,e,t,r){if(n=n.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<n.length;t++)s=e.hasOwnProperty("$"+n[t].value),n[t].selected!==s&&(n[t].selected=s),s&&r&&(n[t].defaultSelected=!0)}else{for(t=""+Dn(t),e=null,s=0;s<n.length;s++){if(n[s].value===t){n[s].selected=!0,r&&(n[s].defaultSelected=!0);return}e!==null||n[s].disabled||(e=n[s])}e!==null&&(e.selected=!0)}}function dl(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(B(91));return ve({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function Yc(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(B(92));if(os(t)){if(1<t.length)throw Error(B(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:Dn(t)}}function $h(n,e){var t=Dn(e.value),r=Dn(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function qc(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function jh(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function fl(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?jh(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Zs,Gh=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,s){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,s)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(Zs=Zs||document.createElement("div"),Zs.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Zs.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function Es(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var us={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ey=["Webkit","ms","Moz","O"];Object.keys(us).forEach(function(n){ey.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),us[e]=us[n]})});function Hh(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||us.hasOwnProperty(n)&&us[n]?(""+e).trim():e+"px"}function Vh(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,s=Hh(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,s):n[t]=s}}var ty=ve({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function hl(n,e){if(e){if(ty[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(B(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(B(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(B(61))}if(e.style!=null&&typeof e.style!="object")throw Error(B(62))}}function ml(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var pl=null;function bu(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var gl=null,Lr=null,Rr=null;function Xc(n){if(n=Ks(n)){if(typeof gl!="function")throw Error(B(280));var e=n.stateNode;e&&(e=Uo(e),gl(n.stateNode,n.type,e))}}function Kh(n){Lr?Rr?Rr.push(n):Rr=[n]:Lr=n}function zh(){if(Lr){var n=Lr,e=Rr;if(Rr=Lr=null,Xc(n),e)for(n=0;n<e.length;n++)Xc(e[n])}}function Wh(n,e){return n(e)}function Yh(){}var la=!1;function qh(n,e,t){if(la)return n(e,t);la=!0;try{return Wh(n,e,t)}finally{la=!1,(Lr!==null||Rr!==null)&&(Yh(),zh())}}function Ss(n,e){var t=n.stateNode;if(t===null)return null;var r=Uo(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(B(231,e,typeof t));return t}var yl=!1;if(rn)try{var Xr={};Object.defineProperty(Xr,"passive",{get:function(){yl=!0}}),window.addEventListener("test",Xr,Xr),window.removeEventListener("test",Xr,Xr)}catch{yl=!1}function ny(n,e,t,r,s,i,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(c){this.onError(c)}}var cs=!1,Yi=null,qi=!1,vl=null,ry={onError:function(n){cs=!0,Yi=n}};function sy(n,e,t,r,s,i,o,a,l){cs=!1,Yi=null,ny.apply(ry,arguments)}function iy(n,e,t,r,s,i,o,a,l){if(sy.apply(this,arguments),cs){if(cs){var u=Yi;cs=!1,Yi=null}else throw Error(B(198));qi||(qi=!0,vl=u)}}function tr(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function Xh(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function Qc(n){if(tr(n)!==n)throw Error(B(188))}function oy(n){var e=n.alternate;if(!e){if(e=tr(n),e===null)throw Error(B(188));return e!==n?null:n}for(var t=n,r=e;;){var s=t.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){t=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===t)return Qc(s),n;if(i===r)return Qc(s),e;i=i.sibling}throw Error(B(188))}if(t.return!==r.return)t=s,r=i;else{for(var o=!1,a=s.child;a;){if(a===t){o=!0,t=s,r=i;break}if(a===r){o=!0,r=s,t=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===t){o=!0,t=i,r=s;break}if(a===r){o=!0,r=i,t=s;break}a=a.sibling}if(!o)throw Error(B(189))}}if(t.alternate!==r)throw Error(B(190))}if(t.tag!==3)throw Error(B(188));return t.stateNode.current===t?n:e}function Qh(n){return n=oy(n),n!==null?Jh(n):null}function Jh(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=Jh(n);if(e!==null)return e;n=n.sibling}return null}var Zh=at.unstable_scheduleCallback,Jc=at.unstable_cancelCallback,ay=at.unstable_shouldYield,ly=at.unstable_requestPaint,Se=at.unstable_now,uy=at.unstable_getCurrentPriorityLevel,_u=at.unstable_ImmediatePriority,em=at.unstable_UserBlockingPriority,Xi=at.unstable_NormalPriority,cy=at.unstable_LowPriority,tm=at.unstable_IdlePriority,No=null,Ht=null;function dy(n){if(Ht&&typeof Ht.onCommitFiberRoot=="function")try{Ht.onCommitFiberRoot(No,n,void 0,(n.current.flags&128)===128)}catch{}}var It=Math.clz32?Math.clz32:my,fy=Math.log,hy=Math.LN2;function my(n){return n>>>=0,n===0?32:31-(fy(n)/hy|0)|0}var ei=64,ti=4194304;function as(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Qi(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,s=n.suspendedLanes,i=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~s;a!==0?r=as(a):(i&=o,i!==0&&(r=as(i)))}else o=t&~s,o!==0?r=as(o):i!==0&&(r=as(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-It(e),s=1<<t,r|=n[t],e&=~s;return r}function py(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function gy(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,s=n.expirationTimes,i=n.pendingLanes;0<i;){var o=31-It(i),a=1<<o,l=s[o];l===-1?(!(a&t)||a&r)&&(s[o]=py(a,e)):l<=e&&(n.expiredLanes|=a),i&=~a}}function xl(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function nm(){var n=ei;return ei<<=1,!(ei&4194240)&&(ei=64),n}function ua(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function Hs(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-It(e),n[e]=t}function yy(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var s=31-It(t),i=1<<s;e[s]=0,r[s]=-1,n[s]=-1,t&=~i}}function Pu(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-It(t),s=1<<r;s&e|n[r]&e&&(n[r]|=e),t&=~s}}var oe=0;function rm(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var sm,Nu,im,om,am,El=!1,ni=[],En=null,Sn=null,Tn=null,Ts=new Map,Ls=new Map,pn=[],vy="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Zc(n,e){switch(n){case"focusin":case"focusout":En=null;break;case"dragenter":case"dragleave":Sn=null;break;case"mouseover":case"mouseout":Tn=null;break;case"pointerover":case"pointerout":Ts.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ls.delete(e.pointerId)}}function Qr(n,e,t,r,s,i){return n===null||n.nativeEvent!==i?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Ks(e),e!==null&&Nu(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),n)}function xy(n,e,t,r,s){switch(e){case"focusin":return En=Qr(En,n,e,t,r,s),!0;case"dragenter":return Sn=Qr(Sn,n,e,t,r,s),!0;case"mouseover":return Tn=Qr(Tn,n,e,t,r,s),!0;case"pointerover":var i=s.pointerId;return Ts.set(i,Qr(Ts.get(i)||null,n,e,t,r,s)),!0;case"gotpointercapture":return i=s.pointerId,Ls.set(i,Qr(Ls.get(i)||null,n,e,t,r,s)),!0}return!1}function lm(n){var e=Bn(n.target);if(e!==null){var t=tr(e);if(t!==null){if(e=t.tag,e===13){if(e=Xh(t),e!==null){n.blockedOn=e,am(n.priority,function(){im(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Ci(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=Sl(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);pl=r,t.target.dispatchEvent(r),pl=null}else return e=Ks(t),e!==null&&Nu(e),n.blockedOn=t,!1;e.shift()}return!0}function ed(n,e,t){Ci(n)&&t.delete(e)}function Ey(){El=!1,En!==null&&Ci(En)&&(En=null),Sn!==null&&Ci(Sn)&&(Sn=null),Tn!==null&&Ci(Tn)&&(Tn=null),Ts.forEach(ed),Ls.forEach(ed)}function Jr(n,e){n.blockedOn===e&&(n.blockedOn=null,El||(El=!0,at.unstable_scheduleCallback(at.unstable_NormalPriority,Ey)))}function Rs(n){function e(s){return Jr(s,n)}if(0<ni.length){Jr(ni[0],n);for(var t=1;t<ni.length;t++){var r=ni[t];r.blockedOn===n&&(r.blockedOn=null)}}for(En!==null&&Jr(En,n),Sn!==null&&Jr(Sn,n),Tn!==null&&Jr(Tn,n),Ts.forEach(e),Ls.forEach(e),t=0;t<pn.length;t++)r=pn[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<pn.length&&(t=pn[0],t.blockedOn===null);)lm(t),t.blockedOn===null&&pn.shift()}var Ar=ln.ReactCurrentBatchConfig,Ji=!0;function Sy(n,e,t,r){var s=oe,i=Ar.transition;Ar.transition=null;try{oe=1,Ou(n,e,t,r)}finally{oe=s,Ar.transition=i}}function Ty(n,e,t,r){var s=oe,i=Ar.transition;Ar.transition=null;try{oe=4,Ou(n,e,t,r)}finally{oe=s,Ar.transition=i}}function Ou(n,e,t,r){if(Ji){var s=Sl(n,e,t,r);if(s===null)xa(n,e,r,Zi,t),Zc(n,r);else if(xy(s,n,e,t,r))r.stopPropagation();else if(Zc(n,r),e&4&&-1<vy.indexOf(n)){for(;s!==null;){var i=Ks(s);if(i!==null&&sm(i),i=Sl(n,e,t,r),i===null&&xa(n,e,r,Zi,t),i===s)break;s=i}s!==null&&r.stopPropagation()}else xa(n,e,r,null,t)}}var Zi=null;function Sl(n,e,t,r){if(Zi=null,n=bu(r),n=Bn(n),n!==null)if(e=tr(n),e===null)n=null;else if(t=e.tag,t===13){if(n=Xh(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return Zi=n,null}function um(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(uy()){case _u:return 1;case em:return 4;case Xi:case cy:return 16;case tm:return 536870912;default:return 16}default:return 16}}var yn=null,Fu=null,Ii=null;function cm(){if(Ii)return Ii;var n,e=Fu,t=e.length,r,s="value"in yn?yn.value:yn.textContent,i=s.length;for(n=0;n<t&&e[n]===s[n];n++);var o=t-n;for(r=1;r<=o&&e[t-r]===s[i-r];r++);return Ii=s.slice(n,1<r?1-r:void 0)}function Di(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function ri(){return!0}function td(){return!1}function ut(n){function e(t,r,s,i,o){this._reactName=t,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?ri:td,this.isPropagationStopped=td,this}return ve(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=ri)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=ri)},persist:function(){},isPersistent:ri}),e}var Gr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Mu=ut(Gr),Vs=ve({},Gr,{view:0,detail:0}),Ly=ut(Vs),ca,da,Zr,Oo=ve({},Vs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Uu,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Zr&&(Zr&&n.type==="mousemove"?(ca=n.screenX-Zr.screenX,da=n.screenY-Zr.screenY):da=ca=0,Zr=n),ca)},movementY:function(n){return"movementY"in n?n.movementY:da}}),nd=ut(Oo),Ry=ve({},Oo,{dataTransfer:0}),Ay=ut(Ry),wy=ve({},Vs,{relatedTarget:0}),fa=ut(wy),Cy=ve({},Gr,{animationName:0,elapsedTime:0,pseudoElement:0}),Iy=ut(Cy),Dy=ve({},Gr,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),ky=ut(Dy),by=ve({},Gr,{data:0}),rd=ut(by),_y={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Py={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ny={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Oy(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=Ny[n])?!!e[n]:!1}function Uu(){return Oy}var Fy=ve({},Vs,{key:function(n){if(n.key){var e=_y[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Di(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?Py[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Uu,charCode:function(n){return n.type==="keypress"?Di(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Di(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),My=ut(Fy),Uy=ve({},Oo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),sd=ut(Uy),By=ve({},Vs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Uu}),$y=ut(By),jy=ve({},Gr,{propertyName:0,elapsedTime:0,pseudoElement:0}),Gy=ut(jy),Hy=ve({},Oo,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),Vy=ut(Hy),Ky=[9,13,27,32],Bu=rn&&"CompositionEvent"in window,ds=null;rn&&"documentMode"in document&&(ds=document.documentMode);var zy=rn&&"TextEvent"in window&&!ds,dm=rn&&(!Bu||ds&&8<ds&&11>=ds),id=" ",od=!1;function fm(n,e){switch(n){case"keyup":return Ky.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function hm(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var dr=!1;function Wy(n,e){switch(n){case"compositionend":return hm(e);case"keypress":return e.which!==32?null:(od=!0,id);case"textInput":return n=e.data,n===id&&od?null:n;default:return null}}function Yy(n,e){if(dr)return n==="compositionend"||!Bu&&fm(n,e)?(n=cm(),Ii=Fu=yn=null,dr=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return dm&&e.locale!=="ko"?null:e.data;default:return null}}var qy={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ad(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!qy[n.type]:e==="textarea"}function mm(n,e,t,r){Kh(r),e=eo(e,"onChange"),0<e.length&&(t=new Mu("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var fs=null,As=null;function Xy(n){Am(n,0)}function Fo(n){var e=mr(n);if(Uh(e))return n}function Qy(n,e){if(n==="change")return e}var pm=!1;if(rn){var ha;if(rn){var ma="oninput"in document;if(!ma){var ld=document.createElement("div");ld.setAttribute("oninput","return;"),ma=typeof ld.oninput=="function"}ha=ma}else ha=!1;pm=ha&&(!document.documentMode||9<document.documentMode)}function ud(){fs&&(fs.detachEvent("onpropertychange",gm),As=fs=null)}function gm(n){if(n.propertyName==="value"&&Fo(As)){var e=[];mm(e,As,n,bu(n)),qh(Xy,e)}}function Jy(n,e,t){n==="focusin"?(ud(),fs=e,As=t,fs.attachEvent("onpropertychange",gm)):n==="focusout"&&ud()}function Zy(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Fo(As)}function ev(n,e){if(n==="click")return Fo(e)}function tv(n,e){if(n==="input"||n==="change")return Fo(e)}function nv(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var bt=typeof Object.is=="function"?Object.is:nv;function ws(n,e){if(bt(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var s=t[r];if(!rl.call(e,s)||!bt(n[s],e[s]))return!1}return!0}function cd(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function dd(n,e){var t=cd(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=cd(t)}}function ym(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?ym(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function vm(){for(var n=window,e=Wi();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=Wi(n.document)}return e}function $u(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function rv(n){var e=vm(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&ym(t.ownerDocument.documentElement,t)){if(r!==null&&$u(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var s=t.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!n.extend&&i>r&&(s=r,r=i,i=s),s=dd(t,i);var o=dd(t,r);s&&o&&(n.rangeCount!==1||n.anchorNode!==s.node||n.anchorOffset!==s.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),n.removeAllRanges(),i>r?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var sv=rn&&"documentMode"in document&&11>=document.documentMode,fr=null,Tl=null,hs=null,Ll=!1;function fd(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;Ll||fr==null||fr!==Wi(r)||(r=fr,"selectionStart"in r&&$u(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),hs&&ws(hs,r)||(hs=r,r=eo(Tl,"onSelect"),0<r.length&&(e=new Mu("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=fr)))}function si(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var hr={animationend:si("Animation","AnimationEnd"),animationiteration:si("Animation","AnimationIteration"),animationstart:si("Animation","AnimationStart"),transitionend:si("Transition","TransitionEnd")},pa={},xm={};rn&&(xm=document.createElement("div").style,"AnimationEvent"in window||(delete hr.animationend.animation,delete hr.animationiteration.animation,delete hr.animationstart.animation),"TransitionEvent"in window||delete hr.transitionend.transition);function Mo(n){if(pa[n])return pa[n];if(!hr[n])return n;var e=hr[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in xm)return pa[n]=e[t];return n}var Em=Mo("animationend"),Sm=Mo("animationiteration"),Tm=Mo("animationstart"),Lm=Mo("transitionend"),Rm=new Map,hd="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function bn(n,e){Rm.set(n,e),er(e,[n])}for(var ga=0;ga<hd.length;ga++){var ya=hd[ga],iv=ya.toLowerCase(),ov=ya[0].toUpperCase()+ya.slice(1);bn(iv,"on"+ov)}bn(Em,"onAnimationEnd");bn(Sm,"onAnimationIteration");bn(Tm,"onAnimationStart");bn("dblclick","onDoubleClick");bn("focusin","onFocus");bn("focusout","onBlur");bn(Lm,"onTransitionEnd");kr("onMouseEnter",["mouseout","mouseover"]);kr("onMouseLeave",["mouseout","mouseover"]);kr("onPointerEnter",["pointerout","pointerover"]);kr("onPointerLeave",["pointerout","pointerover"]);er("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));er("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));er("onBeforeInput",["compositionend","keypress","textInput","paste"]);er("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));er("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));er("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ls="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),av=new Set("cancel close invalid load scroll toggle".split(" ").concat(ls));function md(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,iy(r,e,void 0,n),n.currentTarget=null}function Am(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==i&&s.isPropagationStopped())break e;md(s,a,u),i=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,u=a.currentTarget,a=a.listener,l!==i&&s.isPropagationStopped())break e;md(s,a,u),i=l}}}if(qi)throw n=vl,qi=!1,vl=null,n}function de(n,e){var t=e[Il];t===void 0&&(t=e[Il]=new Set);var r=n+"__bubble";t.has(r)||(wm(e,n,2,!1),t.add(r))}function va(n,e,t){var r=0;e&&(r|=4),wm(t,n,r,e)}var ii="_reactListening"+Math.random().toString(36).slice(2);function Cs(n){if(!n[ii]){n[ii]=!0,Ph.forEach(function(t){t!=="selectionchange"&&(av.has(t)||va(t,!1,n),va(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[ii]||(e[ii]=!0,va("selectionchange",!1,e))}}function wm(n,e,t,r){switch(um(e)){case 1:var s=Sy;break;case 4:s=Ty;break;default:s=Ou}t=s.bind(null,e,t,n),s=void 0,!yl||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?n.addEventListener(e,t,{capture:!0,passive:s}):n.addEventListener(e,t,!0):s!==void 0?n.addEventListener(e,t,{passive:s}):n.addEventListener(e,t,!1)}function xa(n,e,t,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;o=o.return}for(;a!==null;){if(o=Bn(a),o===null)return;if(l=o.tag,l===5||l===6){r=i=o;continue e}a=a.parentNode}}r=r.return}qh(function(){var u=i,c=bu(t),d=[];e:{var f=Rm.get(n);if(f!==void 0){var m=Mu,h=n;switch(n){case"keypress":if(Di(t)===0)break e;case"keydown":case"keyup":m=My;break;case"focusin":h="focus",m=fa;break;case"focusout":h="blur",m=fa;break;case"beforeblur":case"afterblur":m=fa;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=nd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=Ay;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=$y;break;case Em:case Sm:case Tm:m=Iy;break;case Lm:m=Gy;break;case"scroll":m=Ly;break;case"wheel":m=Vy;break;case"copy":case"cut":case"paste":m=ky;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=sd}var p=(e&4)!==0,y=!p&&n==="scroll",g=p?f!==null?f+"Capture":null:f;p=[];for(var v=u,x;v!==null;){x=v;var L=x.stateNode;if(x.tag===5&&L!==null&&(x=L,g!==null&&(L=Ss(v,g),L!=null&&p.push(Is(v,L,x)))),y)break;v=v.return}0<p.length&&(f=new m(f,h,null,t,c),d.push({event:f,listeners:p}))}}if(!(e&7)){e:{if(f=n==="mouseover"||n==="pointerover",m=n==="mouseout"||n==="pointerout",f&&t!==pl&&(h=t.relatedTarget||t.fromElement)&&(Bn(h)||h[sn]))break e;if((m||f)&&(f=c.window===c?c:(f=c.ownerDocument)?f.defaultView||f.parentWindow:window,m?(h=t.relatedTarget||t.toElement,m=u,h=h?Bn(h):null,h!==null&&(y=tr(h),h!==y||h.tag!==5&&h.tag!==6)&&(h=null)):(m=null,h=u),m!==h)){if(p=nd,L="onMouseLeave",g="onMouseEnter",v="mouse",(n==="pointerout"||n==="pointerover")&&(p=sd,L="onPointerLeave",g="onPointerEnter",v="pointer"),y=m==null?f:mr(m),x=h==null?f:mr(h),f=new p(L,v+"leave",m,t,c),f.target=y,f.relatedTarget=x,L=null,Bn(c)===u&&(p=new p(g,v+"enter",h,t,c),p.target=x,p.relatedTarget=y,L=p),y=L,m&&h)t:{for(p=m,g=h,v=0,x=p;x;x=rr(x))v++;for(x=0,L=g;L;L=rr(L))x++;for(;0<v-x;)p=rr(p),v--;for(;0<x-v;)g=rr(g),x--;for(;v--;){if(p===g||g!==null&&p===g.alternate)break t;p=rr(p),g=rr(g)}p=null}else p=null;m!==null&&pd(d,f,m,p,!1),h!==null&&y!==null&&pd(d,y,h,p,!0)}}e:{if(f=u?mr(u):window,m=f.nodeName&&f.nodeName.toLowerCase(),m==="select"||m==="input"&&f.type==="file")var T=Qy;else if(ad(f))if(pm)T=tv;else{T=Zy;var A=Jy}else(m=f.nodeName)&&m.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(T=ev);if(T&&(T=T(n,u))){mm(d,T,t,c);break e}A&&A(n,f,u),n==="focusout"&&(A=f._wrapperState)&&A.controlled&&f.type==="number"&&cl(f,"number",f.value)}switch(A=u?mr(u):window,n){case"focusin":(ad(A)||A.contentEditable==="true")&&(fr=A,Tl=u,hs=null);break;case"focusout":hs=Tl=fr=null;break;case"mousedown":Ll=!0;break;case"contextmenu":case"mouseup":case"dragend":Ll=!1,fd(d,t,c);break;case"selectionchange":if(sv)break;case"keydown":case"keyup":fd(d,t,c)}var R;if(Bu)e:{switch(n){case"compositionstart":var I="onCompositionStart";break e;case"compositionend":I="onCompositionEnd";break e;case"compositionupdate":I="onCompositionUpdate";break e}I=void 0}else dr?fm(n,t)&&(I="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(I="onCompositionStart");I&&(dm&&t.locale!=="ko"&&(dr||I!=="onCompositionStart"?I==="onCompositionEnd"&&dr&&(R=cm()):(yn=c,Fu="value"in yn?yn.value:yn.textContent,dr=!0)),A=eo(u,I),0<A.length&&(I=new rd(I,n,null,t,c),d.push({event:I,listeners:A}),R?I.data=R:(R=hm(t),R!==null&&(I.data=R)))),(R=zy?Wy(n,t):Yy(n,t))&&(u=eo(u,"onBeforeInput"),0<u.length&&(c=new rd("onBeforeInput","beforeinput",null,t,c),d.push({event:c,listeners:u}),c.data=R))}Am(d,e)})}function Is(n,e,t){return{instance:n,listener:e,currentTarget:t}}function eo(n,e){for(var t=e+"Capture",r=[];n!==null;){var s=n,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Ss(n,t),i!=null&&r.unshift(Is(n,i,s)),i=Ss(n,e),i!=null&&r.push(Is(n,i,s))),n=n.return}return r}function rr(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function pd(n,e,t,r,s){for(var i=e._reactName,o=[];t!==null&&t!==r;){var a=t,l=a.alternate,u=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&u!==null&&(a=u,s?(l=Ss(t,i),l!=null&&o.unshift(Is(t,l,a))):s||(l=Ss(t,i),l!=null&&o.push(Is(t,l,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var lv=/\r\n?/g,uv=/\u0000|\uFFFD/g;function gd(n){return(typeof n=="string"?n:""+n).replace(lv,`
`).replace(uv,"")}function oi(n,e,t){if(e=gd(e),gd(n)!==e&&t)throw Error(B(425))}function to(){}var Rl=null,Al=null;function wl(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Cl=typeof setTimeout=="function"?setTimeout:void 0,cv=typeof clearTimeout=="function"?clearTimeout:void 0,yd=typeof Promise=="function"?Promise:void 0,dv=typeof queueMicrotask=="function"?queueMicrotask:typeof yd<"u"?function(n){return yd.resolve(null).then(n).catch(fv)}:Cl;function fv(n){setTimeout(function(){throw n})}function Ea(n,e){var t=e,r=0;do{var s=t.nextSibling;if(n.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(r===0){n.removeChild(s),Rs(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=s}while(t);Rs(e)}function Ln(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function vd(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Hr=Math.random().toString(36).slice(2),Bt="__reactFiber$"+Hr,Ds="__reactProps$"+Hr,sn="__reactContainer$"+Hr,Il="__reactEvents$"+Hr,hv="__reactListeners$"+Hr,mv="__reactHandles$"+Hr;function Bn(n){var e=n[Bt];if(e)return e;for(var t=n.parentNode;t;){if(e=t[sn]||t[Bt]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=vd(n);n!==null;){if(t=n[Bt])return t;n=vd(n)}return e}n=t,t=n.parentNode}return null}function Ks(n){return n=n[Bt]||n[sn],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function mr(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(B(33))}function Uo(n){return n[Ds]||null}var Dl=[],pr=-1;function _n(n){return{current:n}}function fe(n){0>pr||(n.current=Dl[pr],Dl[pr]=null,pr--)}function ue(n,e){pr++,Dl[pr]=n.current,n.current=e}var kn={},Ve=_n(kn),Ze=_n(!1),Wn=kn;function br(n,e){var t=n.type.contextTypes;if(!t)return kn;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in t)s[i]=e[i];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=s),s}function et(n){return n=n.childContextTypes,n!=null}function no(){fe(Ze),fe(Ve)}function xd(n,e,t){if(Ve.current!==kn)throw Error(B(168));ue(Ve,e),ue(Ze,t)}function Cm(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(B(108,J0(n)||"Unknown",s));return ve({},t,r)}function ro(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||kn,Wn=Ve.current,ue(Ve,n),ue(Ze,Ze.current),!0}function Ed(n,e,t){var r=n.stateNode;if(!r)throw Error(B(169));t?(n=Cm(n,e,Wn),r.__reactInternalMemoizedMergedChildContext=n,fe(Ze),fe(Ve),ue(Ve,n)):fe(Ze),ue(Ze,t)}var Zt=null,Bo=!1,Sa=!1;function Im(n){Zt===null?Zt=[n]:Zt.push(n)}function pv(n){Bo=!0,Im(n)}function Pn(){if(!Sa&&Zt!==null){Sa=!0;var n=0,e=oe;try{var t=Zt;for(oe=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}Zt=null,Bo=!1}catch(s){throw Zt!==null&&(Zt=Zt.slice(n+1)),Zh(_u,Pn),s}finally{oe=e,Sa=!1}}return null}var gr=[],yr=0,so=null,io=0,ht=[],mt=0,Yn=null,en=1,tn="";function Fn(n,e){gr[yr++]=io,gr[yr++]=so,so=n,io=e}function Dm(n,e,t){ht[mt++]=en,ht[mt++]=tn,ht[mt++]=Yn,Yn=n;var r=en;n=tn;var s=32-It(r)-1;r&=~(1<<s),t+=1;var i=32-It(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,en=1<<32-It(e)+s|t<<s|r,tn=i+n}else en=1<<i|t<<s|r,tn=n}function ju(n){n.return!==null&&(Fn(n,1),Dm(n,1,0))}function Gu(n){for(;n===so;)so=gr[--yr],gr[yr]=null,io=gr[--yr],gr[yr]=null;for(;n===Yn;)Yn=ht[--mt],ht[mt]=null,tn=ht[--mt],ht[mt]=null,en=ht[--mt],ht[mt]=null}var ot=null,it=null,he=!1,wt=null;function km(n,e){var t=pt(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function Sd(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,ot=n,it=Ln(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,ot=n,it=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Yn!==null?{id:en,overflow:tn}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=pt(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,ot=n,it=null,!0):!1;default:return!1}}function kl(n){return(n.mode&1)!==0&&(n.flags&128)===0}function bl(n){if(he){var e=it;if(e){var t=e;if(!Sd(n,e)){if(kl(n))throw Error(B(418));e=Ln(t.nextSibling);var r=ot;e&&Sd(n,e)?km(r,t):(n.flags=n.flags&-4097|2,he=!1,ot=n)}}else{if(kl(n))throw Error(B(418));n.flags=n.flags&-4097|2,he=!1,ot=n}}}function Td(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;ot=n}function ai(n){if(n!==ot)return!1;if(!he)return Td(n),he=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!wl(n.type,n.memoizedProps)),e&&(e=it)){if(kl(n))throw bm(),Error(B(418));for(;e;)km(n,e),e=Ln(e.nextSibling)}if(Td(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(B(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){it=Ln(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}it=null}}else it=ot?Ln(n.stateNode.nextSibling):null;return!0}function bm(){for(var n=it;n;)n=Ln(n.nextSibling)}function _r(){it=ot=null,he=!1}function Hu(n){wt===null?wt=[n]:wt.push(n)}var gv=ln.ReactCurrentBatchConfig;function es(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(B(309));var r=t.stateNode}if(!r)throw Error(B(147,n));var s=r,i=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof n!="string")throw Error(B(284));if(!t._owner)throw Error(B(290,n))}return n}function li(n,e){throw n=Object.prototype.toString.call(e),Error(B(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function Ld(n){var e=n._init;return e(n._payload)}function _m(n){function e(g,v){if(n){var x=g.deletions;x===null?(g.deletions=[v],g.flags|=16):x.push(v)}}function t(g,v){if(!n)return null;for(;v!==null;)e(g,v),v=v.sibling;return null}function r(g,v){for(g=new Map;v!==null;)v.key!==null?g.set(v.key,v):g.set(v.index,v),v=v.sibling;return g}function s(g,v){return g=Cn(g,v),g.index=0,g.sibling=null,g}function i(g,v,x){return g.index=x,n?(x=g.alternate,x!==null?(x=x.index,x<v?(g.flags|=2,v):x):(g.flags|=2,v)):(g.flags|=1048576,v)}function o(g){return n&&g.alternate===null&&(g.flags|=2),g}function a(g,v,x,L){return v===null||v.tag!==6?(v=Ia(x,g.mode,L),v.return=g,v):(v=s(v,x),v.return=g,v)}function l(g,v,x,L){var T=x.type;return T===cr?c(g,v,x.props.children,L,x.key):v!==null&&(v.elementType===T||typeof T=="object"&&T!==null&&T.$$typeof===fn&&Ld(T)===v.type)?(L=s(v,x.props),L.ref=es(g,v,x),L.return=g,L):(L=Fi(x.type,x.key,x.props,null,g.mode,L),L.ref=es(g,v,x),L.return=g,L)}function u(g,v,x,L){return v===null||v.tag!==4||v.stateNode.containerInfo!==x.containerInfo||v.stateNode.implementation!==x.implementation?(v=Da(x,g.mode,L),v.return=g,v):(v=s(v,x.children||[]),v.return=g,v)}function c(g,v,x,L,T){return v===null||v.tag!==7?(v=Vn(x,g.mode,L,T),v.return=g,v):(v=s(v,x),v.return=g,v)}function d(g,v,x){if(typeof v=="string"&&v!==""||typeof v=="number")return v=Ia(""+v,g.mode,x),v.return=g,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Qs:return x=Fi(v.type,v.key,v.props,null,g.mode,x),x.ref=es(g,null,v),x.return=g,x;case ur:return v=Da(v,g.mode,x),v.return=g,v;case fn:var L=v._init;return d(g,L(v._payload),x)}if(os(v)||qr(v))return v=Vn(v,g.mode,x,null),v.return=g,v;li(g,v)}return null}function f(g,v,x,L){var T=v!==null?v.key:null;if(typeof x=="string"&&x!==""||typeof x=="number")return T!==null?null:a(g,v,""+x,L);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Qs:return x.key===T?l(g,v,x,L):null;case ur:return x.key===T?u(g,v,x,L):null;case fn:return T=x._init,f(g,v,T(x._payload),L)}if(os(x)||qr(x))return T!==null?null:c(g,v,x,L,null);li(g,x)}return null}function m(g,v,x,L,T){if(typeof L=="string"&&L!==""||typeof L=="number")return g=g.get(x)||null,a(v,g,""+L,T);if(typeof L=="object"&&L!==null){switch(L.$$typeof){case Qs:return g=g.get(L.key===null?x:L.key)||null,l(v,g,L,T);case ur:return g=g.get(L.key===null?x:L.key)||null,u(v,g,L,T);case fn:var A=L._init;return m(g,v,x,A(L._payload),T)}if(os(L)||qr(L))return g=g.get(x)||null,c(v,g,L,T,null);li(v,L)}return null}function h(g,v,x,L){for(var T=null,A=null,R=v,I=v=0,M=null;R!==null&&I<x.length;I++){R.index>I?(M=R,R=null):M=R.sibling;var D=f(g,R,x[I],L);if(D===null){R===null&&(R=M);break}n&&R&&D.alternate===null&&e(g,R),v=i(D,v,I),A===null?T=D:A.sibling=D,A=D,R=M}if(I===x.length)return t(g,R),he&&Fn(g,I),T;if(R===null){for(;I<x.length;I++)R=d(g,x[I],L),R!==null&&(v=i(R,v,I),A===null?T=R:A.sibling=R,A=R);return he&&Fn(g,I),T}for(R=r(g,R);I<x.length;I++)M=m(R,g,I,x[I],L),M!==null&&(n&&M.alternate!==null&&R.delete(M.key===null?I:M.key),v=i(M,v,I),A===null?T=M:A.sibling=M,A=M);return n&&R.forEach(function(F){return e(g,F)}),he&&Fn(g,I),T}function p(g,v,x,L){var T=qr(x);if(typeof T!="function")throw Error(B(150));if(x=T.call(x),x==null)throw Error(B(151));for(var A=T=null,R=v,I=v=0,M=null,D=x.next();R!==null&&!D.done;I++,D=x.next()){R.index>I?(M=R,R=null):M=R.sibling;var F=f(g,R,D.value,L);if(F===null){R===null&&(R=M);break}n&&R&&F.alternate===null&&e(g,R),v=i(F,v,I),A===null?T=F:A.sibling=F,A=F,R=M}if(D.done)return t(g,R),he&&Fn(g,I),T;if(R===null){for(;!D.done;I++,D=x.next())D=d(g,D.value,L),D!==null&&(v=i(D,v,I),A===null?T=D:A.sibling=D,A=D);return he&&Fn(g,I),T}for(R=r(g,R);!D.done;I++,D=x.next())D=m(R,g,I,D.value,L),D!==null&&(n&&D.alternate!==null&&R.delete(D.key===null?I:D.key),v=i(D,v,I),A===null?T=D:A.sibling=D,A=D);return n&&R.forEach(function(Y){return e(g,Y)}),he&&Fn(g,I),T}function y(g,v,x,L){if(typeof x=="object"&&x!==null&&x.type===cr&&x.key===null&&(x=x.props.children),typeof x=="object"&&x!==null){switch(x.$$typeof){case Qs:e:{for(var T=x.key,A=v;A!==null;){if(A.key===T){if(T=x.type,T===cr){if(A.tag===7){t(g,A.sibling),v=s(A,x.props.children),v.return=g,g=v;break e}}else if(A.elementType===T||typeof T=="object"&&T!==null&&T.$$typeof===fn&&Ld(T)===A.type){t(g,A.sibling),v=s(A,x.props),v.ref=es(g,A,x),v.return=g,g=v;break e}t(g,A);break}else e(g,A);A=A.sibling}x.type===cr?(v=Vn(x.props.children,g.mode,L,x.key),v.return=g,g=v):(L=Fi(x.type,x.key,x.props,null,g.mode,L),L.ref=es(g,v,x),L.return=g,g=L)}return o(g);case ur:e:{for(A=x.key;v!==null;){if(v.key===A)if(v.tag===4&&v.stateNode.containerInfo===x.containerInfo&&v.stateNode.implementation===x.implementation){t(g,v.sibling),v=s(v,x.children||[]),v.return=g,g=v;break e}else{t(g,v);break}else e(g,v);v=v.sibling}v=Da(x,g.mode,L),v.return=g,g=v}return o(g);case fn:return A=x._init,y(g,v,A(x._payload),L)}if(os(x))return h(g,v,x,L);if(qr(x))return p(g,v,x,L);li(g,x)}return typeof x=="string"&&x!==""||typeof x=="number"?(x=""+x,v!==null&&v.tag===6?(t(g,v.sibling),v=s(v,x),v.return=g,g=v):(t(g,v),v=Ia(x,g.mode,L),v.return=g,g=v),o(g)):t(g,v)}return y}var Pr=_m(!0),Pm=_m(!1),oo=_n(null),ao=null,vr=null,Vu=null;function Ku(){Vu=vr=ao=null}function zu(n){var e=oo.current;fe(oo),n._currentValue=e}function _l(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function wr(n,e){ao=n,Vu=vr=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(Je=!0),n.firstContext=null)}function vt(n){var e=n._currentValue;if(Vu!==n)if(n={context:n,memoizedValue:e,next:null},vr===null){if(ao===null)throw Error(B(308));vr=n,ao.dependencies={lanes:0,firstContext:n}}else vr=vr.next=n;return e}var $n=null;function Wu(n){$n===null?$n=[n]:$n.push(n)}function Nm(n,e,t,r){var s=e.interleaved;return s===null?(t.next=t,Wu(e)):(t.next=s.next,s.next=t),e.interleaved=t,on(n,r)}function on(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var hn=!1;function Yu(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Om(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function nn(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Rn(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,se&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,on(n,t)}return s=r.interleaved,s===null?(e.next=e,Wu(r)):(e.next=s.next,s.next=e),r.interleaved=e,on(n,t)}function ki(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,Pu(n,t)}}function Rd(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var s=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?s=i=o:i=i.next=o,t=t.next}while(t!==null);i===null?s=i=e:i=i.next=e}else s=i=e;t={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function lo(n,e,t,r){var s=n.updateQueue;hn=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var l=a,u=l.next;l.next=null,o===null?i=u:o.next=u,o=l;var c=n.alternate;c!==null&&(c=c.updateQueue,a=c.lastBaseUpdate,a!==o&&(a===null?c.firstBaseUpdate=u:a.next=u,c.lastBaseUpdate=l))}if(i!==null){var d=s.baseState;o=0,c=u=l=null,a=i;do{var f=a.lane,m=a.eventTime;if((r&f)===f){c!==null&&(c=c.next={eventTime:m,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var h=n,p=a;switch(f=e,m=t,p.tag){case 1:if(h=p.payload,typeof h=="function"){d=h.call(m,d,f);break e}d=h;break e;case 3:h.flags=h.flags&-65537|128;case 0:if(h=p.payload,f=typeof h=="function"?h.call(m,d,f):h,f==null)break e;d=ve({},d,f);break e;case 2:hn=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,f=s.effects,f===null?s.effects=[a]:f.push(a))}else m={eventTime:m,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},c===null?(u=c=m,l=d):c=c.next=m,o|=f;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;f=a,a=f.next,f.next=null,s.lastBaseUpdate=f,s.shared.pending=null}}while(!0);if(c===null&&(l=d),s.baseState=l,s.firstBaseUpdate=u,s.lastBaseUpdate=c,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Xn|=o,n.lanes=o,n.memoizedState=d}}function Ad(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],s=r.callback;if(s!==null){if(r.callback=null,r=t,typeof s!="function")throw Error(B(191,s));s.call(r)}}}var zs={},Vt=_n(zs),ks=_n(zs),bs=_n(zs);function jn(n){if(n===zs)throw Error(B(174));return n}function qu(n,e){switch(ue(bs,e),ue(ks,n),ue(Vt,zs),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:fl(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=fl(e,n)}fe(Vt),ue(Vt,e)}function Nr(){fe(Vt),fe(ks),fe(bs)}function Fm(n){jn(bs.current);var e=jn(Vt.current),t=fl(e,n.type);e!==t&&(ue(ks,n),ue(Vt,t))}function Xu(n){ks.current===n&&(fe(Vt),fe(ks))}var ge=_n(0);function uo(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Ta=[];function Qu(){for(var n=0;n<Ta.length;n++)Ta[n]._workInProgressVersionPrimary=null;Ta.length=0}var bi=ln.ReactCurrentDispatcher,La=ln.ReactCurrentBatchConfig,qn=0,ye=null,Ce=null,ke=null,co=!1,ms=!1,_s=0,yv=0;function Be(){throw Error(B(321))}function Ju(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!bt(n[t],e[t]))return!1;return!0}function Zu(n,e,t,r,s,i){if(qn=i,ye=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,bi.current=n===null||n.memoizedState===null?Sv:Tv,n=t(r,s),ms){i=0;do{if(ms=!1,_s=0,25<=i)throw Error(B(301));i+=1,ke=Ce=null,e.updateQueue=null,bi.current=Lv,n=t(r,s)}while(ms)}if(bi.current=fo,e=Ce!==null&&Ce.next!==null,qn=0,ke=Ce=ye=null,co=!1,e)throw Error(B(300));return n}function ec(){var n=_s!==0;return _s=0,n}function Ft(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ke===null?ye.memoizedState=ke=n:ke=ke.next=n,ke}function xt(){if(Ce===null){var n=ye.alternate;n=n!==null?n.memoizedState:null}else n=Ce.next;var e=ke===null?ye.memoizedState:ke.next;if(e!==null)ke=e,Ce=n;else{if(n===null)throw Error(B(310));Ce=n,n={memoizedState:Ce.memoizedState,baseState:Ce.baseState,baseQueue:Ce.baseQueue,queue:Ce.queue,next:null},ke===null?ye.memoizedState=ke=n:ke=ke.next=n}return ke}function Ps(n,e){return typeof e=="function"?e(n):e}function Ra(n){var e=xt(),t=e.queue;if(t===null)throw Error(B(311));t.lastRenderedReducer=n;var r=Ce,s=r.baseQueue,i=t.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,t.pending=null}if(s!==null){i=s.next,r=r.baseState;var a=o=null,l=null,u=i;do{var c=u.lane;if((qn&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:n(r,u.action);else{var d={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=d,o=r):l=l.next=d,ye.lanes|=c,Xn|=c}u=u.next}while(u!==null&&u!==i);l===null?o=r:l.next=a,bt(r,e.memoizedState)||(Je=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,t.lastRenderedState=r}if(n=t.interleaved,n!==null){s=n;do i=s.lane,ye.lanes|=i,Xn|=i,s=s.next;while(s!==n)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function Aa(n){var e=xt(),t=e.queue;if(t===null)throw Error(B(311));t.lastRenderedReducer=n;var r=t.dispatch,s=t.pending,i=e.memoizedState;if(s!==null){t.pending=null;var o=s=s.next;do i=n(i,o.action),o=o.next;while(o!==s);bt(i,e.memoizedState)||(Je=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,r]}function Mm(){}function Um(n,e){var t=ye,r=xt(),s=e(),i=!bt(r.memoizedState,s);if(i&&(r.memoizedState=s,Je=!0),r=r.queue,tc(jm.bind(null,t,r,n),[n]),r.getSnapshot!==e||i||ke!==null&&ke.memoizedState.tag&1){if(t.flags|=2048,Ns(9,$m.bind(null,t,r,s,e),void 0,null),_e===null)throw Error(B(349));qn&30||Bm(t,e,s)}return s}function Bm(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=ye.updateQueue,e===null?(e={lastEffect:null,stores:null},ye.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function $m(n,e,t,r){e.value=t,e.getSnapshot=r,Gm(e)&&Hm(n)}function jm(n,e,t){return t(function(){Gm(e)&&Hm(n)})}function Gm(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!bt(n,t)}catch{return!0}}function Hm(n){var e=on(n,1);e!==null&&Dt(e,n,1,-1)}function wd(n){var e=Ft();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ps,lastRenderedState:n},e.queue=n,n=n.dispatch=Ev.bind(null,ye,n),[e.memoizedState,n]}function Ns(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=ye.updateQueue,e===null?(e={lastEffect:null,stores:null},ye.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function Vm(){return xt().memoizedState}function _i(n,e,t,r){var s=Ft();ye.flags|=n,s.memoizedState=Ns(1|e,t,void 0,r===void 0?null:r)}function $o(n,e,t,r){var s=xt();r=r===void 0?null:r;var i=void 0;if(Ce!==null){var o=Ce.memoizedState;if(i=o.destroy,r!==null&&Ju(r,o.deps)){s.memoizedState=Ns(e,t,i,r);return}}ye.flags|=n,s.memoizedState=Ns(1|e,t,i,r)}function Cd(n,e){return _i(8390656,8,n,e)}function tc(n,e){return $o(2048,8,n,e)}function Km(n,e){return $o(4,2,n,e)}function zm(n,e){return $o(4,4,n,e)}function Wm(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function Ym(n,e,t){return t=t!=null?t.concat([n]):null,$o(4,4,Wm.bind(null,e,n),t)}function nc(){}function qm(n,e){var t=xt();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&Ju(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function Xm(n,e){var t=xt();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&Ju(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function Qm(n,e,t){return qn&21?(bt(t,e)||(t=nm(),ye.lanes|=t,Xn|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,Je=!0),n.memoizedState=t)}function vv(n,e){var t=oe;oe=t!==0&&4>t?t:4,n(!0);var r=La.transition;La.transition={};try{n(!1),e()}finally{oe=t,La.transition=r}}function Jm(){return xt().memoizedState}function xv(n,e,t){var r=wn(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},Zm(n))ep(e,t);else if(t=Nm(n,e,t,r),t!==null){var s=ze();Dt(t,n,r,s),tp(t,e,r)}}function Ev(n,e,t){var r=wn(n),s={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(Zm(n))ep(e,s);else{var i=n.alternate;if(n.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,t);if(s.hasEagerState=!0,s.eagerState=a,bt(a,o)){var l=e.interleaved;l===null?(s.next=s,Wu(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}t=Nm(n,e,s,r),t!==null&&(s=ze(),Dt(t,n,r,s),tp(t,e,r))}}function Zm(n){var e=n.alternate;return n===ye||e!==null&&e===ye}function ep(n,e){ms=co=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function tp(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,Pu(n,t)}}var fo={readContext:vt,useCallback:Be,useContext:Be,useEffect:Be,useImperativeHandle:Be,useInsertionEffect:Be,useLayoutEffect:Be,useMemo:Be,useReducer:Be,useRef:Be,useState:Be,useDebugValue:Be,useDeferredValue:Be,useTransition:Be,useMutableSource:Be,useSyncExternalStore:Be,useId:Be,unstable_isNewReconciler:!1},Sv={readContext:vt,useCallback:function(n,e){return Ft().memoizedState=[n,e===void 0?null:e],n},useContext:vt,useEffect:Cd,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,_i(4194308,4,Wm.bind(null,e,n),t)},useLayoutEffect:function(n,e){return _i(4194308,4,n,e)},useInsertionEffect:function(n,e){return _i(4,2,n,e)},useMemo:function(n,e){var t=Ft();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=Ft();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=xv.bind(null,ye,n),[r.memoizedState,n]},useRef:function(n){var e=Ft();return n={current:n},e.memoizedState=n},useState:wd,useDebugValue:nc,useDeferredValue:function(n){return Ft().memoizedState=n},useTransition:function(){var n=wd(!1),e=n[0];return n=vv.bind(null,n[1]),Ft().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=ye,s=Ft();if(he){if(t===void 0)throw Error(B(407));t=t()}else{if(t=e(),_e===null)throw Error(B(349));qn&30||Bm(r,e,t)}s.memoizedState=t;var i={value:t,getSnapshot:e};return s.queue=i,Cd(jm.bind(null,r,i,n),[n]),r.flags|=2048,Ns(9,$m.bind(null,r,i,t,e),void 0,null),t},useId:function(){var n=Ft(),e=_e.identifierPrefix;if(he){var t=tn,r=en;t=(r&~(1<<32-It(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=_s++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=yv++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},Tv={readContext:vt,useCallback:qm,useContext:vt,useEffect:tc,useImperativeHandle:Ym,useInsertionEffect:Km,useLayoutEffect:zm,useMemo:Xm,useReducer:Ra,useRef:Vm,useState:function(){return Ra(Ps)},useDebugValue:nc,useDeferredValue:function(n){var e=xt();return Qm(e,Ce.memoizedState,n)},useTransition:function(){var n=Ra(Ps)[0],e=xt().memoizedState;return[n,e]},useMutableSource:Mm,useSyncExternalStore:Um,useId:Jm,unstable_isNewReconciler:!1},Lv={readContext:vt,useCallback:qm,useContext:vt,useEffect:tc,useImperativeHandle:Ym,useInsertionEffect:Km,useLayoutEffect:zm,useMemo:Xm,useReducer:Aa,useRef:Vm,useState:function(){return Aa(Ps)},useDebugValue:nc,useDeferredValue:function(n){var e=xt();return Ce===null?e.memoizedState=n:Qm(e,Ce.memoizedState,n)},useTransition:function(){var n=Aa(Ps)[0],e=xt().memoizedState;return[n,e]},useMutableSource:Mm,useSyncExternalStore:Um,useId:Jm,unstable_isNewReconciler:!1};function Rt(n,e){if(n&&n.defaultProps){e=ve({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function Pl(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:ve({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var jo={isMounted:function(n){return(n=n._reactInternals)?tr(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=ze(),s=wn(n),i=nn(r,s);i.payload=e,t!=null&&(i.callback=t),e=Rn(n,i,s),e!==null&&(Dt(e,n,s,r),ki(e,n,s))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=ze(),s=wn(n),i=nn(r,s);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=Rn(n,i,s),e!==null&&(Dt(e,n,s,r),ki(e,n,s))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=ze(),r=wn(n),s=nn(t,r);s.tag=2,e!=null&&(s.callback=e),e=Rn(n,s,r),e!==null&&(Dt(e,n,r,t),ki(e,n,r))}};function Id(n,e,t,r,s,i,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!ws(t,r)||!ws(s,i):!0}function np(n,e,t){var r=!1,s=kn,i=e.contextType;return typeof i=="object"&&i!==null?i=vt(i):(s=et(e)?Wn:Ve.current,r=e.contextTypes,i=(r=r!=null)?br(n,s):kn),e=new e(t,i),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=jo,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=s,n.__reactInternalMemoizedMaskedChildContext=i),e}function Dd(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&jo.enqueueReplaceState(e,e.state,null)}function Nl(n,e,t,r){var s=n.stateNode;s.props=t,s.state=n.memoizedState,s.refs={},Yu(n);var i=e.contextType;typeof i=="object"&&i!==null?s.context=vt(i):(i=et(e)?Wn:Ve.current,s.context=br(n,i)),s.state=n.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(Pl(n,e,i,t),s.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&jo.enqueueReplaceState(s,s.state,null),lo(n,t,s,r),s.state=n.memoizedState),typeof s.componentDidMount=="function"&&(n.flags|=4194308)}function Or(n,e){try{var t="",r=e;do t+=Q0(r),r=r.return;while(r);var s=t}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:n,source:e,stack:s,digest:null}}function wa(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function Ol(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var Rv=typeof WeakMap=="function"?WeakMap:Map;function rp(n,e,t){t=nn(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){mo||(mo=!0,Kl=r),Ol(n,e)},t}function sp(n,e,t){t=nn(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;t.payload=function(){return r(s)},t.callback=function(){Ol(n,e)}}var i=n.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){Ol(n,e),typeof r!="function"&&(An===null?An=new Set([this]):An.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function kd(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new Rv;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(t)||(s.add(t),n=Uv.bind(null,n,e,t),e.then(n,n))}function bd(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function _d(n,e,t,r,s){return n.mode&1?(n.flags|=65536,n.lanes=s,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=nn(-1,1),e.tag=2,Rn(t,e,1))),t.lanes|=1),n)}var Av=ln.ReactCurrentOwner,Je=!1;function Ke(n,e,t,r){e.child=n===null?Pm(e,null,t,r):Pr(e,n.child,t,r)}function Pd(n,e,t,r,s){t=t.render;var i=e.ref;return wr(e,s),r=Zu(n,e,t,r,i,s),t=ec(),n!==null&&!Je?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,an(n,e,s)):(he&&t&&ju(e),e.flags|=1,Ke(n,e,r,s),e.child)}function Nd(n,e,t,r,s){if(n===null){var i=t.type;return typeof i=="function"&&!cc(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,ip(n,e,i,r,s)):(n=Fi(t.type,null,r,e,e.mode,s),n.ref=e.ref,n.return=e,e.child=n)}if(i=n.child,!(n.lanes&s)){var o=i.memoizedProps;if(t=t.compare,t=t!==null?t:ws,t(o,r)&&n.ref===e.ref)return an(n,e,s)}return e.flags|=1,n=Cn(i,r),n.ref=e.ref,n.return=e,e.child=n}function ip(n,e,t,r,s){if(n!==null){var i=n.memoizedProps;if(ws(i,r)&&n.ref===e.ref)if(Je=!1,e.pendingProps=r=i,(n.lanes&s)!==0)n.flags&131072&&(Je=!0);else return e.lanes=n.lanes,an(n,e,s)}return Fl(n,e,t,r,s)}function op(n,e,t){var r=e.pendingProps,s=r.children,i=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ue(Er,st),st|=t;else{if(!(t&1073741824))return n=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,ue(Er,st),st|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:t,ue(Er,st),st|=r}else i!==null?(r=i.baseLanes|t,e.memoizedState=null):r=t,ue(Er,st),st|=r;return Ke(n,e,s,t),e.child}function ap(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function Fl(n,e,t,r,s){var i=et(t)?Wn:Ve.current;return i=br(e,i),wr(e,s),t=Zu(n,e,t,r,i,s),r=ec(),n!==null&&!Je?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,an(n,e,s)):(he&&r&&ju(e),e.flags|=1,Ke(n,e,t,s),e.child)}function Od(n,e,t,r,s){if(et(t)){var i=!0;ro(e)}else i=!1;if(wr(e,s),e.stateNode===null)Pi(n,e),np(e,t,r),Nl(e,t,r,s),r=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,u=t.contextType;typeof u=="object"&&u!==null?u=vt(u):(u=et(t)?Wn:Ve.current,u=br(e,u));var c=t.getDerivedStateFromProps,d=typeof c=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==u)&&Dd(e,o,r,u),hn=!1;var f=e.memoizedState;o.state=f,lo(e,r,o,s),l=e.memoizedState,a!==r||f!==l||Ze.current||hn?(typeof c=="function"&&(Pl(e,t,c,r),l=e.memoizedState),(a=hn||Id(e,t,a,r,f,l,u))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=u,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,Om(n,e),a=e.memoizedProps,u=e.type===e.elementType?a:Rt(e.type,a),o.props=u,d=e.pendingProps,f=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=vt(l):(l=et(t)?Wn:Ve.current,l=br(e,l));var m=t.getDerivedStateFromProps;(c=typeof m=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||f!==l)&&Dd(e,o,r,l),hn=!1,f=e.memoizedState,o.state=f,lo(e,r,o,s);var h=e.memoizedState;a!==d||f!==h||Ze.current||hn?(typeof m=="function"&&(Pl(e,t,m,r),h=e.memoizedState),(u=hn||Id(e,t,u,r,f,h,l)||!1)?(c||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,h,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,h,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=h),o.props=r,o.state=h,o.context=l,r=u):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),r=!1)}return Ml(n,e,t,r,i,s)}function Ml(n,e,t,r,s,i){ap(n,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&Ed(e,t,!1),an(n,e,i);r=e.stateNode,Av.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&o?(e.child=Pr(e,n.child,null,i),e.child=Pr(e,null,a,i)):Ke(n,e,a,i),e.memoizedState=r.state,s&&Ed(e,t,!0),e.child}function lp(n){var e=n.stateNode;e.pendingContext?xd(n,e.pendingContext,e.pendingContext!==e.context):e.context&&xd(n,e.context,!1),qu(n,e.containerInfo)}function Fd(n,e,t,r,s){return _r(),Hu(s),e.flags|=256,Ke(n,e,t,r),e.child}var Ul={dehydrated:null,treeContext:null,retryLane:0};function Bl(n){return{baseLanes:n,cachePool:null,transitions:null}}function up(n,e,t){var r=e.pendingProps,s=ge.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(s|=1),ue(ge,s&1),n===null)return bl(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,n=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=Vo(o,r,0,null),n=Vn(n,r,t,null),i.return=e,n.return=e,i.sibling=n,e.child=i,e.child.memoizedState=Bl(t),e.memoizedState=Ul,n):rc(e,o));if(s=n.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return wv(n,e,o,r,a,s,t);if(i){i=r.fallback,o=e.mode,s=n.child,a=s.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=Cn(s,l),r.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=Cn(a,i):(i=Vn(i,o,t,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=n.child.memoizedState,o=o===null?Bl(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=n.childLanes&~t,e.memoizedState=Ul,r}return i=n.child,n=i.sibling,r=Cn(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function rc(n,e){return e=Vo({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function ui(n,e,t,r){return r!==null&&Hu(r),Pr(e,n.child,null,t),n=rc(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function wv(n,e,t,r,s,i,o){if(t)return e.flags&256?(e.flags&=-257,r=wa(Error(B(422))),ui(n,e,o,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=Vo({mode:"visible",children:r.children},s,0,null),i=Vn(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&Pr(e,n.child,null,o),e.child.memoizedState=Bl(o),e.memoizedState=Ul,i);if(!(e.mode&1))return ui(n,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(B(419)),r=wa(i,r,void 0),ui(n,e,o,r)}if(a=(o&n.childLanes)!==0,Je||a){if(r=_e,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,on(n,s),Dt(r,n,s,-1))}return uc(),r=wa(Error(B(421))),ui(n,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=n.child,e=Bv.bind(null,n),s._reactRetry=e,null):(n=i.treeContext,it=Ln(s.nextSibling),ot=e,he=!0,wt=null,n!==null&&(ht[mt++]=en,ht[mt++]=tn,ht[mt++]=Yn,en=n.id,tn=n.overflow,Yn=e),e=rc(e,r.children),e.flags|=4096,e)}function Md(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),_l(n.return,e,t)}function Ca(n,e,t,r,s){var i=n.memoizedState;i===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=t,i.tailMode=s)}function cp(n,e,t){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(Ke(n,e,r.children,t),r=ge.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&Md(n,t,e);else if(n.tag===19)Md(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(ue(ge,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)n=t.alternate,n!==null&&uo(n)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),Ca(e,!1,s,t,i);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(n=s.alternate,n!==null&&uo(n)===null){e.child=s;break}n=s.sibling,s.sibling=t,t=s,s=n}Ca(e,!0,t,null,i);break;case"together":Ca(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Pi(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function an(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Xn|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(B(153));if(e.child!==null){for(n=e.child,t=Cn(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=Cn(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function Cv(n,e,t){switch(e.tag){case 3:lp(e),_r();break;case 5:Fm(e);break;case 1:et(e.type)&&ro(e);break;case 4:qu(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;ue(oo,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(ue(ge,ge.current&1),e.flags|=128,null):t&e.child.childLanes?up(n,e,t):(ue(ge,ge.current&1),n=an(n,e,t),n!==null?n.sibling:null);ue(ge,ge.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return cp(n,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),ue(ge,ge.current),r)break;return null;case 22:case 23:return e.lanes=0,op(n,e,t)}return an(n,e,t)}var dp,$l,fp,hp;dp=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};$l=function(){};fp=function(n,e,t,r){var s=n.memoizedProps;if(s!==r){n=e.stateNode,jn(Vt.current);var i=null;switch(t){case"input":s=ll(n,s),r=ll(n,r),i=[];break;case"select":s=ve({},s,{value:void 0}),r=ve({},r,{value:void 0}),i=[];break;case"textarea":s=dl(n,s),r=dl(n,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=to)}hl(t,r);var o;t=null;for(u in s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var a=s[u];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(xs.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var l=r[u];if(a=s!=null?s[u]:void 0,r.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(i||(i=[]),i.push(u,t)),t=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(xs.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&de("scroll",n),i||a===l||(i=[])):(i=i||[]).push(u,l))}t&&(i=i||[]).push("style",t);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};hp=function(n,e,t,r){t!==r&&(e.flags|=4)};function ts(n,e){if(!he)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function $e(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=n,s=s.sibling;else for(s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=n,s=s.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function Iv(n,e,t){var r=e.pendingProps;switch(Gu(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return $e(e),null;case 1:return et(e.type)&&no(),$e(e),null;case 3:return r=e.stateNode,Nr(),fe(Ze),fe(Ve),Qu(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(ai(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,wt!==null&&(Yl(wt),wt=null))),$l(n,e),$e(e),null;case 5:Xu(e);var s=jn(bs.current);if(t=e.type,n!==null&&e.stateNode!=null)fp(n,e,t,r,s),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(B(166));return $e(e),null}if(n=jn(Vt.current),ai(e)){r=e.stateNode,t=e.type;var i=e.memoizedProps;switch(r[Bt]=e,r[Ds]=i,n=(e.mode&1)!==0,t){case"dialog":de("cancel",r),de("close",r);break;case"iframe":case"object":case"embed":de("load",r);break;case"video":case"audio":for(s=0;s<ls.length;s++)de(ls[s],r);break;case"source":de("error",r);break;case"img":case"image":case"link":de("error",r),de("load",r);break;case"details":de("toggle",r);break;case"input":zc(r,i),de("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},de("invalid",r);break;case"textarea":Yc(r,i),de("invalid",r)}hl(t,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&oi(r.textContent,a,n),s=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&oi(r.textContent,a,n),s=["children",""+a]):xs.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&de("scroll",r)}switch(t){case"input":Js(r),Wc(r,i,!0);break;case"textarea":Js(r),qc(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=to)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=jh(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=o.createElement(t,{is:r.is}):(n=o.createElement(t),t==="select"&&(o=n,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):n=o.createElementNS(n,t),n[Bt]=e,n[Ds]=r,dp(n,e,!1,!1),e.stateNode=n;e:{switch(o=ml(t,r),t){case"dialog":de("cancel",n),de("close",n),s=r;break;case"iframe":case"object":case"embed":de("load",n),s=r;break;case"video":case"audio":for(s=0;s<ls.length;s++)de(ls[s],n);s=r;break;case"source":de("error",n),s=r;break;case"img":case"image":case"link":de("error",n),de("load",n),s=r;break;case"details":de("toggle",n),s=r;break;case"input":zc(n,r),s=ll(n,r),de("invalid",n);break;case"option":s=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},s=ve({},r,{value:void 0}),de("invalid",n);break;case"textarea":Yc(n,r),s=dl(n,r),de("invalid",n);break;default:s=r}hl(t,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?Vh(n,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&Gh(n,l)):i==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&Es(n,l):typeof l=="number"&&Es(n,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(xs.hasOwnProperty(i)?l!=null&&i==="onScroll"&&de("scroll",n):l!=null&&Cu(n,i,l,o))}switch(t){case"input":Js(n),Wc(n,r,!1);break;case"textarea":Js(n),qc(n);break;case"option":r.value!=null&&n.setAttribute("value",""+Dn(r.value));break;case"select":n.multiple=!!r.multiple,i=r.value,i!=null?Tr(n,!!r.multiple,i,!1):r.defaultValue!=null&&Tr(n,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(n.onclick=to)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return $e(e),null;case 6:if(n&&e.stateNode!=null)hp(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(B(166));if(t=jn(bs.current),jn(Vt.current),ai(e)){if(r=e.stateNode,t=e.memoizedProps,r[Bt]=e,(i=r.nodeValue!==t)&&(n=ot,n!==null))switch(n.tag){case 3:oi(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&oi(r.nodeValue,t,(n.mode&1)!==0)}i&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[Bt]=e,e.stateNode=r}return $e(e),null;case 13:if(fe(ge),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(he&&it!==null&&e.mode&1&&!(e.flags&128))bm(),_r(),e.flags|=98560,i=!1;else if(i=ai(e),r!==null&&r.dehydrated!==null){if(n===null){if(!i)throw Error(B(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(B(317));i[Bt]=e}else _r(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;$e(e),i=!1}else wt!==null&&(Yl(wt),wt=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||ge.current&1?Ie===0&&(Ie=3):uc())),e.updateQueue!==null&&(e.flags|=4),$e(e),null);case 4:return Nr(),$l(n,e),n===null&&Cs(e.stateNode.containerInfo),$e(e),null;case 10:return zu(e.type._context),$e(e),null;case 17:return et(e.type)&&no(),$e(e),null;case 19:if(fe(ge),i=e.memoizedState,i===null)return $e(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)ts(i,!1);else{if(Ie!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=uo(n),o!==null){for(e.flags|=128,ts(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)i=t,n=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,n=o.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return ue(ge,ge.current&1|2),e.child}n=n.sibling}i.tail!==null&&Se()>Fr&&(e.flags|=128,r=!0,ts(i,!1),e.lanes=4194304)}else{if(!r)if(n=uo(o),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),ts(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!he)return $e(e),null}else 2*Se()-i.renderingStartTime>Fr&&t!==1073741824&&(e.flags|=128,r=!0,ts(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(t=i.last,t!==null?t.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Se(),e.sibling=null,t=ge.current,ue(ge,r?t&1|2:t&1),e):($e(e),null);case 22:case 23:return lc(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?st&1073741824&&($e(e),e.subtreeFlags&6&&(e.flags|=8192)):$e(e),null;case 24:return null;case 25:return null}throw Error(B(156,e.tag))}function Dv(n,e){switch(Gu(e),e.tag){case 1:return et(e.type)&&no(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return Nr(),fe(Ze),fe(Ve),Qu(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return Xu(e),null;case 13:if(fe(ge),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(B(340));_r()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return fe(ge),null;case 4:return Nr(),null;case 10:return zu(e.type._context),null;case 22:case 23:return lc(),null;case 24:return null;default:return null}}var ci=!1,He=!1,kv=typeof WeakSet=="function"?WeakSet:Set,j=null;function xr(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){Ee(n,e,r)}else t.current=null}function jl(n,e,t){try{t()}catch(r){Ee(n,e,r)}}var Ud=!1;function bv(n,e){if(Rl=Ji,n=vm(),$u(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,u=0,c=0,d=n,f=null;t:for(;;){for(var m;d!==t||s!==0&&d.nodeType!==3||(a=o+s),d!==i||r!==0&&d.nodeType!==3||(l=o+r),d.nodeType===3&&(o+=d.nodeValue.length),(m=d.firstChild)!==null;)f=d,d=m;for(;;){if(d===n)break t;if(f===t&&++u===s&&(a=o),f===i&&++c===r&&(l=o),(m=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=m}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(Al={focusedElem:n,selectionRange:t},Ji=!1,j=e;j!==null;)if(e=j,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,j=n;else for(;j!==null;){e=j;try{var h=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(h!==null){var p=h.memoizedProps,y=h.memoizedState,g=e.stateNode,v=g.getSnapshotBeforeUpdate(e.elementType===e.type?p:Rt(e.type,p),y);g.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var x=e.stateNode.containerInfo;x.nodeType===1?x.textContent="":x.nodeType===9&&x.documentElement&&x.removeChild(x.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(B(163))}}catch(L){Ee(e,e.return,L)}if(n=e.sibling,n!==null){n.return=e.return,j=n;break}j=e.return}return h=Ud,Ud=!1,h}function ps(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&n)===n){var i=s.destroy;s.destroy=void 0,i!==void 0&&jl(e,t,i)}s=s.next}while(s!==r)}}function Go(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function Gl(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function mp(n){var e=n.alternate;e!==null&&(n.alternate=null,mp(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Bt],delete e[Ds],delete e[Il],delete e[hv],delete e[mv])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function pp(n){return n.tag===5||n.tag===3||n.tag===4}function Bd(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||pp(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Hl(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=to));else if(r!==4&&(n=n.child,n!==null))for(Hl(n,e,t),n=n.sibling;n!==null;)Hl(n,e,t),n=n.sibling}function Vl(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(Vl(n,e,t),n=n.sibling;n!==null;)Vl(n,e,t),n=n.sibling}var Oe=null,At=!1;function un(n,e,t){for(t=t.child;t!==null;)gp(n,e,t),t=t.sibling}function gp(n,e,t){if(Ht&&typeof Ht.onCommitFiberUnmount=="function")try{Ht.onCommitFiberUnmount(No,t)}catch{}switch(t.tag){case 5:He||xr(t,e);case 6:var r=Oe,s=At;Oe=null,un(n,e,t),Oe=r,At=s,Oe!==null&&(At?(n=Oe,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):Oe.removeChild(t.stateNode));break;case 18:Oe!==null&&(At?(n=Oe,t=t.stateNode,n.nodeType===8?Ea(n.parentNode,t):n.nodeType===1&&Ea(n,t),Rs(n)):Ea(Oe,t.stateNode));break;case 4:r=Oe,s=At,Oe=t.stateNode.containerInfo,At=!0,un(n,e,t),Oe=r,At=s;break;case 0:case 11:case 14:case 15:if(!He&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&jl(t,e,o),s=s.next}while(s!==r)}un(n,e,t);break;case 1:if(!He&&(xr(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(a){Ee(t,e,a)}un(n,e,t);break;case 21:un(n,e,t);break;case 22:t.mode&1?(He=(r=He)||t.memoizedState!==null,un(n,e,t),He=r):un(n,e,t);break;default:un(n,e,t)}}function $d(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new kv),e.forEach(function(r){var s=$v.bind(null,n,r);t.has(r)||(t.add(r),r.then(s,s))})}}function St(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var s=t[r];try{var i=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Oe=a.stateNode,At=!1;break e;case 3:Oe=a.stateNode.containerInfo,At=!0;break e;case 4:Oe=a.stateNode.containerInfo,At=!0;break e}a=a.return}if(Oe===null)throw Error(B(160));gp(i,o,s),Oe=null,At=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(u){Ee(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)yp(e,n),e=e.sibling}function yp(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(St(e,n),Nt(n),r&4){try{ps(3,n,n.return),Go(3,n)}catch(p){Ee(n,n.return,p)}try{ps(5,n,n.return)}catch(p){Ee(n,n.return,p)}}break;case 1:St(e,n),Nt(n),r&512&&t!==null&&xr(t,t.return);break;case 5:if(St(e,n),Nt(n),r&512&&t!==null&&xr(t,t.return),n.flags&32){var s=n.stateNode;try{Es(s,"")}catch(p){Ee(n,n.return,p)}}if(r&4&&(s=n.stateNode,s!=null)){var i=n.memoizedProps,o=t!==null?t.memoizedProps:i,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&Bh(s,i),ml(a,o);var u=ml(a,i);for(o=0;o<l.length;o+=2){var c=l[o],d=l[o+1];c==="style"?Vh(s,d):c==="dangerouslySetInnerHTML"?Gh(s,d):c==="children"?Es(s,d):Cu(s,c,d,u)}switch(a){case"input":ul(s,i);break;case"textarea":$h(s,i);break;case"select":var f=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var m=i.value;m!=null?Tr(s,!!i.multiple,m,!1):f!==!!i.multiple&&(i.defaultValue!=null?Tr(s,!!i.multiple,i.defaultValue,!0):Tr(s,!!i.multiple,i.multiple?[]:"",!1))}s[Ds]=i}catch(p){Ee(n,n.return,p)}}break;case 6:if(St(e,n),Nt(n),r&4){if(n.stateNode===null)throw Error(B(162));s=n.stateNode,i=n.memoizedProps;try{s.nodeValue=i}catch(p){Ee(n,n.return,p)}}break;case 3:if(St(e,n),Nt(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{Rs(e.containerInfo)}catch(p){Ee(n,n.return,p)}break;case 4:St(e,n),Nt(n);break;case 13:St(e,n),Nt(n),s=n.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(oc=Se())),r&4&&$d(n);break;case 22:if(c=t!==null&&t.memoizedState!==null,n.mode&1?(He=(u=He)||c,St(e,n),He=u):St(e,n),Nt(n),r&8192){if(u=n.memoizedState!==null,(n.stateNode.isHidden=u)&&!c&&n.mode&1)for(j=n,c=n.child;c!==null;){for(d=j=c;j!==null;){switch(f=j,m=f.child,f.tag){case 0:case 11:case 14:case 15:ps(4,f,f.return);break;case 1:xr(f,f.return);var h=f.stateNode;if(typeof h.componentWillUnmount=="function"){r=f,t=f.return;try{e=r,h.props=e.memoizedProps,h.state=e.memoizedState,h.componentWillUnmount()}catch(p){Ee(r,t,p)}}break;case 5:xr(f,f.return);break;case 22:if(f.memoizedState!==null){Gd(d);continue}}m!==null?(m.return=f,j=m):Gd(d)}c=c.sibling}e:for(c=null,d=n;;){if(d.tag===5){if(c===null){c=d;try{s=d.stateNode,u?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=d.stateNode,l=d.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=Hh("display",o))}catch(p){Ee(n,n.return,p)}}}else if(d.tag===6){if(c===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(p){Ee(n,n.return,p)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===n)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===n)break e;for(;d.sibling===null;){if(d.return===null||d.return===n)break e;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:St(e,n),Nt(n),r&4&&$d(n);break;case 21:break;default:St(e,n),Nt(n)}}function Nt(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(pp(t)){var r=t;break e}t=t.return}throw Error(B(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(Es(s,""),r.flags&=-33);var i=Bd(n);Vl(n,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,a=Bd(n);Hl(n,a,o);break;default:throw Error(B(161))}}catch(l){Ee(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function _v(n,e,t){j=n,vp(n)}function vp(n,e,t){for(var r=(n.mode&1)!==0;j!==null;){var s=j,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||ci;if(!o){var a=s.alternate,l=a!==null&&a.memoizedState!==null||He;a=ci;var u=He;if(ci=o,(He=l)&&!u)for(j=s;j!==null;)o=j,l=o.child,o.tag===22&&o.memoizedState!==null?Hd(s):l!==null?(l.return=o,j=l):Hd(s);for(;i!==null;)j=i,vp(i),i=i.sibling;j=s,ci=a,He=u}jd(n)}else s.subtreeFlags&8772&&i!==null?(i.return=s,j=i):jd(n)}}function jd(n){for(;j!==null;){var e=j;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:He||Go(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!He)if(t===null)r.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:Rt(e.type,t.memoizedProps);r.componentDidUpdate(s,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&Ad(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}Ad(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var d=c.dehydrated;d!==null&&Rs(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(B(163))}He||e.flags&512&&Gl(e)}catch(f){Ee(e,e.return,f)}}if(e===n){j=null;break}if(t=e.sibling,t!==null){t.return=e.return,j=t;break}j=e.return}}function Gd(n){for(;j!==null;){var e=j;if(e===n){j=null;break}var t=e.sibling;if(t!==null){t.return=e.return,j=t;break}j=e.return}}function Hd(n){for(;j!==null;){var e=j;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{Go(4,e)}catch(l){Ee(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(l){Ee(e,s,l)}}var i=e.return;try{Gl(e)}catch(l){Ee(e,i,l)}break;case 5:var o=e.return;try{Gl(e)}catch(l){Ee(e,o,l)}}}catch(l){Ee(e,e.return,l)}if(e===n){j=null;break}var a=e.sibling;if(a!==null){a.return=e.return,j=a;break}j=e.return}}var Pv=Math.ceil,ho=ln.ReactCurrentDispatcher,sc=ln.ReactCurrentOwner,gt=ln.ReactCurrentBatchConfig,se=0,_e=null,Le=null,Me=0,st=0,Er=_n(0),Ie=0,Os=null,Xn=0,Ho=0,ic=0,gs=null,Xe=null,oc=0,Fr=1/0,Xt=null,mo=!1,Kl=null,An=null,di=!1,vn=null,po=0,ys=0,zl=null,Ni=-1,Oi=0;function ze(){return se&6?Se():Ni!==-1?Ni:Ni=Se()}function wn(n){return n.mode&1?se&2&&Me!==0?Me&-Me:gv.transition!==null?(Oi===0&&(Oi=nm()),Oi):(n=oe,n!==0||(n=window.event,n=n===void 0?16:um(n.type)),n):1}function Dt(n,e,t,r){if(50<ys)throw ys=0,zl=null,Error(B(185));Hs(n,t,r),(!(se&2)||n!==_e)&&(n===_e&&(!(se&2)&&(Ho|=t),Ie===4&&gn(n,Me)),tt(n,r),t===1&&se===0&&!(e.mode&1)&&(Fr=Se()+500,Bo&&Pn()))}function tt(n,e){var t=n.callbackNode;gy(n,e);var r=Qi(n,n===_e?Me:0);if(r===0)t!==null&&Jc(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&Jc(t),e===1)n.tag===0?pv(Vd.bind(null,n)):Im(Vd.bind(null,n)),dv(function(){!(se&6)&&Pn()}),t=null;else{switch(rm(r)){case 1:t=_u;break;case 4:t=em;break;case 16:t=Xi;break;case 536870912:t=tm;break;default:t=Xi}t=wp(t,xp.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function xp(n,e){if(Ni=-1,Oi=0,se&6)throw Error(B(327));var t=n.callbackNode;if(Cr()&&n.callbackNode!==t)return null;var r=Qi(n,n===_e?Me:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=go(n,r);else{e=r;var s=se;se|=2;var i=Sp();(_e!==n||Me!==e)&&(Xt=null,Fr=Se()+500,Hn(n,e));do try{Fv();break}catch(a){Ep(n,a)}while(!0);Ku(),ho.current=i,se=s,Le!==null?e=0:(_e=null,Me=0,e=Ie)}if(e!==0){if(e===2&&(s=xl(n),s!==0&&(r=s,e=Wl(n,s))),e===1)throw t=Os,Hn(n,0),gn(n,r),tt(n,Se()),t;if(e===6)gn(n,r);else{if(s=n.current.alternate,!(r&30)&&!Nv(s)&&(e=go(n,r),e===2&&(i=xl(n),i!==0&&(r=i,e=Wl(n,i))),e===1))throw t=Os,Hn(n,0),gn(n,r),tt(n,Se()),t;switch(n.finishedWork=s,n.finishedLanes=r,e){case 0:case 1:throw Error(B(345));case 2:Mn(n,Xe,Xt);break;case 3:if(gn(n,r),(r&130023424)===r&&(e=oc+500-Se(),10<e)){if(Qi(n,0)!==0)break;if(s=n.suspendedLanes,(s&r)!==r){ze(),n.pingedLanes|=n.suspendedLanes&s;break}n.timeoutHandle=Cl(Mn.bind(null,n,Xe,Xt),e);break}Mn(n,Xe,Xt);break;case 4:if(gn(n,r),(r&4194240)===r)break;for(e=n.eventTimes,s=-1;0<r;){var o=31-It(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=Se()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Pv(r/1960))-r,10<r){n.timeoutHandle=Cl(Mn.bind(null,n,Xe,Xt),r);break}Mn(n,Xe,Xt);break;case 5:Mn(n,Xe,Xt);break;default:throw Error(B(329))}}}return tt(n,Se()),n.callbackNode===t?xp.bind(null,n):null}function Wl(n,e){var t=gs;return n.current.memoizedState.isDehydrated&&(Hn(n,e).flags|=256),n=go(n,e),n!==2&&(e=Xe,Xe=t,e!==null&&Yl(e)),n}function Yl(n){Xe===null?Xe=n:Xe.push.apply(Xe,n)}function Nv(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var s=t[r],i=s.getSnapshot;s=s.value;try{if(!bt(i(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function gn(n,e){for(e&=~ic,e&=~Ho,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-It(e),r=1<<t;n[t]=-1,e&=~r}}function Vd(n){if(se&6)throw Error(B(327));Cr();var e=Qi(n,0);if(!(e&1))return tt(n,Se()),null;var t=go(n,e);if(n.tag!==0&&t===2){var r=xl(n);r!==0&&(e=r,t=Wl(n,r))}if(t===1)throw t=Os,Hn(n,0),gn(n,e),tt(n,Se()),t;if(t===6)throw Error(B(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,Mn(n,Xe,Xt),tt(n,Se()),null}function ac(n,e){var t=se;se|=1;try{return n(e)}finally{se=t,se===0&&(Fr=Se()+500,Bo&&Pn())}}function Qn(n){vn!==null&&vn.tag===0&&!(se&6)&&Cr();var e=se;se|=1;var t=gt.transition,r=oe;try{if(gt.transition=null,oe=1,n)return n()}finally{oe=r,gt.transition=t,se=e,!(se&6)&&Pn()}}function lc(){st=Er.current,fe(Er)}function Hn(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,cv(t)),Le!==null)for(t=Le.return;t!==null;){var r=t;switch(Gu(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&no();break;case 3:Nr(),fe(Ze),fe(Ve),Qu();break;case 5:Xu(r);break;case 4:Nr();break;case 13:fe(ge);break;case 19:fe(ge);break;case 10:zu(r.type._context);break;case 22:case 23:lc()}t=t.return}if(_e=n,Le=n=Cn(n.current,null),Me=st=e,Ie=0,Os=null,ic=Ho=Xn=0,Xe=gs=null,$n!==null){for(e=0;e<$n.length;e++)if(t=$n[e],r=t.interleaved,r!==null){t.interleaved=null;var s=r.next,i=t.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}t.pending=r}$n=null}return n}function Ep(n,e){do{var t=Le;try{if(Ku(),bi.current=fo,co){for(var r=ye.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}co=!1}if(qn=0,ke=Ce=ye=null,ms=!1,_s=0,sc.current=null,t===null||t.return===null){Ie=1,Os=e,Le=null;break}e:{var i=n,o=t.return,a=t,l=e;if(e=Me,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=a,d=c.tag;if(!(c.mode&1)&&(d===0||d===11||d===15)){var f=c.alternate;f?(c.updateQueue=f.updateQueue,c.memoizedState=f.memoizedState,c.lanes=f.lanes):(c.updateQueue=null,c.memoizedState=null)}var m=bd(o);if(m!==null){m.flags&=-257,_d(m,o,a,i,e),m.mode&1&&kd(i,u,e),e=m,l=u;var h=e.updateQueue;if(h===null){var p=new Set;p.add(l),e.updateQueue=p}else h.add(l);break e}else{if(!(e&1)){kd(i,u,e),uc();break e}l=Error(B(426))}}else if(he&&a.mode&1){var y=bd(o);if(y!==null){!(y.flags&65536)&&(y.flags|=256),_d(y,o,a,i,e),Hu(Or(l,a));break e}}i=l=Or(l,a),Ie!==4&&(Ie=2),gs===null?gs=[i]:gs.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var g=rp(i,l,e);Rd(i,g);break e;case 1:a=l;var v=i.type,x=i.stateNode;if(!(i.flags&128)&&(typeof v.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(An===null||!An.has(x)))){i.flags|=65536,e&=-e,i.lanes|=e;var L=sp(i,a,e);Rd(i,L);break e}}i=i.return}while(i!==null)}Lp(t)}catch(T){e=T,Le===t&&t!==null&&(Le=t=t.return);continue}break}while(!0)}function Sp(){var n=ho.current;return ho.current=fo,n===null?fo:n}function uc(){(Ie===0||Ie===3||Ie===2)&&(Ie=4),_e===null||!(Xn&268435455)&&!(Ho&268435455)||gn(_e,Me)}function go(n,e){var t=se;se|=2;var r=Sp();(_e!==n||Me!==e)&&(Xt=null,Hn(n,e));do try{Ov();break}catch(s){Ep(n,s)}while(!0);if(Ku(),se=t,ho.current=r,Le!==null)throw Error(B(261));return _e=null,Me=0,Ie}function Ov(){for(;Le!==null;)Tp(Le)}function Fv(){for(;Le!==null&&!ay();)Tp(Le)}function Tp(n){var e=Ap(n.alternate,n,st);n.memoizedProps=n.pendingProps,e===null?Lp(n):Le=e,sc.current=null}function Lp(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=Dv(t,e),t!==null){t.flags&=32767,Le=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Ie=6,Le=null;return}}else if(t=Iv(t,e,st),t!==null){Le=t;return}if(e=e.sibling,e!==null){Le=e;return}Le=e=n}while(e!==null);Ie===0&&(Ie=5)}function Mn(n,e,t){var r=oe,s=gt.transition;try{gt.transition=null,oe=1,Mv(n,e,t,r)}finally{gt.transition=s,oe=r}return null}function Mv(n,e,t,r){do Cr();while(vn!==null);if(se&6)throw Error(B(327));t=n.finishedWork;var s=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(B(177));n.callbackNode=null,n.callbackPriority=0;var i=t.lanes|t.childLanes;if(yy(n,i),n===_e&&(Le=_e=null,Me=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||di||(di=!0,wp(Xi,function(){return Cr(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=gt.transition,gt.transition=null;var o=oe;oe=1;var a=se;se|=4,sc.current=null,bv(n,t),yp(t,n),rv(Al),Ji=!!Rl,Al=Rl=null,n.current=t,_v(t),ly(),se=a,oe=o,gt.transition=i}else n.current=t;if(di&&(di=!1,vn=n,po=s),i=n.pendingLanes,i===0&&(An=null),dy(t.stateNode),tt(n,Se()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)s=e[t],r(s.value,{componentStack:s.stack,digest:s.digest});if(mo)throw mo=!1,n=Kl,Kl=null,n;return po&1&&n.tag!==0&&Cr(),i=n.pendingLanes,i&1?n===zl?ys++:(ys=0,zl=n):ys=0,Pn(),null}function Cr(){if(vn!==null){var n=rm(po),e=gt.transition,t=oe;try{if(gt.transition=null,oe=16>n?16:n,vn===null)var r=!1;else{if(n=vn,vn=null,po=0,se&6)throw Error(B(331));var s=se;for(se|=4,j=n.current;j!==null;){var i=j,o=i.child;if(j.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(j=u;j!==null;){var c=j;switch(c.tag){case 0:case 11:case 15:ps(8,c,i)}var d=c.child;if(d!==null)d.return=c,j=d;else for(;j!==null;){c=j;var f=c.sibling,m=c.return;if(mp(c),c===u){j=null;break}if(f!==null){f.return=m,j=f;break}j=m}}}var h=i.alternate;if(h!==null){var p=h.child;if(p!==null){h.child=null;do{var y=p.sibling;p.sibling=null,p=y}while(p!==null)}}j=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,j=o;else e:for(;j!==null;){if(i=j,i.flags&2048)switch(i.tag){case 0:case 11:case 15:ps(9,i,i.return)}var g=i.sibling;if(g!==null){g.return=i.return,j=g;break e}j=i.return}}var v=n.current;for(j=v;j!==null;){o=j;var x=o.child;if(o.subtreeFlags&2064&&x!==null)x.return=o,j=x;else e:for(o=v;j!==null;){if(a=j,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Go(9,a)}}catch(T){Ee(a,a.return,T)}if(a===o){j=null;break e}var L=a.sibling;if(L!==null){L.return=a.return,j=L;break e}j=a.return}}if(se=s,Pn(),Ht&&typeof Ht.onPostCommitFiberRoot=="function")try{Ht.onPostCommitFiberRoot(No,n)}catch{}r=!0}return r}finally{oe=t,gt.transition=e}}return!1}function Kd(n,e,t){e=Or(t,e),e=rp(n,e,1),n=Rn(n,e,1),e=ze(),n!==null&&(Hs(n,1,e),tt(n,e))}function Ee(n,e,t){if(n.tag===3)Kd(n,n,t);else for(;e!==null;){if(e.tag===3){Kd(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(An===null||!An.has(r))){n=Or(t,n),n=sp(e,n,1),e=Rn(e,n,1),n=ze(),e!==null&&(Hs(e,1,n),tt(e,n));break}}e=e.return}}function Uv(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=ze(),n.pingedLanes|=n.suspendedLanes&t,_e===n&&(Me&t)===t&&(Ie===4||Ie===3&&(Me&130023424)===Me&&500>Se()-oc?Hn(n,0):ic|=t),tt(n,e)}function Rp(n,e){e===0&&(n.mode&1?(e=ti,ti<<=1,!(ti&130023424)&&(ti=4194304)):e=1);var t=ze();n=on(n,e),n!==null&&(Hs(n,e,t),tt(n,t))}function Bv(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),Rp(n,t)}function $v(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,s=n.memoizedState;s!==null&&(t=s.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(B(314))}r!==null&&r.delete(e),Rp(n,t)}var Ap;Ap=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||Ze.current)Je=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return Je=!1,Cv(n,e,t);Je=!!(n.flags&131072)}else Je=!1,he&&e.flags&1048576&&Dm(e,io,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Pi(n,e),n=e.pendingProps;var s=br(e,Ve.current);wr(e,t),s=Zu(null,e,r,n,s,t);var i=ec();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,et(r)?(i=!0,ro(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Yu(e),s.updater=jo,e.stateNode=s,s._reactInternals=e,Nl(e,r,n,t),e=Ml(null,e,r,!0,i,t)):(e.tag=0,he&&i&&ju(e),Ke(null,e,s,t),e=e.child),e;case 16:r=e.elementType;e:{switch(Pi(n,e),n=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=Gv(r),n=Rt(r,n),s){case 0:e=Fl(null,e,r,n,t);break e;case 1:e=Od(null,e,r,n,t);break e;case 11:e=Pd(null,e,r,n,t);break e;case 14:e=Nd(null,e,r,Rt(r.type,n),t);break e}throw Error(B(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Rt(r,s),Fl(n,e,r,s,t);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Rt(r,s),Od(n,e,r,s,t);case 3:e:{if(lp(e),n===null)throw Error(B(387));r=e.pendingProps,i=e.memoizedState,s=i.element,Om(n,e),lo(e,r,null,t);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=Or(Error(B(423)),e),e=Fd(n,e,r,t,s);break e}else if(r!==s){s=Or(Error(B(424)),e),e=Fd(n,e,r,t,s);break e}else for(it=Ln(e.stateNode.containerInfo.firstChild),ot=e,he=!0,wt=null,t=Pm(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(_r(),r===s){e=an(n,e,t);break e}Ke(n,e,r,t)}e=e.child}return e;case 5:return Fm(e),n===null&&bl(e),r=e.type,s=e.pendingProps,i=n!==null?n.memoizedProps:null,o=s.children,wl(r,s)?o=null:i!==null&&wl(r,i)&&(e.flags|=32),ap(n,e),Ke(n,e,o,t),e.child;case 6:return n===null&&bl(e),null;case 13:return up(n,e,t);case 4:return qu(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=Pr(e,null,r,t):Ke(n,e,r,t),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Rt(r,s),Pd(n,e,r,s,t);case 7:return Ke(n,e,e.pendingProps,t),e.child;case 8:return Ke(n,e,e.pendingProps.children,t),e.child;case 12:return Ke(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,ue(oo,r._currentValue),r._currentValue=o,i!==null)if(bt(i.value,o)){if(i.children===s.children&&!Ze.current){e=an(n,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(i.tag===1){l=nn(-1,t&-t),l.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}i.lanes|=t,l=i.alternate,l!==null&&(l.lanes|=t),_l(i.return,t,e),a.lanes|=t;break}l=l.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(B(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),_l(o,t,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}Ke(n,e,s.children,t),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,wr(e,t),s=vt(s),r=r(s),e.flags|=1,Ke(n,e,r,t),e.child;case 14:return r=e.type,s=Rt(r,e.pendingProps),s=Rt(r.type,s),Nd(n,e,r,s,t);case 15:return ip(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Rt(r,s),Pi(n,e),e.tag=1,et(r)?(n=!0,ro(e)):n=!1,wr(e,t),np(e,r,s),Nl(e,r,s,t),Ml(null,e,r,!0,n,t);case 19:return cp(n,e,t);case 22:return op(n,e,t)}throw Error(B(156,e.tag))};function wp(n,e){return Zh(n,e)}function jv(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function pt(n,e,t,r){return new jv(n,e,t,r)}function cc(n){return n=n.prototype,!(!n||!n.isReactComponent)}function Gv(n){if(typeof n=="function")return cc(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Du)return 11;if(n===ku)return 14}return 2}function Cn(n,e){var t=n.alternate;return t===null?(t=pt(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function Fi(n,e,t,r,s,i){var o=2;if(r=n,typeof n=="function")cc(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case cr:return Vn(t.children,s,i,e);case Iu:o=8,s|=8;break;case sl:return n=pt(12,t,e,s|2),n.elementType=sl,n.lanes=i,n;case il:return n=pt(13,t,e,s),n.elementType=il,n.lanes=i,n;case ol:return n=pt(19,t,e,s),n.elementType=ol,n.lanes=i,n;case Fh:return Vo(t,s,i,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case Nh:o=10;break e;case Oh:o=9;break e;case Du:o=11;break e;case ku:o=14;break e;case fn:o=16,r=null;break e}throw Error(B(130,n==null?n:typeof n,""))}return e=pt(o,t,e,s),e.elementType=n,e.type=r,e.lanes=i,e}function Vn(n,e,t,r){return n=pt(7,n,r,e),n.lanes=t,n}function Vo(n,e,t,r){return n=pt(22,n,r,e),n.elementType=Fh,n.lanes=t,n.stateNode={isHidden:!1},n}function Ia(n,e,t){return n=pt(6,n,null,e),n.lanes=t,n}function Da(n,e,t){return e=pt(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function Hv(n,e,t,r,s){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ua(0),this.expirationTimes=ua(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ua(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function dc(n,e,t,r,s,i,o,a,l){return n=new Hv(n,e,t,a,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=pt(3,null,null,e),n.current=i,i.stateNode=n,i.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Yu(i),n}function Vv(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ur,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function Cp(n){if(!n)return kn;n=n._reactInternals;e:{if(tr(n)!==n||n.tag!==1)throw Error(B(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(et(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(B(171))}if(n.tag===1){var t=n.type;if(et(t))return Cm(n,t,e)}return e}function Ip(n,e,t,r,s,i,o,a,l){return n=dc(t,r,!0,n,s,i,o,a,l),n.context=Cp(null),t=n.current,r=ze(),s=wn(t),i=nn(r,s),i.callback=e??null,Rn(t,i,s),n.current.lanes=s,Hs(n,s,r),tt(n,r),n}function Ko(n,e,t,r){var s=e.current,i=ze(),o=wn(s);return t=Cp(t),e.context===null?e.context=t:e.pendingContext=t,e=nn(i,o),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=Rn(s,e,o),n!==null&&(Dt(n,s,o,i),ki(n,s,o)),o}function yo(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function zd(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function fc(n,e){zd(n,e),(n=n.alternate)&&zd(n,e)}function Kv(){return null}var Dp=typeof reportError=="function"?reportError:function(n){console.error(n)};function hc(n){this._internalRoot=n}zo.prototype.render=hc.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(B(409));Ko(n,e,null,null)};zo.prototype.unmount=hc.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Qn(function(){Ko(null,n,null,null)}),e[sn]=null}};function zo(n){this._internalRoot=n}zo.prototype.unstable_scheduleHydration=function(n){if(n){var e=om();n={blockedOn:null,target:n,priority:e};for(var t=0;t<pn.length&&e!==0&&e<pn[t].priority;t++);pn.splice(t,0,n),t===0&&lm(n)}};function mc(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Wo(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function Wd(){}function zv(n,e,t,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var u=yo(o);i.call(u)}}var o=Ip(e,r,n,0,null,!1,!1,"",Wd);return n._reactRootContainer=o,n[sn]=o.current,Cs(n.nodeType===8?n.parentNode:n),Qn(),o}for(;s=n.lastChild;)n.removeChild(s);if(typeof r=="function"){var a=r;r=function(){var u=yo(l);a.call(u)}}var l=dc(n,0,!1,null,null,!1,!1,"",Wd);return n._reactRootContainer=l,n[sn]=l.current,Cs(n.nodeType===8?n.parentNode:n),Qn(function(){Ko(e,l,t,r)}),l}function Yo(n,e,t,r,s){var i=t._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var l=yo(o);a.call(l)}}Ko(e,o,n,s)}else o=zv(t,e,n,s,r);return yo(o)}sm=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=as(e.pendingLanes);t!==0&&(Pu(e,t|1),tt(e,Se()),!(se&6)&&(Fr=Se()+500,Pn()))}break;case 13:Qn(function(){var r=on(n,1);if(r!==null){var s=ze();Dt(r,n,1,s)}}),fc(n,1)}};Nu=function(n){if(n.tag===13){var e=on(n,134217728);if(e!==null){var t=ze();Dt(e,n,134217728,t)}fc(n,134217728)}};im=function(n){if(n.tag===13){var e=wn(n),t=on(n,e);if(t!==null){var r=ze();Dt(t,n,e,r)}fc(n,e)}};om=function(){return oe};am=function(n,e){var t=oe;try{return oe=n,e()}finally{oe=t}};gl=function(n,e,t){switch(e){case"input":if(ul(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var s=Uo(r);if(!s)throw Error(B(90));Uh(r),ul(r,s)}}}break;case"textarea":$h(n,t);break;case"select":e=t.value,e!=null&&Tr(n,!!t.multiple,e,!1)}};Wh=ac;Yh=Qn;var Wv={usingClientEntryPoint:!1,Events:[Ks,mr,Uo,Kh,zh,ac]},ns={findFiberByHostInstance:Bn,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Yv={bundleType:ns.bundleType,version:ns.version,rendererPackageName:ns.rendererPackageName,rendererConfig:ns.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ln.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=Qh(n),n===null?null:n.stateNode},findFiberByHostInstance:ns.findFiberByHostInstance||Kv,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var fi=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!fi.isDisabled&&fi.supportsFiber)try{No=fi.inject(Yv),Ht=fi}catch{}}lt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Wv;lt.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!mc(e))throw Error(B(200));return Vv(n,e,null,t)};lt.createRoot=function(n,e){if(!mc(n))throw Error(B(299));var t=!1,r="",s=Dp;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=dc(n,1,!1,null,null,t,!1,r,s),n[sn]=e.current,Cs(n.nodeType===8?n.parentNode:n),new hc(e)};lt.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(B(188)):(n=Object.keys(n).join(","),Error(B(268,n)));return n=Qh(e),n=n===null?null:n.stateNode,n};lt.flushSync=function(n){return Qn(n)};lt.hydrate=function(n,e,t){if(!Wo(e))throw Error(B(200));return Yo(null,n,e,!0,t)};lt.hydrateRoot=function(n,e,t){if(!mc(n))throw Error(B(405));var r=t!=null&&t.hydratedSources||null,s=!1,i="",o=Dp;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=Ip(e,null,n,1,t??null,s,!1,i,o),n[sn]=e.current,Cs(n),r)for(n=0;n<r.length;n++)t=r[n],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new zo(e)};lt.render=function(n,e,t){if(!Wo(e))throw Error(B(200));return Yo(null,n,e,!1,t)};lt.unmountComponentAtNode=function(n){if(!Wo(n))throw Error(B(40));return n._reactRootContainer?(Qn(function(){Yo(null,null,n,!1,function(){n._reactRootContainer=null,n[sn]=null})}),!0):!1};lt.unstable_batchedUpdates=ac;lt.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!Wo(t))throw Error(B(200));if(n==null||n._reactInternals===void 0)throw Error(B(38));return Yo(n,e,t,!1,r)};lt.version="18.3.1-next-f1338f8080-20240426";function kp(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(kp)}catch(n){console.error(n)}}kp(),kh.exports=lt;var qv=kh.exports,Yd=qv;nl.createRoot=Yd.createRoot,nl.hydrateRoot=Yd.hydrateRoot;/**
 * @remix-run/router v1.16.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Fs(){return Fs=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Fs.apply(this,arguments)}var xn;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(xn||(xn={}));const qd="popstate";function Xv(n){n===void 0&&(n={});function e(r,s){let{pathname:i,search:o,hash:a}=r.location;return ql("",{pathname:i,search:o,hash:a},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function t(r,s){return typeof s=="string"?s:vo(s)}return Jv(e,t,null,n)}function Re(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function bp(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Qv(){return Math.random().toString(36).substr(2,8)}function Xd(n,e){return{usr:n.state,key:n.key,idx:e}}function ql(n,e,t,r){return t===void 0&&(t=null),Fs({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?Vr(e):e,{state:t,key:e&&e.key||r||Qv()})}function vo(n){let{pathname:e="/",search:t="",hash:r=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function Vr(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substr(r),n=n.substr(0,r)),n&&(e.pathname=n)}return e}function Jv(n,e,t,r){r===void 0&&(r={});let{window:s=document.defaultView,v5Compat:i=!1}=r,o=s.history,a=xn.Pop,l=null,u=c();u==null&&(u=0,o.replaceState(Fs({},o.state,{idx:u}),""));function c(){return(o.state||{idx:null}).idx}function d(){a=xn.Pop;let y=c(),g=y==null?null:y-u;u=y,l&&l({action:a,location:p.location,delta:g})}function f(y,g){a=xn.Push;let v=ql(p.location,y,g);u=c()+1;let x=Xd(v,u),L=p.createHref(v);try{o.pushState(x,"",L)}catch(T){if(T instanceof DOMException&&T.name==="DataCloneError")throw T;s.location.assign(L)}i&&l&&l({action:a,location:p.location,delta:1})}function m(y,g){a=xn.Replace;let v=ql(p.location,y,g);u=c();let x=Xd(v,u),L=p.createHref(v);o.replaceState(x,"",L),i&&l&&l({action:a,location:p.location,delta:0})}function h(y){let g=s.location.origin!=="null"?s.location.origin:s.location.href,v=typeof y=="string"?y:vo(y);return v=v.replace(/ $/,"%20"),Re(g,"No window.location.(origin|href) available to create URL for href: "+v),new URL(v,g)}let p={get action(){return a},get location(){return n(s,o)},listen(y){if(l)throw new Error("A history only accepts one active listener");return s.addEventListener(qd,d),l=y,()=>{s.removeEventListener(qd,d),l=null}},createHref(y){return e(s,y)},createURL:h,encodeLocation(y){let g=h(y);return{pathname:g.pathname,search:g.search,hash:g.hash}},push:f,replace:m,go(y){return o.go(y)}};return p}var Qd;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(Qd||(Qd={}));function Zv(n,e,t){t===void 0&&(t="/");let r=typeof e=="string"?Vr(e):e,s=pc(r.pathname||"/",t);if(s==null)return null;let i=_p(n);ex(i);let o=null;for(let a=0;o==null&&a<i.length;++a){let l=fx(s);o=ux(i[a],l)}return o}function _p(n,e,t,r){e===void 0&&(e=[]),t===void 0&&(t=[]),r===void 0&&(r="");let s=(i,o,a)=>{let l={relativePath:a===void 0?i.path||"":a,caseSensitive:i.caseSensitive===!0,childrenIndex:o,route:i};l.relativePath.startsWith("/")&&(Re(l.relativePath.startsWith(r),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(r.length));let u=In([r,l.relativePath]),c=t.concat(l);i.children&&i.children.length>0&&(Re(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),_p(i.children,e,c,u)),!(i.path==null&&!i.index)&&e.push({path:u,score:ax(u,i.index),routesMeta:c})};return n.forEach((i,o)=>{var a;if(i.path===""||!((a=i.path)!=null&&a.includes("?")))s(i,o);else for(let l of Pp(i.path))s(i,o,l)}),e}function Pp(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,s=t.endsWith("?"),i=t.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let o=Pp(r.join("/")),a=[];return a.push(...o.map(l=>l===""?i:[i,l].join("/"))),s&&a.push(...o),a.map(l=>n.startsWith("/")&&l===""?"/":l)}function ex(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:lx(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}const tx=/^:[\w-]+$/,nx=3,rx=2,sx=1,ix=10,ox=-2,Jd=n=>n==="*";function ax(n,e){let t=n.split("/"),r=t.length;return t.some(Jd)&&(r+=ox),e&&(r+=rx),t.filter(s=>!Jd(s)).reduce((s,i)=>s+(tx.test(i)?nx:i===""?sx:ix),r)}function lx(n,e){return n.length===e.length&&n.slice(0,-1).every((r,s)=>r===e[s])?n[n.length-1]-e[e.length-1]:0}function ux(n,e){let{routesMeta:t}=n,r={},s="/",i=[];for(let o=0;o<t.length;++o){let a=t[o],l=o===t.length-1,u=s==="/"?e:e.slice(s.length)||"/",c=cx({path:a.relativePath,caseSensitive:a.caseSensitive,end:l},u);if(!c)return null;Object.assign(r,c.params);let d=a.route;i.push({params:r,pathname:In([s,c.pathname]),pathnameBase:gx(In([s,c.pathnameBase])),route:d}),c.pathnameBase!=="/"&&(s=In([s,c.pathnameBase]))}return i}function cx(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=dx(n.path,n.caseSensitive,n.end),s=e.match(t);if(!s)return null;let i=s[0],o=i.replace(/(.)\/+$/,"$1"),a=s.slice(1);return{params:r.reduce((u,c,d)=>{let{paramName:f,isOptional:m}=c;if(f==="*"){let p=a[d]||"";o=i.slice(0,i.length-p.length).replace(/(.)\/+$/,"$1")}const h=a[d];return m&&!h?u[f]=void 0:u[f]=(h||"").replace(/%2F/g,"/"),u},{}),pathname:i,pathnameBase:o,pattern:n}}function dx(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),bp(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let r=[],s="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(r.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(r.push({paramName:"*"}),s+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?s+="\\/*$":n!==""&&n!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function fx(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return bp(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function pc(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}function hx(n,e){e===void 0&&(e="/");let{pathname:t,search:r="",hash:s=""}=typeof n=="string"?Vr(n):n;return{pathname:t?t.startsWith("/")?t:mx(t,e):e,search:yx(r),hash:vx(s)}}function mx(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(s=>{s===".."?t.length>1&&t.pop():s!=="."&&t.push(s)}),t.length>1?t.join("/"):"/"}function ka(n,e,t,r){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function px(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function Np(n,e){let t=px(n);return e?t.map((r,s)=>s===n.length-1?r.pathname:r.pathnameBase):t.map(r=>r.pathnameBase)}function Op(n,e,t,r){r===void 0&&(r=!1);let s;typeof n=="string"?s=Vr(n):(s=Fs({},n),Re(!s.pathname||!s.pathname.includes("?"),ka("?","pathname","search",s)),Re(!s.pathname||!s.pathname.includes("#"),ka("#","pathname","hash",s)),Re(!s.search||!s.search.includes("#"),ka("#","search","hash",s)));let i=n===""||s.pathname==="",o=i?"/":s.pathname,a;if(o==null)a=t;else{let d=e.length-1;if(!r&&o.startsWith("..")){let f=o.split("/");for(;f[0]==="..";)f.shift(),d-=1;s.pathname=f.join("/")}a=d>=0?e[d]:"/"}let l=hx(s,a),u=o&&o!=="/"&&o.endsWith("/"),c=(i||o===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(u||c)&&(l.pathname+="/"),l}const In=n=>n.join("/").replace(/\/\/+/g,"/"),gx=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),yx=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,vx=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function xx(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const Fp=["post","put","patch","delete"];new Set(Fp);const Ex=["get",...Fp];new Set(Ex);/**
 * React Router v6.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ms(){return Ms=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Ms.apply(this,arguments)}const gc=_.createContext(null),Sx=_.createContext(null),nr=_.createContext(null),qo=_.createContext(null),Nn=_.createContext({outlet:null,matches:[],isDataRoute:!1}),Mp=_.createContext(null);function Tx(n,e){let{relative:t}=e===void 0?{}:e;Ws()||Re(!1);let{basename:r,navigator:s}=_.useContext(nr),{hash:i,pathname:o,search:a}=Bp(n,{relative:t}),l=o;return r!=="/"&&(l=o==="/"?r:In([r,o])),s.createHref({pathname:l,search:a,hash:i})}function Ws(){return _.useContext(qo)!=null}function Wt(){return Ws()||Re(!1),_.useContext(qo).location}function Up(n){_.useContext(nr).static||_.useLayoutEffect(n)}function ct(){let{isDataRoute:n}=_.useContext(Nn);return n?Ox():Lx()}function Lx(){Ws()||Re(!1);let n=_.useContext(gc),{basename:e,future:t,navigator:r}=_.useContext(nr),{matches:s}=_.useContext(Nn),{pathname:i}=Wt(),o=JSON.stringify(Np(s,t.v7_relativeSplatPath)),a=_.useRef(!1);return Up(()=>{a.current=!0}),_.useCallback(function(u,c){if(c===void 0&&(c={}),!a.current)return;if(typeof u=="number"){r.go(u);return}let d=Op(u,JSON.parse(o),i,c.relative==="path");n==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:In([e,d.pathname])),(c.replace?r.replace:r.push)(d,c.state,c)},[e,r,o,i,n])}function Kr(){let{matches:n}=_.useContext(Nn),e=n[n.length-1];return e?e.params:{}}function Bp(n,e){let{relative:t}=e===void 0?{}:e,{future:r}=_.useContext(nr),{matches:s}=_.useContext(Nn),{pathname:i}=Wt(),o=JSON.stringify(Np(s,r.v7_relativeSplatPath));return _.useMemo(()=>Op(n,JSON.parse(o),i,t==="path"),[n,o,i,t])}function Rx(n,e){return Ax(n,e)}function Ax(n,e,t,r){Ws()||Re(!1);let{navigator:s}=_.useContext(nr),{matches:i}=_.useContext(Nn),o=i[i.length-1],a=o?o.params:{};o&&o.pathname;let l=o?o.pathnameBase:"/";o&&o.route;let u=Wt(),c;if(e){var d;let y=typeof e=="string"?Vr(e):e;l==="/"||(d=y.pathname)!=null&&d.startsWith(l)||Re(!1),c=y}else c=u;let f=c.pathname||"/",m=f;if(l!=="/"){let y=l.replace(/^\//,"").split("/");m="/"+f.replace(/^\//,"").split("/").slice(y.length).join("/")}let h=Zv(n,{pathname:m}),p=kx(h&&h.map(y=>Object.assign({},y,{params:Object.assign({},a,y.params),pathname:In([l,s.encodeLocation?s.encodeLocation(y.pathname).pathname:y.pathname]),pathnameBase:y.pathnameBase==="/"?l:In([l,s.encodeLocation?s.encodeLocation(y.pathnameBase).pathname:y.pathnameBase])})),i,t,r);return e&&p?_.createElement(qo.Provider,{value:{location:Ms({pathname:"/",search:"",hash:"",state:null,key:"default"},c),navigationType:xn.Pop}},p):p}function wx(){let n=Nx(),e=xx(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return _.createElement(_.Fragment,null,_.createElement("h2",null,"Unexpected Application Error!"),_.createElement("h3",{style:{fontStyle:"italic"}},e),t?_.createElement("pre",{style:s},t):null,null)}const Cx=_.createElement(wx,null);class Ix extends _.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?_.createElement(Nn.Provider,{value:this.props.routeContext},_.createElement(Mp.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Dx(n){let{routeContext:e,match:t,children:r}=n,s=_.useContext(gc);return s&&s.static&&s.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=t.route.id),_.createElement(Nn.Provider,{value:e},r)}function kx(n,e,t,r){var s;if(e===void 0&&(e=[]),t===void 0&&(t=null),r===void 0&&(r=null),n==null){var i;if((i=t)!=null&&i.errors)n=t.matches;else return null}let o=n,a=(s=t)==null?void 0:s.errors;if(a!=null){let c=o.findIndex(d=>d.route.id&&(a==null?void 0:a[d.route.id])!==void 0);c>=0||Re(!1),o=o.slice(0,Math.min(o.length,c+1))}let l=!1,u=-1;if(t&&r&&r.v7_partialHydration)for(let c=0;c<o.length;c++){let d=o[c];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(u=c),d.route.id){let{loaderData:f,errors:m}=t,h=d.route.loader&&f[d.route.id]===void 0&&(!m||m[d.route.id]===void 0);if(d.route.lazy||h){l=!0,u>=0?o=o.slice(0,u+1):o=[o[0]];break}}}return o.reduceRight((c,d,f)=>{let m,h=!1,p=null,y=null;t&&(m=a&&d.route.id?a[d.route.id]:void 0,p=d.route.errorElement||Cx,l&&(u<0&&f===0?(h=!0,y=null):u===f&&(h=!0,y=d.route.hydrateFallbackElement||null)));let g=e.concat(o.slice(0,f+1)),v=()=>{let x;return m?x=p:h?x=y:d.route.Component?x=_.createElement(d.route.Component,null):d.route.element?x=d.route.element:x=c,_.createElement(Dx,{match:d,routeContext:{outlet:c,matches:g,isDataRoute:t!=null},children:x})};return t&&(d.route.ErrorBoundary||d.route.errorElement||f===0)?_.createElement(Ix,{location:t.location,revalidation:t.revalidation,component:p,error:m,children:v(),routeContext:{outlet:null,matches:g,isDataRoute:!0}}):v()},null)}var $p=function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n}($p||{}),xo=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(xo||{});function bx(n){let e=_.useContext(gc);return e||Re(!1),e}function _x(n){let e=_.useContext(Sx);return e||Re(!1),e}function Px(n){let e=_.useContext(Nn);return e||Re(!1),e}function jp(n){let e=Px(),t=e.matches[e.matches.length-1];return t.route.id||Re(!1),t.route.id}function Nx(){var n;let e=_.useContext(Mp),t=_x(xo.UseRouteError),r=jp(xo.UseRouteError);return e!==void 0?e:(n=t.errors)==null?void 0:n[r]}function Ox(){let{router:n}=bx($p.UseNavigateStable),e=jp(xo.UseNavigateStable),t=_.useRef(!1);return Up(()=>{t.current=!0}),_.useCallback(function(s,i){i===void 0&&(i={}),t.current&&(typeof s=="number"?n.navigate(s):n.navigate(s,Ms({fromRouteId:e},i)))},[n,e])}function je(n){Re(!1)}function Fx(n){let{basename:e="/",children:t=null,location:r,navigationType:s=xn.Pop,navigator:i,static:o=!1,future:a}=n;Ws()&&Re(!1);let l=e.replace(/^\/*/,"/"),u=_.useMemo(()=>({basename:l,navigator:i,static:o,future:Ms({v7_relativeSplatPath:!1},a)}),[l,a,i,o]);typeof r=="string"&&(r=Vr(r));let{pathname:c="/",search:d="",hash:f="",state:m=null,key:h="default"}=r,p=_.useMemo(()=>{let y=pc(c,l);return y==null?null:{location:{pathname:y,search:d,hash:f,state:m,key:h},navigationType:s}},[l,c,d,f,m,h,s]);return p==null?null:_.createElement(nr.Provider,{value:u},_.createElement(qo.Provider,{children:t,value:p}))}function Mx(n){let{children:e,location:t}=n;return Rx(Xl(e),t)}new Promise(()=>{});function Xl(n,e){e===void 0&&(e=[]);let t=[];return _.Children.forEach(n,(r,s)=>{if(!_.isValidElement(r))return;let i=[...e,s];if(r.type===_.Fragment){t.push.apply(t,Xl(r.props.children,i));return}r.type!==je&&Re(!1),!r.props.index||!r.props.children||Re(!1);let o={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=Xl(r.props.children,i)),t.push(o)}),t}/**
 * React Router DOM v6.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ql(){return Ql=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Ql.apply(this,arguments)}function Ux(n,e){if(n==null)return{};var t={},r=Object.keys(n),s,i;for(i=0;i<r.length;i++)s=r[i],!(e.indexOf(s)>=0)&&(t[s]=n[s]);return t}function Bx(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function $x(n,e){return n.button===0&&(!e||e==="_self")&&!Bx(n)}function Jl(n){return n===void 0&&(n=""),new URLSearchParams(typeof n=="string"||Array.isArray(n)||n instanceof URLSearchParams?n:Object.keys(n).reduce((e,t)=>{let r=n[t];return e.concat(Array.isArray(r)?r.map(s=>[t,s]):[[t,r]])},[]))}function jx(n,e){let t=Jl(n);return e&&e.forEach((r,s)=>{t.has(s)||e.getAll(s).forEach(i=>{t.append(s,i)})}),t}const Gx=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],Hx="6";try{window.__reactRouterVersion=Hx}catch{}const Vx="startTransition",Zd=U0[Vx];function Kx(n){let{basename:e,children:t,future:r,window:s}=n,i=_.useRef();i.current==null&&(i.current=Xv({window:s,v5Compat:!0}));let o=i.current,[a,l]=_.useState({action:o.action,location:o.location}),{v7_startTransition:u}=r||{},c=_.useCallback(d=>{u&&Zd?Zd(()=>l(d)):l(d)},[l,u]);return _.useLayoutEffect(()=>o.listen(c),[o,c]),_.createElement(Fx,{basename:e,children:t,location:a.location,navigationType:a.action,navigator:o,future:r})}const zx=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Wx=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,hi=_.forwardRef(function(e,t){let{onClick:r,relative:s,reloadDocument:i,replace:o,state:a,target:l,to:u,preventScrollReset:c,unstable_viewTransition:d}=e,f=Ux(e,Gx),{basename:m}=_.useContext(nr),h,p=!1;if(typeof u=="string"&&Wx.test(u)&&(h=u,zx))try{let x=new URL(window.location.href),L=u.startsWith("//")?new URL(x.protocol+u):new URL(u),T=pc(L.pathname,m);L.origin===x.origin&&T!=null?u=T+L.search+L.hash:p=!0}catch{}let y=Tx(u,{relative:s}),g=Yx(u,{replace:o,state:a,target:l,preventScrollReset:c,relative:s,unstable_viewTransition:d});function v(x){r&&r(x),x.defaultPrevented||g(x)}return _.createElement("a",Ql({},f,{href:h||y,onClick:p||i?r:v,ref:t,target:l}))});var ef;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(ef||(ef={}));var tf;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(tf||(tf={}));function Yx(n,e){let{target:t,replace:r,state:s,preventScrollReset:i,relative:o,unstable_viewTransition:a}=e===void 0?{}:e,l=ct(),u=Wt(),c=Bp(n,{relative:o});return _.useCallback(d=>{if($x(d,t)){d.preventDefault();let f=r!==void 0?r:vo(u)===vo(c);l(n,{replace:f,state:s,preventScrollReset:i,relative:o,unstable_viewTransition:a})}},[u,l,c,r,s,t,n,i,o,a])}function Gp(n){let e=_.useRef(Jl(n)),t=_.useRef(!1),r=Wt(),s=_.useMemo(()=>jx(r.search,t.current?null:e.current),[r.search]),i=ct(),o=_.useCallback((a,l)=>{const u=Jl(typeof a=="function"?a(s):a);t.current=!0,i("?"+u,l)},[i,s]);return[s,o]}function Hp(n,e){return function(){return n.apply(e,arguments)}}const{toString:qx}=Object.prototype,{getPrototypeOf:yc}=Object,Xo=(n=>e=>{const t=qx.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),Pt=n=>(n=n.toLowerCase(),e=>Xo(e)===n),Qo=n=>e=>typeof e===n,{isArray:zr}=Array,Us=Qo("undefined");function Xx(n){return n!==null&&!Us(n)&&n.constructor!==null&&!Us(n.constructor)&&yt(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const Vp=Pt("ArrayBuffer");function Qx(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&Vp(n.buffer),e}const Jx=Qo("string"),yt=Qo("function"),Kp=Qo("number"),Jo=n=>n!==null&&typeof n=="object",Zx=n=>n===!0||n===!1,Mi=n=>{if(Xo(n)!=="object")return!1;const e=yc(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},eE=Pt("Date"),tE=Pt("File"),nE=Pt("Blob"),rE=Pt("FileList"),sE=n=>Jo(n)&&yt(n.pipe),iE=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||yt(n.append)&&((e=Xo(n))==="formdata"||e==="object"&&yt(n.toString)&&n.toString()==="[object FormData]"))},oE=Pt("URLSearchParams"),[aE,lE,uE,cE]=["ReadableStream","Request","Response","Headers"].map(Pt),dE=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Ys(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n>"u")return;let r,s;if(typeof n!="object"&&(n=[n]),zr(n))for(r=0,s=n.length;r<s;r++)e.call(null,n[r],r,n);else{const i=t?Object.getOwnPropertyNames(n):Object.keys(n),o=i.length;let a;for(r=0;r<o;r++)a=i[r],e.call(null,n[a],a,n)}}function zp(n,e){e=e.toLowerCase();const t=Object.keys(n);let r=t.length,s;for(;r-- >0;)if(s=t[r],e===s.toLowerCase())return s;return null}const Wp=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Yp=n=>!Us(n)&&n!==Wp;function Zl(){const{caseless:n}=Yp(this)&&this||{},e={},t=(r,s)=>{const i=n&&zp(e,s)||s;Mi(e[i])&&Mi(r)?e[i]=Zl(e[i],r):Mi(r)?e[i]=Zl({},r):zr(r)?e[i]=r.slice():e[i]=r};for(let r=0,s=arguments.length;r<s;r++)arguments[r]&&Ys(arguments[r],t);return e}const fE=(n,e,t,{allOwnKeys:r}={})=>(Ys(e,(s,i)=>{t&&yt(s)?n[i]=Hp(s,t):n[i]=s},{allOwnKeys:r}),n),hE=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),mE=(n,e,t,r)=>{n.prototype=Object.create(e.prototype,r),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},pE=(n,e,t,r)=>{let s,i,o;const a={};if(e=e||{},n==null)return e;do{for(s=Object.getOwnPropertyNames(n),i=s.length;i-- >0;)o=s[i],(!r||r(o,n,e))&&!a[o]&&(e[o]=n[o],a[o]=!0);n=t!==!1&&yc(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},gE=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const r=n.indexOf(e,t);return r!==-1&&r===t},yE=n=>{if(!n)return null;if(zr(n))return n;let e=n.length;if(!Kp(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},vE=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&yc(Uint8Array)),xE=(n,e)=>{const r=(n&&n[Symbol.iterator]).call(n);let s;for(;(s=r.next())&&!s.done;){const i=s.value;e.call(n,i[0],i[1])}},EE=(n,e)=>{let t;const r=[];for(;(t=n.exec(e))!==null;)r.push(t);return r},SE=Pt("HTMLFormElement"),TE=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,s){return r.toUpperCase()+s}),nf=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),LE=Pt("RegExp"),qp=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),r={};Ys(t,(s,i)=>{let o;(o=e(s,i,n))!==!1&&(r[i]=o||s)}),Object.defineProperties(n,r)},RE=n=>{qp(n,(e,t)=>{if(yt(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const r=n[t];if(yt(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},AE=(n,e)=>{const t={},r=s=>{s.forEach(i=>{t[i]=!0})};return zr(n)?r(n):r(String(n).split(e)),t},wE=()=>{},CE=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e,ba="abcdefghijklmnopqrstuvwxyz",rf="0123456789",Xp={DIGIT:rf,ALPHA:ba,ALPHA_DIGIT:ba+ba.toUpperCase()+rf},IE=(n=16,e=Xp.ALPHA_DIGIT)=>{let t="";const{length:r}=e;for(;n--;)t+=e[Math.random()*r|0];return t};function DE(n){return!!(n&&yt(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const kE=n=>{const e=new Array(10),t=(r,s)=>{if(Jo(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[s]=r;const i=zr(r)?[]:{};return Ys(r,(o,a)=>{const l=t(o,s+1);!Us(l)&&(i[a]=l)}),e[s]=void 0,i}}return r};return t(n,0)},bE=Pt("AsyncFunction"),_E=n=>n&&(Jo(n)||yt(n))&&yt(n.then)&&yt(n.catch),b={isArray:zr,isArrayBuffer:Vp,isBuffer:Xx,isFormData:iE,isArrayBufferView:Qx,isString:Jx,isNumber:Kp,isBoolean:Zx,isObject:Jo,isPlainObject:Mi,isReadableStream:aE,isRequest:lE,isResponse:uE,isHeaders:cE,isUndefined:Us,isDate:eE,isFile:tE,isBlob:nE,isRegExp:LE,isFunction:yt,isStream:sE,isURLSearchParams:oE,isTypedArray:vE,isFileList:rE,forEach:Ys,merge:Zl,extend:fE,trim:dE,stripBOM:hE,inherits:mE,toFlatObject:pE,kindOf:Xo,kindOfTest:Pt,endsWith:gE,toArray:yE,forEachEntry:xE,matchAll:EE,isHTMLForm:SE,hasOwnProperty:nf,hasOwnProp:nf,reduceDescriptors:qp,freezeMethods:RE,toObjectSet:AE,toCamelCase:TE,noop:wE,toFiniteNumber:CE,findKey:zp,global:Wp,isContextDefined:Yp,ALPHABET:Xp,generateString:IE,isSpecCompliantForm:DE,toJSONObject:kE,isAsyncFn:bE,isThenable:_E};function Z(n,e,t,r,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),r&&(this.request=r),s&&(this.response=s)}b.inherits(Z,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:b.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const Qp=Z.prototype,Jp={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{Jp[n]={value:n}});Object.defineProperties(Z,Jp);Object.defineProperty(Qp,"isAxiosError",{value:!0});Z.from=(n,e,t,r,s,i)=>{const o=Object.create(Qp);return b.toFlatObject(n,o,function(l){return l!==Error.prototype},a=>a!=="isAxiosError"),Z.call(o,n.message,e,t,r,s),o.cause=n,o.name=n.name,i&&Object.assign(o,i),o};const PE=null;function eu(n){return b.isPlainObject(n)||b.isArray(n)}function Zp(n){return b.endsWith(n,"[]")?n.slice(0,-2):n}function sf(n,e,t){return n?n.concat(e).map(function(s,i){return s=Zp(s),!t&&i?"["+s+"]":s}).join(t?".":""):e}function NE(n){return b.isArray(n)&&!n.some(eu)}const OE=b.toFlatObject(b,{},null,function(e){return/^is[A-Z]/.test(e)});function Zo(n,e,t){if(!b.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=b.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(p,y){return!b.isUndefined(y[p])});const r=t.metaTokens,s=t.visitor||c,i=t.dots,o=t.indexes,l=(t.Blob||typeof Blob<"u"&&Blob)&&b.isSpecCompliantForm(e);if(!b.isFunction(s))throw new TypeError("visitor must be a function");function u(h){if(h===null)return"";if(b.isDate(h))return h.toISOString();if(!l&&b.isBlob(h))throw new Z("Blob is not supported. Use a Buffer instead.");return b.isArrayBuffer(h)||b.isTypedArray(h)?l&&typeof Blob=="function"?new Blob([h]):Buffer.from(h):h}function c(h,p,y){let g=h;if(h&&!y&&typeof h=="object"){if(b.endsWith(p,"{}"))p=r?p:p.slice(0,-2),h=JSON.stringify(h);else if(b.isArray(h)&&NE(h)||(b.isFileList(h)||b.endsWith(p,"[]"))&&(g=b.toArray(h)))return p=Zp(p),g.forEach(function(x,L){!(b.isUndefined(x)||x===null)&&e.append(o===!0?sf([p],L,i):o===null?p:p+"[]",u(x))}),!1}return eu(h)?!0:(e.append(sf(y,p,i),u(h)),!1)}const d=[],f=Object.assign(OE,{defaultVisitor:c,convertValue:u,isVisitable:eu});function m(h,p){if(!b.isUndefined(h)){if(d.indexOf(h)!==-1)throw Error("Circular reference detected in "+p.join("."));d.push(h),b.forEach(h,function(g,v){(!(b.isUndefined(g)||g===null)&&s.call(e,g,b.isString(v)?v.trim():v,p,f))===!0&&m(g,p?p.concat(v):[v])}),d.pop()}}if(!b.isObject(n))throw new TypeError("data must be an object");return m(n),e}function of(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function vc(n,e){this._pairs=[],n&&Zo(n,this,e)}const eg=vc.prototype;eg.append=function(e,t){this._pairs.push([e,t])};eg.toString=function(e){const t=e?function(r){return e.call(this,r,of)}:of;return this._pairs.map(function(s){return t(s[0])+"="+t(s[1])},"").join("&")};function FE(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function tg(n,e,t){if(!e)return n;const r=t&&t.encode||FE,s=t&&t.serialize;let i;if(s?i=s(e,t):i=b.isURLSearchParams(e)?e.toString():new vc(e,t).toString(r),i){const o=n.indexOf("#");o!==-1&&(n=n.slice(0,o)),n+=(n.indexOf("?")===-1?"?":"&")+i}return n}class af{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){b.forEach(this.handlers,function(r){r!==null&&e(r)})}}const ng={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},ME=typeof URLSearchParams<"u"?URLSearchParams:vc,UE=typeof FormData<"u"?FormData:null,BE=typeof Blob<"u"?Blob:null,$E={isBrowser:!0,classes:{URLSearchParams:ME,FormData:UE,Blob:BE},protocols:["http","https","file","blob","url","data"]},xc=typeof window<"u"&&typeof document<"u",jE=(n=>xc&&["ReactNative","NativeScript","NS"].indexOf(n)<0)(typeof navigator<"u"&&navigator.product),GE=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",HE=xc&&window.location.href||"http://localhost",VE=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:xc,hasStandardBrowserEnv:jE,hasStandardBrowserWebWorkerEnv:GE,origin:HE},Symbol.toStringTag,{value:"Module"})),kt={...VE,...$E};function KE(n,e){return Zo(n,new kt.classes.URLSearchParams,Object.assign({visitor:function(t,r,s,i){return kt.isNode&&b.isBuffer(t)?(this.append(r,t.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},e))}function zE(n){return b.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function WE(n){const e={},t=Object.keys(n);let r;const s=t.length;let i;for(r=0;r<s;r++)i=t[r],e[i]=n[i];return e}function rg(n){function e(t,r,s,i){let o=t[i++];if(o==="__proto__")return!0;const a=Number.isFinite(+o),l=i>=t.length;return o=!o&&b.isArray(s)?s.length:o,l?(b.hasOwnProp(s,o)?s[o]=[s[o],r]:s[o]=r,!a):((!s[o]||!b.isObject(s[o]))&&(s[o]=[]),e(t,r,s[o],i)&&b.isArray(s[o])&&(s[o]=WE(s[o])),!a)}if(b.isFormData(n)&&b.isFunction(n.entries)){const t={};return b.forEachEntry(n,(r,s)=>{e(zE(r),s,t,0)}),t}return null}function YE(n,e,t){if(b.isString(n))try{return(e||JSON.parse)(n),b.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(t||JSON.stringify)(n)}const qs={transitional:ng,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const r=t.getContentType()||"",s=r.indexOf("application/json")>-1,i=b.isObject(e);if(i&&b.isHTMLForm(e)&&(e=new FormData(e)),b.isFormData(e))return s?JSON.stringify(rg(e)):e;if(b.isArrayBuffer(e)||b.isBuffer(e)||b.isStream(e)||b.isFile(e)||b.isBlob(e)||b.isReadableStream(e))return e;if(b.isArrayBufferView(e))return e.buffer;if(b.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(i){if(r.indexOf("application/x-www-form-urlencoded")>-1)return KE(e,this.formSerializer).toString();if((a=b.isFileList(e))||r.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return Zo(a?{"files[]":e}:e,l&&new l,this.formSerializer)}}return i||s?(t.setContentType("application/json",!1),YE(e)):e}],transformResponse:[function(e){const t=this.transitional||qs.transitional,r=t&&t.forcedJSONParsing,s=this.responseType==="json";if(b.isResponse(e)||b.isReadableStream(e))return e;if(e&&b.isString(e)&&(r&&!this.responseType||s)){const o=!(t&&t.silentJSONParsing)&&s;try{return JSON.parse(e)}catch(a){if(o)throw a.name==="SyntaxError"?Z.from(a,Z.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:kt.classes.FormData,Blob:kt.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};b.forEach(["delete","get","head","post","put","patch"],n=>{qs.headers[n]={}});const qE=b.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),XE=n=>{const e={};let t,r,s;return n&&n.split(`
`).forEach(function(o){s=o.indexOf(":"),t=o.substring(0,s).trim().toLowerCase(),r=o.substring(s+1).trim(),!(!t||e[t]&&qE[t])&&(t==="set-cookie"?e[t]?e[t].push(r):e[t]=[r]:e[t]=e[t]?e[t]+", "+r:r)}),e},lf=Symbol("internals");function rs(n){return n&&String(n).trim().toLowerCase()}function Ui(n){return n===!1||n==null?n:b.isArray(n)?n.map(Ui):String(n)}function QE(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=t.exec(n);)e[r[1]]=r[2];return e}const JE=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function _a(n,e,t,r,s){if(b.isFunction(r))return r.call(this,e,t);if(s&&(e=t),!!b.isString(e)){if(b.isString(r))return e.indexOf(r)!==-1;if(b.isRegExp(r))return r.test(e)}}function ZE(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}function eS(n,e){const t=b.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(n,r+t,{value:function(s,i,o){return this[r].call(this,e,s,i,o)},configurable:!0})})}class nt{constructor(e){e&&this.set(e)}set(e,t,r){const s=this;function i(a,l,u){const c=rs(l);if(!c)throw new Error("header name must be a non-empty string");const d=b.findKey(s,c);(!d||s[d]===void 0||u===!0||u===void 0&&s[d]!==!1)&&(s[d||l]=Ui(a))}const o=(a,l)=>b.forEach(a,(u,c)=>i(u,c,l));if(b.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(b.isString(e)&&(e=e.trim())&&!JE(e))o(XE(e),t);else if(b.isHeaders(e))for(const[a,l]of e.entries())i(l,a,r);else e!=null&&i(t,e,r);return this}get(e,t){if(e=rs(e),e){const r=b.findKey(this,e);if(r){const s=this[r];if(!t)return s;if(t===!0)return QE(s);if(b.isFunction(t))return t.call(this,s,r);if(b.isRegExp(t))return t.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=rs(e),e){const r=b.findKey(this,e);return!!(r&&this[r]!==void 0&&(!t||_a(this,this[r],r,t)))}return!1}delete(e,t){const r=this;let s=!1;function i(o){if(o=rs(o),o){const a=b.findKey(r,o);a&&(!t||_a(r,r[a],a,t))&&(delete r[a],s=!0)}}return b.isArray(e)?e.forEach(i):i(e),s}clear(e){const t=Object.keys(this);let r=t.length,s=!1;for(;r--;){const i=t[r];(!e||_a(this,this[i],i,e,!0))&&(delete this[i],s=!0)}return s}normalize(e){const t=this,r={};return b.forEach(this,(s,i)=>{const o=b.findKey(r,i);if(o){t[o]=Ui(s),delete t[i];return}const a=e?ZE(i):String(i).trim();a!==i&&delete t[i],t[a]=Ui(s),r[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return b.forEach(this,(r,s)=>{r!=null&&r!==!1&&(t[s]=e&&b.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach(s=>r.set(s)),r}static accessor(e){const r=(this[lf]=this[lf]={accessors:{}}).accessors,s=this.prototype;function i(o){const a=rs(o);r[a]||(eS(s,o),r[a]=!0)}return b.isArray(e)?e.forEach(i):i(e),this}}nt.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);b.reduceDescriptors(nt.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(r){this[t]=r}}});b.freezeMethods(nt);function Pa(n,e){const t=this||qs,r=e||t,s=nt.from(r.headers);let i=r.data;return b.forEach(n,function(a){i=a.call(t,i,s.normalize(),e?e.status:void 0)}),s.normalize(),i}function sg(n){return!!(n&&n.__CANCEL__)}function Wr(n,e,t){Z.call(this,n??"canceled",Z.ERR_CANCELED,e,t),this.name="CanceledError"}b.inherits(Wr,Z,{__CANCEL__:!0});function ig(n,e,t){const r=t.config.validateStatus;!t.status||!r||r(t.status)?n(t):e(new Z("Request failed with status code "+t.status,[Z.ERR_BAD_REQUEST,Z.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function tS(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function nS(n,e){n=n||10;const t=new Array(n),r=new Array(n);let s=0,i=0,o;return e=e!==void 0?e:1e3,function(l){const u=Date.now(),c=r[i];o||(o=u),t[s]=l,r[s]=u;let d=i,f=0;for(;d!==s;)f+=t[d++],d=d%n;if(s=(s+1)%n,s===i&&(i=(i+1)%n),u-o<e)return;const m=c&&u-c;return m?Math.round(f*1e3/m):void 0}}function rS(n,e){let t=0;const r=1e3/e;let s=null;return function(){const o=this===!0,a=Date.now();if(o||a-t>r)return s&&(clearTimeout(s),s=null),t=a,n.apply(null,arguments);s||(s=setTimeout(()=>(s=null,t=Date.now(),n.apply(null,arguments)),r-(a-t)))}}const Eo=(n,e,t=3)=>{let r=0;const s=nS(50,250);return rS(i=>{const o=i.loaded,a=i.lengthComputable?i.total:void 0,l=o-r,u=s(l),c=o<=a;r=o;const d={loaded:o,total:a,progress:a?o/a:void 0,bytes:l,rate:u||void 0,estimated:u&&a&&c?(a-o)/u:void 0,event:i,lengthComputable:a!=null};d[e?"download":"upload"]=!0,n(d)},t)},sS=kt.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let r;function s(i){let o=i;return e&&(t.setAttribute("href",o),o=t.href),t.setAttribute("href",o),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return r=s(window.location.href),function(o){const a=b.isString(o)?s(o):o;return a.protocol===r.protocol&&a.host===r.host}}():function(){return function(){return!0}}(),iS=kt.hasStandardBrowserEnv?{write(n,e,t,r,s,i){const o=[n+"="+encodeURIComponent(e)];b.isNumber(t)&&o.push("expires="+new Date(t).toGMTString()),b.isString(r)&&o.push("path="+r),b.isString(s)&&o.push("domain="+s),i===!0&&o.push("secure"),document.cookie=o.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function oS(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function aS(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function og(n,e){return n&&!oS(e)?aS(n,e):e}const uf=n=>n instanceof nt?{...n}:n;function Jn(n,e){e=e||{};const t={};function r(u,c,d){return b.isPlainObject(u)&&b.isPlainObject(c)?b.merge.call({caseless:d},u,c):b.isPlainObject(c)?b.merge({},c):b.isArray(c)?c.slice():c}function s(u,c,d){if(b.isUndefined(c)){if(!b.isUndefined(u))return r(void 0,u,d)}else return r(u,c,d)}function i(u,c){if(!b.isUndefined(c))return r(void 0,c)}function o(u,c){if(b.isUndefined(c)){if(!b.isUndefined(u))return r(void 0,u)}else return r(void 0,c)}function a(u,c,d){if(d in e)return r(u,c);if(d in n)return r(void 0,u)}const l={url:i,method:i,data:i,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(u,c)=>s(uf(u),uf(c),!0)};return b.forEach(Object.keys(Object.assign({},n,e)),function(c){const d=l[c]||s,f=d(n[c],e[c],c);b.isUndefined(f)&&d!==a||(t[c]=f)}),t}const ag=n=>{const e=Jn({},n);let{data:t,withXSRFToken:r,xsrfHeaderName:s,xsrfCookieName:i,headers:o,auth:a}=e;e.headers=o=nt.from(o),e.url=tg(og(e.baseURL,e.url),n.params,n.paramsSerializer),a&&o.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):"")));let l;if(b.isFormData(t)){if(kt.hasStandardBrowserEnv||kt.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((l=o.getContentType())!==!1){const[u,...c]=l?l.split(";").map(d=>d.trim()).filter(Boolean):[];o.setContentType([u||"multipart/form-data",...c].join("; "))}}if(kt.hasStandardBrowserEnv&&(r&&b.isFunction(r)&&(r=r(e)),r||r!==!1&&sS(e.url))){const u=s&&i&&iS.read(i);u&&o.set(s,u)}return e},lS=typeof XMLHttpRequest<"u",uS=lS&&function(n){return new Promise(function(t,r){const s=ag(n);let i=s.data;const o=nt.from(s.headers).normalize();let{responseType:a}=s,l;function u(){s.cancelToken&&s.cancelToken.unsubscribe(l),s.signal&&s.signal.removeEventListener("abort",l)}let c=new XMLHttpRequest;c.open(s.method.toUpperCase(),s.url,!0),c.timeout=s.timeout;function d(){if(!c)return;const m=nt.from("getAllResponseHeaders"in c&&c.getAllResponseHeaders()),p={data:!a||a==="text"||a==="json"?c.responseText:c.response,status:c.status,statusText:c.statusText,headers:m,config:n,request:c};ig(function(g){t(g),u()},function(g){r(g),u()},p),c=null}"onloadend"in c?c.onloadend=d:c.onreadystatechange=function(){!c||c.readyState!==4||c.status===0&&!(c.responseURL&&c.responseURL.indexOf("file:")===0)||setTimeout(d)},c.onabort=function(){c&&(r(new Z("Request aborted",Z.ECONNABORTED,s,c)),c=null)},c.onerror=function(){r(new Z("Network Error",Z.ERR_NETWORK,s,c)),c=null},c.ontimeout=function(){let h=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const p=s.transitional||ng;s.timeoutErrorMessage&&(h=s.timeoutErrorMessage),r(new Z(h,p.clarifyTimeoutError?Z.ETIMEDOUT:Z.ECONNABORTED,s,c)),c=null},i===void 0&&o.setContentType(null),"setRequestHeader"in c&&b.forEach(o.toJSON(),function(h,p){c.setRequestHeader(p,h)}),b.isUndefined(s.withCredentials)||(c.withCredentials=!!s.withCredentials),a&&a!=="json"&&(c.responseType=s.responseType),typeof s.onDownloadProgress=="function"&&c.addEventListener("progress",Eo(s.onDownloadProgress,!0)),typeof s.onUploadProgress=="function"&&c.upload&&c.upload.addEventListener("progress",Eo(s.onUploadProgress)),(s.cancelToken||s.signal)&&(l=m=>{c&&(r(!m||m.type?new Wr(null,n,c):m),c.abort(),c=null)},s.cancelToken&&s.cancelToken.subscribe(l),s.signal&&(s.signal.aborted?l():s.signal.addEventListener("abort",l)));const f=tS(s.url);if(f&&kt.protocols.indexOf(f)===-1){r(new Z("Unsupported protocol "+f+":",Z.ERR_BAD_REQUEST,n));return}c.send(i||null)})},cS=(n,e)=>{let t=new AbortController,r;const s=function(l){if(!r){r=!0,o();const u=l instanceof Error?l:this.reason;t.abort(u instanceof Z?u:new Wr(u instanceof Error?u.message:u))}};let i=e&&setTimeout(()=>{s(new Z(`timeout ${e} of ms exceeded`,Z.ETIMEDOUT))},e);const o=()=>{n&&(i&&clearTimeout(i),i=null,n.forEach(l=>{l&&(l.removeEventListener?l.removeEventListener("abort",s):l.unsubscribe(s))}),n=null)};n.forEach(l=>l&&l.addEventListener&&l.addEventListener("abort",s));const{signal:a}=t;return a.unsubscribe=o,[a,()=>{i&&clearTimeout(i),i=null}]},dS=function*(n,e){let t=n.byteLength;if(!e||t<e){yield n;return}let r=0,s;for(;r<t;)s=r+e,yield n.slice(r,s),r=s},fS=async function*(n,e,t){for await(const r of n)yield*dS(ArrayBuffer.isView(r)?r:await t(String(r)),e)},cf=(n,e,t,r,s)=>{const i=fS(n,e,s);let o=0;return new ReadableStream({type:"bytes",async pull(a){const{done:l,value:u}=await i.next();if(l){a.close(),r();return}let c=u.byteLength;t&&t(o+=c),a.enqueue(new Uint8Array(u))},cancel(a){return r(a),i.return()}},{highWaterMark:2})},df=(n,e)=>{const t=n!=null;return r=>setTimeout(()=>e({lengthComputable:t,total:n,loaded:r}))},ea=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",lg=ea&&typeof ReadableStream=="function",tu=ea&&(typeof TextEncoder=="function"?(n=>e=>n.encode(e))(new TextEncoder):async n=>new Uint8Array(await new Response(n).arrayBuffer())),hS=lg&&(()=>{let n=!1;const e=new Request(kt.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!e})(),ff=64*1024,nu=lg&&!!(()=>{try{return b.isReadableStream(new Response("").body)}catch{}})(),So={stream:nu&&(n=>n.body)};ea&&(n=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!So[e]&&(So[e]=b.isFunction(n[e])?t=>t[e]():(t,r)=>{throw new Z(`Response type '${e}' is not supported`,Z.ERR_NOT_SUPPORT,r)})})})(new Response);const mS=async n=>{if(n==null)return 0;if(b.isBlob(n))return n.size;if(b.isSpecCompliantForm(n))return(await new Request(n).arrayBuffer()).byteLength;if(b.isArrayBufferView(n))return n.byteLength;if(b.isURLSearchParams(n)&&(n=n+""),b.isString(n))return(await tu(n)).byteLength},pS=async(n,e)=>{const t=b.toFiniteNumber(n.getContentLength());return t??mS(e)},gS=ea&&(async n=>{let{url:e,method:t,data:r,signal:s,cancelToken:i,timeout:o,onDownloadProgress:a,onUploadProgress:l,responseType:u,headers:c,withCredentials:d="same-origin",fetchOptions:f}=ag(n);u=u?(u+"").toLowerCase():"text";let[m,h]=s||i||o?cS([s,i],o):[],p,y;const g=()=>{!p&&setTimeout(()=>{m&&m.unsubscribe()}),p=!0};let v;try{if(l&&hS&&t!=="get"&&t!=="head"&&(v=await pS(c,r))!==0){let A=new Request(e,{method:"POST",body:r,duplex:"half"}),R;b.isFormData(r)&&(R=A.headers.get("content-type"))&&c.setContentType(R),A.body&&(r=cf(A.body,ff,df(v,Eo(l)),null,tu))}b.isString(d)||(d=d?"cors":"omit"),y=new Request(e,{...f,signal:m,method:t.toUpperCase(),headers:c.normalize().toJSON(),body:r,duplex:"half",withCredentials:d});let x=await fetch(y);const L=nu&&(u==="stream"||u==="response");if(nu&&(a||L)){const A={};["status","statusText","headers"].forEach(I=>{A[I]=x[I]});const R=b.toFiniteNumber(x.headers.get("content-length"));x=new Response(cf(x.body,ff,a&&df(R,Eo(a,!0)),L&&g,tu),A)}u=u||"text";let T=await So[b.findKey(So,u)||"text"](x,n);return!L&&g(),h&&h(),await new Promise((A,R)=>{ig(A,R,{data:T,headers:nt.from(x.headers),status:x.status,statusText:x.statusText,config:n,request:y})})}catch(x){throw g(),x&&x.name==="TypeError"&&/fetch/i.test(x.message)?Object.assign(new Z("Network Error",Z.ERR_NETWORK,n,y),{cause:x.cause||x}):Z.from(x,x&&x.code,n,y)}}),ru={http:PE,xhr:uS,fetch:gS};b.forEach(ru,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const hf=n=>`- ${n}`,yS=n=>b.isFunction(n)||n===null||n===!1,ug={getAdapter:n=>{n=b.isArray(n)?n:[n];const{length:e}=n;let t,r;const s={};for(let i=0;i<e;i++){t=n[i];let o;if(r=t,!yS(t)&&(r=ru[(o=String(t)).toLowerCase()],r===void 0))throw new Z(`Unknown adapter '${o}'`);if(r)break;s[o||"#"+i]=r}if(!r){const i=Object.entries(s).map(([a,l])=>`adapter ${a} `+(l===!1?"is not supported by the environment":"is not available in the build"));let o=e?i.length>1?`since :
`+i.map(hf).join(`
`):" "+hf(i[0]):"as no adapter specified";throw new Z("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return r},adapters:ru};function Na(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Wr(null,n)}function mf(n){return Na(n),n.headers=nt.from(n.headers),n.data=Pa.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),ug.getAdapter(n.adapter||qs.adapter)(n).then(function(r){return Na(n),r.data=Pa.call(n,n.transformResponse,r),r.headers=nt.from(r.headers),r},function(r){return sg(r)||(Na(n),r&&r.response&&(r.response.data=Pa.call(n,n.transformResponse,r.response),r.response.headers=nt.from(r.response.headers))),Promise.reject(r)})}const cg="1.7.2",Ec={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{Ec[n]=function(r){return typeof r===n||"a"+(e<1?"n ":" ")+n}});const pf={};Ec.transitional=function(e,t,r){function s(i,o){return"[Axios v"+cg+"] Transitional option '"+i+"'"+o+(r?". "+r:"")}return(i,o,a)=>{if(e===!1)throw new Z(s(o," has been removed"+(t?" in "+t:"")),Z.ERR_DEPRECATED);return t&&!pf[o]&&(pf[o]=!0,console.warn(s(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(i,o,a):!0}};function vS(n,e,t){if(typeof n!="object")throw new Z("options must be an object",Z.ERR_BAD_OPTION_VALUE);const r=Object.keys(n);let s=r.length;for(;s-- >0;){const i=r[s],o=e[i];if(o){const a=n[i],l=a===void 0||o(a,i,n);if(l!==!0)throw new Z("option "+i+" must be "+l,Z.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new Z("Unknown option "+i,Z.ERR_BAD_OPTION)}}const su={assertOptions:vS,validators:Ec},cn=su.validators;class Kn{constructor(e){this.defaults=e,this.interceptors={request:new af,response:new af}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let s;Error.captureStackTrace?Error.captureStackTrace(s={}):s=new Error;const i=s.stack?s.stack.replace(/^.+\n/,""):"";try{r.stack?i&&!String(r.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+i):r.stack=i}catch{}}throw r}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Jn(this.defaults,t);const{transitional:r,paramsSerializer:s,headers:i}=t;r!==void 0&&su.assertOptions(r,{silentJSONParsing:cn.transitional(cn.boolean),forcedJSONParsing:cn.transitional(cn.boolean),clarifyTimeoutError:cn.transitional(cn.boolean)},!1),s!=null&&(b.isFunction(s)?t.paramsSerializer={serialize:s}:su.assertOptions(s,{encode:cn.function,serialize:cn.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=i&&b.merge(i.common,i[t.method]);i&&b.forEach(["delete","get","head","post","put","patch","common"],h=>{delete i[h]}),t.headers=nt.concat(o,i);const a=[];let l=!0;this.interceptors.request.forEach(function(p){typeof p.runWhen=="function"&&p.runWhen(t)===!1||(l=l&&p.synchronous,a.unshift(p.fulfilled,p.rejected))});const u=[];this.interceptors.response.forEach(function(p){u.push(p.fulfilled,p.rejected)});let c,d=0,f;if(!l){const h=[mf.bind(this),void 0];for(h.unshift.apply(h,a),h.push.apply(h,u),f=h.length,c=Promise.resolve(t);d<f;)c=c.then(h[d++],h[d++]);return c}f=a.length;let m=t;for(d=0;d<f;){const h=a[d++],p=a[d++];try{m=h(m)}catch(y){p.call(this,y);break}}try{c=mf.call(this,m)}catch(h){return Promise.reject(h)}for(d=0,f=u.length;d<f;)c=c.then(u[d++],u[d++]);return c}getUri(e){e=Jn(this.defaults,e);const t=og(e.baseURL,e.url);return tg(t,e.params,e.paramsSerializer)}}b.forEach(["delete","get","head","options"],function(e){Kn.prototype[e]=function(t,r){return this.request(Jn(r||{},{method:e,url:t,data:(r||{}).data}))}});b.forEach(["post","put","patch"],function(e){function t(r){return function(i,o,a){return this.request(Jn(a||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:i,data:o}))}}Kn.prototype[e]=t(),Kn.prototype[e+"Form"]=t(!0)});class Sc{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(i){t=i});const r=this;this.promise.then(s=>{if(!r._listeners)return;let i=r._listeners.length;for(;i-- >0;)r._listeners[i](s);r._listeners=null}),this.promise.then=s=>{let i;const o=new Promise(a=>{r.subscribe(a),i=a}).then(s);return o.cancel=function(){r.unsubscribe(i)},o},e(function(i,o,a){r.reason||(r.reason=new Wr(i,o,a),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}static source(){let e;return{token:new Sc(function(s){e=s}),cancel:e}}}function xS(n){return function(t){return n.apply(null,t)}}function ES(n){return b.isObject(n)&&n.isAxiosError===!0}const iu={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(iu).forEach(([n,e])=>{iu[e]=n});function dg(n){const e=new Kn(n),t=Hp(Kn.prototype.request,e);return b.extend(t,Kn.prototype,e,{allOwnKeys:!0}),b.extend(t,e,null,{allOwnKeys:!0}),t.create=function(s){return dg(Jn(n,s))},t}const Te=dg(qs);Te.Axios=Kn;Te.CanceledError=Wr;Te.CancelToken=Sc;Te.isCancel=sg;Te.VERSION=cg;Te.toFormData=Zo;Te.AxiosError=Z;Te.Cancel=Te.CanceledError;Te.all=function(e){return Promise.all(e)};Te.spread=xS;Te.isAxiosError=ES;Te.mergeConfig=Jn;Te.AxiosHeaders=nt;Te.formToJSON=n=>rg(b.isHTMLForm(n)?new FormData(n):n);Te.getAdapter=ug.getAdapter;Te.HttpStatusCode=iu;Te.default=Te;const rt=Te.create({baseURL:"https://botsailer-api.vercel.app"});function SS(){const[n,e]=_.useState([]),[t,r]=_.useState([]),[s,i]=_.useState(""),[o,a]=_.useState(1),l=ct();_.useEffect(()=>{(async()=>{const f=await rt.get(`/meta/anilist/popular?perPage=20&page=${o}`);e(f.data.results)})()},[o]),_.useEffect(()=>{(async()=>{const f=await rt.get("/anime/gogoanime/recent-episodes");console.log(f.data.results),r(f.data.results)})()},[]);const u=["Action","Adventure","Comedy","Drama","Fantasy","Horror","Romance","Sci-Fi"],c=d=>{i(d.target.value)};return S.jsxs("div",{className:"container mx-auto",children:[S.jsxs("form",{onSubmit:d=>{d.preventDefault(),l(`/search/${s.replace(/ /g,"-").toLowerCase()}`)},className:"flex flex-col md:flex-row items-center justify-between py-4 px-2 md:px-0 bg-gray-900 text-white",children:[S.jsx("h1",{className:"text-4xl text-center md:text-left mb-4 md:mb-0 w-full font-bold",children:"Depressed Zone"}),S.jsx("input",{type:"text",placeholder:"Search anime...",value:s,onChange:c,className:"px-2 py-1 rounded border border-gray-300 w-full md:w-auto bg-white text-gray-900"}),S.jsx("input",{type:"submit",value:"Search",className:"mt-2 md:mt-0 md:ml-2 px-2 py-1 rounded bg-white text-gray-900 cursor-pointer"})]}),S.jsxs("section",{className:"mb-8",children:[S.jsx("h2",{className:"text-2xl font-bold mb-4 mt-8",children:"Top Popular Anime"}),S.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:n.map(d=>S.jsxs("div",{onClick:()=>l(`/search/${d.title.english.replace(/ /g,"-").toLowerCase()}`),className:"flex flex-col items-center mb-4 border-2 border-gray-300 rounded p-4 hover:shadow-lg transition duration-300 cursor-pointer",children:[S.jsx("img",{src:d.image,alt:d.title.english,className:"w-40 h-52 rounded mb-2"}),S.jsxs("div",{className:"mt-2 text-center",children:[S.jsx("h3",{className:"font-bold",children:d.title.english}),S.jsxs("p",{className:"text-sm",children:["Released Year ",d.releaseDate," | Status: ",d.status]}),S.jsxs("p",{className:"text-sm",children:["Episodes: ",d.totalEpisodes]}),S.jsx("div",{className:"flex flex-wrap justify-center mt-2",children:d.genres.map((f,m)=>S.jsx("span",{className:"m-1 p-1 bg-blue-500 text-white text-xs rounded",children:f},m))})]})]},d.id))}),S.jsxs("div",{className:"pagination flex justify-center mt-8",children:[S.jsx("button",{onClick:()=>a(o>1?o-1:1),className:"px-4 py-2 bg-gray-300  text-black font-bold rounded mr-2 hover:bg-gray-400",children:"Previous"}),S.jsxs("span",{className:"px-4 py-2 bg-gray-300 text-black font-bold rounded mr-2",children:["Page ",o]}),S.jsx("button",{onClick:()=>a(o+1),className:"px-4 py-2 bg-gray-300 text-black font-bold rounded hover:bg-gray-400",children:"Next"})]})]}),S.jsxs("section",{className:"mb-8",children:[S.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Recent Episodes "}),S.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:t.map(d=>S.jsxs("div",{onClick:()=>l("/episodes",{state:{preplayer:d.episodeId}}),className:"flex flex-col items-center mb-4 border-2 border-gray-300 rounded p-4 hover:shadow-lg transition duration-300",children:[S.jsx("img",{src:d.image,alt:d.title,className:"w-40 h-52 rounded mb-2"}),S.jsx("div",{className:"mt-2 text-center",children:S.jsx("h3",{className:"font-bold",children:d.title})}),S.jsxs("p",{children:[S.jsx("span",{className:"font-bold",children:"Episode:"})," ",d.episodeNumber]})]},d.id))})]}),S.jsxs("section",{className:"mb-8",children:[S.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Genres"}),S.jsx("div",{className:"flex flex-wrap justify-center",children:u.map(d=>S.jsx("button",{className:"px-4 py-2 rounded bg-blue-500 text-white mr-2 mb-2 hover:bg-blue-600 transition duration-300",children:d},d))})]})]})}function _t(){return S.jsx("div",{className:"flex justify-center items-center h-screen",children:S.jsxs("div",{children:[S.jsx("img",{src:"/loading.gif",alt:"Loading"}),S.jsx("br",{}),S.jsx("h1",{className:"text-2xl font-bold",children:"Loading..."})]})})}function TS(){const{anime:n}=Kr(),[e,t]=_.useState([]),[r,s]=_.useState(1),[i,o]=_.useState(!0),[a,l]=_.useState(0),[u,c]=_.useState(!1),d=ct();_.useEffect(()=>{n&&(async()=>{c(!0);const p=await rt.get(`/anime/gogoanime/${n}?page=${r}`);t(p.data.results),console.log(p.data),o(p.data.hasNextPage),l(p.data.totalPages),c(!1)})()},[n,r]);const f=()=>{s(r+1)},m=()=>{r>1&&s(r-1)};return n?u?S.jsx(_t,{}):S.jsxs("div",{className:"container mx-auto",children:[S.jsxs("h1",{className:"text-3xl font-bold mt-8 mb-4",children:["Search query: ",n]}),S.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:e.map(h=>h.status!=="NOT_YET_RELEASED"&&S.jsxs("div",{onClick:()=>d(`/anime/${h.id}`),className:"flex flex-col items-center mb-4 border-2 border-gray-300 rounded p-4 hover:shadow-lg transition duration-300 cursor-pointer",children:[S.jsx("img",{src:h.image,alt:h.title,className:"w-40 h-52 rounded mb-2"}),S.jsxs("div",{className:"mt-2 text-center",children:[S.jsx("h3",{className:"font-bold",children:h.title}),S.jsxs("p",{children:["Total Ep: ",h.episodes," | Dub: ",h.dub," | Sub: ",h.sub," episodes"]}),S.jsxs("div",{className:"flex flex-wrap justify-center mt-2",children:[h.nsfw?S.jsx("span",{className:" font-bold p-1 text-white bg-orange-900",children:"18+"}):S.jsx(S.Fragment,{}),h.type==="OVA"?S.jsx("span",{className:" ml-2 font-bold p-1 text-white bg-emerald-900",children:"OVA"}):null]}),S.jsx("p",{className:"text-sm text-gray-700",children:h.score})]})]},h.id))}),S.jsxs("div",{className:"flex justify-center mt-8",children:[r>1&&S.jsx("button",{onClick:m,className:`px-4 py-2 text-black font-bold rounded mr-2 ${r===1?"bg-gray-200":"bg-gray-300 hover:bg-gray-400"}`,disabled:r===1,children:"Previous"}),S.jsxs("span",{className:"px-4 py-2  text-black font-bold bg-gray-300 rounded mr-2",children:["Page ",r," out of ",a&&1]}),i&&S.jsx("button",{onClick:()=>{event.target.disabled=!0,f()},className:"px-4 py-2 text-black font-bold bg-gray-300 rounded hover:bg-gray-400",children:"Next"})]})]}):window.location.href="/"}function LS(){const n=()=>{window.location.href="/"};return S.jsxs("div",{className:"fixed top-0 left-0 w-full h-full overflow-hidden",children:[S.jsx("video",{autoPlay:!0,loop:!0,muted:!0,className:"absolute top-0 left-0 w-full h-full object-cover z-[-1]",children:S.jsx("source",{src:"1.webm",type:"video/webm"})}),S.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-black bg-opacity-50 z-[-1]"}),S.jsxs("div",{className:"container mx-auto h-full flex flex-col justify-center items-center text-white px-4",children:[S.jsx("h1",{style:{fontSize:"5rem",fontWeight:"bold",marginBottom:"1rem",textAlign:"center",fontFamily:"serif"},children:"Error 404. Page Not Found."}),S.jsx("p",{className:"text-2xl mb-8 text-center font-poppins",children:"Head back to previous page?"}),S.jsx("div",{className:"flex justify-center",children:S.jsx("button",{onClick:n,className:"px-8 py-3 bg-[#f74a1e] text-[#0eff06] text-xl font-bold rounded-lg shadow-lg hover:shadow-[#0ef165] transition-shadow duration-300",children:"Head Back"})})]})]})}function RS(){const{id:n}=Kr(),[e,t]=_.useState(null),r=ct();if(_.useEffect(()=>{(async()=>{const o=await rt.get(`/anime/gogoanime/info/${n}`);t(o.data),console.log(o.data),window.scrollTo(0,0)})()},[n]),!e)return S.jsx(_t,{});const s=()=>({__html:e.description});return S.jsxs("div",{className:"container mx-auto px-4 py-8",children:[S.jsx("h1",{className:"text-4xl font-bold mb-4",children:e.title}),S.jsxs("div",{className:"flex flex-col md:flex-row",children:[S.jsx("div",{className:"md:w-full",children:S.jsx("img",{src:e.image,alt:e.title,className:"w-full h-auto mb-4"})}),S.jsxs("div",{className:"md:w-2/3 md:pl-8",children:[S.jsx("p",{className:"text-lg mb-4",dangerouslySetInnerHTML:s()}),S.jsxs("div",{className:"mb-4",children:[S.jsx("span",{className:"font-bold",children:"Type:"})," ",e.type]}),S.jsxs("div",{className:"mb-4",children:[S.jsx("span",{className:"font-bold",children:"Episodes:"})," ",e.totalEpisodes]}),S.jsx("button",{className:"bg-blue-500 text-white px-4 py-2 rounded mt-4",onClick:()=>r("/episodes",{state:e.episodes}),children:"View Now"})]})]})]})}function AS(){var m;const e=(m=Wt().state)==null?void 0:m.data,[t,r]=_.useState(null),[s,i]=_.useState(1),o=50;if(!e||e.length===0)return S.jsx("div",{className:"text-center text-2xl mt-8",children:"No artwork available."});const a=h=>{r(h)},l=()=>{r(null)},u=()=>{i(h=>h+1)},c=(s-1)*o,d=c+o,f=e.slice(c,d);return S.jsxs("div",{className:"container mx-auto px-4 py-8",children:[S.jsx("h1",{className:"text-4xl font-bold mb-4",children:"Artwork"}),S.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:f.map((h,p)=>S.jsx("div",{className:"flex flex-col items-center",children:S.jsx("img",{src:h.img,alt:`Artwork ${p+1}`,className:"w-full h-auto mb-2 cursor-pointer",onClick:()=>a(h.img)})},p))}),d<e.length&&S.jsx("div",{className:"text-center mt-8",children:S.jsx("button",{className:"bg-blue-500 text-white px-4 py-2 rounded",onClick:u,children:"Load More"})}),t&&S.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-75",children:S.jsxs("div",{className:"max-w-full max-h-full",children:[S.jsx("img",{src:t,alt:"Selected Artwork",className:"max-w-full max-h-full"}),S.jsx("button",{className:"absolute top-4 right-4 text-white text-2xl",onClick:l,children:""})]})})]})}function wS(){const[n,e]=_.useState([]),[t,r]=_.useState(1),[s,i]=_.useState(""),[o,a]=_.useState(!1),[l,u]=_.useState(!1),[c,d]=_.useState(!1),f=ct(),m="https://manga-api-vercel.vercel.app/api/mangalist";_.useEffect(()=>{(async()=>{d(!0),await Te.get(m).then(v=>{console.log(v.data),e(v.data.mangaList)}).catch(v=>{console.error("Error fetching data: ",v)}),d(!1)})(),localStorage.getItem("neverShowPopup")||a(!0)},[t]);const h=y=>{i(y.target.value)},p=()=>{a(!1),l&&localStorage.setItem("neverShowPopup","true")};return S.jsxs("div",{children:[c?S.jsx(_t,{}):S.jsx(S.Fragment,{children:o&&S.jsx("div",{className:"fixed z-10 inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true",children:S.jsxs("div",{className:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[S.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true"}),S.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:""}),S.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full",children:[S.jsx("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:S.jsx("div",{className:"sm:flex sm:items-start",children:S.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left",children:[S.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900 text-center ",id:"modal-title",children:"Attention"}),S.jsx("div",{className:"mt-2",children:S.jsx("p",{className:"text-sm text-black",children:"Your request Might be slow due to the server being hosted on a fucking Teensy 4.1 with Fucking 32 MB Ram. Please be patient."})})]})})}),S.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:[S.jsx("button",{type:"button",className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm",onClick:p,children:"OK"}),S.jsxs("div",{className:"mt-2 sm:mt-0 sm:w-auto sm:text-sm flex items-center",children:[S.jsx("input",{id:"never-show",name:"never-show",type:"checkbox",className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",checked:l,onChange:()=>u(!l)}),S.jsx("label",{htmlFor:"never-show",className:"ml-2 block text-sm text-gray-900",children:"Never show again"})]})]})]})]})})}),n.length!==0&&!c&&S.jsxs("div",{className:" container mx-auto  h-screen",children:[S.jsxs("form",{onSubmit:y=>{y.preventDefault(),f(`/searchmanga/${s.replace(/ /g,"-").toLowerCase()}`)},className:"flex flex-col md:flex-row items-center justify-between py-4 px-2 md:px-0 bg-gray-900 text-white",children:[S.jsx("h1",{className:"text-4xl text-center md:text-left mb-4 md:mb-0 w-full font-bold",children:"Depressed Zone"}),S.jsx("input",{type:"text",placeholder:"Search anime...",value:s,onChange:h,className:"px-2 py-1 rounded border border-gray-300 w-full md:w-auto bg-white text-gray-900"}),S.jsx("input",{type:"submit",value:"Search",className:"mt-2 md:mt-0 md:ml-2 px-2 py-1 rounded bg-white text-gray-900 cursor-pointer"})]}),S.jsx("h1",{className:"text-4xl text-center py-4 bg-gray-900 text-white font-bold",children:"Manga List"}),S.jsx("section",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 my-8",children:n.map(y=>S.jsxs("div",{onClick:()=>{f(`/mangainfo/${y.id}`)},className:"border p-4 rounded shadow",children:[S.jsx("div",{className:"flex justify-center",children:S.jsx("img",{src:y.image,alt:y.title,className:"w-48 h-auto rounded mb-4"})}),S.jsx("h2",{className:"text-xl font-bold mb-2",children:y.title}),S.jsxs("p",{className:"mb-2",children:[S.jsx("strong",{children:"Chapter:"})," ",y.chapter]}),S.jsxs("p",{className:"mb-2",children:[S.jsx("strong",{children:"Views:"})," ",y.view]})]},y.id))})]})]})}function CS(){const{manga:n}=Kr(),[e,t]=_.useState([]),[r,s]=_.useState(!1),[i,o]=_.useState(0),[a,l]=_.useState(1),u=ct();_.useEffect(()=>{if(!n)return window.location.href="/manga";(async()=>{s(!0),await rt.get(`https://manga-api-vercel.vercel.app/api/search/${n}?page=${a}`).then(m=>{console.log(m.data),t(m.data.mangaList),o(m.data.metaData.totalPages)}).catch(m=>{console.error("Error fetching data: ",m)}),s(!1)})()},[n,a]);const c=()=>{l(a+1)},d=()=>{a>1&&l(a-1)};return r?S.jsx(_t,{}):S.jsxs(S.Fragment,{children:[S.jsxs("div",{children:["Searchmanga : - ",n]}),S.jsx("section",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 my-8",children:e.map((f,m)=>S.jsxs("div",{className:"border p-4 rounded shadow cursor-pointer",onClick:()=>u(`/mangainfo/${f.id}`),children:[S.jsx("div",{className:"flex justify-center",children:S.jsx("img",{src:f.image,alt:f.title,className:"w-48 h-auto rounded mb-4"})}),S.jsx("h2",{className:"text-xl font-bold mb-2",children:f.title})]},m))}),S.jsxs("div",{className:"flex justify-center mt-8",children:[a>1&&S.jsx("button",{onClick:d,className:`px-4 py-2 rounded  text-black font-bold mr-2 ${a===1?"bg-gray-200 ":"bg-gray-300 hover:bg-gray-400"}`,children:"Previous"}),S.jsxs("span",{className:"px-4 py-2 text-black font-bold bg-gray-300 rounded mr-2",children:["Page",a," Out of ",i]}),i>1&a<i&&S.jsx("button",{onClick:c,className:"px-4 py-2 text-black font-bold bg-gray-300 rounded hover:bg-gray-400",children:"Next"})]})]})}function IS(){const{manga:n}=Kr(),[e,t]=_.useState(null),[r,s]=_.useState(!1),i=ct();return _.useEffect(()=>{(async()=>{try{s(!0);const a=await rt.get(`https://manga-api-vercel.vercel.app/api/manga/${n}`);console.log(a.data),t(a.data)}catch(a){console.log("error in data:",a)}s(!1)})()},[n]),r?S.jsx(_t,{}):S.jsx("div",{className:"container mx-auto px-4 py-8",children:e?S.jsxs("div",{children:[S.jsx("h1",{className:"text-3xl font-bold mb-4 text-center",children:e.name}),S.jsxs("div",{className:"grid md:grid-cols-3 gap-4 items-start",children:[S.jsx("div",{className:"col-span-3 md:col-span-1",children:S.jsx("img",{src:e.imageUrl,alt:e.title,className:"w-full h-auto rounded shadow"})}),S.jsxs("div",{className:"col-span-3 md:col-span-2",children:[S.jsx("p",{className:"text-lg mb-4",dangerouslySetInnerHTML:{__html:e.description}}),S.jsxs("div",{className:"mb-2",children:[S.jsx("span",{className:"font-bold",children:"Chapters:"})," ",e.chapterList.length>0?e.chapterList.length:"N/A"]}),S.jsxs("div",{className:"mb-2",children:[S.jsx("span",{className:"font-bold",children:"Genres:"})," ",e.genres.join(", ")]}),S.jsxs("div",{className:"mb-2",children:[S.jsx("span",{className:"font-bold",children:"Status:"})," ",e.status]}),S.jsxs("div",{className:"mb-2",children:[S.jsx("span",{className:"font-bold",children:"Author:"})," ",e.author]}),S.jsxs("div",{className:"mb-2",children:[S.jsx("span",{className:"font-bold",children:"Last Updated:"})," ",e.updated]}),S.jsxs("div",{className:"mb-2",children:[S.jsx("span",{className:"font-bold",children:"view:"})," ",e.view]}),S.jsx("div",{className:" mt-5 p-5",children:S.jsx("input",{onClick:()=>{i("/manga/chapters",{state:e.chapterList})},type:"button",value:"Read Now",className:"mt-2 md:mt-0 md:ml-2 px-2 py-1 scale-105 rounded bg-purple-500 text-white cursor-pointer"})})]})]})]}):S.jsx(_t,{})})}function DS(){const e=Wt().state,[t,r]=_.useState(1),[s]=_.useState(100),i=ct();if(!e)return S.jsx("div",{className:"flex justify-center items-center h-screen",children:S.jsx("h1",{className:"text-2xl font-bold",children:"No Chapters Found. Maybe you skipped a step?"})});const o=t*s,a=o-s,l=e.slice(a,o),u=c=>r(c);return S.jsxs("div",{className:"container mx-auto py-8",children:[S.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Chapters"}),S.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:l.map((c,d)=>S.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 cursor-pointer",onClick:()=>i(`/manga/read?id=${c.path.replace("/chapter/","")}`),children:[S.jsx("h2",{className:`text-xl text-black\r
             font-bold mb-2`,children:c.name}),S.jsxs("p",{className:"text-gray-600",children:["Chapter ",c.name]}),S.jsx("br",{}),S.jsxs("p",{className:"text-gray-600",children:["Creation: ",c.createdAt]}),S.jsx("br",{}),S.jsxs("p",{className:"text-gray-600",children:["view: ",c.view]})]},c.id))}),S.jsxs("div",{className:"flex justify-center mt-8",children:[S.jsx("button",{className:`px-4 py-2 rounded-l ${t===1?"bg-gray-300 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600"} text-white`,onClick:()=>u(t-1),disabled:t===1,children:"Previous"}),S.jsx("button",{className:`px-4 py-2 rounded-r ${o>=e.length?"bg-gray-300 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600"} text-white`,onClick:()=>u(t+1),disabled:o>=e.length,children:"Next"})]})]})}function kS(){const[n]=Gp(),e=n.get("id");Wt();const t=ct(),[r,s]=_.useState({}),[i,o]=_.useState(!0);_.useEffect(()=>{const m=async()=>{try{s({});const h=await rt.get(`https://manga-api-vercel.vercel.app/api/manga/${e}`);console.log(h.data),s(h.data)}catch(h){console.log("error in data:",h)}};window.scrollTo(0,0),m()},[e]);const a=()=>{const h=r.chapterListIds.findIndex(p=>p.id===r.currentChapter)+1;if(h<r.chapterListIds.length){const p=r.chapterListIds[h].id;t(`/manga/read?id=${e.split("/")[0]+"/"+p}`)}},l=()=>{const h=r.chapterListIds.findIndex(p=>p.id===r.currentChapter)-1;if(h>=0){const p=r.chapterListIds[h].id;t(`/manga/read?id=${e.split("/")[0]+"/"+p}`)}},u=()=>{o(!i)};if(!r.images||r.images.length===0)return S.jsx(_t,{});const c=r.chapterListIds.findIndex(m=>m.id===r.currentChapter.replace(" ","-").toLowerCase());console.log(c);const d=c>0;console.log(d);const f=c<r.chapterListIds.length-1;return console.log(f),S.jsxs("div",{className:"container mx-auto py-8",children:[S.jsx("div",{className:`relative ${i?"flex flex-col":"flex flex-row overflow-x-auto"}`,children:r.images.map((m,h)=>S.jsx("img",{src:m.image,alt:`Chapter ${e} - Page ${h+1}`,className:`${i?"w-full h-auto mb-4":"h-[80vh] w-auto"}`},h))}),S.jsxs("div",{className:"flex justify-between mb-4",children:[f&&S.jsx("button",{className:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded",onClick:l,disabled:!f,children:"Previous Chapter"}),S.jsx("button",{className:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded",onClick:u,children:"Toggle View"}),d&&S.jsx("button",{className:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded",onClick:a,children:"Next Chapter"})]})]})}function bS({darkMode:n,setDarkMode:e}){const[t,r]=_.useState(!1),s=Wt(),i=()=>{e(!n)},o=()=>{r(!t)},a=l=>s.pathname===l;return _.useEffect(()=>{const l=document.querySelector("html");n?l.classList.add("dark"):l.classList.remove("dark")},[n]),S.jsxs("nav",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-purple-600 to-indigo-600 dark:from-gray-800 dark:to-gray-900 text-white sticky top-0 z-50",children:[S.jsxs("div",{className:"flex items-center",children:[S.jsx("button",{className:"md:hidden focus:outline-none",onClick:o,children:S.jsx("svg",{className:"w-6 h-6 fill-current",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:t?S.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M19.293 4.293a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 01-1.414-1.414L20.586 9H4a1 1 0 110-2h16.586l-1.293-1.293a1 1 0 010-1.414z"}):S.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4 6a1 1 0 011-1h14a1 1 0 110 2H5a1 1 0 01-1-1zm0 5a1 1 0 011-1h14a1 1 0 110 2H5a1 1 0 01-1-1zm1 4a1 1 0 100 2h14a1 1 0 100-2H5z"})})}),S.jsx(hi,{to:"/",className:"text-2xl font-bold ml-4 md:text-3xl",children:"Depressed Zone"})]}),S.jsx("div",{className:`${t?"block":"hidden"} md:flex md:items-center`,children:S.jsxs("div",{className:"flex flex-col md:flex-row md:ml-6",children:[S.jsx(hi,{to:"/",className:`mt-2 md:mt-0 md:ml-6 text-white hover:text-gray-200 ${a("/")?"bg-green-500":""} px-3 py-1 rounded`,children:"Home"}),S.jsx(hi,{to:"/manga",className:`mt-2 md:mt-0 md:ml-6 text-white hover:text-gray-200 ${a("/manga")?"bg-green-500":""} px-3 py-1 rounded`,children:"Manga"}),S.jsx(hi,{to:"/movie",className:`mt-2 md:mt-0 md:ml-6 text-white hover:text-gray-200 ${a("/movie")?"bg-green-500":""} px-3 py-1 rounded`,children:"Movie Info"})]})}),S.jsxs("div",{className:"md:ml-4 flex items-center",children:[S.jsxs("span",{className:"mr-2",children:[n?"Light":"Dark"," Mode"]}),S.jsx("button",{onClick:i,className:"flex items-center justify-center w-12 h-6 rounded-full bg-white focus:outline-none",children:S.jsx("div",{className:`w-6 h-6 rounded-full shadow-md transform transition-transform ${n?"bg-gray-800 translate-x-6":"bg-purple-600 -translate-x-3"}`})})]})]})}function _S(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var fg={exports:{}};(function(n,e){(function(t){var r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,i=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(l,u,c){if(c=c||{},l=l.trim(),u=u.trim(),!u){if(!c.alwaysNormalize)return l;var d=a.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");return d.path=a.normalizePath(d.path),a.buildURLFromParts(d)}var f=a.parseURL(u);if(!f)throw new Error("Error trying to parse relative URL.");if(f.scheme)return c.alwaysNormalize?(f.path=a.normalizePath(f.path),a.buildURLFromParts(f)):u;var m=a.parseURL(l);if(!m)throw new Error("Error trying to parse base URL.");if(!m.netLoc&&m.path&&m.path[0]!=="/"){var h=s.exec(m.path);m.netLoc=h[1],m.path=h[2]}m.netLoc&&!m.path&&(m.path="/");var p={scheme:m.scheme,netLoc:f.netLoc,path:null,params:f.params,query:f.query,fragment:f.fragment};if(!f.netLoc&&(p.netLoc=m.netLoc,f.path[0]!=="/"))if(!f.path)p.path=m.path,f.params||(p.params=m.params,f.query||(p.query=m.query));else{var y=m.path,g=y.substring(0,y.lastIndexOf("/")+1)+f.path;p.path=a.normalizePath(g)}return p.path===null&&(p.path=c.alwaysNormalize?a.normalizePath(f.path):f.path),a.buildURLFromParts(p)},parseURL:function(l){var u=r.exec(l);return u?{scheme:u[1]||"",netLoc:u[2]||"",path:u[3]||"",params:u[4]||"",query:u[5]||"",fragment:u[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(i,"");l.length!==(l=l.replace(o,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};n.exports=a})()})(fg);var Tc=fg.exports;function gf(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function Pe(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?gf(Object(t),!0).forEach(function(r){OS(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):gf(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function PS(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function NS(n){var e=PS(n,"string");return typeof e=="symbol"?e:String(e)}function OS(n,e,t){return e=NS(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Ae(){return Ae=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Ae.apply(this,arguments)}const G=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)},FS=Number.isSafeInteger||function(n){return typeof n=="number"&&Math.abs(n)<=MS},MS=Number.MAX_SAFE_INTEGER||9007199254740991;let E=function(n){return n.MEDIA_ATTACHING="hlsMediaAttaching",n.MEDIA_ATTACHED="hlsMediaAttached",n.MEDIA_DETACHING="hlsMediaDetaching",n.MEDIA_DETACHED="hlsMediaDetached",n.BUFFER_RESET="hlsBufferReset",n.BUFFER_CODECS="hlsBufferCodecs",n.BUFFER_CREATED="hlsBufferCreated",n.BUFFER_APPENDING="hlsBufferAppending",n.BUFFER_APPENDED="hlsBufferAppended",n.BUFFER_EOS="hlsBufferEos",n.BUFFER_FLUSHING="hlsBufferFlushing",n.BUFFER_FLUSHED="hlsBufferFlushed",n.MANIFEST_LOADING="hlsManifestLoading",n.MANIFEST_LOADED="hlsManifestLoaded",n.MANIFEST_PARSED="hlsManifestParsed",n.LEVEL_SWITCHING="hlsLevelSwitching",n.LEVEL_SWITCHED="hlsLevelSwitched",n.LEVEL_LOADING="hlsLevelLoading",n.LEVEL_LOADED="hlsLevelLoaded",n.LEVEL_UPDATED="hlsLevelUpdated",n.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",n.LEVELS_UPDATED="hlsLevelsUpdated",n.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",n.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",n.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",n.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",n.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",n.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",n.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",n.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",n.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",n.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",n.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",n.CUES_PARSED="hlsCuesParsed",n.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",n.INIT_PTS_FOUND="hlsInitPtsFound",n.FRAG_LOADING="hlsFragLoading",n.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",n.FRAG_LOADED="hlsFragLoaded",n.FRAG_DECRYPTED="hlsFragDecrypted",n.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",n.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",n.FRAG_PARSING_METADATA="hlsFragParsingMetadata",n.FRAG_PARSED="hlsFragParsed",n.FRAG_BUFFERED="hlsFragBuffered",n.FRAG_CHANGED="hlsFragChanged",n.FPS_DROP="hlsFpsDrop",n.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",n.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",n.ERROR="hlsError",n.DESTROYING="hlsDestroying",n.KEY_LOADING="hlsKeyLoading",n.KEY_LOADED="hlsKeyLoaded",n.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",n.BACK_BUFFER_REACHED="hlsBackBufferReached",n.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",n}({}),q=function(n){return n.NETWORK_ERROR="networkError",n.MEDIA_ERROR="mediaError",n.KEY_SYSTEM_ERROR="keySystemError",n.MUX_ERROR="muxError",n.OTHER_ERROR="otherError",n}({}),k=function(n){return n.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",n.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",n.KEY_SYSTEM_NO_SESSION="keySystemNoSession",n.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",n.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",n.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",n.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",n.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",n.MANIFEST_LOAD_ERROR="manifestLoadError",n.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",n.MANIFEST_PARSING_ERROR="manifestParsingError",n.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",n.LEVEL_EMPTY_ERROR="levelEmptyError",n.LEVEL_LOAD_ERROR="levelLoadError",n.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",n.LEVEL_PARSING_ERROR="levelParsingError",n.LEVEL_SWITCH_ERROR="levelSwitchError",n.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",n.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",n.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",n.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",n.FRAG_LOAD_ERROR="fragLoadError",n.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",n.FRAG_DECRYPT_ERROR="fragDecryptError",n.FRAG_PARSING_ERROR="fragParsingError",n.FRAG_GAP="fragGap",n.REMUX_ALLOC_ERROR="remuxAllocError",n.KEY_LOAD_ERROR="keyLoadError",n.KEY_LOAD_TIMEOUT="keyLoadTimeOut",n.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",n.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",n.BUFFER_APPEND_ERROR="bufferAppendError",n.BUFFER_APPENDING_ERROR="bufferAppendingError",n.BUFFER_STALLED_ERROR="bufferStalledError",n.BUFFER_FULL_ERROR="bufferFullError",n.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",n.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",n.INTERNAL_EXCEPTION="internalException",n.INTERNAL_ABORTED="aborted",n.UNKNOWN="unknown",n}({});const Un=function(){},ou={trace:Un,debug:Un,log:Un,warn:Un,info:Un,error:Un};let vs=ou;function US(n){const e=self.console[n];return e?e.bind(self.console,`[${n}] >`):Un}function BS(n,...e){e.forEach(function(t){vs[t]=n[t]?n[t].bind(n):US(t)})}function $S(n,e){if(typeof console=="object"&&n===!0||typeof n=="object"){BS(n,"debug","log","info","warn","error");try{vs.log(`Debug logs enabled for "${e}" in hls.js version 1.5.11`)}catch{vs=ou}}else vs=ou}const w=vs,jS=/^(\d+)x(\d+)$/,yf=/(.+?)=(".*?"|.*?)(?:,|$)/g;class pe{constructor(e){typeof e=="string"&&(e=pe.parseAttrList(e)),Ae(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const r=new Uint8Array(t.length/2);for(let s=0;s<t.length/2;s++)r[s]=parseInt(t.slice(s*2,s*2+2),16);return r}else return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const r=this[e];return r?parseFloat(r):t}enumeratedString(e){return this[e]}bool(e){return this[e]==="YES"}decimalResolution(e){const t=jS.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e){let t;const r={},s='"';for(yf.lastIndex=0;(t=yf.exec(e))!==null;){let i=t[2];i.indexOf(s)===0&&i.lastIndexOf(s)===i.length-1&&(i=i.slice(1,-1));const o=t[1].trim();r[o]=i}return r}}function GS(n){return n!=="ID"&&n!=="CLASS"&&n!=="START-DATE"&&n!=="DURATION"&&n!=="END-DATE"&&n!=="END-ON-NEXT"}function HS(n){return n==="SCTE35-OUT"||n==="SCTE35-IN"}class hg{constructor(e,t){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,t){const r=t.attr;for(const s in r)if(Object.prototype.hasOwnProperty.call(e,s)&&e[s]!==r[s]){w.warn(`DATERANGE tag attribute: "${s}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=s;break}e=Ae(new pe({}),r,e)}if(this.attr=e,this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const r=new Date(this.attr["END-DATE"]);G(r.getTime())&&(this._endDate=r)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const e=this.duration;return e!==null?new Date(this._startDate.getTime()+e*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(G(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&G(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class ta{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var ie={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class mg{constructor(e){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[ie.AUDIO]:null,[ie.VIDEO]:null,[ie.AUDIOVIDEO]:null},this.baseurl=e}setByteRange(e,t){const r=e.split("@",2);let s;r.length===1?s=(t==null?void 0:t.byteRangeEndOffset)||0:s=parseInt(r[1]),this._byteRange=[s,parseInt(r[0])+s]}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Tc.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}}class Oa extends mg{constructor(e,t){super(t),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new ta,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const r=Object.keys(this.levelkeys);if(r.length===1)return this._decryptdata=this.levelkeys[r[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null||!G(this.programDateTime))return null;const e=G(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){const t=Object.keys(this.levelkeys),r=t.length;if(r>1||r===1&&this.levelkeys[t[0]].encrypted)return!0}return!1}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,r,s,i,o=!1){const{elementaryStreams:a}=this,l=a[e];if(!l){a[e]={startPTS:t,endPTS:r,startDTS:s,endDTS:i,partial:o};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,r),l.startDTS=Math.min(l.startDTS,s),l.endDTS=Math.max(l.endDTS,i)}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[ie.AUDIO]=null,e[ie.VIDEO]=null,e[ie.AUDIOVIDEO]=null}}class VS extends mg{constructor(e,t,r,s,i){super(r),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new ta,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=s;const o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,i),i&&(this.fragOffset=i.fragOffset+i.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}const KS=10;class zS{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&r>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay}get hasProgramDateTime(){return this.fragments.length?G(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||KS}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function Lc(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0))}function WS(n){const e=au(n).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function YS(n){const e=function(r,s,i){const o=r[s];r[s]=r[i],r[i]=o};e(n,0,3),e(n,1,2),e(n,4,5),e(n,6,7)}function qS(n){const e=n.split(":");let t=null;if(e[0]==="data"&&e.length===2){const r=e[1].split(";"),s=r[r.length-1].split(",");if(s.length===2){const i=s[0]==="base64",o=s[1];i?(r.splice(-1,1),t=Lc(o)):t=WS(o)}}return t}function au(n){return Uint8Array.from(unescape(encodeURIComponent(n)),e=>e.charCodeAt(0))}const Mr=typeof self<"u"?self:void 0;var me={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Qe={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function vf(n){switch(n){case Qe.FAIRPLAY:return me.FAIRPLAY;case Qe.PLAYREADY:return me.PLAYREADY;case Qe.WIDEVINE:return me.WIDEVINE;case Qe.CLEARKEY:return me.CLEARKEY}}var pg={WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function XS(n){if(n===pg.WIDEVINE)return me.WIDEVINE}function xf(n){switch(n){case me.FAIRPLAY:return Qe.FAIRPLAY;case me.PLAYREADY:return Qe.PLAYREADY;case me.WIDEVINE:return Qe.WIDEVINE;case me.CLEARKEY:return Qe.CLEARKEY}}function Fa(n){const{drmSystems:e,widevineLicenseUrl:t}=n,r=e?[me.FAIRPLAY,me.WIDEVINE,me.PLAYREADY,me.CLEARKEY].filter(s=>!!e[s]):[];return!r[me.WIDEVINE]&&t&&r.push(me.WIDEVINE),r}const gg=function(n){return Mr!=null&&(n=Mr.navigator)!=null&&n.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function QS(n,e,t,r){let s;switch(n){case me.FAIRPLAY:s=["cenc","sinf"];break;case me.WIDEVINE:case me.PLAYREADY:s=["cenc"];break;case me.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${n}`)}return JS(s,e,t,r)}function JS(n,e,t,r){return[{initDataTypes:n,persistentState:r.persistentState||"optional",distinctiveIdentifier:r.distinctiveIdentifier||"optional",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:e.map(i=>({contentType:`audio/mp4; codecs="${i}"`,robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null})),videoCapabilities:t.map(i=>({contentType:`video/mp4; codecs="${i}"`,robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}))}]}function zn(n,e,t){return Uint8Array.prototype.slice?n.slice(e,t):new Uint8Array(Array.prototype.slice.call(n,e,t))}const Rc=(n,e)=>e+10<=n.length&&n[e]===73&&n[e+1]===68&&n[e+2]===51&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128,yg=(n,e)=>e+10<=n.length&&n[e]===51&&n[e+1]===68&&n[e+2]===73&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128,Bs=(n,e)=>{const t=e;let r=0;for(;Rc(n,e);){r+=10;const s=na(n,e+6);r+=s,yg(n,e+10)&&(r+=10),e+=r}if(r>0)return n.subarray(t,t+r)},na=(n,e)=>{let t=0;return t=(n[e]&127)<<21,t|=(n[e+1]&127)<<14,t|=(n[e+2]&127)<<7,t|=n[e+3]&127,t},ZS=(n,e)=>Rc(n,e)&&na(n,e+6)+10<=n.length-e,Ac=n=>{const e=xg(n);for(let t=0;t<e.length;t++){const r=e[t];if(vg(r))return iT(r)}},vg=n=>n&&n.key==="PRIV"&&n.info==="com.apple.streaming.transportStreamTimestamp",eT=n=>{const e=String.fromCharCode(n[0],n[1],n[2],n[3]),t=na(n,4),r=10;return{type:e,size:t,data:n.subarray(r,r+t)}},xg=n=>{let e=0;const t=[];for(;Rc(n,e);){const r=na(n,e+6);e+=10;const s=e+r;for(;e+8<s;){const i=eT(n.subarray(e)),o=tT(i);o&&t.push(o),e+=i.size+10}yg(n,e)&&(e+=10)}return t},tT=n=>n.type==="PRIV"?nT(n):n.type[0]==="W"?sT(n):rT(n),nT=n=>{if(n.size<2)return;const e=Kt(n.data,!0),t=new Uint8Array(n.data.subarray(e.length+1));return{key:n.type,info:e,data:t.buffer}},rT=n=>{if(n.size<2)return;if(n.type==="TXXX"){let t=1;const r=Kt(n.data.subarray(t),!0);t+=r.length+1;const s=Kt(n.data.subarray(t));return{key:n.type,info:r,data:s}}const e=Kt(n.data.subarray(1));return{key:n.type,data:e}},sT=n=>{if(n.type==="WXXX"){if(n.size<2)return;let t=1;const r=Kt(n.data.subarray(t),!0);t+=r.length+1;const s=Kt(n.data.subarray(t));return{key:n.type,info:r,data:s}}const e=Kt(n.data);return{key:n.type,data:e}},iT=n=>{if(n.data.byteLength===8){const e=new Uint8Array(n.data),t=e[3]&1;let r=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return r/=45,t&&(r+=4772185884e-2),Math.round(r)}},Kt=(n,e=!1)=>{const t=oT();if(t){const u=t.decode(n);if(e){const c=u.indexOf("\0");return c!==-1?u.substring(0,c):u}return u.replace(/\0/g,"")}const r=n.length;let s,i,o,a="",l=0;for(;l<r;){if(s=n[l++],s===0&&e)return a;if(s===0||s===3)continue;switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(s);break;case 12:case 13:i=n[l++],a+=String.fromCharCode((s&31)<<6|i&63);break;case 14:i=n[l++],o=n[l++],a+=String.fromCharCode((s&15)<<12|(i&63)<<6|(o&63)<<0);break}}return a};let Ma;function oT(){if(!navigator.userAgent.includes("PlayStation 4"))return!Ma&&typeof self.TextDecoder<"u"&&(Ma=new self.TextDecoder("utf-8")),Ma}const Mt={hexDump:function(n){let e="";for(let t=0;t<n.length;t++){let r=n[t].toString(16);r.length<2&&(r="0"+r),e+=r}return e}},To=Math.pow(2,32)-1,aT=[].push,Eg={video:1,audio:2,id3:3,text:4};function we(n){return String.fromCharCode.apply(null,n)}function Sg(n,e){const t=n[e]<<8|n[e+1];return t<0?65536+t:t}function z(n,e){const t=Tg(n,e);return t<0?4294967296+t:t}function Ef(n,e){let t=z(n,e);return t*=Math.pow(2,32),t+=z(n,e+4),t}function Tg(n,e){return n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3]}function Ua(n,e,t){n[e]=t>>24,n[e+1]=t>>16&255,n[e+2]=t>>8&255,n[e+3]=t&255}function lT(n){const e=n.byteLength;for(let t=0;t<e;){const r=z(n,t);if(r>8&&n[t+4]===109&&n[t+5]===111&&n[t+6]===111&&n[t+7]===102)return!0;t=r>1?t+r:e}return!1}function J(n,e){const t=[];if(!e.length)return t;const r=n.byteLength;for(let s=0;s<r;){const i=z(n,s),o=we(n.subarray(s+4,s+8)),a=i>1?s+i:r;if(o===e[0])if(e.length===1)t.push(n.subarray(s+8,a));else{const l=J(n.subarray(s+8,a),e.slice(1));l.length&&aT.apply(t,l)}s=a}return t}function uT(n){const e=[],t=n[0];let r=8;const s=z(n,r);r+=4;let i=0,o=0;t===0?(i=z(n,r),o=z(n,r+4),r+=8):(i=Ef(n,r),o=Ef(n,r+8),r+=16),r+=2;let a=n.length+o;const l=Sg(n,r);r+=2;for(let u=0;u<l;u++){let c=r;const d=z(n,c);c+=4;const f=d&2147483647;if((d&2147483648)>>>31===1)return w.warn("SIDX has hierarchical references (not supported)"),null;const h=z(n,c);c+=4,e.push({referenceSize:f,subsegmentDuration:h,info:{duration:h/s,start:a,end:a+f-1}}),a+=f,c+=4,r=c}return{earliestPresentationTime:i,timescale:s,version:t,referencesCount:l,references:e}}function Lg(n){const e=[],t=J(n,["moov","trak"]);for(let s=0;s<t.length;s++){const i=t[s],o=J(i,["tkhd"])[0];if(o){let a=o[0];const l=z(o,a===0?12:20),u=J(i,["mdia","mdhd"])[0];if(u){a=u[0];const c=z(u,a===0?12:20),d=J(i,["mdia","hdlr"])[0];if(d){const f=we(d.subarray(8,12)),m={soun:ie.AUDIO,vide:ie.VIDEO}[f];if(m){const h=J(i,["mdia","minf","stbl","stsd"])[0],p=cT(h);e[l]={timescale:c,type:m},e[m]=Pe({timescale:c,id:l},p)}}}}}return J(n,["moov","mvex","trex"]).forEach(s=>{const i=z(s,4),o=e[i];o&&(o.default={duration:z(s,12),flags:z(s,20)})}),e}function cT(n){const e=n.subarray(8),t=e.subarray(86),r=we(e.subarray(4,8));let s=r;const i=r==="enca"||r==="encv";if(i){const a=J(e,[r])[0].subarray(r==="enca"?28:78);J(a,["sinf"]).forEach(u=>{const c=J(u,["schm"])[0];if(c){const d=we(c.subarray(4,8));if(d==="cbcs"||d==="cenc"){const f=J(u,["frma"])[0];f&&(s=we(f))}}})}switch(s){case"avc1":case"avc2":case"avc3":case"avc4":{const o=J(t,["avcC"])[0];s+="."+mi(o[1])+mi(o[2])+mi(o[3]);break}case"mp4a":{const o=J(e,[r])[0],a=J(o.subarray(28),["esds"])[0];if(a&&a.length>12){let l=4;if(a[l++]!==3)break;l=Ba(a,l),l+=2;const u=a[l++];if(u&128&&(l+=2),u&64&&(l+=a[l++]),a[l++]!==4)break;l=Ba(a,l);const c=a[l++];if(c===64)s+="."+mi(c);else break;if(l+=12,a[l++]!==5)break;l=Ba(a,l);const d=a[l++];let f=(d&248)>>3;f===31&&(f+=1+((d&7)<<3)+((a[l]&224)>>5)),s+="."+f}break}case"hvc1":case"hev1":{const o=J(t,["hvcC"])[0],a=o[1],l=["","A","B","C"][a>>6],u=a&31,c=z(o,2),d=(a&32)>>5?"H":"L",f=o[12],m=o.subarray(6,12);s+="."+l+u,s+="."+c.toString(16).toUpperCase(),s+="."+d+f;let h="";for(let p=m.length;p--;){const y=m[p];(y||h)&&(h="."+y.toString(16).toUpperCase()+h)}s+=h;break}case"dvh1":case"dvhe":{const o=J(t,["dvcC"])[0],a=o[2]>>1&127,l=o[2]<<5&32|o[3]>>3&31;s+="."+Ot(a)+"."+Ot(l);break}case"vp09":{const o=J(t,["vpcC"])[0],a=o[4],l=o[5],u=o[6]>>4&15;s+="."+Ot(a)+"."+Ot(l)+"."+Ot(u);break}case"av01":{const o=J(t,["av1C"])[0],a=o[1]>>>5,l=o[1]&31,u=o[2]>>>7?"H":"M",c=(o[2]&64)>>6,d=(o[2]&32)>>5,f=a===2&&c?d?12:10:c?10:8,m=(o[2]&16)>>4,h=(o[2]&8)>>3,p=(o[2]&4)>>2,y=o[2]&3;s+="."+a+"."+Ot(l)+u+"."+Ot(f)+"."+m+"."+h+p+y+"."+Ot(1)+"."+Ot(1)+"."+Ot(1)+"."+0;break}}return{codec:s,encrypted:i}}function Ba(n,e){const t=e+5;for(;n[e++]&128&&e<t;);return e}function mi(n){return("0"+n.toString(16).toUpperCase()).slice(-2)}function Ot(n){return(n<10?"0":"")+n}function dT(n,e){if(!n||!e)return n;const t=e.keyId;return t&&e.isCommonEncryption&&J(n,["moov","trak"]).forEach(s=>{const o=J(s,["mdia","minf","stbl","stsd"])[0].subarray(8);let a=J(o,["enca"]);const l=a.length>0;l||(a=J(o,["encv"])),a.forEach(u=>{const c=l?u.subarray(28):u.subarray(78);J(c,["sinf"]).forEach(f=>{const m=Rg(f);if(m){const h=m.subarray(8,24);h.some(p=>p!==0)||(w.log(`[eme] Patching keyId in 'enc${l?"a":"v"}>sinf>>tenc' box: ${Mt.hexDump(h)} -> ${Mt.hexDump(t)}`),m.set(t,8))}})})}),n}function Rg(n){const e=J(n,["schm"])[0];if(e){const t=we(e.subarray(4,8));if(t==="cbcs"||t==="cenc")return J(n,["schi","tenc"])[0]}return w.error("[eme] missing 'schm' box"),null}function fT(n,e){return J(e,["moof","traf"]).reduce((t,r)=>{const s=J(r,["tfdt"])[0],i=s[0],o=J(r,["tfhd"]).reduce((a,l)=>{const u=z(l,4),c=n[u];if(c){let d=z(s,4);if(i===1){if(d===To)return w.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),a;d*=To+1,d+=z(s,8)}const f=c.timescale||9e4,m=d/f;if(G(m)&&(a===null||m<a))return m}return a},null);return o!==null&&G(o)&&(t===null||o<t)?o:t},null)}function hT(n,e){let t=0,r=0,s=0;const i=J(n,["moof","traf"]);for(let o=0;o<i.length;o++){const a=i[o],l=J(a,["tfhd"])[0],u=z(l,4),c=e[u];if(!c)continue;const d=c.default,f=z(l,0)|(d==null?void 0:d.flags);let m=d==null?void 0:d.duration;f&8&&(f&2?m=z(l,12):m=z(l,8));const h=c.timescale||9e4,p=J(a,["trun"]);for(let y=0;y<p.length;y++){if(t=mT(p[y]),!t&&m){const g=z(p[y],4);t=m*g}c.type===ie.VIDEO?r+=t/h:c.type===ie.AUDIO&&(s+=t/h)}}if(r===0&&s===0){let o=1/0,a=0,l=0;const u=J(n,["sidx"]);for(let c=0;c<u.length;c++){const d=uT(u[c]);if(d!=null&&d.references){o=Math.min(o,d.earliestPresentationTime/d.timescale);const f=d.references.reduce((m,h)=>m+h.info.duration||0,0);a=Math.max(a,f+d.earliestPresentationTime/d.timescale),l=a-o}}if(l&&G(l))return l}return r||s}function mT(n){const e=z(n,0);let t=8;e&1&&(t+=4),e&4&&(t+=4);let r=0;const s=z(n,4);for(let i=0;i<s;i++){if(e&256){const o=z(n,t);r+=o,t+=4}e&512&&(t+=4),e&1024&&(t+=4),e&2048&&(t+=4)}return r}function pT(n,e,t){J(e,["moof","traf"]).forEach(r=>{J(r,["tfhd"]).forEach(s=>{const i=z(s,4),o=n[i];if(!o)return;const a=o.timescale||9e4;J(r,["tfdt"]).forEach(l=>{const u=l[0],c=t*a;if(c){let d=z(l,4);if(u===0)d-=c,d=Math.max(d,0),Ua(l,4,d);else{d*=Math.pow(2,32),d+=z(l,8),d-=c,d=Math.max(d,0);const f=Math.floor(d/(To+1)),m=Math.floor(d%(To+1));Ua(l,4,f),Ua(l,8,m)}}})})})}function gT(n){const e={valid:null,remainder:null},t=J(n,["moof"]);if(t.length<2)return e.remainder=n,e;const r=t[t.length-1];return e.valid=zn(n,0,r.byteOffset-8),e.remainder=zn(n,r.byteOffset-8),e}function Et(n,e){const t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function Sf(n,e){const t=[],r=e.samples,s=e.timescale,i=e.id;let o=!1;return J(r,["moof"]).map(l=>{const u=l.byteOffset-8;J(l,["traf"]).map(d=>{const f=J(d,["tfdt"]).map(m=>{const h=m[0];let p=z(m,4);return h===1&&(p*=Math.pow(2,32),p+=z(m,8)),p/s})[0];return f!==void 0&&(n=f),J(d,["tfhd"]).map(m=>{const h=z(m,4),p=z(m,0)&16777215,y=(p&1)!==0,g=(p&2)!==0,v=(p&8)!==0;let x=0;const L=(p&16)!==0;let T=0;const A=(p&32)!==0;let R=8;h===i&&(y&&(R+=8),g&&(R+=4),v&&(x=z(m,R),R+=4),L&&(T=z(m,R),R+=4),A&&(R+=4),e.type==="video"&&(o=yT(e.codec)),J(d,["trun"]).map(I=>{const M=I[0],D=z(I,0)&16777215,F=(D&1)!==0;let Y=0;const $=(D&4)!==0,X=(D&256)!==0;let Q=0;const V=(D&512)!==0;let te=0;const U=(D&1024)!==0,O=(D&2048)!==0;let P=0;const K=z(I,4);let H=8;F&&(Y=z(I,H),H+=4),$&&(H+=4);let ne=Y+u;for(let ae=0;ae<K;ae++){if(X?(Q=z(I,H),H+=4):Q=x,V?(te=z(I,H),H+=4):te=T,U&&(H+=4),O&&(M===0?P=z(I,H):P=Tg(I,H),H+=4),e.type===ie.VIDEO){let xe=0;for(;xe<te;){const ce=z(r,ne);if(ne+=4,vT(o,r[ne])){const Ne=r.subarray(ne,ne+ce);Ag(Ne,o?2:1,n+P/s,t)}ne+=ce,xe+=ce+4}}n+=Q/s}}))})})}),t}function yT(n){if(!n)return!1;const e=n.indexOf("."),t=e<0?n:n.substring(0,e);return t==="hvc1"||t==="hev1"||t==="dvh1"||t==="dvhe"}function vT(n,e){if(n){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function Ag(n,e,t,r){const s=wg(n);let i=0;i+=e;let o=0,a=0,l=0;for(;i<s.length;){o=0;do{if(i>=s.length)break;l=s[i++],o+=l}while(l===255);a=0;do{if(i>=s.length)break;l=s[i++],a+=l}while(l===255);const u=s.length-i;let c=i;if(a<u)i+=a;else if(a>u){w.error(`Malformed SEI payload. ${a} is too small, only ${u} bytes left to parse.`);break}if(o===4){if(s[c++]===181){const f=Sg(s,c);if(c+=2,f===49){const m=z(s,c);if(c+=4,m===1195456820){const h=s[c++];if(h===3){const p=s[c++],y=31&p,g=64&p,v=g?2+y*3:0,x=new Uint8Array(v);if(g){x[0]=p;for(let L=1;L<v;L++)x[L]=s[c++]}r.push({type:h,payloadType:o,pts:t,bytes:x})}}}}}else if(o===5&&a>16){const d=[];for(let h=0;h<16;h++){const p=s[c++].toString(16);d.push(p.length==1?"0"+p:p),(h===3||h===5||h===7||h===9)&&d.push("-")}const f=a-16,m=new Uint8Array(f);for(let h=0;h<f;h++)m[h]=s[c++];r.push({payloadType:o,pts:t,uuid:d.join(""),userData:Kt(m),userDataBytes:m})}}}function wg(n){const e=n.byteLength,t=[];let r=1;for(;r<e-2;)n[r]===0&&n[r+1]===0&&n[r+2]===3?(t.push(r+2),r+=2):r++;if(t.length===0)return n;const s=e-t.length,i=new Uint8Array(s);let o=0;for(r=0;r<s;o++,r++)o===t[0]&&(o++,t.shift()),i[r]=n[o];return i}function xT(n){const e=n[0];let t="",r="",s=0,i=0,o=0,a=0,l=0,u=0;if(e===0){for(;we(n.subarray(u,u+1))!=="\0";)t+=we(n.subarray(u,u+1)),u+=1;for(t+=we(n.subarray(u,u+1)),u+=1;we(n.subarray(u,u+1))!=="\0";)r+=we(n.subarray(u,u+1)),u+=1;r+=we(n.subarray(u,u+1)),u+=1,s=z(n,12),i=z(n,16),a=z(n,20),l=z(n,24),u=28}else if(e===1){u+=4,s=z(n,u),u+=4;const d=z(n,u);u+=4;const f=z(n,u);for(u+=4,o=2**32*d+f,FS(o)||(o=Number.MAX_SAFE_INTEGER,w.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),a=z(n,u),u+=4,l=z(n,u),u+=4;we(n.subarray(u,u+1))!=="\0";)t+=we(n.subarray(u,u+1)),u+=1;for(t+=we(n.subarray(u,u+1)),u+=1;we(n.subarray(u,u+1))!=="\0";)r+=we(n.subarray(u,u+1)),u+=1;r+=we(n.subarray(u,u+1)),u+=1}const c=n.subarray(u,n.byteLength);return{schemeIdUri:t,value:r,timeScale:s,presentationTime:o,presentationTimeDelta:i,eventDuration:a,id:l,payload:c}}function ET(n,...e){const t=e.length;let r=8,s=t;for(;s--;)r+=e[s].byteLength;const i=new Uint8Array(r);for(i[0]=r>>24&255,i[1]=r>>16&255,i[2]=r>>8&255,i[3]=r&255,i.set(n,4),s=0,r=8;s<t;s++)i.set(e[s],r),r+=e[s].byteLength;return i}function ST(n,e,t){if(n.byteLength!==16)throw new RangeError("Invalid system id");let r,s;r=0,s=new Uint8Array;let i;r>0?(i=new Uint8Array(4),e.length>0&&new DataView(i.buffer).setUint32(0,e.length,!1)):i=new Uint8Array;const o=new Uint8Array(4);return t&&t.byteLength>0&&new DataView(o.buffer).setUint32(0,t.byteLength,!1),ET([112,115,115,104],new Uint8Array([r,0,0,0]),n,i,s,o,t||new Uint8Array)}function TT(n){if(!(n instanceof ArrayBuffer)||n.byteLength<32)return null;const e={version:0,systemId:"",kids:null,data:null},t=new DataView(n),r=t.getUint32(0);if(n.byteLength!==r&&r>44||t.getUint32(4)!==1886614376||(e.version=t.getUint32(8)>>>24,e.version>1))return null;e.systemId=Mt.hexDump(new Uint8Array(n,12,16));const i=t.getUint32(28);if(e.version===0){if(r-32<i)return null;e.data=new Uint8Array(n,32,i)}else if(e.version===1){e.kids=[];for(let o=0;o<i;o++)e.kids.push(new Uint8Array(n,32+o*16,16))}return e}let pi={};class $s{static clearKeyUriToKeyIdMap(){pi={}}constructor(e,t,r,s=[1],i=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=s,this.iv=i,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&e!=="AES-128"}isSupported(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Qe.FAIRPLAY:case Qe.WIDEVINE:case Qe.PLAYREADY:case Qe.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof e!="number"&&(this.method==="AES-128"&&!this.iv&&w.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const r=LT(e);return new $s(this.method,this.uri,"identity",this.keyFormatVersions,r)}const t=qS(this.uri);if(t)switch(this.keyFormat){case Qe.WIDEVINE:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case Qe.PLAYREADY:{const r=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=ST(r,null,t);const s=new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2),i=String.fromCharCode.apply(null,Array.from(s)),o=i.substring(i.indexOf("<"),i.length),u=new DOMParser().parseFromString(o,"text/xml").getElementsByTagName("KID")[0];if(u){const c=u.childNodes[0]?u.childNodes[0].nodeValue:u.getAttribute("VALUE");if(c){const d=Lc(c).subarray(0,16);YS(d),this.keyId=d}}break}default:{let r=t.subarray(0,16);if(r.length!==16){const s=new Uint8Array(16);s.set(r,16-r.length),r=s}this.keyId=r;break}}if(!this.keyId||this.keyId.byteLength!==16){let r=pi[this.uri];if(!r){const s=Object.keys(pi).length%Number.MAX_SAFE_INTEGER;r=new Uint8Array(16),new DataView(r.buffer,12,4).setUint32(0,s),pi[this.uri]=r}this.keyId=r}return this}}function LT(n){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=n>>8*(15-t)&255;return e}const Cg=/\{\$([a-zA-Z0-9-_]+)\}/g;function Tf(n){return Cg.test(n)}function qe(n,e,t){if(n.variableList!==null||n.hasVariableRefs)for(let r=t.length;r--;){const s=t[r],i=e[s];i&&(e[s]=lu(n,i))}}function lu(n,e){if(n.variableList!==null||n.hasVariableRefs){const t=n.variableList;return e.replace(Cg,r=>{const s=r.substring(2,r.length-1),i=t==null?void 0:t[s];return i===void 0?(n.playlistParsingError||(n.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${s}"`)),r):i})}return e}function Lf(n,e,t){let r=n.variableList;r||(n.variableList=r={});let s,i;if("QUERYPARAM"in e){s=e.QUERYPARAM;try{const o=new self.URL(t).searchParams;if(o.has(s))i=o.get(s);else throw new Error(`"${s}" does not match any query parameter in URI: "${t}"`)}catch(o){n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else s=e.NAME,i=e.VALUE;s in r?n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${s}"`)):r[s]=i||""}function RT(n,e,t){const r=e.IMPORT;if(t&&r in t){let s=n.variableList;s||(n.variableList=s={}),s[r]=t[r]}else n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${r}"`))}function Zn(n=!0){return typeof self>"u"?void 0:(n||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function AT(n){return typeof self<"u"&&n===self.ManagedMediaSource}const Lo={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function wT(n,e){const t=Lo[e];return!!t&&!!t[n.slice(0,4)]}function $a(n,e,t=!0){return!n.split(",").some(r=>!Ig(r,e,t))}function Ig(n,e,t=!0){var r;const s=Zn(t);return(r=s==null?void 0:s.isTypeSupported(js(n,e)))!=null?r:!1}function js(n,e){return`${e}/mp4;codecs="${n}"`}function Rf(n){if(n){const e=n.substring(0,4);return Lo.video[e]}return 2}function Ro(n){return n.split(",").reduce((e,t)=>{const r=Lo.video[t];return r?(r*2+e)/(e?3:2):(Lo.audio[t]+e)/(e?2:1)},0)}const ja={};function CT(n,e=!0){if(ja[n])return ja[n];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"]}[n];for(let r=0;r<t.length;r++)if(Ig(t[r],"audio",e))return ja[n]=t[r],t[r];return n}const IT=/flac|opus/i;function Ao(n,e=!0){return n.replace(IT,t=>CT(t.toLowerCase(),e))}function Af(n,e){return n&&n!=="mp4a"?n:e&&e.split(",")[0]}function DT(n){const e=n.split(".");if(e.length>2){let t=e.shift()+".";return t+=parseInt(e.shift()).toString(16),t+=("000"+parseInt(e.shift()).toString(16)).slice(-4),t}return n}const wf=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Cf=/#EXT-X-MEDIA:(.*)/g,kT=/^#EXT(?:INF|-X-TARGETDURATION):/m,If=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),bT=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class $t{static findGroup(e,t){for(let r=0;r<e.length;r++){const s=e[r];if(s.id===t)return s}}static resolve(e,t){return Tc.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return kT.test(e)}static parseMasterPlaylist(e,t){const r=Tf(e),s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:r},i=[];wf.lastIndex=0;let o;for(;(o=wf.exec(e))!=null;)if(o[1]){var a;const u=new pe(o[1]);qe(s,u,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const c=lu(s,o[2]),d={attrs:u,bitrate:u.decimalInteger("BANDWIDTH")||u.decimalInteger("AVERAGE-BANDWIDTH"),name:u.NAME,url:$t.resolve(c,t)},f=u.decimalResolution("RESOLUTION");f&&(d.width=f.width,d.height=f.height),_T(u.CODECS,d),(a=d.unknownCodecs)!=null&&a.length||i.push(d),s.levels.push(d)}else if(o[3]){const u=o[3],c=o[4];switch(u){case"SESSION-DATA":{const d=new pe(c);qe(s,d,["DATA-ID","LANGUAGE","VALUE","URI"]);const f=d["DATA-ID"];f&&(s.sessionData===null&&(s.sessionData={}),s.sessionData[f]=d);break}case"SESSION-KEY":{const d=Df(c,t,s);d.encrypted&&d.isSupported()?(s.sessionKeys===null&&(s.sessionKeys=[]),s.sessionKeys.push(d)):w.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${c}"`);break}case"DEFINE":{{const d=new pe(c);qe(s,d,["NAME","VALUE","QUERYPARAM"]),Lf(s,d,t)}break}case"CONTENT-STEERING":{const d=new pe(c);qe(s,d,["SERVER-URI","PATHWAY-ID"]),s.contentSteering={uri:$t.resolve(d["SERVER-URI"],t),pathwayId:d["PATHWAY-ID"]||"."};break}case"START":{s.startTimeOffset=kf(c);break}}}const l=i.length>0&&i.length<s.levels.length;return s.levels=l?i:s.levels,s.levels.length===0&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(e,t,r){let s;const i={},o=r.levels,a={AUDIO:o.map(u=>({id:u.attrs.AUDIO,audioCodec:u.audioCodec})),SUBTITLES:o.map(u=>({id:u.attrs.SUBTITLES,textCodec:u.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(Cf.lastIndex=0;(s=Cf.exec(e))!==null;){const u=new pe(s[1]),c=u.TYPE;if(c){const d=a[c],f=i[c]||[];i[c]=f,qe(r,u,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const m=u.LANGUAGE,h=u["ASSOC-LANGUAGE"],p=u.CHANNELS,y=u.CHARACTERISTICS,g=u["INSTREAM-ID"],v={attrs:u,bitrate:0,id:l++,groupId:u["GROUP-ID"]||"",name:u.NAME||m||"",type:c,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:m,url:u.URI?$t.resolve(u.URI,t):""};if(h&&(v.assocLang=h),p&&(v.channels=p),y&&(v.characteristics=y),g&&(v.instreamId=g),d!=null&&d.length){const x=$t.findGroup(d,v.groupId)||d[0];bf(v,x,"audioCodec"),bf(v,x,"textCodec")}f.push(v)}}return i}static parseLevelPlaylist(e,t,r,s,i,o){const a=new zS(t),l=a.fragments;let u=null,c=0,d=0,f=0,m=0,h=null,p=new Oa(s,t),y,g,v,x=-1,L=!1,T=null;for(If.lastIndex=0,a.m3u8=e,a.hasVariableRefs=Tf(e);(y=If.exec(e))!==null;){L&&(L=!1,p=new Oa(s,t),p.start=f,p.sn=c,p.cc=m,p.level=r,u&&(p.initSegment=u,p.rawProgramDateTime=u.rawProgramDateTime,u.rawProgramDateTime=null,T&&(p.setByteRange(T),T=null)));const M=y[1];if(M){p.duration=parseFloat(M);const D=(" "+y[2]).slice(1);p.title=D||null,p.tagList.push(D?["INF",M,D]:["INF",M])}else if(y[3]){if(G(p.duration)){p.start=f,v&&Nf(p,v,a),p.sn=c,p.level=r,p.cc=m,l.push(p);const D=(" "+y[3]).slice(1);p.relurl=lu(a,D),_f(p,h),h=p,f+=p.duration,c++,d=0,L=!0}}else if(y[4]){const D=(" "+y[4]).slice(1);h?p.setByteRange(D,h):p.setByteRange(D)}else if(y[5])p.rawProgramDateTime=(" "+y[5]).slice(1),p.tagList.push(["PROGRAM-DATE-TIME",p.rawProgramDateTime]),x===-1&&(x=l.length);else{if(y=y[0].match(bT),!y){w.warn("No matches on slow regex match for level playlist!");continue}for(g=1;g<y.length&&!(typeof y[g]<"u");g++);const D=(" "+y[g]).slice(1),F=(" "+y[g+1]).slice(1),Y=y[g+2]?(" "+y[g+2]).slice(1):"";switch(D){case"PLAYLIST-TYPE":a.type=F.toUpperCase();break;case"MEDIA-SEQUENCE":c=a.startSN=parseInt(F);break;case"SKIP":{const $=new pe(F);qe(a,$,["RECENTLY-REMOVED-DATERANGES"]);const X=$.decimalInteger("SKIPPED-SEGMENTS");if(G(X)){a.skippedSegments=X;for(let V=X;V--;)l.unshift(null);c+=X}const Q=$.enumeratedString("RECENTLY-REMOVED-DATERANGES");Q&&(a.recentlyRemovedDateranges=Q.split("	"));break}case"TARGETDURATION":a.targetduration=Math.max(parseInt(F),1);break;case"VERSION":a.version=parseInt(F);break;case"INDEPENDENT-SEGMENTS":case"EXTM3U":break;case"ENDLIST":a.live=!1;break;case"#":(F||Y)&&p.tagList.push(Y?[F,Y]:[F]);break;case"DISCONTINUITY":m++,p.tagList.push(["DIS"]);break;case"GAP":p.gap=!0,p.tagList.push([D]);break;case"BITRATE":p.tagList.push([D,F]);break;case"DATERANGE":{const $=new pe(F);qe(a,$,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),qe(a,$,$.clientAttrs);const X=new hg($,a.dateRanges[$.ID]);X.isValid||a.skippedSegments?a.dateRanges[X.id]=X:w.warn(`Ignoring invalid DATERANGE tag: "${F}"`),p.tagList.push(["EXT-X-DATERANGE",F]);break}case"DEFINE":{{const $=new pe(F);qe(a,$,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in $?RT(a,$,o):Lf(a,$,t)}break}case"DISCONTINUITY-SEQUENCE":m=parseInt(F);break;case"KEY":{const $=Df(F,t,a);if($.isSupported()){if($.method==="NONE"){v=void 0;break}v||(v={}),v[$.keyFormat]&&(v=Ae({},v)),v[$.keyFormat]=$}else w.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${F}"`);break}case"START":a.startTimeOffset=kf(F);break;case"MAP":{const $=new pe(F);if(qe(a,$,["BYTERANGE","URI"]),p.duration){const X=new Oa(s,t);Pf(X,$,r,v),u=X,p.initSegment=u,u.rawProgramDateTime&&!p.rawProgramDateTime&&(p.rawProgramDateTime=u.rawProgramDateTime)}else{const X=p.byteRangeEndOffset;if(X){const Q=p.byteRangeStartOffset;T=`${X-Q}@${Q}`}else T=null;Pf(p,$,r,v),u=p,L=!0}break}case"SERVER-CONTROL":{const $=new pe(F);a.canBlockReload=$.bool("CAN-BLOCK-RELOAD"),a.canSkipUntil=$.optionalFloat("CAN-SKIP-UNTIL",0),a.canSkipDateRanges=a.canSkipUntil>0&&$.bool("CAN-SKIP-DATERANGES"),a.partHoldBack=$.optionalFloat("PART-HOLD-BACK",0),a.holdBack=$.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const $=new pe(F);a.partTarget=$.decimalFloatingPoint("PART-TARGET");break}case"PART":{let $=a.partList;$||($=a.partList=[]);const X=d>0?$[$.length-1]:void 0,Q=d++,V=new pe(F);qe(a,V,["BYTERANGE","URI"]);const te=new VS(V,p,t,Q,X);$.push(te),p.duration+=te.duration;break}case"PRELOAD-HINT":{const $=new pe(F);qe(a,$,["URI"]),a.preloadHint=$;break}case"RENDITION-REPORT":{const $=new pe(F);qe(a,$,["URI"]),a.renditionReports=a.renditionReports||[],a.renditionReports.push($);break}default:w.warn(`line parsed but not handled: ${y}`);break}}}h&&!h.relurl?(l.pop(),f-=h.duration,a.partList&&(a.fragmentHint=h)):a.partList&&(_f(p,h),p.cc=m,a.fragmentHint=p,v&&Nf(p,v,a));const A=l.length,R=l[0],I=l[A-1];if(f+=a.skippedSegments*a.targetduration,f>0&&A&&I){a.averagetargetduration=f/A;const M=I.sn;a.endSN=M!=="initSegment"?M:0,a.live||(I.endList=!0),R&&(a.startCC=R.cc)}else a.endSN=0,a.startCC=0;return a.fragmentHint&&(f+=a.fragmentHint.duration),a.totalduration=f,a.endCC=m,x>0&&PT(l,x),a}}function Df(n,e,t){var r,s;const i=new pe(n);qe(t,i,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const o=(r=i.METHOD)!=null?r:"",a=i.URI,l=i.hexadecimalInteger("IV"),u=i.KEYFORMATVERSIONS,c=(s=i.KEYFORMAT)!=null?s:"identity";a&&i.IV&&!l&&w.error(`Invalid IV: ${i.IV}`);const d=a?$t.resolve(a,e):"",f=(u||"1").split("/").map(Number).filter(Number.isFinite);return new $s(o,d,c,f,l)}function kf(n){const t=new pe(n).decimalFloatingPoint("TIME-OFFSET");return G(t)?t:null}function _T(n,e){let t=(n||"").split(/[ ,]+/).filter(r=>r);["video","audio","text"].forEach(r=>{const s=t.filter(i=>wT(i,r));s.length&&(e[`${r}Codec`]=s.join(","),t=t.filter(i=>s.indexOf(i)===-1))}),e.unknownCodecs=t}function bf(n,e,t){const r=e[t];r&&(n[t]=r)}function PT(n,e){let t=n[e];for(let r=e;r--;){const s=n[r];if(!s)return;s.programDateTime=t.programDateTime-s.duration*1e3,t=s}}function _f(n,e){n.rawProgramDateTime?n.programDateTime=Date.parse(n.rawProgramDateTime):e!=null&&e.programDateTime&&(n.programDateTime=e.endProgramDateTime),G(n.programDateTime)||(n.programDateTime=null,n.rawProgramDateTime=null)}function Pf(n,e,t,r){n.relurl=e.URI,e.BYTERANGE&&n.setByteRange(e.BYTERANGE),n.level=t,n.sn="initSegment",r&&(n.levelkeys=r),n.initSegment=null}function Nf(n,e,t){n.levelkeys=e;const{encryptedFragments:r}=t;(!r.length||r[r.length-1].levelkeys!==e)&&Object.keys(e).some(s=>e[s].isCommonEncryption)&&r.push(n)}var re={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},W={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function Of(n){const{type:e}=n;switch(e){case re.AUDIO_TRACK:return W.AUDIO;case re.SUBTITLE_TRACK:return W.SUBTITLE;default:return W.MAIN}}function Ga(n,e){let t=n.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class NT{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.LEVEL_LOADING,this.onLevelLoading,this),e.on(E.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(E.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:e}=this;e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.LEVEL_LOADING,this.onLevelLoading,this),e.off(E.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(E.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(e){const t=this.hls.config,r=t.pLoader,s=t.loader,i=r||s,o=new i(t);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:r}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:re.MANIFEST,url:r,deliveryDirectives:null})}onLevelLoading(e,t){const{id:r,level:s,pathwayId:i,url:o,deliveryDirectives:a}=t;this.load({id:r,level:s,pathwayId:i,responseType:"text",type:re.LEVEL,url:o,deliveryDirectives:a})}onAudioTrackLoading(e,t){const{id:r,groupId:s,url:i,deliveryDirectives:o}=t;this.load({id:r,groupId:s,level:null,responseType:"text",type:re.AUDIO_TRACK,url:i,deliveryDirectives:o})}onSubtitleTrackLoading(e,t){const{id:r,groupId:s,url:i,deliveryDirectives:o}=t;this.load({id:r,groupId:s,level:null,responseType:"text",type:re.SUBTITLE_TRACK,url:i,deliveryDirectives:o})}load(e){var t;const r=this.hls.config;let s=this.getInternalLoader(e);if(s){const u=s.context;if(u&&u.url===e.url&&u.level===e.level){w.trace("[playlist-loader]: playlist request ongoing");return}w.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),s.abort()}let i;if(e.type===re.MANIFEST?i=r.manifestLoadPolicy.default:i=Ae({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(e),G((t=e.deliveryDirectives)==null?void 0:t.part)){let u;if(e.type===re.LEVEL&&e.level!==null?u=this.hls.levels[e.level].details:e.type===re.AUDIO_TRACK&&e.id!==null?u=this.hls.audioTracks[e.id].details:e.type===re.SUBTITLE_TRACK&&e.id!==null&&(u=this.hls.subtitleTracks[e.id].details),u){const c=u.partTarget,d=u.targetduration;if(c&&d){const f=Math.max(c*3,d*.8)*1e3;i=Ae({},i,{maxTimeToFirstByteMs:Math.min(f,i.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(f,i.maxTimeToFirstByteMs)})}}}const o=i.errorRetry||i.timeoutRetry||{},a={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},l={onSuccess:(u,c,d,f)=>{const m=this.getInternalLoader(d);this.resetInternalLoader(d.type);const h=u.data;if(h.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(u,d,new Error("no EXTM3U delimiter"),f||null,c);return}c.parsing.start=performance.now(),$t.isMediaPlaylist(h)?this.handleTrackOrLevelPlaylist(u,c,d,f||null,m):this.handleMasterPlaylist(u,c,d,f)},onError:(u,c,d,f)=>{this.handleNetworkError(c,d,!1,u,f)},onTimeout:(u,c,d)=>{this.handleNetworkError(c,d,!0,void 0,u)}};s.load(e,a,l)}handleMasterPlaylist(e,t,r,s){const i=this.hls,o=e.data,a=Ga(e,r),l=$t.parseMasterPlaylist(o,a);if(l.playlistParsingError){this.handleManifestParsingError(e,r,l.playlistParsingError,s,t);return}const{contentSteering:u,levels:c,sessionData:d,sessionKeys:f,startTimeOffset:m,variableList:h}=l;this.variableList=h;const{AUDIO:p=[],SUBTITLES:y,"CLOSED-CAPTIONS":g}=$t.parseMasterPlaylistMedia(o,a,l);p.length&&!p.some(x=>!x.url)&&c[0].audioCodec&&!c[0].attrs.AUDIO&&(w.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new pe({}),bitrate:0,url:""})),i.trigger(E.MANIFEST_LOADED,{levels:c,audioTracks:p,subtitles:y,captions:g,contentSteering:u,url:a,stats:t,networkDetails:s,sessionData:d,sessionKeys:f,startTimeOffset:m,variableList:h})}handleTrackOrLevelPlaylist(e,t,r,s,i){const o=this.hls,{id:a,level:l,type:u}=r,c=Ga(e,r),d=0,f=G(l)?l:G(a)?a:0,m=Of(r),h=$t.parseLevelPlaylist(e.data,c,f,m,d,this.variableList);if(u===re.MANIFEST){const p={attrs:new pe({}),bitrate:0,details:h,name:"",url:c};o.trigger(E.MANIFEST_LOADED,{levels:[p],audioTracks:[],url:c,stats:t,networkDetails:s,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=h,this.handlePlaylistLoaded(h,e,t,r,s,i)}handleManifestParsingError(e,t,r,s,i){this.hls.trigger(E.ERROR,{type:q.NETWORK_ERROR,details:k.MANIFEST_PARSING_ERROR,fatal:t.type===re.MANIFEST,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:s,stats:i})}handleNetworkError(e,t,r=!1,s,i){let o=`A network ${r?"timeout":"error"+(s?" (status "+s.code+")":"")} occurred while loading ${e.type}`;e.type===re.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===re.AUDIO_TRACK||e.type===re.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);const a=new Error(o);w.warn(`[playlist-loader]: ${o}`);let l=k.UNKNOWN,u=!1;const c=this.getInternalLoader(e);switch(e.type){case re.MANIFEST:l=r?k.MANIFEST_LOAD_TIMEOUT:k.MANIFEST_LOAD_ERROR,u=!0;break;case re.LEVEL:l=r?k.LEVEL_LOAD_TIMEOUT:k.LEVEL_LOAD_ERROR,u=!1;break;case re.AUDIO_TRACK:l=r?k.AUDIO_TRACK_LOAD_TIMEOUT:k.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case re.SUBTITLE_TRACK:l=r?k.SUBTITLE_TRACK_LOAD_TIMEOUT:k.SUBTITLE_LOAD_ERROR,u=!1;break}c&&this.resetInternalLoader(e.type);const d={type:q.NETWORK_ERROR,details:l,fatal:u,url:e.url,loader:c,context:e,error:a,networkDetails:t,stats:i};if(s){const f=(t==null?void 0:t.url)||e.url;d.response=Pe({url:f,data:void 0},s)}this.hls.trigger(E.ERROR,d)}handlePlaylistLoaded(e,t,r,s,i,o){const a=this.hls,{type:l,level:u,id:c,groupId:d,deliveryDirectives:f}=s,m=Ga(t,s),h=Of(s),p=typeof s.level=="number"&&h===W.MAIN?u:void 0;if(!e.fragments.length){const g=new Error("No Segments found in Playlist");a.trigger(E.ERROR,{type:q.NETWORK_ERROR,details:k.LEVEL_EMPTY_ERROR,fatal:!1,url:m,error:g,reason:g.message,response:t,context:s,level:p,parent:h,networkDetails:i,stats:r});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const y=e.playlistParsingError;if(y){a.trigger(E.ERROR,{type:q.NETWORK_ERROR,details:k.LEVEL_PARSING_ERROR,fatal:!1,url:m,error:y,reason:y.message,response:t,context:s,level:p,parent:h,networkDetails:i,stats:r});return}switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case re.MANIFEST:case re.LEVEL:a.trigger(E.LEVEL_LOADED,{details:e,level:p||0,id:c||0,stats:r,networkDetails:i,deliveryDirectives:f});break;case re.AUDIO_TRACK:a.trigger(E.AUDIO_TRACK_LOADED,{details:e,id:c||0,groupId:d||"",stats:r,networkDetails:i,deliveryDirectives:f});break;case re.SUBTITLE_TRACK:a.trigger(E.SUBTITLE_TRACK_LOADED,{details:e,id:c||0,groupId:d||"",stats:r,networkDetails:i,deliveryDirectives:f});break}}}function Dg(n,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=n,e.dispatchEvent(t)}function kg(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues&&!n.cues.getCueById(e.id))try{if(n.addCue(e),!n.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(r){w.debug(`[texttrack-utils]: ${r}`);try{const s=new self.TextTrackCue(e.startTime,e.endTime,e.text);s.id=e.id,n.addCue(s)}catch(s){w.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${s}`)}}t==="disabled"&&(n.mode=t)}function Sr(n){const e=n.mode;if(e==="disabled"&&(n.mode="hidden"),n.cues)for(let t=n.cues.length;t--;)n.removeCue(n.cues[t]);e==="disabled"&&(n.mode=e)}function uu(n,e,t,r){const s=n.mode;if(s==="disabled"&&(n.mode="hidden"),n.cues&&n.cues.length>0){const i=FT(n.cues,e,t);for(let o=0;o<i.length;o++)(!r||r(i[o]))&&n.removeCue(i[o])}s==="disabled"&&(n.mode=s)}function OT(n,e){if(e<n[0].startTime)return 0;const t=n.length-1;if(e>n[t].endTime)return-1;let r=0,s=t;for(;r<=s;){const i=Math.floor((s+r)/2);if(e<n[i].startTime)s=i-1;else if(e>n[i].startTime&&r<t)r=i+1;else return i}return n[r].startTime-e<e-n[s].startTime?r:s}function FT(n,e,t){const r=[],s=OT(n,e);if(s>-1)for(let i=s,o=n.length;i<o;i++){const a=n[i];if(a.startTime>=e&&a.endTime<=t)r.push(a);else if(a.startTime>t)return r}return r}function Bi(n){const e=[];for(let t=0;t<n.length;t++){const r=n[t];(r.kind==="subtitles"||r.kind==="captions")&&r.label&&e.push(n[t])}return e}var Ct={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"};const MT=.25;function cu(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function Ff(n,e,t,r,s){let i=new n(e,t,"");try{i.value=r,s&&(i.type=s)}catch{i=new n(e,t,JSON.stringify(s?Pe({type:s},r):r))}return i}const gi=(()=>{const n=cu();try{n&&new n(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function Ha(n,e){return n.getTime()/1e3-e}function UT(n){return Uint8Array.from(n.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class BT{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:e}=this;e.on(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(E.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(E.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(E.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(E.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(e,t){this.media=t.media}onMediaDetaching(){this.id3Track&&(Sr(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const r=e[t];if(r.kind==="metadata"&&r.label==="id3")return Dg(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:r,enableID3MetadataCues:s}}}=this;if(!r&&!s)return;const{samples:i}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=cu();if(o)for(let a=0;a<i.length;a++){const l=i[a].type;if(l===Ct.emsg&&!r||!s)continue;const u=xg(i[a].data);if(u){const c=i[a].pts;let d=c+i[a].duration;d>gi&&(d=gi),d-c<=0&&(d=c+MT);for(let m=0;m<u.length;m++){const h=u[m];if(!vg(h)){this.updateId3CueEnds(c,l);const p=Ff(o,c,d,h,l);p&&this.id3Track.addCue(p)}}}}}updateId3CueEnds(e,t){var r;const s=(r=this.id3Track)==null?void 0:r.cues;if(s)for(let i=s.length;i--;){const o=s[i];o.type===t&&o.startTime<e&&o.endTime===gi&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:r,type:s}){const{id3Track:i,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:l}}=o;if(i&&(a||l)){let u;s==="audio"?u=c=>c.type===Ct.audioId3&&l:s==="video"?u=c=>c.type===Ct.emsg&&a:u=c=>c.type===Ct.audioId3&&l||c.type===Ct.emsg&&a,uu(i,t,r,u)}}onLevelUpdated(e,{details:t}){if(!this.media||!t.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:r,id3Track:s}=this,{dateRanges:i}=t,o=Object.keys(i);if(s){const c=Object.keys(r).filter(d=>!o.includes(d));for(let d=c.length;d--;){const f=c[d];Object.keys(r[f].cues).forEach(m=>{s.removeCue(r[f].cues[m])}),delete r[f]}}const a=t.fragments[t.fragments.length-1];if(o.length===0||!G(a==null?void 0:a.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const l=a.programDateTime/1e3-a.start,u=cu();for(let c=0;c<o.length;c++){const d=o[c],f=i[d],m=Ha(f.startDate,l),h=r[d],p=(h==null?void 0:h.cues)||{};let y=(h==null?void 0:h.durationKnown)||!1,g=gi;const v=f.endDate;if(v)g=Ha(v,l),y=!0;else if(f.endOnNext&&!y){const L=o.reduce((T,A)=>{if(A!==f.id){const R=i[A];if(R.class===f.class&&R.startDate>f.startDate&&(!T||f.startDate<T.startDate))return R}return T},null);L&&(g=Ha(L.startDate,l),y=!0)}const x=Object.keys(f.attr);for(let L=0;L<x.length;L++){const T=x[L];if(!GS(T))continue;const A=p[T];if(A)y&&!h.durationKnown&&(A.endTime=g);else if(u){let R=f.attr[T];HS(T)&&(R=UT(R));const I=Ff(u,m,g,{key:T,data:R},Ct.dateRange);I&&(I.id=d,this.id3Track.addCue(I),p[T]=I)}}r[d]={cues:p,dateRange:f,durationKnown:y}}}}class $T{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=e,this.config=e.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:e,levelDetails:t}=this;return e.liveMaxLatencyDuration!==void 0?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const{levelDetails:e}=this;if(e===null)return null;const{holdBack:t,partHoldBack:r,targetduration:s}=e,{liveSyncDuration:i,liveSyncDurationCount:o,lowLatencyMode:a}=this.config,l=this.hls.userConfig;let u=a&&r||t;(l.liveSyncDuration||l.liveSyncDurationCount||u===0)&&(u=i!==void 0?i:o*s);const c=s;return u+Math.min(this.stallCount*1,c)}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency,r=this.levelDetails;if(e===null||t===null||r===null)return null;const s=r.edge,i=e-t-this.edgeStalled,o=s-r.totalduration,a=s-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(o,i),a)}get drift(){const{levelDetails:e}=this;return e===null?1:e.drift}get edgeStalled(){const{levelDetails:e}=this;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e,levelDetails:t}=this;if(!e||!t)return 0;const r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(E.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(E.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(E.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(E.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(E.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(E.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(E.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(E.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(E.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(E.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){this.levelDetails=t,t.advanced&&this.timeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(e,t){var r;t.details===k.BUFFER_STALLED_ERROR&&(this.stallCount++,(r=this.levelDetails)!=null&&r.live&&w.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:e,levelDetails:t}=this;if(!e||!t)return;this.currentTime=e.currentTime;const r=this.computeLatency();if(r===null)return;this._latency=r;const{lowLatencyMode:s,maxLiveSyncPlaybackRate:i}=this.config;if(!s||i===1||!t.live)return;const o=this.targetLatency;if(o===null)return;const a=r-o,l=Math.min(this.maxLatency,o+t.targetduration);if(a<l&&a>.05&&this.forwardBufferLength>1){const c=Math.min(2,Math.max(1,i)),d=Math.round(2/(1+Math.exp(-.75*a-this.edgeStalled))*20)/20;e.playbackRate=Math.min(c,Math.max(1,d))}else e.playbackRate!==1&&e.playbackRate!==0&&(e.playbackRate=1)}estimateLiveEdge(){const{levelDetails:e}=this;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}const du=["NONE","TYPE-0","TYPE-1",null];function jT(n){return du.indexOf(n)>-1}const wo=["SDR","PQ","HLG"];function GT(n){return!!n&&wo.indexOf(n)>-1}var $i={No:"",Yes:"YES",v2:"v2"};function Mf(n){const{canSkipUntil:e,canSkipDateRanges:t,age:r}=n,s=r<e/2;return e&&s?t?$i.v2:$i.Yes:$i.No}class Uf{constructor(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Ur{constructor(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(t=>!!t).map(t=>t.substring(0,4)).join(","),this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Bf(this._audioGroups,e)}hasSubtitleGroup(e){return Bf(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let r=this._audioGroups;r||(r=this._audioGroups=[]),r.indexOf(t)===-1&&r.push(t)}else if(e==="text"){let r=this._subtitleGroups;r||(r=this._subtitleGroups=[]),r.indexOf(t)===-1&&r.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Bf(n,e){return!e||!n?!1:n.indexOf(e)!==-1}function Va(n,e){const t=e.startPTS;if(G(t)){let r=0,s;e.sn>n.sn?(r=t-n.start,s=n):(r=n.start-t,s=e),s.duration!==r&&(s.duration=r)}else e.sn>n.sn?n.cc===e.cc&&n.minEndPTS?e.start=n.start+(n.minEndPTS-n.start):e.start=n.start+n.duration:e.start=Math.max(n.start-e.duration,0)}function bg(n,e,t,r,s,i){r-t<=0&&(w.warn("Fragment should have a positive duration",e),r=t+e.duration,i=s+e.duration);let a=t,l=r;const u=e.startPTS,c=e.endPTS;if(G(u)){const y=Math.abs(u-t);G(e.deltaPTS)?e.deltaPTS=Math.max(y,e.deltaPTS):e.deltaPTS=y,a=Math.max(t,u),t=Math.min(t,u),s=Math.min(s,e.startDTS),l=Math.min(r,c),r=Math.max(r,c),i=Math.max(i,e.endDTS)}const d=t-e.start;e.start!==0&&(e.start=t),e.duration=r-e.start,e.startPTS=t,e.maxStartPTS=a,e.startDTS=s,e.endPTS=r,e.minEndPTS=l,e.endDTS=i;const f=e.sn;if(!n||f<n.startSN||f>n.endSN)return 0;let m;const h=f-n.startSN,p=n.fragments;for(p[h]=e,m=h;m>0;m--)Va(p[m],p[m-1]);for(m=h;m<p.length-1;m++)Va(p[m],p[m+1]);return n.fragmentHint&&Va(p[p.length-1],n.fragmentHint),n.PTSKnown=n.alignedSliding=!0,d}function HT(n,e){let t=null;const r=n.fragments;for(let l=r.length-1;l>=0;l--){const u=r[l].initSegment;if(u){t=u;break}}n.fragmentHint&&delete n.fragmentHint.endPTS;let s=0,i;if(zT(n,e,(l,u)=>{l.relurl&&(s=l.cc-u.cc),G(l.startPTS)&&G(l.endPTS)&&(u.start=u.startPTS=l.startPTS,u.startDTS=l.startDTS,u.maxStartPTS=l.maxStartPTS,u.endPTS=l.endPTS,u.endDTS=l.endDTS,u.minEndPTS=l.minEndPTS,u.duration=l.endPTS-l.startPTS,u.duration&&(i=u),e.PTSKnown=e.alignedSliding=!0),u.elementaryStreams=l.elementaryStreams,u.loader=l.loader,u.stats=l.stats,l.initSegment&&(u.initSegment=l.initSegment,t=l.initSegment)}),t&&(e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments).forEach(u=>{var c;u&&(!u.initSegment||u.initSegment.relurl===((c=t)==null?void 0:c.relurl))&&(u.initSegment=t)}),e.skippedSegments)if(e.deltaUpdateFailed=e.fragments.some(l=>!l),e.deltaUpdateFailed){w.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let l=e.skippedSegments;l--;)e.fragments.shift();e.startSN=e.fragments[0].sn,e.startCC=e.fragments[0].cc}else e.canSkipDateRanges&&(e.dateRanges=VT(n.dateRanges,e.dateRanges,e.recentlyRemovedDateranges));const o=e.fragments;if(s){w.warn("discontinuity sliding from playlist, take drift into account");for(let l=0;l<o.length;l++)o[l].cc+=s}e.skippedSegments&&(e.startCC=e.fragments[0].cc),KT(n.partList,e.partList,(l,u)=>{u.elementaryStreams=l.elementaryStreams,u.stats=l.stats}),i?bg(e,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS):_g(n,e),o.length&&(e.totalduration=e.edge-o[0].start),e.driftStartTime=n.driftStartTime,e.driftStart=n.driftStart;const a=e.advancedDateTime;if(e.advanced&&a){const l=e.edge;e.driftStart||(e.driftStartTime=a,e.driftStart=l),e.driftEndTime=a,e.driftEnd=l}else e.driftEndTime=n.driftEndTime,e.driftEnd=n.driftEnd,e.advancedDateTime=n.advancedDateTime}function VT(n,e,t){const r=Ae({},n);return t&&t.forEach(s=>{delete r[s]}),Object.keys(e).forEach(s=>{const i=new hg(e[s].attr,r[s]);i.isValid?r[s]=i:w.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(e[s].attr)}"`)}),r}function KT(n,e,t){if(n&&e){let r=0;for(let s=0,i=n.length;s<=i;s++){const o=n[s],a=e[s+r];o&&a&&o.index===a.index&&o.fragment.sn===a.fragment.sn?t(o,a):r--}}}function zT(n,e,t){const r=e.skippedSegments,s=Math.max(n.startSN,e.startSN)-e.startSN,i=(n.fragmentHint?1:0)+(r?e.endSN:Math.min(n.endSN,e.endSN))-e.startSN,o=e.startSN-n.startSN,a=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments;for(let u=s;u<=i;u++){const c=l[o+u];let d=a[u];r&&!d&&u<r&&(d=e.fragments[u]=c),c&&d&&t(c,d)}}function _g(n,e){const t=e.startSN+e.skippedSegments-n.startSN,r=n.fragments;t<0||t>=r.length||fu(e,r[t].start)}function fu(n,e){if(e){const t=n.fragments;for(let r=n.skippedSegments;r<t.length;r++)t[r].start+=e;n.fragmentHint&&(n.fragmentHint.start+=e)}}function WT(n,e=1/0){let t=1e3*n.targetduration;if(n.updated){const r=n.fragments;if(r.length&&t*4>e){const i=r[r.length-1].duration*1e3;i<t&&(t=i)}}else t/=2;return Math.round(t)}function YT(n,e,t){if(!(n!=null&&n.details))return null;const r=n.details;let s=r.fragments[e-r.startSN];return s||(s=r.fragmentHint,s&&s.sn===e)?s:e<r.startSN&&t&&t.sn===e?t:null}function $f(n,e,t){var r;return n!=null&&n.details?Pg((r=n.details)==null?void 0:r.partList,e,t):null}function Pg(n,e,t){if(n)for(let r=n.length;r--;){const s=n[r];if(s.index===t&&s.fragment.sn===e)return s}return null}function Ng(n){n.forEach((e,t)=>{const{details:r}=e;r!=null&&r.fragments&&r.fragments.forEach(s=>{s.level=t})})}function Co(n){switch(n.details){case k.FRAG_LOAD_TIMEOUT:case k.KEY_LOAD_TIMEOUT:case k.LEVEL_LOAD_TIMEOUT:case k.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function jf(n,e){const t=Co(e);return n.default[`${t?"timeout":"error"}Retry`]}function wc(n,e){const t=n.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*n.retryDelayMs,n.maxRetryDelayMs)}function Gf(n){return Pe(Pe({},n),{errorRetry:null,timeoutRetry:null})}function Io(n,e,t,r){if(!n)return!1;const s=r==null?void 0:r.code,i=e<n.maxNumRetry&&(qT(s)||!!t);return n.shouldRetry?n.shouldRetry(n,e,t,r,i):i}function qT(n){return n===0&&navigator.onLine===!1||!!n&&(n<400||n>499)}const Og={search:function(n,e){let t=0,r=n.length-1,s=null,i=null;for(;t<=r;){s=(t+r)/2|0,i=n[s];const o=e(i);if(o>0)t=s+1;else if(o<0)r=s-1;else return i}return null}};function XT(n,e,t){if(e===null||!Array.isArray(n)||!n.length||!G(e))return null;const r=n[0].programDateTime;if(e<(r||0))return null;const s=n[n.length-1].endProgramDateTime;if(e>=(s||0))return null;t=t||0;for(let i=0;i<n.length;++i){const o=n[i];if(JT(e,t,o))return o}return null}function Do(n,e,t=0,r=0,s=.005){let i=null;if(n){i=e[n.sn-e[0].sn+1]||null;const a=n.endDTS-t;a>0&&a<15e-7&&(t+=15e-7)}else t===0&&e[0].start===0&&(i=e[0]);if(i&&((!n||n.level===i.level)&&hu(t,r,i)===0||QT(i,n,Math.min(s,r))))return i;const o=Og.search(e,hu.bind(null,t,r));return o&&(o!==n||!i)?o:i}function QT(n,e,t){if(e&&e.start===0&&e.level<n.level&&(e.endPTS||0)>0){const r=e.tagList.reduce((s,i)=>(i[0]==="INF"&&(s+=parseFloat(i[1])),s),t);return n.start<=r}return!1}function hu(n=0,e=0,t){if(t.start<=n&&t.start+t.duration>n)return 0;const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-r<=n?1:t.start-r>n&&t.start?-1:0}function JT(n,e,t){const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-r>n}function ZT(n,e){return Og.search(n,t=>t.cc<e?1:t.cc>e?-1:0)}var Fe={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},Tt={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class e1{constructor(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=w.log.bind(w,"[info]:"),this.warn=w.warn.bind(w,"[warning]:"),this.error=w.error.bind(w,"[error]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(E.ERROR,this.onError,this),e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(E.ERROR,this.onError,this),e.off(E.ERROR,this.onErrorOut,this),e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===W.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var r,s;if(t.fatal)return;const i=this.hls,o=t.context;switch(t.details){case k.FRAG_LOAD_ERROR:case k.FRAG_LOAD_TIMEOUT:case k.KEY_LOAD_ERROR:case k.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case k.FRAG_PARSING_ERROR:if((r=t.frag)!=null&&r.gap){t.errorAction={action:Fe.DoNothing,flags:Tt.None};return}case k.FRAG_GAP:case k.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Fe.SendAlternateToPenaltyBox;return}case k.LEVEL_EMPTY_ERROR:case k.LEVEL_PARSING_ERROR:{var a,l;const u=t.parent===W.MAIN?t.level:i.loadLevel;t.details===k.LEVEL_EMPTY_ERROR&&((a=t.context)!=null&&(l=a.levelDetails)!=null&&l.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,u):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,u))}return;case k.LEVEL_LOAD_ERROR:case k.LEVEL_LOAD_TIMEOUT:typeof(o==null?void 0:o.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,o.level));return;case k.AUDIO_TRACK_LOAD_ERROR:case k.AUDIO_TRACK_LOAD_TIMEOUT:case k.SUBTITLE_LOAD_ERROR:case k.SUBTITLE_TRACK_LOAD_TIMEOUT:if(o){const u=i.levels[i.loadLevel];if(u&&(o.type===re.AUDIO_TRACK&&u.hasAudioGroup(o.groupId)||o.type===re.SUBTITLE_TRACK&&u.hasSubtitleGroup(o.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.loadLevel),t.errorAction.action=Fe.SendAlternateToPenaltyBox,t.errorAction.flags=Tt.MoveAllAlternatesMatchingHost;return}}return;case k.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const u=i.levels[i.loadLevel],c=u==null?void 0:u.attrs["HDCP-LEVEL"];c?t.errorAction={action:Fe.SendAlternateToPenaltyBox,flags:Tt.MoveAllAlternatesMatchingHDCP,hdcpLevel:c}:this.keySystemError(t)}return;case k.BUFFER_ADD_CODEC_ERROR:case k.REMUX_ALLOC_ERROR:case k.BUFFER_APPEND_ERROR:t.errorAction=this.getLevelSwitchAction(t,(s=t.level)!=null?s:i.loadLevel);return;case k.INTERNAL_EXCEPTION:case k.BUFFER_APPENDING_ERROR:case k.BUFFER_FULL_ERROR:case k.LEVEL_SWITCH_ERROR:case k.BUFFER_STALLED_ERROR:case k.BUFFER_SEEK_OVER_HOLE:case k.BUFFER_NUDGE_ON_STALL:t.errorAction={action:Fe.DoNothing,flags:Tt.None};return}t.type===q.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){const t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){const r=this.hls,s=jf(r.config.playlistLoadPolicy,e),i=this.playlistError++;if(Io(s,i,Co(e),e.response))return{action:Fe.RetryRequest,flags:Tt.None,retryConfig:s,retryCount:i};const a=this.getLevelSwitchAction(e,t);return s&&(a.retryConfig=s,a.retryCount=i),a}getFragRetryOrSwitchAction(e){const t=this.hls,r=this.getVariantLevelIndex(e.frag),s=t.levels[r],{fragLoadPolicy:i,keyLoadPolicy:o}=t.config,a=jf(e.details.startsWith("key")?o:i,e),l=t.levels.reduce((c,d)=>c+d.fragmentError,0);if(s&&(e.details!==k.FRAG_GAP&&s.fragmentError++,Io(a,l,Co(e),e.response)))return{action:Fe.RetryRequest,flags:Tt.None,retryConfig:a,retryCount:l};const u=this.getLevelSwitchAction(e,r);return a&&(u.retryConfig=a,u.retryCount=l),u}getLevelSwitchAction(e,t){const r=this.hls;t==null&&(t=r.loadLevel);const s=this.hls.levels[t];if(s){var i,o;const u=e.details;s.loadError++,u===k.BUFFER_APPEND_ERROR&&s.fragmentError++;let c=-1;const{levels:d,loadLevel:f,minAutoLevel:m,maxAutoLevel:h}=r;r.autoLevelEnabled||(r.loadLevel=-1);const p=(i=e.frag)==null?void 0:i.type,g=(p===W.AUDIO&&u===k.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(u===k.BUFFER_ADD_CODEC_ERROR||u===k.BUFFER_APPEND_ERROR))&&d.some(({audioCodec:A})=>s.audioCodec!==A),x=e.sourceBufferName==="video"&&(u===k.BUFFER_ADD_CODEC_ERROR||u===k.BUFFER_APPEND_ERROR)&&d.some(({codecSet:A,audioCodec:R})=>s.codecSet!==A&&s.audioCodec===R),{type:L,groupId:T}=(o=e.context)!=null?o:{};for(let A=d.length;A--;){const R=(A+f)%d.length;if(R!==f&&R>=m&&R<=h&&d[R].loadError===0){var a,l;const I=d[R];if(u===k.FRAG_GAP&&p===W.MAIN&&e.frag){const M=d[R].details;if(M){const D=Do(e.frag,M.fragments,e.frag.start);if(D!=null&&D.gap)continue}}else{if(L===re.AUDIO_TRACK&&I.hasAudioGroup(T)||L===re.SUBTITLE_TRACK&&I.hasSubtitleGroup(T))continue;if(p===W.AUDIO&&(a=s.audioGroups)!=null&&a.some(M=>I.hasAudioGroup(M))||p===W.SUBTITLE&&(l=s.subtitleGroups)!=null&&l.some(M=>I.hasSubtitleGroup(M))||g&&s.audioCodec===I.audioCodec||!g&&s.audioCodec!==I.audioCodec||x&&s.codecSet===I.codecSet)continue}c=R;break}}if(c>-1&&r.loadLevel!==c)return e.levelRetry=!0,this.playlistError=0,{action:Fe.SendAlternateToPenaltyBox,flags:Tt.None,nextAutoLevel:c}}return{action:Fe.SendAlternateToPenaltyBox,flags:Tt.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var r;switch((r=t.errorAction)==null?void 0:r.action){case Fe.DoNothing:break;case Fe.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==k.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,r=e.errorAction;if(!r)return;const{flags:s,hdcpLevel:i,nextAutoLevel:o}=r;switch(s){case Tt.None:this.switchLevel(e,o);break;case Tt.MoveAllAlternatesMatchingHDCP:i&&(t.maxHdcpLevel=du[du.indexOf(i)-1],r.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}r.resolved||this.switchLevel(e,o)}switchLevel(e,t){t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}}class Cc{constructor(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=w.log.bind(w,`${t}:`),this.warn=w.warn.bind(w,`${t}:`),this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,r){const s=t==null?void 0:t.renditionReports;if(s){let i=-1;for(let o=0;o<s.length;o++){const a=s[o];let l;try{l=new self.URL(a.URI,t.url).href}catch(u){w.warn(`Could not construct new URL for Rendition Report: ${u}`),l=a.URI||""}if(l===e){i=o;break}else l===e.substring(0,l.length)&&(i=o)}if(i!==-1){const o=s[i],a=parseInt(o["LAST-MSN"])||(t==null?void 0:t.lastPartSn);let l=parseInt(o["LAST-PART"])||(t==null?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const c=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&c>t.partTarget&&(l+=1)}const u=r&&Mf(r);return new Uf(a,l>=0?l:void 0,u)}}}loadPlaylist(e){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}shouldReloadPlaylist(e){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(e)}playlistLoaded(e,t,r){const{details:s,stats:i}=t,o=self.performance.now(),a=i.loading.first?Math.max(0,o-i.loading.first):0;if(s.advancedDateTime=Date.now()-a,s.live||r!=null&&r.live){if(s.reloaded(r),r&&this.log(`live playlist ${e} ${s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:s.updated?"UPDATED":"MISSED"}`),r&&s.fragments.length>0&&HT(r,s),!this.canLoad||!s.live)return;let l,u,c;if(s.canBlockReload&&s.endSN&&s.advanced){const y=this.hls.config.lowLatencyMode,g=s.lastPartSn,v=s.endSN,x=s.lastPartIndex,L=x!==-1,T=g===v,A=y?0:x;L?(u=T?v+1:g,c=T?A:x+1):u=v+1;const R=s.age,I=R+s.ageHeader;let M=Math.min(I-s.partTarget,s.targetduration*1.5);if(M>0){if(r&&M>r.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${r.tuneInGoal} to: ${M} with playlist age: ${s.age}`),M=0;else{const D=Math.floor(M/s.targetduration);if(u+=D,c!==void 0){const F=Math.round(M%s.targetduration/s.partTarget);c+=F}this.log(`CDN Tune-in age: ${s.ageHeader}s last advanced ${R.toFixed(2)}s goal: ${M} skip sn ${D} to part ${c}`)}s.tuneInGoal=M}if(l=this.getDeliveryDirectives(s,t.deliveryDirectives,u,c),y||!T){this.loadPlaylist(l);return}}else(s.canBlockReload||s.canSkipUntil)&&(l=this.getDeliveryDirectives(s,t.deliveryDirectives,u,c));const d=this.hls.mainForwardBufferInfo,f=d?d.end-d.len:0,m=(s.edge-f)*1e3,h=WT(s,m);s.updated&&o>this.requestScheduled+h&&(this.requestScheduled=i.loading.start),u!==void 0&&s.canBlockReload?this.requestScheduled=i.loading.first+h-(s.partTarget*1e3||1e3):this.requestScheduled===-1||this.requestScheduled+h<o?this.requestScheduled=o:this.requestScheduled-o<=0&&(this.requestScheduled+=h);let p=this.requestScheduled-o;p=Math.max(0,p),this.log(`reload live playlist ${e} in ${Math.round(p)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(l),p)}else this.clearTimer()}getDeliveryDirectives(e,t,r,s){let i=Mf(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,s=t.part,i=$i.No),new Uf(r,s,i)}checkRetry(e){const t=e.details,r=Co(e),s=e.errorAction,{action:i,retryCount:o=0,retryConfig:a}=s||{},l=!!s&&!!a&&(i===Fe.RetryRequest||!s.resolved&&i===Fe.SendAlternateToPenaltyBox);if(l){var u;if(this.requestScheduled=-1,o>=a.maxNumRetry)return!1;if(r&&(u=e.context)!=null&&u.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const c=wc(a,o);this.timer=self.setTimeout(()=>this.loadPlaylist(),c),this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" in ${c}ms`)}e.levelRetry=!0,s.resolved=!0}return l}}class sr{constructor(e,t=0,r=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}sample(e,t){const r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class t1{constructor(e,t,r,s=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new sr(e),this.fast_=new sr(t),this.defaultTTFB_=s,this.ttfb_=new sr(e)}update(e,t){const{slow_:r,fast_:s,ttfb_:i}=this;r.halfLife!==e&&(this.slow_=new sr(e,r.getEstimate(),r.getTotalWeight())),s.halfLife!==t&&(this.fast_=new sr(t,s.getEstimate(),s.getTotalWeight())),i.halfLife!==e&&(this.ttfb_=new sr(e,i.getEstimate(),i.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const r=8*t,s=e/1e3,i=r/s;this.fast_.sample(s,i),this.slow_.sample(s,i)}sampleTTFB(e){const t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}const Fg={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]},Hf={};function n1(n,e,t,r,s,i){const o=n.audioCodec?n.audioGroups:null,a=i==null?void 0:i.audioCodec,l=i==null?void 0:i.channels,u=l?parseInt(l):a?1/0:2;let c=null;if(o!=null&&o.length)try{o.length===1&&o[0]?c=e.groups[o[0]].channels:c=o.reduce((d,f)=>{if(f){const m=e.groups[f];if(!m)throw new Error(`Audio track group ${f} not found`);Object.keys(m.channels).forEach(h=>{d[h]=(d[h]||0)+m.channels[h]})}return d},{2:0})}catch{return!0}return n.videoCodec!==void 0&&(n.width>1920&&n.height>1088||n.height>1920&&n.width>1088||n.frameRate>Math.max(r,30)||n.videoRange!=="SDR"&&n.videoRange!==t||n.bitrate>Math.max(s,8e6))||!!c&&G(u)&&Object.keys(c).some(d=>parseInt(d)>u)}function r1(n,e,t){const r=n.videoCodec,s=n.audioCodec;if(!r||!s||!t)return Promise.resolve(Fg);const i={width:n.width,height:n.height,bitrate:Math.ceil(Math.max(n.bitrate*.9,n.averageBitrate)),framerate:n.frameRate||30},o=n.videoRange;o!=="SDR"&&(i.transferFunction=o.toLowerCase());const a=r.split(",").map(l=>({type:"media-source",video:Pe(Pe({},i),{},{contentType:js(l,"video")})}));return s&&n.audioGroups&&n.audioGroups.forEach(l=>{var u;l&&((u=e.groups[l])==null||u.tracks.forEach(c=>{if(c.groupId===l){const d=c.channels||"",f=parseFloat(d);G(f)&&f>2&&a.push.apply(a,s.split(",").map(m=>({type:"media-source",audio:{contentType:js(m,"audio"),channels:""+f}})))}}))}),Promise.all(a.map(l=>{const u=s1(l);return Hf[u]||(Hf[u]=t.decodingInfo(l))})).then(l=>({supported:!l.some(u=>!u.supported),configurations:a,decodingInfoResults:l})).catch(l=>({supported:!1,configurations:a,decodingInfoResults:[],error:l}))}function s1(n){const{audio:e,video:t}=n,r=t||e;if(r){const s=r.contentType.split('"')[1];if(t)return`r${t.height}x${t.width}f${Math.ceil(t.framerate)}${t.transferFunction||"sd"}_${s}_${Math.ceil(t.bitrate/1e5)}`;if(e)return`c${e.channels}${e.spatialRendering?"s":"n"}_${s}`}return""}function i1(){if(typeof matchMedia=="function"){const n=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(n.media!==e.media)return n.matches===!0}return!1}function o1(n,e){let t=!1,r=[];return n&&(t=n!=="SDR",r=[n]),e&&(r=e.allowedVideoRanges||wo.slice(0),t=e.preferHDR!==void 0?e.preferHDR:i1(),t?r=r.filter(s=>s!=="SDR"):r=["SDR"]),{preferHDR:t,allowedVideoRanges:r}}function a1(n,e,t,r,s){const i=Object.keys(n),o=r==null?void 0:r.channels,a=r==null?void 0:r.audioCodec,l=o&&parseInt(o)===2;let u=!0,c=!1,d=1/0,f=1/0,m=1/0,h=0,p=[];const{preferHDR:y,allowedVideoRanges:g}=o1(e,s);for(let T=i.length;T--;){const A=n[i[T]];u=A.channels[2]>0,d=Math.min(d,A.minHeight),f=Math.min(f,A.minFramerate),m=Math.min(m,A.minBitrate);const R=g.filter(I=>A.videoRanges[I]>0);R.length>0&&(c=!0,p=R)}d=G(d)?d:0,f=G(f)?f:0;const v=Math.max(1080,d),x=Math.max(30,f);return m=G(m)?m:t,t=Math.max(m,t),c||(e=void 0,p=[]),{codecSet:i.reduce((T,A)=>{const R=n[A];if(A===T)return T;if(R.minBitrate>t)return Yt(A,`min bitrate of ${R.minBitrate} > current estimate of ${t}`),T;if(!R.hasDefaultAudio)return Yt(A,"no renditions with default or auto-select sound found"),T;if(a&&A.indexOf(a.substring(0,4))%5!==0)return Yt(A,`audio codec preference "${a}" not found`),T;if(o&&!l){if(!R.channels[o])return Yt(A,`no renditions with ${o} channel sound found (channels options: ${Object.keys(R.channels)})`),T}else if((!a||l)&&u&&R.channels[2]===0)return Yt(A,"no renditions with stereo sound found"),T;return R.minHeight>v?(Yt(A,`min resolution of ${R.minHeight} > maximum of ${v}`),T):R.minFramerate>x?(Yt(A,`min framerate of ${R.minFramerate} > maximum of ${x}`),T):p.some(I=>R.videoRanges[I]>0)?R.maxScore<h?(Yt(A,`max score of ${R.maxScore} < selected max of ${h}`),T):T&&(Ro(A)>=Ro(T)||R.fragmentError>n[T].fragmentError)?T:(h=R.maxScore,A):(Yt(A,`no variants with VIDEO-RANGE of ${JSON.stringify(p)} found`),T)},void 0),videoRanges:p,preferHDR:y,minFramerate:f,minBitrate:m}}function Yt(n,e){w.log(`[abr] start candidates with "${n}" ignored because ${e}`)}function l1(n){return n.reduce((e,t)=>{let r=e.groups[t.groupId];r||(r=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),r.tracks.push(t);const s=t.channels||"2";return r.channels[s]=(r.channels[s]||0)+1,r.hasDefault=r.hasDefault||t.default,r.hasAutoSelect=r.hasAutoSelect||t.autoselect,r.hasDefault&&(e.hasDefaultAudio=!0),r.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function u1(n,e,t,r){return n.slice(t,r+1).reduce((s,i)=>{if(!i.codecSet)return s;const o=i.audioGroups;let a=s[i.codecSet];a||(s[i.codecSet]=a={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!o,fragmentError:0}),a.minBitrate=Math.min(a.minBitrate,i.bitrate);const l=Math.min(i.height,i.width);return a.minHeight=Math.min(a.minHeight,l),a.minFramerate=Math.min(a.minFramerate,i.frameRate),a.maxScore=Math.max(a.maxScore,i.score),a.fragmentError+=i.fragmentError,a.videoRanges[i.videoRange]=(a.videoRanges[i.videoRange]||0)+1,o&&o.forEach(u=>{if(!u)return;const c=e.groups[u];c&&(a.hasDefaultAudio=a.hasDefaultAudio||e.hasDefaultAudio?c.hasDefault:c.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(c.channels).forEach(d=>{a.channels[d]=(a.channels[d]||0)+c.channels[d]}))}),s},{})}function jt(n,e,t){if("attrs"in n){const r=e.indexOf(n);if(r!==-1)return r}for(let r=0;r<e.length;r++){const s=e[r];if(Ir(n,s,t))return r}return-1}function Ir(n,e,t){const{groupId:r,name:s,lang:i,assocLang:o,characteristics:a,default:l}=n,u=n.forced;return(r===void 0||e.groupId===r)&&(s===void 0||e.name===s)&&(i===void 0||e.lang===i)&&(i===void 0||e.assocLang===o)&&(l===void 0||e.default===l)&&(u===void 0||e.forced===u)&&(a===void 0||c1(a,e.characteristics))&&(t===void 0||t(n,e))}function c1(n,e=""){const t=n.split(","),r=e.split(",");return t.length===r.length&&!t.some(s=>r.indexOf(s)===-1)}function ir(n,e){const{audioCodec:t,channels:r}=n;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(r===void 0||r===(e.channels||"2"))}function d1(n,e,t,r,s){const i=e[r],a=e.reduce((f,m,h)=>{const p=m.uri;return(f[p]||(f[p]=[])).push(h),f},{})[i.uri];a.length>1&&(r=Math.max.apply(Math,a));const l=i.videoRange,u=i.frameRate,c=i.codecSet.substring(0,4),d=Vf(e,r,f=>{if(f.videoRange!==l||f.frameRate!==u||f.codecSet.substring(0,4)!==c)return!1;const m=f.audioGroups,h=t.filter(p=>!m||m.indexOf(p.groupId)!==-1);return jt(n,h,s)>-1});return d>-1?d:Vf(e,r,f=>{const m=f.audioGroups,h=t.filter(p=>!m||m.indexOf(p.groupId)!==-1);return jt(n,h,s)>-1})}function Vf(n,e,t){for(let r=e;r;r--)if(t(n[r]))return r;for(let r=e+1;r<n.length;r++)if(t(n[r]))return r;return-1}class f1{constructor(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this._abandonRulesCheck=()=>{const{fragCurrent:t,partCurrent:r,hls:s}=this,{autoLevelEnabled:i,media:o}=s;if(!t||!o)return;const a=performance.now(),l=r?r.stats:t.stats,u=r?r.duration:t.duration,c=a-l.loading.start,d=s.minAutoLevel;if(l.aborted||l.loaded&&l.loaded===l.total||t.level<=d){this.clearTimer(),this._nextAutoLevel=-1;return}if(!i||o.paused||!o.playbackRate||!o.readyState)return;const f=s.mainForwardBufferInfo;if(f===null)return;const m=this.bwEstimator.getEstimateTTFB(),h=Math.abs(o.playbackRate);if(c<=Math.max(m,1e3*(u/(h*2))))return;const p=f.len/h,y=l.loading.first?l.loading.first-l.loading.start:-1,g=l.loaded&&y>-1,v=this.getBwEstimate(),x=s.levels,L=x[t.level],T=l.total||Math.max(l.loaded,Math.round(u*L.averageBitrate/8));let A=g?c-y:c;A<1&&g&&(A=Math.min(c,l.loaded*8/v));const R=g?l.loaded*1e3/A:0,I=R?(T-l.loaded)/R:T*8/v+m/1e3;if(I<=p)return;const M=R?R*8:v;let D=Number.POSITIVE_INFINITY,F;for(F=t.level-1;F>d;F--){const $=x[F].maxBitrate;if(D=this.getTimeToLoadFrag(m/1e3,M,u*$,!x[F].details),D<p)break}if(D>=I||D>u*10)return;s.nextLoadLevel=s.nextAutoLevel=F,g?this.bwEstimator.sample(c-Math.min(m,y),l.loaded):this.bwEstimator.sampleTTFB(c);const Y=x[F].maxBitrate;this.getBwEstimate()*this.hls.config.abrBandWidthUpFactor>Y&&this.resetEstimator(Y),this.clearTimer(),w.warn(`[abr] Fragment ${t.sn}${r?" part "+r.index:""} of level ${t.level} is loading too slowly;
      Time to underbuffer: ${p.toFixed(3)} s
      Estimated load time for current fragment: ${I.toFixed(3)} s
      Estimated load time for down switch fragment: ${D.toFixed(3)} s
      TTFB estimate: ${y|0} ms
      Current BW estimate: ${G(v)?v|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${F} @ ${Y|0} bps`),s.trigger(E.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:r,stats:l})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(w.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new t1(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.FRAG_LOADING,this.onFragLoading,this),e.on(E.FRAG_LOADED,this.onFragLoaded,this),e.on(E.FRAG_BUFFERED,this.onFragBuffered,this),e.on(E.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(E.LEVEL_LOADED,this.onLevelLoaded,this),e.on(E.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(E.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(E.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.FRAG_LOADING,this.onFragLoading,this),e.off(E.FRAG_LOADED,this.onFragLoaded,this),e.off(E.FRAG_BUFFERED,this.onFragBuffered,this),e.off(E.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(E.LEVEL_LOADED,this.onLevelLoaded,this),e.off(E.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(E.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(E.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const r=t.frag;if(!this.ignoreFragment(r)){if(!r.bitrateTest){var s;this.fragCurrent=r,this.partCurrent=(s=t.part)!=null?s:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case k.BUFFER_ADD_CODEC_ERROR:case k.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case k.FRAG_LOAD_TIMEOUT:{const r=t.frag,{fragCurrent:s,partCurrent:i}=this;if(r&&s&&r.sn===s.sn&&r.level===s.level){const o=performance.now(),a=i?i.stats:r.stats,l=o-a.loading.start,u=a.loading.first?a.loading.first-a.loading.start:-1;if(a.loaded&&u>-1){const d=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(d,u),a.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,t,r,s){const i=e+r/t,o=s?this.lastLevelLoadSec:0;return i+o}onLevelLoaded(e,t){const r=this.hls.config,{loading:s}=t.stats,i=s.end-s.start;G(i)&&(this.lastLevelLoadSec=i/1e3),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)}onFragLoaded(e,{frag:t,part:r}){const s=r?r.stats:t.stats;if(t.type===W.MAIN&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const i=r?r.duration:t.duration,o=this.hls.levels[t.level],a=(o.loaded?o.loaded.bytes:0)+s.loaded,l=(o.loaded?o.loaded.duration:0)+i;o.loaded={bytes:a,duration:l},o.realBitrate=Math.round(8*a/l)}if(t.bitrateTest){const i={stats:s,frag:t,part:r,id:t.type};this.onFragBuffered(E.FRAG_BUFFERED,i),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:r,part:s}=t,i=s!=null&&s.stats.loaded?s.stats:r.stats;if(i.aborted||this.ignoreFragment(r))return;const o=i.parsing.end-i.loading.start-Math.min(i.loading.first-i.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,i.loaded),i.bwEstimate=this.getBwEstimate(),r.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==W.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,r=this.getBwEstimate(),s=this.hls.config.maxStarvationDelay,i=this.findBestLevel(r,t,e,0,s,1,1);if(i>-1)return i;const o=this.hls.firstLevel,a=Math.min(Math.max(o,t),e);return w.warn(`[abr] Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${a}`),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,r=this.bwEstimator.canEstimate(),s=this.lastLoadedFragLevel>-1;if(e!==-1&&(!r||!s||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const i=r&&s?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const o=this.hls.levels;if(o.length>Math.max(e,i)&&o[e].loadError<=o[i].loadError)return e}return this._nextAutoLevel=i,this.nextAutoLevelKey=this.getAutoLevelKey(),i}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:r}=this,{maxAutoLevel:s,config:i,minAutoLevel:o}=r,a=t?t.duration:e?e.duration:0,l=this.getBwEstimate(),u=this.getStarvationDelay();let c=i.abrBandWidthFactor,d=i.abrBandWidthUpFactor;if(u){const y=this.findBestLevel(l,o,s,u,0,c,d);if(y>=0)return y}let f=a?Math.min(a,i.maxStarvationDelay):i.maxStarvationDelay;if(!u){const y=this.bitrateTestDelay;y&&(f=(a?Math.min(a,i.maxLoadingDelay):i.maxLoadingDelay)-y,w.info(`[abr] bitrate test took ${Math.round(1e3*y)}ms, set first fragment max fetchDuration to ${Math.round(1e3*f)} ms`),c=d=1)}const m=this.findBestLevel(l,o,s,u,f,c,d);if(w.info(`[abr] ${u?"rebuffering expected":"buffer is empty"}, optimal quality level ${m}`),m>-1)return m;const h=r.levels[o],p=r.levels[r.loadLevel];return(h==null?void 0:h.bitrate)<(p==null?void 0:p.bitrate)?o:r.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const r=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,s=e.mainForwardBufferInfo;return(s?s.len:0)/r}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,r,s,i,o,a){var l;const u=s+i,c=this.lastLoadedFragLevel,d=c===-1?this.hls.firstLevel:c,{fragCurrent:f,partCurrent:m}=this,{levels:h,allAudioTracks:p,loadLevel:y,config:g}=this.hls;if(h.length===1)return 0;const v=h[d],x=!!(v!=null&&(l=v.details)!=null&&l.live),L=y===-1||c===-1;let T,A="SDR",R=(v==null?void 0:v.frameRate)||0;const{audioPreference:I,videoPreference:M}=g,D=this.audioTracksByGroup||(this.audioTracksByGroup=l1(p));if(L){if(this.firstSelection!==-1)return this.firstSelection;const Q=this.codecTiers||(this.codecTiers=u1(h,D,t,r)),V=a1(Q,A,e,I,M),{codecSet:te,videoRanges:U,minFramerate:O,minBitrate:P,preferHDR:K}=V;T=te,A=K?U[U.length-1]:U[0],R=O,e=Math.max(e,P),w.log(`[abr] picked start tier ${JSON.stringify(V)}`)}else T=v==null?void 0:v.codecSet,A=v==null?void 0:v.videoRange;const F=m?m.duration:f?f.duration:0,Y=this.bwEstimator.getEstimateTTFB()/1e3,$=[];for(let Q=r;Q>=t;Q--){var X;const V=h[Q],te=Q>d;if(!V)continue;if(g.useMediaCapabilities&&!V.supportedResult&&!V.supportedPromise){const ae=navigator.mediaCapabilities;typeof(ae==null?void 0:ae.decodingInfo)=="function"&&n1(V,D,A,R,e,I)?(V.supportedPromise=r1(V,D,ae),V.supportedPromise.then(xe=>{if(!this.hls)return;V.supportedResult=xe;const ce=this.hls.levels,Ne=ce.indexOf(V);xe.error?w.warn(`[abr] MediaCapabilities decodingInfo error: "${xe.error}" for level ${Ne} ${JSON.stringify(xe)}`):xe.supported||(w.warn(`[abr] Unsupported MediaCapabilities decodingInfo result for level ${Ne} ${JSON.stringify(xe)}`),Ne>-1&&ce.length>1&&(w.log(`[abr] Removing unsupported level ${Ne}`),this.hls.removeLevel(Ne)))})):V.supportedResult=Fg}if(T&&V.codecSet!==T||A&&V.videoRange!==A||te&&R>V.frameRate||!te&&R>0&&R<V.frameRate||V.supportedResult&&!((X=V.supportedResult.decodingInfoResults)!=null&&X[0].smooth)){$.push(Q);continue}const U=V.details,O=(m?U==null?void 0:U.partTarget:U==null?void 0:U.averagetargetduration)||F;let P;te?P=a*e:P=o*e;const K=F&&s>=F*2&&i===0?h[Q].averageBitrate:h[Q].maxBitrate,H=this.getTimeToLoadFrag(Y,P,K*O,U===void 0);if(P>=K&&(Q===c||V.loadError===0&&V.fragmentError===0)&&(H<=Y||!G(H)||x&&!this.bitrateTestDelay||H<u)){const ae=this.forcedAutoLevel;return Q!==y&&(ae===-1||ae!==y)&&($.length&&w.trace(`[abr] Skipped level(s) ${$.join(",")} of ${r} max with CODECS and VIDEO-RANGE:"${h[$[0]].codecs}" ${h[$[0]].videoRange}; not compatible with "${v.codecs}" ${A}`),w.info(`[abr] switch candidate:${d}->${Q} adjustedbw(${Math.round(P)})-bitrate=${Math.round(P-K)} ttfb:${Y.toFixed(1)} avgDuration:${O.toFixed(1)} maxFetchDuration:${u.toFixed(1)} fetchDuration:${H.toFixed(1)} firstSelection:${L} codecSet:${T} videoRange:${A} hls.loadLevel:${y}`)),L&&(this.firstSelection=Q),Q}}return-1}set nextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:r}=this.hls,s=Math.min(Math.max(e,r),t);this._nextAutoLevel!==s&&(this.nextAutoLevelKey="",this._nextAutoLevel=s)}}class h1{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}var be={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class m1{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(E.BUFFER_APPENDED,this.onBufferAppended,this),e.on(E.FRAG_BUFFERED,this.onFragBuffered,this),e.on(E.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(E.BUFFER_APPENDED,this.onBufferAppended,this),e.off(E.FRAG_BUFFERED,this.onFragBuffered,this),e.off(E.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const r=this.activePartLists[t];if(r)for(let s=r.length;s--;){const i=r[s];if(!i)break;const o=i.end;if(i.start<=e&&o!==null&&e<=o)return i}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){const{fragments:r}=this,s=Object.keys(r);for(let i=s.length;i--;){const o=r[s[i]];if((o==null?void 0:o.body.type)===t&&o.buffered){const a=o.body;if(a.start<=e&&e<=a.end)return a}}return null}detectEvictedFragments(e,t,r,s){this.timeRanges&&(this.timeRanges[e]=t);const i=(s==null?void 0:s.fragment.sn)||-1;Object.keys(this.fragments).forEach(o=>{const a=this.fragments[o];if(!a||i>=a.body.sn)return;if(!a.buffered&&!a.loaded){a.body.type===r&&this.removeFragment(a.body);return}const l=a.range[e];l&&l.time.some(u=>{const c=!this.isTimeBuffered(u.startPTS,u.endPTS,t);return c&&this.removeFragment(a.body),c})})}detectPartialFragments(e){const t=this.timeRanges,{frag:r,part:s}=e;if(!t||r.sn==="initSegment")return;const i=or(r),o=this.fragments[i];if(!o||o.buffered&&r.gap)return;const a=!r.relurl;Object.keys(t).forEach(l=>{const u=r.elementaryStreams[l];if(!u)return;const c=t[l],d=a||u.partial===!0;o.range[l]=this.getBufferedTimes(r,s,d,c)}),o.loaded=null,Object.keys(o.range).length?(o.buffered=!0,(o.body.endList=r.endList||o.body.endList)&&(this.endListFragments[o.body.type]=o),yi(o)||this.removeParts(r.sn-1,r.type)):this.removeFragment(o.body)}removeParts(e,t){const r=this.activePartLists[t];r&&(this.activePartLists[t]=r.filter(s=>s.fragment.sn>=e))}fragBuffered(e,t){const r=or(e);let s=this.fragments[r];!s&&t&&(s=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),s&&(s.loaded=null,s.buffered=!0)}getBufferedTimes(e,t,r,s){const i={time:[],partial:r},o=e.start,a=e.end,l=e.minEndPTS||a,u=e.maxStartPTS||o;for(let c=0;c<s.length;c++){const d=s.start(c)-this.bufferPadding,f=s.end(c)+this.bufferPadding;if(u>=d&&l<=f){i.time.push({startPTS:Math.max(o,s.start(c)),endPTS:Math.min(a,s.end(c))});break}else if(o<f&&a>d){const m=Math.max(o,s.start(c)),h=Math.min(a,s.end(c));h>m&&(i.partial=!0,i.time.push({startPTS:m,endPTS:h}))}else if(a<=d)break}return i}getPartialFragment(e){let t=null,r,s,i,o=0;const{bufferPadding:a,fragments:l}=this;return Object.keys(l).forEach(u=>{const c=l[u];c&&yi(c)&&(s=c.body.start-a,i=c.body.end+a,e>=s&&e<=i&&(r=Math.min(e-s,i-e),o<=r&&(t=c.body,o=r)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||yi(t))}getState(e){const t=or(e),r=this.fragments[t];return r?r.buffered?yi(r)?be.PARTIAL:be.OK:be.APPENDING:be.NOT_LOADED}isTimeBuffered(e,t,r){let s,i;for(let o=0;o<r.length;o++){if(s=r.start(o)-this.bufferPadding,i=r.end(o)+this.bufferPadding,e>=s&&t<=i)return!0;if(t<=s)return!1}return!1}onFragLoaded(e,t){const{frag:r,part:s}=t;if(r.sn==="initSegment"||r.bitrateTest)return;const i=s?null:t,o=or(r);this.fragments[o]={body:r,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:r,part:s,timeRanges:i}=t;if(r.sn==="initSegment")return;const o=r.type;if(s){let a=this.activePartLists[o];a||(this.activePartLists[o]=a=[]),a.push(s)}this.timeRanges=i,Object.keys(i).forEach(a=>{const l=i[a];this.detectEvictedFragments(a,l,o,s)})}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=or(e);return!!this.fragments[t]}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,r,s,i){s&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const a=this.fragments[o];if(!a)return;const l=a.body;l.type!==r||s&&!l.gap||l.start<t&&l.end>e&&(a.buffered||i)&&this.removeFragment(l)})}removeFragment(e){const t=or(e);e.stats.loaded=0,e.clearElementaryStreamInfo();const r=this.activePartLists[e.type];if(r){const s=e.sn;this.activePartLists[e.type]=r.filter(i=>i.fragment.sn!==s)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function yi(n){var e,t,r;return n.buffered&&(n.body.gap||((e=n.range.video)==null?void 0:e.partial)||((t=n.range.audio)==null?void 0:t.partial)||((r=n.range.audiovideo)==null?void 0:r.partial))}function or(n){return`${n.type}_${n.level}_${n.sn}`}const p1={length:0,start:()=>0,end:()=>0};class le{static isBuffered(e,t){try{if(e){const r=le.getBuffered(e);for(let s=0;s<r.length;s++)if(t>=r.start(s)&&t<=r.end(s))return!0}}catch{}return!1}static bufferInfo(e,t,r){try{if(e){const s=le.getBuffered(e),i=[];let o;for(o=0;o<s.length;o++)i.push({start:s.start(o),end:s.end(o)});return this.bufferedInfo(i,t,r)}}catch{}return{len:0,start:t,end:t,nextStart:void 0}}static bufferedInfo(e,t,r){t=Math.max(0,t),e.sort(function(u,c){const d=u.start-c.start;return d||c.end-u.end});let s=[];if(r)for(let u=0;u<e.length;u++){const c=s.length;if(c){const d=s[c-1].end;e[u].start-d<r?e[u].end>d&&(s[c-1].end=e[u].end):s.push(e[u])}else s.push(e[u])}else s=e;let i=0,o,a=t,l=t;for(let u=0;u<s.length;u++){const c=s[u].start,d=s[u].end;if(t+r>=c&&t<d)a=c,l=d,i=l-t;else if(t+r<c){o=c;break}}return{len:i,start:a||0,end:l||0,nextStart:o}}static getBuffered(e){try{return e.buffered}catch(t){return w.log("failed to get media.buffered",t),p1}}}class Ic{constructor(e,t,r,s=0,i=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=vi(),this.buffering={audio:vi(),video:vi(),audiovideo:vi()},this.level=e,this.sn=t,this.id=r,this.size=s,this.part=i,this.partial=o}}function vi(){return{start:0,executeStart:0,executeEnd:0,end:0}}function ji(n,e){for(let r=0,s=n.length;r<s;r++){var t;if(((t=n[r])==null?void 0:t.cc)===e)return n[r]}return null}function g1(n,e,t){return!!(e&&(t.endCC>t.startCC||n&&n.cc<t.startCC))}function y1(n,e){const t=n.fragments,r=e.fragments;if(!r.length||!t.length){w.log("No fragments to align");return}const s=ji(t,r[0].cc);if(!s||s&&!s.startPTS){w.log("No frag in previous level to align on");return}return s}function Kf(n,e){if(n){const t=n.start+e;n.start=n.startPTS=t,n.endPTS=t+n.duration}}function Mg(n,e){const t=e.fragments;for(let r=0,s=t.length;r<s;r++)Kf(t[r],n);e.fragmentHint&&Kf(e.fragmentHint,n),e.alignedSliding=!0}function v1(n,e,t){e&&(x1(n,t,e),!t.alignedSliding&&e&&ko(t,e),!t.alignedSliding&&e&&!t.skippedSegments&&_g(e,t))}function x1(n,e,t){if(g1(n,t,e)){const r=y1(t,e);r&&G(r.start)&&(w.log(`Adjusting PTS using last level due to CC increase within current level ${e.url}`),Mg(r.start,e))}}function ko(n,e){if(!n.hasProgramDateTime||!e.hasProgramDateTime)return;const t=n.fragments,r=e.fragments;if(!t.length||!r.length)return;let s,i;const o=Math.min(e.endCC,n.endCC);e.startCC<o&&n.startCC<o&&(s=ji(r,o),i=ji(t,o)),(!s||!i)&&(s=r[Math.floor(r.length/2)],i=ji(t,s.cc)||t[Math.floor(t.length/2)]);const a=s.programDateTime,l=i.programDateTime;if(!a||!l)return;const u=(l-a)/1e3-(i.start-s.start);Mg(u,n)}const zf=Math.pow(2,17);class E1{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const r=e.url;if(!r)return Promise.reject(new Qt({type:q.NETWORK_ERROR,details:k.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${r?"part list":"url"}`),networkDetails:null}));this.abort();const s=this.config,i=s.fLoader,o=s.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(m=>m[0]==="GAP")){l(Yf(e));return}else e.gap=!1;const u=this.loader=e.loader=i?new i(s):new o(s),c=Wf(e),d=Gf(s.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:zf};e.stats=u.stats,u.load(c,f,{onSuccess:(m,h,p,y)=>{this.resetLoader(e,u);let g=m.data;p.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(g.slice(0,16)),g=g.slice(16)),a({frag:e,part:null,payload:g,networkDetails:y})},onError:(m,h,p,y)=>{this.resetLoader(e,u),l(new Qt({type:q.NETWORK_ERROR,details:k.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Pe({url:r,data:void 0},m),error:new Error(`HTTP Error ${m.code} ${m.text}`),networkDetails:p,stats:y}))},onAbort:(m,h,p)=>{this.resetLoader(e,u),l(new Qt({type:q.NETWORK_ERROR,details:k.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:p,stats:m}))},onTimeout:(m,h,p)=>{this.resetLoader(e,u),l(new Qt({type:q.NETWORK_ERROR,details:k.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:p,stats:m}))},onProgress:(m,h,p,y)=>{t&&t({frag:e,part:null,payload:p,networkDetails:y})}})})}loadPart(e,t,r){this.abort();const s=this.config,i=s.fLoader,o=s.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l(Yf(e,t));return}const u=this.loader=e.loader=i?new i(s):new o(s),c=Wf(e,t),d=Gf(s.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:zf};t.stats=u.stats,u.load(c,f,{onSuccess:(m,h,p,y)=>{this.resetLoader(e,u),this.updateStatsFromPart(e,t);const g={frag:e,part:t,payload:m.data,networkDetails:y};r(g),a(g)},onError:(m,h,p,y)=>{this.resetLoader(e,u),l(new Qt({type:q.NETWORK_ERROR,details:k.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Pe({url:c.url,data:void 0},m),error:new Error(`HTTP Error ${m.code} ${m.text}`),networkDetails:p,stats:y}))},onAbort:(m,h,p)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,u),l(new Qt({type:q.NETWORK_ERROR,details:k.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:p,stats:m}))},onTimeout:(m,h,p)=>{this.resetLoader(e,u),l(new Qt({type:q.NETWORK_ERROR,details:k.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:p,stats:m}))}})})}updateStatsFromPart(e,t){const r=e.stats,s=t.stats,i=s.total;if(r.loaded+=s.loaded,i){const l=Math.round(e.duration/t.duration),u=Math.min(Math.round(r.loaded/i),l),d=(l-u)*Math.round(r.loaded/u);r.total=r.loaded+d}else r.total=Math.max(r.loaded,r.total);const o=r.loading,a=s.loading;o.start?o.first+=a.first-a.start:(o.start=a.start,o.first=a.first),o.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function Wf(n,e=null){const t=e||n,r={frag:n,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},s=t.byteRangeStartOffset,i=t.byteRangeEndOffset;if(G(s)&&G(i)){var o;let a=s,l=i;if(n.sn==="initSegment"&&((o=n.decryptdata)==null?void 0:o.method)==="AES-128"){const u=i-s;u%16&&(l=i+(16-u%16)),s!==0&&(r.resetIV=!0,a=s-16)}r.rangeStart=a,r.rangeEnd=l}return r}function Yf(n,e){const t=new Error(`GAP ${n.gap?"tag":"attribute"} found`),r={type:q.MEDIA_ERROR,details:k.FRAG_GAP,fatal:!1,frag:n,error:t,networkDetails:null};return e&&(r.part=e),(e||n).stats.aborted=!0,new Qt(r)}class Qt extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class S1{constructor(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}decrypt(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}class T1{constructor(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}function L1(n){const e=n.byteLength,t=e&&new DataView(n.buffer).getUint8(e-1);return t?zn(n,0,e-t):n}class R1{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),r=new Uint32Array(4);for(let s=0;s<4;s++)r[s]=t.getUint32(s*4);return r}initTable(){const e=this.sBox,t=this.invSBox,r=this.subMix,s=r[0],i=r[1],o=r[2],a=r[3],l=this.invSubMix,u=l[0],c=l[1],d=l[2],f=l[3],m=new Uint32Array(256);let h=0,p=0,y=0;for(y=0;y<256;y++)y<128?m[y]=y<<1:m[y]=y<<1^283;for(y=0;y<256;y++){let g=p^p<<1^p<<2^p<<3^p<<4;g=g>>>8^g&255^99,e[h]=g,t[g]=h;const v=m[h],x=m[v],L=m[x];let T=m[g]*257^g*16843008;s[h]=T<<24|T>>>8,i[h]=T<<16|T>>>16,o[h]=T<<8|T>>>24,a[h]=T,T=L*16843009^x*65537^v*257^h*16843008,u[g]=T<<24|T>>>8,c[g]=T<<16|T>>>16,d[g]=T<<8|T>>>24,f[g]=T,h?(h=v^m[m[m[L^v]]],p^=m[m[p]]):h=p=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let r=!0,s=0;for(;s<t.length&&r;)r=t[s]===this.key[s],s++;if(r)return;this.key=t;const i=this.keySize=t.length;if(i!==4&&i!==6&&i!==8)throw new Error("Invalid aes key size="+i);const o=this.ksRows=(i+6+1)*4;let a,l;const u=this.keySchedule=new Uint32Array(o),c=this.invKeySchedule=new Uint32Array(o),d=this.sBox,f=this.rcon,m=this.invSubMix,h=m[0],p=m[1],y=m[2],g=m[3];let v,x;for(a=0;a<o;a++){if(a<i){v=u[a]=t[a];continue}x=v,a%i===0?(x=x<<8|x>>>24,x=d[x>>>24]<<24|d[x>>>16&255]<<16|d[x>>>8&255]<<8|d[x&255],x^=f[a/i|0]<<24):i>6&&a%i===4&&(x=d[x>>>24]<<24|d[x>>>16&255]<<16|d[x>>>8&255]<<8|d[x&255]),u[a]=v=(u[a-i]^x)>>>0}for(l=0;l<o;l++)a=o-l,l&3?x=u[a]:x=u[a-4],l<4||a<=4?c[l]=x:c[l]=h[d[x>>>24]]^p[d[x>>>16&255]]^y[d[x>>>8&255]]^g[d[x&255]],c[l]=c[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,r){const s=this.keySize+6,i=this.invKeySchedule,o=this.invSBox,a=this.invSubMix,l=a[0],u=a[1],c=a[2],d=a[3],f=this.uint8ArrayToUint32Array_(r);let m=f[0],h=f[1],p=f[2],y=f[3];const g=new Int32Array(e),v=new Int32Array(g.length);let x,L,T,A,R,I,M,D,F,Y,$,X,Q,V;const te=this.networkToHostOrderSwap;for(;t<g.length;){for(F=te(g[t]),Y=te(g[t+1]),$=te(g[t+2]),X=te(g[t+3]),R=F^i[0],I=X^i[1],M=$^i[2],D=Y^i[3],Q=4,V=1;V<s;V++)x=l[R>>>24]^u[I>>16&255]^c[M>>8&255]^d[D&255]^i[Q],L=l[I>>>24]^u[M>>16&255]^c[D>>8&255]^d[R&255]^i[Q+1],T=l[M>>>24]^u[D>>16&255]^c[R>>8&255]^d[I&255]^i[Q+2],A=l[D>>>24]^u[R>>16&255]^c[I>>8&255]^d[M&255]^i[Q+3],R=x,I=L,M=T,D=A,Q=Q+4;x=o[R>>>24]<<24^o[I>>16&255]<<16^o[M>>8&255]<<8^o[D&255]^i[Q],L=o[I>>>24]<<24^o[M>>16&255]<<16^o[D>>8&255]<<8^o[R&255]^i[Q+1],T=o[M>>>24]<<24^o[D>>16&255]<<16^o[R>>8&255]<<8^o[I&255]^i[Q+2],A=o[D>>>24]<<24^o[R>>16&255]<<16^o[I>>8&255]<<8^o[M&255]^i[Q+3],v[t]=te(x^m),v[t+1]=te(A^h),v[t+2]=te(T^p),v[t+3]=te(L^y),m=F,h=Y,p=$,y=X,t=t+4}return v.buffer}}const A1=16;class Dc{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const r=self.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const r=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?L1(r):r}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,r){return this.useSoftware?new Promise((s,i)=>{this.softwareDecrypt(new Uint8Array(e),t,r);const o=this.flush();o?s(o.buffer):i(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,r)}softwareDecrypt(e,t,r){const{currentIV:s,currentResult:i,remainderData:o}=this;this.logOnce("JS AES decrypt"),o&&(e=Et(o,e),this.remainderData=null);const a=this.getValidChunk(e);if(!a.length)return null;s&&(r=s);let l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new R1),l.expandKey(t);const u=i;return this.currentResult=l.decrypt(a.buffer,0,r),this.currentIV=zn(a,-16).buffer,u||null}webCryptoDecrypt(e,t,r){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,r));this.key=t,this.fastAesKey=new T1(this.subtle,t)}return this.fastAesKey.expandKey().then(s=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new S1(this.subtle,new Uint8Array(r)).decrypt(e.buffer,s)):Promise.reject(new Error("web crypto not initialized"))).catch(s=>(w.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${s.name}: ${s.message}`),this.onWebCryptoError(e,t,r)))}onWebCryptoError(e,t,r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r);const s=this.flush();if(s)return s.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(e){let t=e;const r=e.length-e.length%A1;return r!==e.length&&(t=zn(e,0,r),this.remainderData=zn(e,r)),t}logOnce(e){this.logEnabled&&(w.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const w1={toString:function(n){let e="";const t=n.length;for(let r=0;r<t;r++)e+=`[${n.start(r).toFixed(3)}-${n.end(r).toFixed(3)}]`;return e}},N={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class kc extends h1{constructor(e,t,r,s,i){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=N.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=i,this.logPrefix=s,this.log=w.log.bind(w,`${s}:`),this.warn=w.warn.bind(w,`${s}:`),this.hls=e,this.fragmentLoader=new E1(e.config),this.keyLoader=r,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Dc(e.config),e.on(E.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=N.STOPPED}_streamEnded(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;const r=t.partList;if(r!=null&&r.length){const i=r[r.length-1];return le.isBuffered(this.media,i.start+i.duration/2)}const s=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(s)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var e;return(e=this.levelLastLoaded)==null?void 0:e.details}}onMediaAttached(e,t){const r=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),r.addEventListener("seeking",this.onvseeking),r.addEventListener("ended",this.onvended);const s=this.config;this.levels&&s.autoStartLoad&&this.state===N.STOPPED&&this.startLoad(s.startPosition)}onMediaDetaching(){const e=this.media;e!=null&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:e,fragCurrent:t,media:r,mediaBuffer:s,state:i}=this,o=r?r.currentTime:0,a=le.bufferInfo(s||r,o,e.maxBufferHole);if(this.log(`media seeking to ${G(o)?o.toFixed(3):o}, state: ${i}`),this.state===N.ENDED)this.resetLoadingState();else if(t){const l=e.maxFragLookUpTolerance,u=t.start-l,c=t.start+t.duration+l;if(!a.len||c<a.start||u>a.end){const d=o>c;(o<u||d)&&(d&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}r&&(this.fragmentTracker.removeFragmentsInRange(o,1/0,this.playlistType,!0),this.lastCurrentTime=o),!this.loadedmetadata&&!a.len&&(this.nextLoadPosition=this.startPosition=o),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.hls.off(E.MANIFEST_LOADED,this.onManifestLoaded,this),this.stopLoad(),super.onHandlerDestroying(),this.hls=null}onHandlerDestroyed(){this.state=N.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,r){this._loadFragForPlayback(e,t,r)}_loadFragForPlayback(e,t,r){const s=i=>{if(this.fragContextChanged(e)){this.warn(`Fragment ${e.sn}${i.part?" p: "+i.part.index:""} of level ${e.level} was dropped during download.`),this.fragmentTracker.removeFragment(e);return}e.stats.chunkCount++,this._handleFragmentLoadProgress(i)};this._doFragLoad(e,t,r,s).then(i=>{if(!i)return;const o=this.state;if(this.fragContextChanged(e)){(o===N.FRAG_LOADING||!this.fragCurrent&&o===N.PARSING)&&(this.fragmentTracker.removeFragment(e),this.state=N.IDLE);return}"payload"in i&&(this.log(`Loaded fragment ${e.sn} of level ${e.level}`),this.hls.trigger(E.FRAG_LOADED,i)),this._handleFragmentLoadComplete(i)}).catch(i=>{this.state===N.STOPPED||this.state===N.ERROR||(this.warn(`Frag error: ${(i==null?void 0:i.message)||i}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:r}=this;if(r.getState(e)===be.APPENDING){const i=e.type,o=this.getFwdBufferInfo(this.mediaBuffer,i),a=Math.max(e.duration,o?o.len:this.config.maxBufferLength),l=this.backtrackFragment;((l?e.sn-l.sn:0)===1||this.reduceMaxBufferLength(a))&&r.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),r.getState(e)===be.PARTIAL&&r.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}flushMainBuffer(e,t,r=null){if(!(e-t))return;const s={startOffset:e,endOffset:t,type:r};this.hls.trigger(E.BUFFER_FLUSHING,s)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(r=>{if(!r||this.fragContextChanged(e)||!this.levels)throw new Error("init load aborted");return r}).then(r=>{const{hls:s}=this,{payload:i}=r,o=e.decryptdata;if(i&&i.byteLength>0&&o!=null&&o.key&&o.iv&&o.method==="AES-128"){const a=self.performance.now();return this.decrypter.decrypt(new Uint8Array(i),o.key.buffer,o.iv.buffer).catch(l=>{throw s.trigger(E.ERROR,{type:q.MEDIA_ERROR,details:k.FRAG_DECRYPT_ERROR,fatal:!1,error:l,reason:l.message,frag:e}),l}).then(l=>{const u=self.performance.now();return s.trigger(E.FRAG_DECRYPTED,{frag:e,payload:l,stats:{tstart:a,tdecrypt:u}}),r.payload=l,this.completeInitSegmentLoad(r)})}return this.completeInitSegmentLoad(r)}).catch(r=>{this.state===N.STOPPED||this.state===N.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const r=e.frag.stats;this.state=N.IDLE,e.frag.data=new Uint8Array(e.payload),r.parsing.start=r.buffering.start=self.performance.now(),r.parsing.end=r.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){var r,s,i,o;const a=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.playlistType===W.MAIN?"level":"track"} ${e.level} (frag:[${((r=e.startPTS)!=null?r:NaN).toFixed(3)}-${((s=e.endPTS)!=null?s:NaN).toFixed(3)}] > buffer:${a?w1.toString(le.getBuffered(a)):"(detached)"})`),e.sn!=="initSegment"){var l;if(e.type!==W.SUBTITLE){const c=e.elementaryStreams;if(!Object.keys(c).some(d=>!!c[d])){this.state=N.IDLE;return}}const u=(l=this.levels)==null?void 0:l[e.level];u!=null&&u.fragmentError&&(this.log(`Resetting level fragment error count of ${u.fragmentError} on frag buffered`),u.fragmentError=0)}this.state=N.IDLE,a&&(!this.loadedmetadata&&e.type==W.MAIN&&a.buffered.length&&((i=this.fragCurrent)==null?void 0:i.sn)===((o=this.fragPrevious)==null?void 0:o.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:r,part:s,partsLoaded:i}=e,o=!i||i.length===0||i.some(l=>!l),a=new Ic(r.level,r.sn,r.stats.chunkCount+1,0,s?s.index:-1,!o);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,r=null,s){var i;const o=t==null?void 0:t.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let a=null;if(e.encrypted&&!((i=e.decryptdata)!=null&&i.key)?(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${this.logPrefix==="[stream-controller]"?"level":"track"} ${e.level}`),this.state=N.KEY_LOADING,this.fragCurrent=e,a=this.keyLoader.load(e).then(c=>{if(!this.fragContextChanged(c.frag))return this.hls.trigger(E.KEY_LOADED,c),this.state===N.KEY_LOADING&&(this.state=N.IDLE),c}),this.hls.trigger(E.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(a=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!e.encrypted&&o.encryptedFragments.length&&this.keyLoader.loadClear(e,o.encryptedFragments),r=Math.max(e.start,r||0),this.config.lowLatencyMode&&e.sn!=="initSegment"){const c=o.partList;if(c&&s){r>e.end&&o.fragmentHint&&(e=o.fragmentHint);const d=this.getNextPart(c,e,r);if(d>-1){const f=c[d];this.log(`Loading part sn: ${e.sn} p: ${f.index} cc: ${e.cc} of playlist [${o.startSN}-${o.endSN}] parts [0-${d}-${c.length-1}] ${this.logPrefix==="[stream-controller]"?"level":"track"}: ${e.level}, target: ${parseFloat(r.toFixed(3))}`),this.nextLoadPosition=f.start+f.duration,this.state=N.FRAG_LOADING;let m;return a?m=a.then(h=>!h||this.fragContextChanged(h.frag)?null:this.doFragPartsLoad(e,f,t,s)).catch(h=>this.handleFragLoadError(h)):m=this.doFragPartsLoad(e,f,t,s).catch(h=>this.handleFragLoadError(h)),this.hls.trigger(E.FRAG_LOADING,{frag:e,part:f,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):m}else if(!e.url||this.loadedEndOfParts(c,r))return Promise.resolve(null)}}this.log(`Loading fragment ${e.sn} cc: ${e.cc} ${o?"of ["+o.startSN+"-"+o.endSN+"] ":""}${this.logPrefix==="[stream-controller]"?"level":"track"}: ${e.level}, target: ${parseFloat(r.toFixed(3))}`),G(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=N.FRAG_LOADING;const l=this.config.progressive;let u;return l&&a?u=a.then(c=>!c||this.fragContextChanged(c==null?void 0:c.frag)?null:this.fragmentLoader.load(e,s)).catch(c=>this.handleFragLoadError(c)):u=Promise.all([this.fragmentLoader.load(e,l?s:void 0),a]).then(([c])=>(!l&&c&&s&&s(c),c)).catch(c=>this.handleFragLoadError(c)),this.hls.trigger(E.FRAG_LOADING,{frag:e,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):u}doFragPartsLoad(e,t,r,s){return new Promise((i,o)=>{var a;const l=[],u=(a=r.details)==null?void 0:a.partList,c=d=>{this.fragmentLoader.loadPart(e,d,s).then(f=>{l[d.index]=f;const m=f.part;this.hls.trigger(E.FRAG_LOADED,f);const h=$f(r,e.sn,d.index+1)||Pg(u,e.sn,d.index+1);if(h)c(h);else return i({frag:e,part:m,partsLoaded:l})}).catch(o)};c(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===k.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(E.ERROR,t)}else this.hls.trigger(E.ERROR,{type:q.OTHER_ERROR,details:k.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==N.PARSING){!this.fragCurrent&&this.state!==N.STOPPED&&this.state!==N.ERROR&&(this.state=N.IDLE);return}const{frag:r,part:s,level:i}=t,o=self.performance.now();r.stats.parsing.end=o,s&&(s.stats.parsing.end=o),this.updateLevelTiming(r,s,i,e.partial)}getCurrentContext(e){const{levels:t,fragCurrent:r}=this,{level:s,sn:i,part:o}=e;if(!(t!=null&&t[s]))return this.warn(`Levels object was unset while buffering fragment ${i} of level ${s}. The current chunk will not be buffered.`),null;const a=t[s],l=o>-1?$f(a,i,o):null,u=l?l.fragment:YT(a,i,r);return u?(r&&r!==u&&(u.stats=r.stats),{frag:u,part:l,level:a}):null}bufferFragmentData(e,t,r,s,i){var o;if(!e||this.state!==N.PARSING)return;const{data1:a,data2:l}=e;let u=a;if(a&&l&&(u=Et(a,l)),!((o=u)!=null&&o.length))return;const c={type:e.type,frag:t,part:r,chunkMeta:s,parent:t.type,data:u};if(this.hls.trigger(E.BUFFER_APPENDING,c),e.dropped&&e.independent&&!r){if(i)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!le.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const r=t.currentTime,s=le.bufferInfo(t,r,0),i=e.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,i*.25),a=Math.max(Math.min(e.start-o,s.end-o),r+o);e.start-a>o&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){const r=this.getLoadPosition();return G(r)?this.getFwdBufferInfoAtPos(e,r,t):null}getFwdBufferInfoAtPos(e,t,r){const{config:{maxBufferHole:s}}=this,i=le.bufferInfo(e,t,s);if(i.len===0&&i.nextStart!==void 0){const o=this.fragmentTracker.getBufferedFrag(t,r);if(o&&i.nextStart<o.end)return le.bufferInfo(e,t,Math.max(i.nextStart,s))}return i}getMaxBufferLength(e){const{config:t}=this;let r;return e?r=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):r=t.maxBufferLength,Math.min(r,t.maxMaxBufferLength)}reduceMaxBufferLength(e){const t=this.config,r=e||t.maxBufferLength,s=t.maxMaxBufferLength/2;return s>=r?(t.maxMaxBufferLength=s,this.warn(`Reduce max buffer length to ${s}s`),!0):!1}getAppendedFrag(e,t=W.MAIN){const r=this.fragmentTracker.getAppendedFrag(e,W.MAIN);return r&&"fragment"in r?r.fragment:r}getNextFragment(e,t){const r=t.fragments,s=r.length;if(!s)return null;const{config:i}=this,o=r[0].start;let a;if(t.live){const l=i.initialLiveManifestSize;if(s<l)return this.warn(`Not enough fragments to start playback (have: ${s}, need: ${l})`),null;(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<o)&&(a=this.getInitialLiveFragment(t,r),this.startPosition=this.nextLoadPosition=a?this.hls.liveSyncPosition||a.start:e)}else e<=o&&(a=r[0]);if(!a){const l=i.lowLatencyMode?t.partEnd:t.fragmentEnd;a=this.getFragmentAtPosition(e,l,t)}return this.mapToInitFragWhenRequired(a)}isLoopLoading(e,t){const r=this.fragmentTracker.getState(e);return(r===be.OK||r===be.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,r,s,i){const o=e.gap,a=this.getNextFragment(this.nextLoadPosition,t);if(a===null)return a;if(e=a,o&&e&&!e.gap&&r.nextStart){const l=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,s);if(l!==null&&r.len+l.len>=i)return this.log(`buffer full after gaps in "${s}" playlist starting at sn: ${e.sn}`),null}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!(e!=null&&e.initSegment.data)&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,r){let s=-1,i=!1,o=!0;for(let a=0,l=e.length;a<l;a++){const u=e[a];if(o=o&&!u.independent,s>-1&&r<u.start)break;const c=u.loaded;c?s=-1:(i||u.independent||o)&&u.fragment===t&&(s=a),i=c}return s}loadedEndOfParts(e,t){const r=e[e.length-1];return r&&t>r.start&&r.loaded}getInitialLiveFragment(e,t){const r=this.fragPrevious;let s=null;if(r){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${r.programDateTime}`),s=XT(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){const i=r.sn+1;if(i>=e.startSN&&i<=e.endSN){const o=t[i-e.startSN];r.cc===o.cc&&(s=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${s.sn}`))}s||(s=ZT(t,r.cc),s&&this.log(`Live playlist, switching playlist, load frag with same CC: ${s.sn}`))}}else{const i=this.hls.liveSyncPosition;i!==null&&(s=this.getFragmentAtPosition(i,this.bitrateTest?e.fragmentEnd:e.edge,e))}return s}getFragmentAtPosition(e,t,r){const{config:s}=this;let{fragPrevious:i}=this,{fragments:o,endSN:a}=r;const{fragmentHint:l}=r,{maxFragLookUpTolerance:u}=s,c=r.partList,d=!!(s.lowLatencyMode&&c!=null&&c.length&&l);d&&l&&!this.bitrateTest&&(o=o.concat(l),a=l.sn);let f;if(e<t){const m=e>t-u?0:u;f=Do(i,o,e,m)}else f=o[o.length-1];if(f){const m=f.sn-r.startSN,h=this.fragmentTracker.getState(f);if((h===be.OK||h===be.PARTIAL&&f.gap)&&(i=f),i&&f.sn===i.sn&&(!d||c[0].fragment.sn>f.sn)&&i&&f.level===i.level){const y=o[m+1];f.sn<a&&this.fragmentTracker.getState(y)!==be.OK?f=y:f=null}}return f}synchronizeToLiveEdge(e){const{config:t,media:r}=this;if(!r)return;const s=this.hls.liveSyncPosition,i=r.currentTime,o=e.fragments[0].start,a=e.edge,l=i>=o-t.maxFragLookUpTolerance&&i<=a;if(s!==null&&r.duration>s&&(i<s||!l)){const u=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!l&&r.readyState<4||i<a-u)&&(this.loadedmetadata||(this.nextLoadPosition=s),r.readyState&&(this.warn(`Playback: ${i.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${s.toFixed(3)}`),r.currentTime=s))}}alignPlaylists(e,t,r){const s=e.fragments.length;if(!s)return this.warn("No fragments in live playlist"),0;const i=e.fragments[0].start,o=!t,a=e.alignedSliding&&G(i);if(o||!a&&!i){const{fragPrevious:l}=this;v1(l,r,e);const u=e.fragments[0].start;return this.log(`Live playlist sliding: ${u.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} prev-sn: ${l?l.sn:"na"} fragments: ${s}`),u}return i}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let r=this.startPosition;if(r<t&&(r=-1),r===-1||this.lastCurrentTime===-1){const s=this.startTimeOffset!==null,i=s?this.startTimeOffset:e.startTimeOffset;i!==null&&G(i)?(r=t+i,i<0&&(r+=e.totalduration),r=Math.min(Math.max(t,r),t+e.totalduration),this.log(`Start time offset ${i} found in ${s?"multivariant":"media"} playlist, adjust startPosition to ${r}`),this.startPosition=r):e.live?r=this.hls.liveSyncPosition||t:this.startPosition=r=0,this.lastCurrentTime=r}this.nextLoadPosition=r}getLoadPosition(){const{media:e}=this;let t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t}handleFragLoadAborted(e,t){this.transmuxer&&e.sn!=="initSegment"&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==N.FRAG_LOADING_WAITING_RETRY)&&(this.state=N.IDLE)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const c=this.getCurrentContext(t.chunkMeta);c&&(t.frag=c.frag)}const r=t.frag;if(!r||r.type!==e||!this.levels)return;if(this.fragContextChanged(r)){var s;this.warn(`Frag load error must match current frag to retry ${r.url} > ${(s=this.fragCurrent)==null?void 0:s.url}`);return}const i=t.details===k.FRAG_GAP;i&&this.fragmentTracker.fragBuffered(r,!0);const o=t.errorAction,{action:a,retryCount:l=0,retryConfig:u}=o||{};if(o&&a===Fe.RetryRequest&&u){this.resetStartWhenNotLoaded(this.levelLastLoaded);const c=wc(u,l);this.warn(`Fragment ${r.sn} of ${e} ${r.level} errored with ${t.details}, retrying loading ${l+1}/${u.maxNumRetry} in ${c}ms`),o.resolved=!0,this.retryDate=self.performance.now()+c,this.state=N.FRAG_LOADING_WAITING_RETRY}else if(u&&o)if(this.resetFragmentErrors(e),l<u.maxNumRetry)!i&&a!==Fe.RemoveAlternatePermanently&&(o.resolved=!0);else{w.warn(`${t.details} reached or exceeded max retry (${l})`);return}else(o==null?void 0:o.action)===Fe.SendAlternateToPenaltyBox?this.state=N.WAITING_LEVEL:this.state=N.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===N.PARSING||this.state===N.PARSED){const t=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,t),s=r&&r.len>.5;s&&this.reduceMaxBufferLength(r.len);const i=!s;return i&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${t} buffer`),e.frag&&(this.fragmentTracker.removeFragment(e.frag),this.nextLoadPosition=e.frag.start),this.resetLoadingState(),i}return!1}resetFragmentErrors(e){e===W.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==N.STOPPED&&(this.state=N.IDLE)}afterBufferFlushed(e,t,r){if(!e)return;const s=le.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,s,r),this.state===N.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=N.IDLE}resetStartWhenNotLoaded(e){if(!this.loadedmetadata){this.startFragRequested=!1;const t=e?e.details:null;t!=null&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of level ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,r,s){var i;const o=r.details;if(!o){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,u)=>{const c=e.elementaryStreams[u];if(c){const d=c.endPTS-c.startPTS;if(d<=0)return this.warn(`Could not parse fragment ${e.sn} ${u} duration reliably (${d})`),l||!1;const f=s?0:bg(o,e,c.startPTS,c.endPTS,c.startDTS,c.endDTS);return this.hls.trigger(E.LEVEL_PTS_UPDATED,{details:o,level:r,drift:f,type:u,frag:e,start:c.startPTS,end:c.endPTS}),!0}return l},!1)&&((i=this.transmuxer)==null?void 0:i.error)===null){const l=new Error(`Found no media in fragment ${e.sn} of level ${e.level} resetting transmuxer to fallback to playlist timing`);if(r.fragmentError===0&&(r.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)),this.warn(l.message),this.hls.trigger(E.ERROR,{type:q.MEDIA_ERROR,details:k.FRAG_PARSING_ERROR,fatal:!1,error:l,frag:e,reason:`Found no media in msn ${e.sn} of level "${r.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=N.PARSED,this.hls.trigger(E.FRAG_PARSED,{frag:e,part:t})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}class Ug{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let r;if(e.length)e.length===1?r=e[0]:r=C1(e,t);else return new Uint8Array(0);return this.reset(),r}reset(){this.chunks.length=0,this.dataLength=0}}function C1(n,e){const t=new Uint8Array(e);let r=0;for(let s=0;s<n.length;s++){const i=n[s];t.set(i,r),r+=i.length}return t}function I1(){return typeof __HLS_WORKER_BUNDLE__=="function"}function D1(){const n=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),e=self.URL.createObjectURL(n);return{worker:new self.Worker(e),objectURL:e}}function k1(n){const e=new self.URL(n,self.location.href).href;return{worker:new self.Worker(e),scriptURL:e}}function Ut(n="",e=9e4){return{type:n,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class bc{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,r,s){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,r){}demux(e,t){this.cachedData&&(e=Et(this.cachedData,e),this.cachedData=null);let r=Bs(e,0),s=r?r.length:0,i;const o=this._audioTrack,a=this._id3Track,l=r?Ac(r):void 0,u=e.length;for((this.basePTS===null||this.frameIndex===0&&G(l))&&(this.basePTS=b1(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),r&&r.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:Ct.audioId3,duration:Number.POSITIVE_INFINITY});s<u;){if(this.canParse(e,s)){const c=this.appendFrame(o,e,s);c?(this.frameIndex++,this.lastPTS=c.sample.pts,s+=c.length,i=s):s=u}else ZS(e,s)?(r=Bs(e,s),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:Ct.audioId3,duration:Number.POSITIVE_INFINITY}),s+=r.length,i=s):s++;if(s===u&&i!==u){const c=zn(e,i);this.cachedData?this.cachedData=Et(this.cachedData,c):this.cachedData=c}}return{audioTrack:o,videoTrack:Ut(),id3Track:a,textTrack:Ut()}}demuxSampleAes(e,t,r){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Ut(),id3Track:this._id3Track,textTrack:Ut()}}destroy(){}}const b1=(n,e,t)=>{if(G(n))return n*90;const r=t?t.baseTime*9e4/t.timescale:0;return e*9e4+r};function _1(n,e,t,r){let s,i,o,a;const l=navigator.userAgent.toLowerCase(),u=r,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];s=((e[t+2]&192)>>>6)+1;const d=(e[t+2]&60)>>>2;if(d>c.length-1){const f=new Error(`invalid ADTS sampling index:${d}`);n.emit(E.ERROR,E.ERROR,{type:q.MEDIA_ERROR,details:k.FRAG_PARSING_ERROR,fatal:!0,error:f,reason:f.message});return}return o=(e[t+2]&1)<<2,o|=(e[t+3]&192)>>>6,w.log(`manifest codec:${r}, ADTS type:${s}, samplingIndex:${d}`),/firefox/i.test(l)?d>=6?(s=5,a=new Array(4),i=d-3):(s=2,a=new Array(2),i=d):l.indexOf("android")!==-1?(s=2,a=new Array(2),i=d):(s=5,a=new Array(4),r&&(r.indexOf("mp4a.40.29")!==-1||r.indexOf("mp4a.40.5")!==-1)||!r&&d>=6?i=d-3:((r&&r.indexOf("mp4a.40.2")!==-1&&(d>=6&&o===1||/vivaldi/i.test(l))||!r&&o===1)&&(s=2,a=new Array(2)),i=d)),a[0]=s<<3,a[0]|=(d&14)>>1,a[1]|=(d&1)<<7,a[1]|=o<<3,s===5&&(a[1]|=(i&14)>>1,a[2]=(i&1)<<7,a[2]|=8,a[3]=0),{config:a,samplerate:c[d],channelCount:o,codec:"mp4a.40."+s,manifestCodec:u}}function Bg(n,e){return n[e]===255&&(n[e+1]&246)===240}function $g(n,e){return n[e+1]&1?7:9}function _c(n,e){return(n[e+3]&3)<<11|n[e+4]<<3|(n[e+5]&224)>>>5}function P1(n,e){return e+5<n.length}function bo(n,e){return e+1<n.length&&Bg(n,e)}function N1(n,e){return P1(n,e)&&Bg(n,e)&&_c(n,e)<=n.length-e}function O1(n,e){if(bo(n,e)){const t=$g(n,e);if(e+t>=n.length)return!1;const r=_c(n,e);if(r<=t)return!1;const s=e+r;return s===n.length||bo(n,s)}return!1}function jg(n,e,t,r,s){if(!n.samplerate){const i=_1(e,t,r,s);if(!i)return;n.config=i.config,n.samplerate=i.samplerate,n.channelCount=i.channelCount,n.codec=i.codec,n.manifestCodec=i.manifestCodec,w.log(`parsed codec:${n.codec}, rate:${i.samplerate}, channels:${i.channelCount}`)}}function Gg(n){return 1024*9e4/n}function F1(n,e){const t=$g(n,e);if(e+t<=n.length){const r=_c(n,e)-t;if(r>0)return{headerLength:t,frameLength:r}}}function Hg(n,e,t,r,s){const i=Gg(n.samplerate),o=r+s*i,a=F1(e,t);let l;if(a){const{frameLength:d,headerLength:f}=a,m=f+d,h=Math.max(0,t+m-e.length);h?(l=new Uint8Array(m-f),l.set(e.subarray(t+f,e.length),0)):l=e.subarray(t+f,t+m);const p={unit:l,pts:o};return h||n.samples.push(p),{sample:p,length:m,missing:h}}const u=e.length-t;return l=new Uint8Array(u),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:o},length:u,missing:-1}}let xi=null;const M1=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],U1=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],B1=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],$1=[0,1,1,4];function Vg(n,e,t,r,s){if(t+24>e.length)return;const i=Kg(e,t);if(i&&t+i.frameLength<=e.length){const o=i.samplesPerFrame*9e4/i.sampleRate,a=r+s*o,l={unit:e.subarray(t,t+i.frameLength),pts:a,dts:a};return n.config=[],n.channelCount=i.channelCount,n.samplerate=i.sampleRate,n.samples.push(l),{sample:l,length:i.frameLength,missing:0}}}function Kg(n,e){const t=n[e+1]>>3&3,r=n[e+1]>>1&3,s=n[e+2]>>4&15,i=n[e+2]>>2&3;if(t!==1&&s!==0&&s!==15&&i!==3){const o=n[e+2]>>1&1,a=n[e+3]>>6,l=t===3?3-r:r===3?3:4,u=M1[l*14+s-1]*1e3,d=U1[(t===3?0:t===2?1:2)*3+i],f=a===3?1:2,m=B1[t][r],h=$1[r],p=m*8*h,y=Math.floor(m*u/d+o)*h;if(xi===null){const x=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);xi=x?parseInt(x[1]):0}return!!xi&&xi<=87&&r===2&&u>=224e3&&a===0&&(n[e+3]=n[e+3]|128),{sampleRate:d,channelCount:f,frameLength:y,samplesPerFrame:p}}}function Pc(n,e){return n[e]===255&&(n[e+1]&224)===224&&(n[e+1]&6)!==0}function zg(n,e){return e+1<n.length&&Pc(n,e)}function j1(n,e){return Pc(n,e)&&4<=n.length-e}function Wg(n,e){if(e+1<n.length&&Pc(n,e)){const r=Kg(n,e);let s=4;r!=null&&r.frameLength&&(s=r.frameLength);const i=e+s;return i===n.length||zg(n,i)}return!1}class G1 extends bc{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Bs(e,0);let r=(t==null?void 0:t.length)||0;if(Wg(e,r))return!1;for(let s=e.length;r<s;r++)if(O1(e,r))return w.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return N1(e,t)}appendFrame(e,t,r){jg(e,this.observer,t,r,e.manifestCodec);const s=Hg(e,t,r,this.basePTS,this.frameIndex);if(s&&s.missing===0)return s}}const H1=/\/emsg[-/]ID3/i;class V1{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,r,s){const i=this.videoTrack=Ut("video",1),o=this.audioTrack=Ut("audio",1),a=this.txtTrack=Ut("text",1);if(this.id3Track=Ut("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=Lg(e);if(l.video){const{id:u,timescale:c,codec:d}=l.video;i.id=u,i.timescale=a.timescale=c,i.codec=d}if(l.audio){const{id:u,timescale:c,codec:d}=l.audio;o.id=u,o.timescale=c,o.codec=d}a.id=Eg.text,i.sampleDuration=0,i.duration=o.duration=s}resetContiguity(){this.remainderData=null}static probe(e){return lT(e)}demux(e,t){this.timeOffset=t;let r=e;const s=this.videoTrack,i=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=Et(this.remainderData,e));const a=gT(r);this.remainderData=a.remainder,s.samples=a.valid||new Uint8Array}else s.samples=r;const o=this.extractID3Track(s,t);return i.samples=Sf(t,s),{videoTrack:s,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const s=this.extractID3Track(t,this.timeOffset);return r.samples=Sf(e,t),{videoTrack:t,audioTrack:Ut(),id3Track:s,textTrack:Ut()}}extractID3Track(e,t){const r=this.id3Track;if(e.samples.length){const s=J(e.samples,["emsg"]);s&&s.forEach(i=>{const o=xT(i);if(H1.test(o.schemeIdUri)){const a=G(o.presentationTime)?o.presentationTime/o.timeScale:t+o.presentationTimeDelta/o.timeScale;let l=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const u=o.payload;r.samples.push({data:u,len:u.byteLength,dts:a,pts:a,type:Ct.emsg,duration:l})}})}return r}demuxSampleAes(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}}const Yg=(n,e)=>{let t=0,r=5;e+=r;const s=new Uint32Array(1),i=new Uint32Array(1),o=new Uint8Array(1);for(;r>0;){o[0]=n[e];const a=Math.min(r,8),l=8-a;i[0]=4278190080>>>24+l<<l,s[0]=(o[0]&i[0])>>l,t=t?t<<a|s[0]:s[0],e+=1,r-=a}return t};class K1 extends bc{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,r){const s=qg(e,t,r,this.basePTS,this.frameIndex);if(s!==-1)return{sample:e.samples[e.samples.length-1],length:s,missing:0}}static probe(e){if(!e)return!1;const t=Bs(e,0);if(!t)return!1;const r=t.length;return e[r]===11&&e[r+1]===119&&Ac(t)!==void 0&&Yg(e,r)<16}}function qg(n,e,t,r,s){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const i=e[t+4]>>6;if(i>=3)return-1;const a=[48e3,44100,32e3][i],l=e[t+4]&63,c=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+i]*2;if(t+c>e.length)return-1;const d=e[t+6]>>5;let f=0;d===2?f+=2:(d&1&&d!==1&&(f+=2),d&4&&(f+=2));const m=(e[t+6]<<8|e[t+7])>>12-f&1,p=[2,1,2,3,3,4,4,5][d]+m,y=e[t+5]>>3,g=e[t+5]&7,v=new Uint8Array([i<<6|y<<1|g>>2,(g&3)<<6|d<<3|m<<2|l>>4,l<<4&224]),x=1536/a*9e4,L=r+s*x,T=e.subarray(t,t+c);return n.config=v,n.channelCount=p,n.samplerate=a,n.samples.push({unit:T,pts:L}),c}class z1{constructor(){this.VideoSample=null}createVideoSample(e,t,r,s){return{key:e,frame:!1,pts:t,dts:r,units:[],debug:s,length:0}}getLastNalUnit(e){var t;let r=this.VideoSample,s;if((!r||r.units.length===0)&&(r=e[e.length-1]),(t=r)!=null&&t.units){const i=r.units;s=i[i.length-1]}return s}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const r=t.samples,s=r.length;if(s){const i=r[s-1];e.pts=i.pts,e.dts=i.dts}else{t.dropped++;return}}t.samples.push(e)}e.debug.length&&w.log(e.pts+"/"+e.dts+":"+e.debug)}}class qf{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,r=e.byteLength-t,s=new Uint8Array(4),i=Math.min(4,t);if(i===0)throw new Error("no bytes available");s.set(e.subarray(r,r+i)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=i*8,this.bytesAvailable-=i}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const r=this.word>>>32-t;if(e>32&&w.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(e){let t=8,r=8,s;for(let i=0;i<e;i++)r!==0&&(s=this.readEG(),r=(t+s+256)%256),t=r===0?t:r}readSPS(){let e=0,t=0,r=0,s=0,i,o,a;const l=this.readUByte.bind(this),u=this.readBits.bind(this),c=this.readUEG.bind(this),d=this.readBoolean.bind(this),f=this.skipBits.bind(this),m=this.skipEG.bind(this),h=this.skipUEG.bind(this),p=this.skipScalingList.bind(this);l();const y=l();if(u(5),f(3),l(),h(),y===100||y===110||y===122||y===244||y===44||y===83||y===86||y===118||y===128){const A=c();if(A===3&&f(1),h(),h(),f(1),d())for(o=A!==3?8:12,a=0;a<o;a++)d()&&(a<6?p(16):p(64))}h();const g=c();if(g===0)c();else if(g===1)for(f(1),m(),m(),i=c(),a=0;a<i;a++)m();h(),f(1);const v=c(),x=c(),L=u(1);L===0&&f(1),f(1),d()&&(e=c(),t=c(),r=c(),s=c());let T=[1,1];if(d()&&d())switch(l()){case 1:T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:{T=[l()<<8|l(),l()<<8|l()];break}}return{width:Math.ceil((v+1)*16-e*2-t*2),height:(2-L)*(x+1)*16-(L?2:4)*(r+s),pixelRatio:T}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class W1 extends z1{parseAVCPES(e,t,r,s,i){const o=this.parseAVCNALu(e,r.data);let a=this.VideoSample,l,u=!1;r.data=null,a&&o.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts,"")),o.forEach(c=>{var d;switch(c.type){case 1:{let p=!1;l=!0;const y=c.data;if(u&&y.length>4){const g=new qf(y).readSliceType();(g===2||g===4||g===7||g===9)&&(p=!0)}if(p){var f;(f=a)!=null&&f.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts,"")),a.frame=!0,a.key=p;break}case 5:l=!0,(d=a)!=null&&d.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts,"")),a.key=!0,a.frame=!0;break;case 6:{l=!0,Ag(c.data,1,r.pts,t.samples);break}case 7:{var m,h;l=!0,u=!0;const p=c.data,g=new qf(p).readSPS();if(!e.sps||e.width!==g.width||e.height!==g.height||((m=e.pixelRatio)==null?void 0:m[0])!==g.pixelRatio[0]||((h=e.pixelRatio)==null?void 0:h[1])!==g.pixelRatio[1]){e.width=g.width,e.height=g.height,e.pixelRatio=g.pixelRatio,e.sps=[p],e.duration=i;const v=p.subarray(1,4);let x="avc1.";for(let L=0;L<3;L++){let T=v[L].toString(16);T.length<2&&(T="0"+T),x+=T}e.codec=x}break}case 8:l=!0,e.pps=[c.data];break;case 9:l=!0,e.audFound=!0,a&&this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts,"");break;case 12:l=!0;break;default:l=!1,a&&(a.debug+="unknown NAL "+c.type+" ");break}a&&l&&a.units.push(c)}),s&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}parseAVCNALu(e,t){const r=t.byteLength;let s=e.naluState||0;const i=s,o=[];let a=0,l,u,c,d=-1,f=0;for(s===-1&&(d=0,f=t[0]&31,s=0,a=1);a<r;){if(l=t[a++],!s){s=l?0:1;continue}if(s===1){s=l?0:2;continue}if(!l)s=3;else if(l===1){if(u=a-s-1,d>=0){const m={data:t.subarray(d,u),type:f};o.push(m)}else{const m=this.getLastNalUnit(e.samples);m&&(i&&a<=4-i&&m.state&&(m.data=m.data.subarray(0,m.data.byteLength-i)),u>0&&(m.data=Et(m.data,t.subarray(0,u)),m.state=0))}a<r?(c=t[a]&31,d=a,f=c,s=0):s=-1}else s=0}if(d>=0&&s>=0){const m={data:t.subarray(d,r),type:f,state:s};o.push(m)}if(o.length===0){const m=this.getLastNalUnit(e.samples);m&&(m.data=Et(m.data,t))}return e.naluState=s,o}}class Y1{constructor(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new Dc(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(e,t,r){const s=e[t].unit;if(s.length<=16)return;const i=s.subarray(16,s.length-s.length%16),o=i.buffer.slice(i.byteOffset,i.byteOffset+i.length);this.decryptBuffer(o).then(a=>{const l=new Uint8Array(a);s.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,r)})}decryptAacSamples(e,t,r){for(;;t++){if(t>=e.length){r();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,r),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,r=new Int8Array(t);let s=0;for(let i=32;i<e.length-16;i+=160,s+=16)r.set(e.subarray(i,i+16),s);return r}getAvcDecryptedUnit(e,t){const r=new Uint8Array(t);let s=0;for(let i=32;i<e.length-16;i+=160,s+=16)e.set(r.subarray(s,s+16),i);return e}decryptAvcSample(e,t,r,s,i){const o=wg(i.data),a=this.getAvcEncryptedData(o);this.decryptBuffer(a.buffer).then(l=>{i.data=this.getAvcDecryptedUnit(o,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,r+1,s)})}decryptAvcSamples(e,t,r,s){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length){s();return}const i=e[t].units;for(;!(r>=i.length);r++){const o=i[r];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(e,t,r,s,o),!this.decrypter.isSync()))return}}}}const De=188;class mn{constructor(e,t,r){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.videoParser=new W1}static probe(e){const t=mn.syncOffset(e);return t>0&&w.warn(`MPEG2-TS detected but first sync word found @ offset ${t}`),t!==-1}static syncOffset(e){const t=e.length;let r=Math.min(De*5,t-De)+1,s=0;for(;s<r;){let i=!1,o=-1,a=0;for(let l=s;l<t;l+=De)if(e[l]===71&&(t-l===De||e[l+De]===71)){if(a++,o===-1&&(o=l,o!==0&&(r=Math.min(o+De*99,e.length-De)+1)),i||(i=mu(e,l)===0),i&&a>1&&(o===0&&a>2||l+De>r))return o}else{if(a)return-1;break}s++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:Eg[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,r,s){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=mn.createTrack("video"),this._audioTrack=mn.createTrack("audio",s),this._id3Track=mn.createTrack("id3"),this._txtTrack=mn.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r,this._duration=s}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:r}=this;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,r=!1,s=!1){r||(this.sampleAes=null);let i;const o=this._videoTrack,a=this._audioTrack,l=this._id3Track,u=this._txtTrack;let c=o.pid,d=o.pesData,f=a.pid,m=l.pid,h=a.pesData,p=l.pesData,y=null,g=this.pmtParsed,v=this._pmtId,x=e.length;if(this.remainderData&&(e=Et(this.remainderData,e),x=e.length,this.remainderData=null),x<De&&!s)return this.remainderData=e,{audioTrack:a,videoTrack:o,id3Track:l,textTrack:u};const L=Math.max(0,mn.syncOffset(e));x-=(x-L)%De,x<e.byteLength&&!s&&(this.remainderData=new Uint8Array(e.buffer,x,e.buffer.byteLength-x));let T=0;for(let R=L;R<x;R+=De)if(e[R]===71){const I=!!(e[R+1]&64),M=mu(e,R),D=(e[R+3]&48)>>4;let F;if(D>1){if(F=R+5+e[R+4],F===R+De)continue}else F=R+4;switch(M){case c:I&&(d&&(i=ar(d))&&this.videoParser.parseAVCPES(o,u,i,!1,this._duration),d={data:[],size:0}),d&&(d.data.push(e.subarray(F,R+De)),d.size+=R+De-F);break;case f:if(I){if(h&&(i=ar(h)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,i);break;case"mp3":this.parseMPEGPES(a,i);break;case"ac3":this.parseAC3PES(a,i);break}h={data:[],size:0}}h&&(h.data.push(e.subarray(F,R+De)),h.size+=R+De-F);break;case m:I&&(p&&(i=ar(p))&&this.parseID3PES(l,i),p={data:[],size:0}),p&&(p.data.push(e.subarray(F,R+De)),p.size+=R+De-F);break;case 0:I&&(F+=e[F]+1),v=this._pmtId=q1(e,F);break;case v:{I&&(F+=e[F]+1);const Y=X1(e,F,this.typeSupported,r,this.observer);c=Y.videoPid,c>0&&(o.pid=c,o.segmentCodec=Y.segmentVideoCodec),f=Y.audioPid,f>0&&(a.pid=f,a.segmentCodec=Y.segmentAudioCodec),m=Y.id3Pid,m>0&&(l.pid=m),y!==null&&!g&&(w.warn(`MPEG-TS PMT found at ${R} after unknown PID '${y}'. Backtracking to sync byte @${L} to parse all TS packets.`),y=null,R=L-188),g=this.pmtParsed=!0;break}case 17:case 8191:break;default:y=M;break}}else T++;T>0&&_o(this.observer,new Error(`Found ${T} TS packet/s that do not start with 0x47`)),o.pesData=d,a.pesData=h,l.pesData=p;const A={audioTrack:a,videoTrack:o,id3Track:l,textTrack:u};return s&&this.extractRemainingSamples(A),A}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:r,id3Track:s,textTrack:i}=e,o=r.pesData,a=t.pesData,l=s.pesData;let u;if(o&&(u=ar(o))?(this.videoParser.parseAVCPES(r,i,u,!0,this._duration),r.pesData=null):r.pesData=o,a&&(u=ar(a))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,u);break;case"mp3":this.parseMPEGPES(t,u);break;case"ac3":this.parseAC3PES(t,u);break}t.pesData=null}else a!=null&&a.size&&w.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;l&&(u=ar(l))?(this.parseID3PES(s,u),s.pesData=null):s.pesData=l}demuxSampleAes(e,t,r){const s=this.demux(e,r,!0,!this.config.progressive),i=this.sampleAes=new Y1(this.observer,this.config,t);return this.decrypt(s,i)}decrypt(e,t){return new Promise(r=>{const{audioTrack:s,videoTrack:i}=e;s.samples&&s.segmentCodec==="aac"?t.decryptAacSamples(s.samples,0,()=>{i.samples?t.decryptAvcSamples(i.samples,0,0,()=>{r(e)}):r(e)}):i.samples&&t.decryptAvcSamples(i.samples,0,0,()=>{r(e)})})}destroy(){this._duration=0}parseAACPES(e,t){let r=0;const s=this.aacOverFlow;let i=t.data;if(s){this.aacOverFlow=null;const d=s.missing,f=s.sample.unit.byteLength;if(d===-1)i=Et(s.sample.unit,i);else{const m=f-d;s.sample.unit.set(i.subarray(0,d),m),e.samples.push(s.sample),r=s.missing}}let o,a;for(o=r,a=i.length;o<a-1&&!bo(i,o);o++);if(o!==r){let d;const f=o<a-1;if(f?d=`AAC PES did not start with ADTS header,offset:${o}`:d="No ADTS header found in AAC PES",_o(this.observer,new Error(d),f),!f)return}jg(e,this.observer,i,o,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(s){const d=Gg(e.samplerate);l=s.sample.pts+d}else{w.warn("[tsdemuxer]: AAC PES unknown PTS");return}let u=0,c;for(;o<a;)if(c=Hg(e,i,o,l,u),o+=c.length,c.missing){this.aacOverFlow=c;break}else for(u++;o<a-1&&!bo(i,o);o++);}parseMPEGPES(e,t){const r=t.data,s=r.length;let i=0,o=0;const a=t.pts;if(a===void 0){w.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<s;)if(zg(r,o)){const l=Vg(e,r,o,a,i);if(l)o+=l.length,i++;else break}else o++}parseAC3PES(e,t){{const r=t.data,s=t.pts;if(s===void 0){w.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const i=r.length;let o=0,a=0,l;for(;a<i&&(l=qg(e,r,a,s,o++))>0;)a+=l}}parseID3PES(e,t){if(t.pts===void 0){w.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const r=Ae({},t,{type:this._videoTrack?Ct.emsg:Ct.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}}function mu(n,e){return((n[e+1]&31)<<8)+n[e+2]}function q1(n,e){return(n[e+10]&31)<<8|n[e+11]}function X1(n,e,t,r,s){const i={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=(n[e+1]&15)<<8|n[e+2],a=e+3+o-4,l=(n[e+10]&15)<<8|n[e+11];for(e+=12+l;e<a;){const u=mu(n,e),c=(n[e+3]&15)<<8|n[e+4];switch(n[e]){case 207:if(!r){Ka("ADTS AAC");break}case 15:i.audioPid===-1&&(i.audioPid=u);break;case 21:i.id3Pid===-1&&(i.id3Pid=u);break;case 219:if(!r){Ka("H.264");break}case 27:i.videoPid===-1&&(i.videoPid=u,i.segmentVideoCodec="avc");break;case 3:case 4:!t.mpeg&&!t.mp3?w.log("MPEG audio found, not supported in this browser"):i.audioPid===-1&&(i.audioPid=u,i.segmentAudioCodec="mp3");break;case 193:if(!r){Ka("AC-3");break}case 129:t.ac3?i.audioPid===-1&&(i.audioPid=u,i.segmentAudioCodec="ac3"):w.log("AC-3 audio found, not supported in this browser");break;case 6:if(i.audioPid===-1&&c>0){let d=e+5,f=c;for(;f>2;){switch(n[d]){case 106:t.ac3!==!0?w.log("AC-3 audio found, not supported in this browser for now"):(i.audioPid=u,i.segmentAudioCodec="ac3");break}const h=n[d+1]+2;d+=h,f-=h}}break;case 194:case 135:return _o(s,new Error("Unsupported EC-3 in M2TS found")),i;case 36:return _o(s,new Error("Unsupported HEVC in M2TS found")),i}e+=c+5}return i}function _o(n,e,t){w.warn(`parsing error: ${e.message}`),n.emit(E.ERROR,E.ERROR,{type:q.MEDIA_ERROR,details:k.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Ka(n){w.log(`${n} with AES-128-CBC encryption found in unencrypted stream`)}function ar(n){let e=0,t,r,s,i,o;const a=n.data;if(!n||n.size===0)return null;for(;a[0].length<19&&a.length>1;)a[0]=Et(a[0],a[1]),a.splice(1,1);if(t=a[0],(t[0]<<16)+(t[1]<<8)+t[2]===1){if(r=(t[4]<<8)+t[5],r&&r>n.size-6)return null;const u=t[7];u&192&&(i=(t[9]&14)*536870912+(t[10]&255)*4194304+(t[11]&254)*16384+(t[12]&255)*128+(t[13]&254)/2,u&64?(o=(t[14]&14)*536870912+(t[15]&255)*4194304+(t[16]&254)*16384+(t[17]&255)*128+(t[18]&254)/2,i-o>60*9e4&&(w.warn(`${Math.round((i-o)/9e4)}s delta between PTS and DTS, align them`),i=o)):o=i),s=t[8];let c=s+9;if(n.size<=c)return null;n.size-=c;const d=new Uint8Array(n.size);for(let f=0,m=a.length;f<m;f++){t=a[f];let h=t.byteLength;if(c)if(c>h){c-=h;continue}else t=t.subarray(c),h-=c,c=0;d.set(t,e),e+=h}return r&&(r-=s+3),{data:d,pts:i,dts:o,len:r}}return null}class Q1 extends bc{resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Bs(e,0);let r=(t==null?void 0:t.length)||0;if(t&&e[r]===11&&e[r+1]===119&&Ac(t)!==void 0&&Yg(e,r)<=16)return!1;for(let s=e.length;r<s;r++)if(Wg(e,r))return w.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return j1(e,t)}appendFrame(e,t,r){if(this.basePTS!==null)return Vg(e,t,r,this.basePTS,this.frameIndex)}}class Xf{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const dn=Math.pow(2,32)-1;class C{static init(){C.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in C.types)C.types.hasOwnProperty(e)&&(C.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);C.HDLR_TYPES={video:t,audio:r};const s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);C.STTS=C.STSC=C.STCO=i,C.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),C.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),C.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),C.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);C.FTYP=C.box(C.types.ftyp,o,l,o,a),C.DINF=C.box(C.types.dinf,C.box(C.types.dref,s))}static box(e,...t){let r=8,s=t.length;const i=s;for(;s--;)r+=t[s].byteLength;const o=new Uint8Array(r);for(o[0]=r>>24&255,o[1]=r>>16&255,o[2]=r>>8&255,o[3]=r&255,o.set(e,4),s=0,r=8;s<i;s++)o.set(t[s],r),r+=t[s].byteLength;return o}static hdlr(e){return C.box(C.types.hdlr,C.HDLR_TYPES[e])}static mdat(e){return C.box(C.types.mdat,e)}static mdhd(e,t){t*=e;const r=Math.floor(t/(dn+1)),s=Math.floor(t%(dn+1));return C.box(C.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,s>>24,s>>16&255,s>>8&255,s&255,85,196,0,0]))}static mdia(e){return C.box(C.types.mdia,C.mdhd(e.timescale,e.duration),C.hdlr(e.type),C.minf(e))}static mfhd(e){return C.box(C.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?C.box(C.types.minf,C.box(C.types.smhd,C.SMHD),C.DINF,C.stbl(e)):C.box(C.types.minf,C.box(C.types.vmhd,C.VMHD),C.DINF,C.stbl(e))}static moof(e,t,r){return C.box(C.types.moof,C.mfhd(e),C.traf(r,t))}static moov(e){let t=e.length;const r=[];for(;t--;)r[t]=C.trak(e[t]);return C.box.apply(null,[C.types.moov,C.mvhd(e[0].timescale,e[0].duration)].concat(r).concat(C.mvex(e)))}static mvex(e){let t=e.length;const r=[];for(;t--;)r[t]=C.trex(e[t]);return C.box.apply(null,[C.types.mvex,...r])}static mvhd(e,t){t*=e;const r=Math.floor(t/(dn+1)),s=Math.floor(t%(dn+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,s>>24,s>>16&255,s>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return C.box(C.types.mvhd,i)}static sdtp(e){const t=e.samples||[],r=new Uint8Array(4+t.length);let s,i;for(s=0;s<t.length;s++)i=t[s].flags,r[s+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return C.box(C.types.sdtp,r)}static stbl(e){return C.box(C.types.stbl,C.stsd(e),C.box(C.types.stts,C.STTS),C.box(C.types.stsc,C.STSC),C.box(C.types.stsz,C.STSZ),C.box(C.types.stco,C.STCO))}static avc1(e){let t=[],r=[],s,i,o;for(s=0;s<e.sps.length;s++)i=e.sps[s],o=i.byteLength,t.push(o>>>8&255),t.push(o&255),t=t.concat(Array.prototype.slice.call(i));for(s=0;s<e.pps.length;s++)i=e.pps[s],o=i.byteLength,r.push(o>>>8&255),r.push(o&255),r=r.concat(Array.prototype.slice.call(i));const a=C.box(C.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(r))),l=e.width,u=e.height,c=e.pixelRatio[0],d=e.pixelRatio[1];return C.box(C.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,u>>8&255,u&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,C.box(C.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),C.box(C.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,c&255,d>>24,d>>16&255,d>>8&255,d&255])))}static esds(e){const t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}static audioStsd(e){const t=e.samplerate;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return C.box(C.types.mp4a,C.audioStsd(e),C.box(C.types.esds,C.esds(e)))}static mp3(e){return C.box(C.types[".mp3"],C.audioStsd(e))}static ac3(e){return C.box(C.types["ac-3"],C.audioStsd(e),C.box(C.types.dac3,e.config))}static stsd(e){return e.type==="audio"?e.segmentCodec==="mp3"&&e.codec==="mp3"?C.box(C.types.stsd,C.STSD,C.mp3(e)):e.segmentCodec==="ac3"?C.box(C.types.stsd,C.STSD,C.ac3(e)):C.box(C.types.stsd,C.STSD,C.mp4a(e)):C.box(C.types.stsd,C.STSD,C.avc1(e))}static tkhd(e){const t=e.id,r=e.duration*e.timescale,s=e.width,i=e.height,o=Math.floor(r/(dn+1)),a=Math.floor(r%(dn+1));return C.box(C.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,a>>24,a>>16&255,a>>8&255,a&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,s&255,0,0,i>>8&255,i&255,0,0]))}static traf(e,t){const r=C.sdtp(e),s=e.id,i=Math.floor(t/(dn+1)),o=Math.floor(t%(dn+1));return C.box(C.types.traf,C.box(C.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255])),C.box(C.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,o>>24,o>>16&255,o>>8&255,o&255])),C.trun(e,r.length+16+20+8+16+8+8),r)}static trak(e){return e.duration=e.duration||4294967295,C.box(C.types.trak,C.tkhd(e),C.mdia(e))}static trex(e){const t=e.id;return C.box(C.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const r=e.samples||[],s=r.length,i=12+16*s,o=new Uint8Array(i);let a,l,u,c,d,f;for(t+=8+i,o.set([e.type==="video"?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,s&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),a=0;a<s;a++)l=r[a],u=l.duration,c=l.size,d=l.flags,f=l.cts,o.set([u>>>24&255,u>>>16&255,u>>>8&255,u&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,d.degradPrio&61440,d.degradPrio&15,f>>>24&255,f>>>16&255,f>>>8&255,f&255],12+16*a);return C.box(C.types.trun,o)}static initSegment(e){C.types||C.init();const t=C.moov(e);return Et(C.FTYP,t)}}C.types=void 0;C.HDLR_TYPES=void 0;C.STTS=void 0;C.STSC=void 0;C.STCO=void 0;C.STSZ=void 0;C.VMHD=void 0;C.SMHD=void 0;C.STSD=void 0;C.FTYP=void 0;C.DINF=void 0;const Xg=9e4;function Nc(n,e,t=1,r=!1){const s=n*e*t;return r?Math.round(s):s}function J1(n,e,t=1,r=!1){return Nc(n,e,1/t,r)}function ss(n,e=!1){return Nc(n,1e3,1/Xg,e)}function Z1(n,e=1){return Nc(n,Xg,1/e)}const eL=10*1e3,Qf=1024,tL=1152,nL=1536;let lr=null,za=null;class Gi{constructor(e,t,r,s=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,lr===null){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);lr=o?parseInt(o[1]):0}if(za===null){const i=navigator.userAgent.match(/Safari\/(\d+)/i);za=i?parseInt(i[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){w.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){w.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){w.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const r=e.reduce((s,i)=>{const o=i.pts-s;return o<-4294967296?(t=!0,ft(s,i.pts)):o>0?s:i.pts},e[0].pts);return t&&w.debug("PTS rollover detected"),r}remux(e,t,r,s,i,o,a,l){let u,c,d,f,m,h,p=i,y=i;const g=e.pid>-1,v=t.pid>-1,x=t.samples.length,L=e.samples.length>0,T=a&&x>0||x>1;if((!g||L)&&(!v||T)||this.ISGenerated||a){if(this.ISGenerated){var R,I,M,D;const X=this.videoTrackConfig;X&&(t.width!==X.width||t.height!==X.height||((R=t.pixelRatio)==null?void 0:R[0])!==((I=X.pixelRatio)==null?void 0:I[0])||((M=t.pixelRatio)==null?void 0:M[1])!==((D=X.pixelRatio)==null?void 0:D[1]))&&this.resetInitSegment()}else d=this.generateIS(e,t,i,o);const F=this.isVideoContiguous;let Y=-1,$;if(T&&(Y=rL(t.samples),!F&&this.config.forceKeyFrameOnDiscontinuity))if(h=!0,Y>0){w.warn(`[mp4-remuxer]: Dropped ${Y} out of ${x} video samples due to a missing keyframe`);const X=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(Y),t.dropped+=Y,y+=(t.samples[0].pts-X)/t.inputTimeScale,$=y}else Y===-1&&(w.warn(`[mp4-remuxer]: No keyframe found out of ${x} video samples`),h=!1);if(this.ISGenerated){if(L&&T){const X=this.getVideoStartPts(t.samples),V=(ft(e.samples[0].pts,X)-X)/t.inputTimeScale;p+=Math.max(0,V),y+=Math.max(0,-V)}if(L){if(e.samplerate||(w.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),d=this.generateIS(e,t,i,o)),c=this.remuxAudio(e,p,this.isAudioContiguous,o,v||T||l===W.AUDIO?y:void 0),T){const X=c?c.endPTS-c.startPTS:0;t.inputTimeScale||(w.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),d=this.generateIS(e,t,i,o)),u=this.remuxVideo(t,y,F,X)}}else T&&(u=this.remuxVideo(t,y,F,0));u&&(u.firstKeyFrame=Y,u.independent=Y!==-1,u.firstKeyFramePTS=$)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(m=Qg(r,i,this._initPTS,this._initDTS)),s.samples.length&&(f=Jg(s,i,this._initPTS))),{audio:c,video:u,initSegment:d,independent:h,text:f,id3:m}}generateIS(e,t,r,s){const i=e.samples,o=t.samples,a=this.typeSupported,l={},u=this._initPTS;let c=!u||s,d="audio/mp4",f,m,h;if(c&&(f=m=1/0),e.config&&i.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":a.mpeg?(d="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:d,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&a.mpeg?new Uint8Array(0):C.initSegment([e]),metadata:{channelCount:e.channelCount}},c&&(h=e.inputTimeScale,!u||h!==u.timescale?f=m=i[0].pts-Math.round(h*r):c=!1)}if(t.sps&&t.pps&&o.length){if(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:C.initSegment([t]),metadata:{width:t.width,height:t.height}},c)if(h=t.inputTimeScale,!u||h!==u.timescale){const p=this.getVideoStartPts(o),y=Math.round(h*r);m=Math.min(m,ft(o[0].dts,p)-y),f=Math.min(f,p-y)}else c=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,c?(this._initPTS={baseTime:f,timescale:h},this._initDTS={baseTime:m,timescale:h}):f=h=void 0,{tracks:l,initPTS:f,timescale:h}}remuxVideo(e,t,r,s){const i=e.inputTimeScale,o=e.samples,a=[],l=o.length,u=this._initPTS;let c=this.nextAvcDts,d=8,f=this.videoSampleDuration,m,h,p=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,g=!1;if(!r||c===null){const O=t*i,P=o[0].pts-ft(o[0].dts,o[0].pts);lr&&c!==null&&Math.abs(O-P-c)<15e3?r=!0:c=O-P}const v=u.baseTime*i/u.timescale;for(let O=0;O<l;O++){const P=o[O];P.pts=ft(P.pts-v,c),P.dts=ft(P.dts-v,c),P.dts<o[O>0?O-1:O].dts&&(g=!0)}g&&o.sort(function(O,P){const K=O.dts-P.dts,H=O.pts-P.pts;return K||H}),m=o[0].dts,h=o[o.length-1].dts;const x=h-m,L=x?Math.round(x/(l-1)):f||e.inputTimeScale/30;if(r){const O=m-c,P=O>L,K=O<-1;if((P||K)&&(P?w.warn(`AVC: ${ss(O,!0)} ms (${O}dts) hole between fragments detected at ${t.toFixed(3)}`):w.warn(`AVC: ${ss(-O,!0)} ms (${O}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!K||c>=o[0].pts||lr)){m=c;const H=o[0].pts-O;if(P)o[0].dts=m,o[0].pts=H;else for(let ne=0;ne<o.length&&!(o[ne].dts>H);ne++)o[ne].dts-=O,o[ne].pts-=O;w.log(`Video: Initial PTS/DTS adjusted: ${ss(H,!0)}/${ss(m,!0)}, delta: ${ss(O,!0)} ms`)}}m=Math.max(0,m);let T=0,A=0,R=m;for(let O=0;O<l;O++){const P=o[O],K=P.units,H=K.length;let ne=0;for(let ae=0;ae<H;ae++)ne+=K[ae].data.length;A+=ne,T+=H,P.length=ne,P.dts<R?(P.dts=R,R+=L/4|0||1):R=P.dts,p=Math.min(P.pts,p),y=Math.max(P.pts,y)}h=o[l-1].dts;const I=A+4*T+8;let M;try{M=new Uint8Array(I)}catch(O){this.observer.emit(E.ERROR,E.ERROR,{type:q.MUX_ERROR,details:k.REMUX_ALLOC_ERROR,fatal:!1,error:O,bytes:I,reason:`fail allocating video mdat ${I}`});return}const D=new DataView(M.buffer);D.setUint32(0,I),M.set(C.types.mdat,4);let F=!1,Y=Number.POSITIVE_INFINITY,$=Number.POSITIVE_INFINITY,X=Number.NEGATIVE_INFINITY,Q=Number.NEGATIVE_INFINITY;for(let O=0;O<l;O++){const P=o[O],K=P.units;let H=0;for(let xe=0,ce=K.length;xe<ce;xe++){const Ne=K[xe],Yr=Ne.data,ra=Ne.data.byteLength;D.setUint32(d,ra),d+=4,M.set(Yr,d),d+=ra,H+=4+ra}let ne;if(O<l-1)f=o[O+1].dts-P.dts,ne=o[O+1].pts-P.pts;else{const xe=this.config,ce=O>0?P.dts-o[O-1].dts:L;if(ne=O>0?P.pts-o[O-1].pts:L,xe.stretchShortVideoTrack&&this.nextAudioPts!==null){const Ne=Math.floor(xe.maxBufferHole*i),Yr=(s?p+s*i:this.nextAudioPts)-P.pts;Yr>Ne?(f=Yr-ce,f<0?f=ce:F=!0,w.log(`[mp4-remuxer]: It is approximately ${Yr/90} ms to the next segment; using duration ${f/90} ms for the last video frame.`)):f=ce}else f=ce}const ae=Math.round(P.pts-P.dts);Y=Math.min(Y,f),X=Math.max(X,f),$=Math.min($,ne),Q=Math.max(Q,ne),a.push(new Jf(P.key,f,H,ae))}if(a.length){if(lr){if(lr<70){const O=a[0].flags;O.dependsOn=2,O.isNonSync=0}}else if(za&&Q-$<X-Y&&L/X<.025&&a[0].cts===0){w.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let O=m;for(let P=0,K=a.length;P<K;P++){const H=O+a[P].duration,ne=O+a[P].cts;if(P<K-1){const ae=H+a[P+1].cts;a[P].duration=ae-ne}else a[P].duration=P?a[P-1].duration:L;a[P].cts=0,O=H}}}f=F||!f?L:f,this.nextAvcDts=c=h+f,this.videoSampleDuration=f,this.isVideoContiguous=!0;const U={data1:C.moof(e.sequenceNumber++,m,Ae({},e,{samples:a})),data2:M,startPTS:p/i,endPTS:(y+f)/i,startDTS:m/i,endDTS:c/i,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,U}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return tL;case"ac3":return nL;default:return Qf}}remuxAudio(e,t,r,s,i){const o=e.inputTimeScale,a=e.samplerate?e.samplerate:o,l=o/a,u=this.getSamplesPerFrame(e),c=u*l,d=this._initPTS,f=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,m=[],h=i!==void 0;let p=e.samples,y=f?0:8,g=this.nextAudioPts||-1;const v=t*o,x=d.baseTime*o/d.timescale;if(this.isAudioContiguous=r=r||p.length&&g>0&&(s&&Math.abs(v-g)<9e3||Math.abs(ft(p[0].pts-x,v)-g)<20*c),p.forEach(function(V){V.pts=ft(V.pts-x,v)}),!r||g<0){if(p=p.filter(V=>V.pts>=0),!p.length)return;i===0?g=0:s&&!h?g=Math.max(0,v):g=p[0].pts}if(e.segmentCodec==="aac"){const V=this.config.maxAudioFramesDrift;for(let te=0,U=g;te<p.length;te++){const O=p[te],P=O.pts,K=P-U,H=Math.abs(1e3*K/o);if(K<=-V*c&&h)te===0&&(w.warn(`Audio frame @ ${(P/o).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*K/o)} ms.`),this.nextAudioPts=g=U=P);else if(K>=V*c&&H<eL&&h){let ne=Math.round(K/c);U=P-ne*c,U<0&&(ne--,U+=c),te===0&&(this.nextAudioPts=g=U),w.warn(`[mp4-remuxer]: Injecting ${ne} audio frame @ ${(U/o).toFixed(3)}s due to ${Math.round(1e3*K/o)} ms gap.`);for(let ae=0;ae<ne;ae++){const xe=Math.max(U,0);let ce=Xf.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);ce||(w.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),ce=O.unit.subarray()),p.splice(te,0,{unit:ce,pts:xe}),U+=c,te++}}O.pts=U,U+=c}}let L=null,T=null,A,R=0,I=p.length;for(;I--;)R+=p[I].unit.byteLength;for(let V=0,te=p.length;V<te;V++){const U=p[V],O=U.unit;let P=U.pts;if(T!==null){const H=m[V-1];H.duration=Math.round((P-T)/l)}else if(r&&e.segmentCodec==="aac"&&(P=g),L=P,R>0){R+=y;try{A=new Uint8Array(R)}catch(H){this.observer.emit(E.ERROR,E.ERROR,{type:q.MUX_ERROR,details:k.REMUX_ALLOC_ERROR,fatal:!1,error:H,bytes:R,reason:`fail allocating audio mdat ${R}`});return}f||(new DataView(A.buffer).setUint32(0,R),A.set(C.types.mdat,4))}else return;A.set(O,y);const K=O.byteLength;y+=K,m.push(new Jf(!0,u,K,0)),T=P}const M=m.length;if(!M)return;const D=m[m.length-1];this.nextAudioPts=g=T+l*D.duration;const F=f?new Uint8Array(0):C.moof(e.sequenceNumber++,L/l,Ae({},e,{samples:m}));e.samples=[];const Y=L/o,$=g/o,Q={data1:F,data2:A,startPTS:Y,endPTS:$,startDTS:Y,endDTS:$,type:"audio",hasAudio:!0,hasVideo:!1,nb:M};return this.isAudioContiguous=!0,Q}remuxEmptyAudio(e,t,r,s){const i=e.inputTimeScale,o=e.samplerate?e.samplerate:i,a=i/o,l=this.nextAudioPts,u=this._initDTS,c=u.baseTime*9e4/u.timescale,d=(l!==null?l:s.startDTS*i)+c,f=s.endDTS*i+c,m=a*Qf,h=Math.ceil((f-d)/m),p=Xf.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(w.warn("[mp4-remuxer]: remux empty Audio"),!p){w.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}const y=[];for(let g=0;g<h;g++){const v=d+g*m;y.push({unit:p,pts:v,dts:v})}return e.samples=y,this.remuxAudio(e,t,r,!1)}}function ft(n,e){let t;if(e===null)return n;for(e<n?t=-8589934592:t=8589934592;Math.abs(n-e)>4294967296;)n+=t;return n}function rL(n){for(let e=0;e<n.length;e++)if(n[e].key)return e;return-1}function Qg(n,e,t,r){const s=n.samples.length;if(!s)return;const i=n.inputTimeScale;for(let a=0;a<s;a++){const l=n.samples[a];l.pts=ft(l.pts-t.baseTime*i/t.timescale,e*i)/i,l.dts=ft(l.dts-r.baseTime*i/r.timescale,e*i)/i}const o=n.samples;return n.samples=[],{samples:o}}function Jg(n,e,t){const r=n.samples.length;if(!r)return;const s=n.inputTimeScale;for(let o=0;o<r;o++){const a=n.samples[o];a.pts=ft(a.pts-t.baseTime*s/t.timescale,e*s)/s}n.samples.sort((o,a)=>o.pts-a.pts);const i=n.samples;return n.samples=[],{samples:i}}class Jf{constructor(e,t,r,s){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=r,this.cts=s,this.flags={isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:e?2:1,isNonSync:e?0:1}}}class sL{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,r,s){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(dT(e,s)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:r}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const s=this.initData=Lg(e);s.audio&&(t=Zf(s.audio,ie.AUDIO)),s.video&&(r=Zf(s.video,ie.VIDEO));const i={};s.audio&&s.video?i.audiovideo={container:"video/mp4",codec:t+","+r,initSegment:e,id:"main"}:s.audio?i.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:s.video?i.video={container:"video/mp4",codec:r,initSegment:e,id:"main"}:w.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=i}remux(e,t,r,s,i,o){var a,l;let{initPTS:u,lastEndTime:c}=this;const d={audio:void 0,video:void 0,text:s,id3:r,initSegment:void 0};G(c)||(c=this.lastEndTime=i||0);const f=t.samples;if(!(f!=null&&f.length))return d;const m={initPTS:void 0,timescale:1};let h=this.initData;if((a=h)!=null&&a.length||(this.generateInitSegment(f),h=this.initData),!((l=h)!=null&&l.length))return w.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),d;this.emitInitSegment&&(m.tracks=this.initTracks,this.emitInitSegment=!1);const p=hT(f,h),y=fT(h,f),g=y===null?i:y;(iL(u,g,i,p)||m.timescale!==u.timescale&&o)&&(m.initPTS=g-i,u&&u.timescale===1&&w.warn(`Adjusting initPTS by ${m.initPTS-u.baseTime}`),this.initPTS=u={baseTime:m.initPTS,timescale:1});const v=e?g-u.baseTime/u.timescale:c,x=v+p;pT(h,f,u.baseTime/u.timescale),p>0?this.lastEndTime=x:(w.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const L=!!h.audio,T=!!h.video;let A="";L&&(A+="audio"),T&&(A+="video");const R={data1:f,startPTS:v,startDTS:v,endPTS:x,endDTS:x,type:A,hasAudio:L,hasVideo:T,nb:1,dropped:0};return d.audio=R.type==="audio"?R:void 0,d.video=R.type!=="audio"?R:void 0,d.initSegment=m,d.id3=Qg(r,i,u,u),s.samples.length&&(d.text=Jg(s,i,u)),d}}function iL(n,e,t,r){if(n===null)return!0;const s=Math.max(r,1),i=e-n.baseTime/n.timescale;return Math.abs(i-t)>s}function Zf(n,e){const t=n==null?void 0:n.codec;if(t&&t.length>4)return t;if(e===ie.AUDIO){if(t==="ec-3"||t==="ac-3"||t==="alac")return t;if(t==="fLaC"||t==="Opus")return Ao(t,!1);const r="mp4a.40.5";return w.info(`Parsed audio codec "${t}" or audio object type not handled. Using "${r}"`),r}return w.warn(`Unhandled video codec "${t}"`),t==="hvc1"||t==="hev1"?"hvc1.1.6.L120.90":t==="av01"?"av01.0.04M.08":"avc1.42e01e"}let Jt;try{Jt=self.performance.now.bind(self.performance)}catch{w.debug("Unable to use Performance API on this environment"),Jt=Mr==null?void 0:Mr.Date.now}const Hi=[{demux:V1,remux:sL},{demux:mn,remux:Gi},{demux:G1,remux:Gi},{demux:Q1,remux:Gi}];Hi.splice(2,0,{demux:K1,remux:Gi});class eh{constructor(e,t,r,s,i){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.vendor=s,this.id=i}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,r,s){const i=r.transmuxing;i.executeStart=Jt();let o=new Uint8Array(e);const{currentTransmuxState:a,transmuxConfig:l}=this;s&&(this.currentTransmuxState=s);const{contiguous:u,discontinuity:c,trackSwitch:d,accurateTimeOffset:f,timeOffset:m,initSegmentChange:h}=s||a,{audioCodec:p,videoCodec:y,defaultInitPts:g,duration:v,initSegmentData:x}=l,L=oL(o,t);if(L&&L.method==="AES-128"){const I=this.getDecrypter();if(I.isSync()){let M=I.softwareDecrypt(o,L.key.buffer,L.iv.buffer);if(r.part>-1&&(M=I.flush()),!M)return i.executeEnd=Jt(),Wa(r);o=new Uint8Array(M)}else return this.decryptionPromise=I.webCryptoDecrypt(o,L.key.buffer,L.iv.buffer).then(M=>{const D=this.push(M,null,r);return this.decryptionPromise=null,D}),this.decryptionPromise}const T=this.needsProbing(c,d);if(T){const I=this.configureTransmuxer(o);if(I)return w.warn(`[transmuxer] ${I.message}`),this.observer.emit(E.ERROR,E.ERROR,{type:q.MEDIA_ERROR,details:k.FRAG_PARSING_ERROR,fatal:!1,error:I,reason:I.message}),i.executeEnd=Jt(),Wa(r)}(c||d||h||T)&&this.resetInitSegment(x,p,y,v,t),(c||h||T)&&this.resetInitialTimestamp(g),u||this.resetContiguity();const A=this.transmux(o,L,m,f,r),R=this.currentTransmuxState;return R.contiguous=!0,R.discontinuity=!1,R.trackSwitch=!1,i.executeEnd=Jt(),A}flush(e){const t=e.transmuxing;t.executeStart=Jt();const{decrypter:r,currentTransmuxState:s,decryptionPromise:i}=this;if(i)return i.then(()=>this.flush(e));const o=[],{timeOffset:a}=s;if(r){const d=r.flush();d&&o.push(this.push(d,null,e))}const{demuxer:l,remuxer:u}=this;if(!l||!u)return t.executeEnd=Jt(),[Wa(e)];const c=l.flush(a);return Vi(c)?c.then(d=>(this.flushRemux(o,d,e),o)):(this.flushRemux(o,c,e),o)}flushRemux(e,t,r){const{audioTrack:s,videoTrack:i,id3Track:o,textTrack:a}=t,{accurateTimeOffset:l,timeOffset:u}=this.currentTransmuxState;w.log(`[transmuxer.ts]: Flushed fragment ${r.sn}${r.part>-1?" p: "+r.part:""} of level ${r.level}`);const c=this.remuxer.remux(s,i,o,a,u,l,!0,this.id);e.push({remuxResult:c,chunkMeta:r}),r.transmuxing.executeEnd=Jt()}resetInitialTimestamp(e){const{demuxer:t,remuxer:r}=this;!t||!r||(t.resetTimeStamp(e),r.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,r,s,i){const{demuxer:o,remuxer:a}=this;!o||!a||(o.resetInitSegment(e,t,r,s),a.resetInitSegment(e,t,r,i))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,r,s,i){let o;return t&&t.method==="SAMPLE-AES"?o=this.transmuxSampleAes(e,t,r,s,i):o=this.transmuxUnencrypted(e,r,s,i),o}transmuxUnencrypted(e,t,r,s){const{audioTrack:i,videoTrack:o,id3Track:a,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(i,o,a,l,t,r,!1,this.id),chunkMeta:s}}transmuxSampleAes(e,t,r,s,i){return this.demuxer.demuxSampleAes(e,t,r).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,r,s,!1,this.id),chunkMeta:i}))}configureTransmuxer(e){const{config:t,observer:r,typeSupported:s,vendor:i}=this;let o;for(let f=0,m=Hi.length;f<m;f++){var a;if((a=Hi[f].demux)!=null&&a.probe(e)){o=Hi[f];break}}if(!o)return new Error("Failed to find demuxer by probing fragment data");const l=this.demuxer,u=this.remuxer,c=o.remux,d=o.demux;(!u||!(u instanceof c))&&(this.remuxer=new c(r,t,s,i)),(!l||!(l instanceof d))&&(this.demuxer=new d(r,t,s),this.probe=d.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Dc(this.config)),e}}function oL(n,e){let t=null;return n.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Wa=n=>({remuxResult:{},chunkMeta:n});function Vi(n){return"then"in n&&n.then instanceof Function}class aL{constructor(e,t,r,s,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=s,this.defaultInitPts=i||null}}class lL{constructor(e,t,r,s,i,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=s,this.timeOffset=i,this.initSegmentChange=o}}var Zg={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function s(l,u,c){this.fn=l,this.context=u,this.once=c||!1}function i(l,u,c,d,f){if(typeof c!="function")throw new TypeError("The listener must be a function");var m=new s(c,d||l,f),h=t?t+u:u;return l._events[h]?l._events[h].fn?l._events[h]=[l._events[h],m]:l._events[h].push(m):(l._events[h]=m,l._eventsCount++),l}function o(l,u){--l._eventsCount===0?l._events=new r:delete l._events[u]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var u=[],c,d;if(this._eventsCount===0)return u;for(d in c=this._events)e.call(c,d)&&u.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},a.prototype.listeners=function(u){var c=t?t+u:u,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var f=0,m=d.length,h=new Array(m);f<m;f++)h[f]=d[f].fn;return h},a.prototype.listenerCount=function(u){var c=t?t+u:u,d=this._events[c];return d?d.fn?1:d.length:0},a.prototype.emit=function(u,c,d,f,m,h){var p=t?t+u:u;if(!this._events[p])return!1;var y=this._events[p],g=arguments.length,v,x;if(y.fn){switch(y.once&&this.removeListener(u,y.fn,void 0,!0),g){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,c),!0;case 3:return y.fn.call(y.context,c,d),!0;case 4:return y.fn.call(y.context,c,d,f),!0;case 5:return y.fn.call(y.context,c,d,f,m),!0;case 6:return y.fn.call(y.context,c,d,f,m,h),!0}for(x=1,v=new Array(g-1);x<g;x++)v[x-1]=arguments[x];y.fn.apply(y.context,v)}else{var L=y.length,T;for(x=0;x<L;x++)switch(y[x].once&&this.removeListener(u,y[x].fn,void 0,!0),g){case 1:y[x].fn.call(y[x].context);break;case 2:y[x].fn.call(y[x].context,c);break;case 3:y[x].fn.call(y[x].context,c,d);break;case 4:y[x].fn.call(y[x].context,c,d,f);break;default:if(!v)for(T=1,v=new Array(g-1);T<g;T++)v[T-1]=arguments[T];y[x].fn.apply(y[x].context,v)}}return!0},a.prototype.on=function(u,c,d){return i(this,u,c,d,!1)},a.prototype.once=function(u,c,d){return i(this,u,c,d,!0)},a.prototype.removeListener=function(u,c,d,f){var m=t?t+u:u;if(!this._events[m])return this;if(!c)return o(this,m),this;var h=this._events[m];if(h.fn)h.fn===c&&(!f||h.once)&&(!d||h.context===d)&&o(this,m);else{for(var p=0,y=[],g=h.length;p<g;p++)(h[p].fn!==c||f&&!h[p].once||d&&h[p].context!==d)&&y.push(h[p]);y.length?this._events[m]=y.length===1?y[0]:y:o(this,m)}return this},a.prototype.removeAllListeners=function(u){var c;return u?(c=t?t+u:u,this._events[c]&&o(this,c)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a})(Zg);var uL=Zg.exports,Oc=_S(uL);class e0{constructor(e,t,r,s){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const i=e.config;this.hls=e,this.id=t,this.useWorker=!!i.enableWorker,this.onTransmuxComplete=r,this.onFlush=s;const o=(u,c)=>{c=c||{},c.frag=this.frag,c.id=this.id,u===E.ERROR&&(this.error=c.error),this.hls.trigger(u,c)};this.observer=new Oc,this.observer.on(E.FRAG_DECRYPTED,o),this.observer.on(E.ERROR,o);const a=Zn(i.preferManagedMediaSource)||{isTypeSupported:()=>!1},l={mpeg:a.isTypeSupported("audio/mpeg"),mp3:a.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:a.isTypeSupported('audio/mp4; codecs="ac-3"')};if(this.useWorker&&typeof Worker<"u"&&(i.workerPath||I1())){try{i.workerPath?(w.log(`loading Web Worker ${i.workerPath} for "${t}"`),this.workerContext=k1(i.workerPath)):(w.log(`injecting Web Worker for "${t}"`),this.workerContext=D1()),this.onwmsg=d=>this.onWorkerMessage(d);const{worker:c}=this.workerContext;c.addEventListener("message",this.onwmsg),c.onerror=d=>{const f=new Error(`${d.message}  (${d.filename}:${d.lineno})`);i.enableWorker=!1,w.warn(`Error in "${t}" Web Worker, fallback to inline`),this.hls.trigger(E.ERROR,{type:q.OTHER_ERROR,details:k.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:f})},c.postMessage({cmd:"init",typeSupported:l,vendor:"",id:t,config:JSON.stringify(i)})}catch(c){w.warn(`Error setting up "${t}" Web Worker, fallback to inline`,c),this.resetWorker(),this.error=null,this.transmuxer=new eh(this.observer,l,i,"",t)}return}this.transmuxer=new eh(this.observer,l,i,"",t)}resetWorker(){if(this.workerContext){const{worker:e,objectURL:t}=this.workerContext;t&&self.URL.revokeObjectURL(t),e.removeEventListener("message",this.onwmsg),e.onerror=null,e.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(e,t,r,s,i,o,a,l,u,c){var d,f;u.transmuxing.start=self.performance.now();const{transmuxer:m}=this,h=o?o.start:i.start,p=i.decryptdata,y=this.frag,g=!(y&&i.cc===y.cc),v=!(y&&u.level===y.level),x=y?u.sn-y.sn:-1,L=this.part?u.part-this.part.index:-1,T=x===0&&u.id>1&&u.id===(y==null?void 0:y.stats.chunkCount),A=!v&&(x===1||x===0&&(L===1||T&&L<=0)),R=self.performance.now();(v||x||i.stats.parsing.start===0)&&(i.stats.parsing.start=R),o&&(L||!A)&&(o.stats.parsing.start=R);const I=!(y&&((d=i.initSegment)==null?void 0:d.url)===((f=y.initSegment)==null?void 0:f.url)),M=new lL(g,A,l,v,h,I);if(!A||g||I){w.log(`[transmuxer-interface, ${i.type}]: Starting new transmux session for sn: ${u.sn} p: ${u.part} level: ${u.level} id: ${u.id}
        discontinuity: ${g}
        trackSwitch: ${v}
        contiguous: ${A}
        accurateTimeOffset: ${l}
        timeOffset: ${h}
        initSegmentChange: ${I}`);const D=new aL(r,s,t,a,c);this.configureTransmuxer(D)}if(this.frag=i,this.part=o,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:p,chunkMeta:u,state:M},e instanceof ArrayBuffer?[e]:[]);else if(m){const D=m.push(e,p,u,M);Vi(D)?(m.async=!0,D.then(F=>{this.handleTransmuxComplete(F)}).catch(F=>{this.transmuxerError(F,u,"transmuxer-interface push error")})):(m.async=!1,this.handleTransmuxComplete(D))}}flush(e){e.transmuxing.start=self.performance.now();const{transmuxer:t}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(t){let r=t.flush(e);Vi(r)||t.async?(Vi(r)||(r=Promise.resolve(r)),r.then(i=>{this.handleFlushResult(i,e)}).catch(i=>{this.transmuxerError(i,e,"transmuxer-interface flush error")})):this.handleFlushResult(r,e)}}transmuxerError(e,t,r){this.hls&&(this.error=e,this.hls.trigger(E.ERROR,{type:q.MEDIA_ERROR,details:k.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,fatal:!1,error:e,err:e,reason:r}))}handleFlushResult(e,t){e.forEach(r=>{this.handleTransmuxComplete(r)}),this.onFlush(t)}onWorkerMessage(e){const t=e.data;if(!(t!=null&&t.event)){w.warn(`worker message received with no ${t?"event name":"data"}`);return}const r=this.hls;if(this.hls)switch(t.event){case"init":{var s;const i=(s=this.workerContext)==null?void 0:s.objectURL;i&&self.URL.revokeObjectURL(i);break}case"transmuxComplete":{this.handleTransmuxComplete(t.data);break}case"flush":{this.onFlush(t.data);break}case"workerLog":w[t.data.logType]&&w[t.data.logType](t.data.message);break;default:{t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,r.trigger(t.event,t.data);break}}}configureTransmuxer(e){const{transmuxer:t}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}function t0(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!Br(n[t].attrs,e[t].attrs))return!1;return!0}function Br(n,e,t){const r=n["STABLE-RENDITION-ID"];return r&&!t?r===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(s=>n[s]!==e[s])}function pu(n,e){return e.label.toLowerCase()===n.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(n.lang||"").toLowerCase())}const th=100;class cL extends kc{constructor(e,t,r){super(e,t,r,"[audio-stream-controller]",W.AUDIO),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:e}=this;e.on(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.LEVEL_LOADED,this.onLevelLoaded,this),e.on(E.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(E.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(E.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(E.ERROR,this.onError,this),e.on(E.BUFFER_RESET,this.onBufferReset,this),e.on(E.BUFFER_CREATED,this.onBufferCreated,this),e.on(E.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(E.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(E.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(E.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.LEVEL_LOADED,this.onLevelLoaded,this),e.off(E.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(E.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(E.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(E.ERROR,this.onError,this),e.off(E.BUFFER_RESET,this.onBufferReset,this),e.off(E.BUFFER_CREATED,this.onBufferCreated,this),e.off(E.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(E.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(E.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(E.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(e,{frag:t,id:r,initPTS:s,timescale:i}){if(r==="main"){const o=t.cc;this.initPTS[t.cc]={baseTime:s,timescale:i},this.log(`InitPTS for cc: ${o} found from main: ${s}`),this.videoTrackCC=o,this.state===N.WAITING_INIT_PTS&&this.tick()}}startLoad(e){if(!this.levels){this.startPosition=e,this.state=N.STOPPED;return}const t=this.lastCurrentTime;this.stopLoad(),this.setInterval(th),t>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t,this.state=N.IDLE):(this.loadedmetadata=!1,this.state=N.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}doTick(){switch(this.state){case N.IDLE:this.doTickIdle();break;case N.WAITING_TRACK:{var e;const{levels:r,trackId:s}=this,i=r==null||(e=r[s])==null?void 0:e.details;if(i){if(this.waitForCdnTuneIn(i))break;this.state=N.WAITING_INIT_PTS}break}case N.FRAG_LOADING_WAITING_RETRY:{var t;const r=performance.now(),s=this.retryDate;if(!s||r>=s||(t=this.media)!=null&&t.seeking){const{levels:i,trackId:o}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((i==null?void 0:i[o])||null),this.state=N.IDLE}break}case N.WAITING_INIT_PTS:{const r=this.waitingData;if(r){const{frag:s,part:i,cache:o,complete:a}=r;if(this.initPTS[s.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=N.FRAG_LOADING;const l=o.flush(),u={frag:s,part:i,payload:l,networkDetails:null};this._handleFragmentLoadProgress(u),a&&super._handleFragmentLoadComplete(u)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${s.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const l=this.getLoadPosition(),u=le.bufferInfo(this.mediaBuffer,l,this.config.maxBufferHole);hu(u.end,this.config.maxFragLookUpTolerance,s)<0&&(this.log(`Waiting fragment cc (${s.cc}) @ ${s.start} cancelled because another fragment at ${u.end} is needed`),this.clearWaitingFragment())}}else this.state=N.IDLE}}this.onTickEnd()}clearWaitingFragment(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=N.IDLE)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){const{hls:e,levels:t,media:r,trackId:s}=this,i=e.config;if(!r&&(this.startFragRequested||!i.startFragPrefetch)||!(t!=null&&t[s]))return;const o=t[s],a=o.details;if(!a||a.live&&this.levelLastLoaded!==o||this.waitForCdnTuneIn(a)){this.state=N.WAITING_TRACK;return}const l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,ie.AUDIO,W.AUDIO));const u=this.getFwdBufferInfo(l,W.AUDIO);if(u===null)return;const{bufferedTrack:c,switchingTrack:d}=this;if(!d&&this._streamEnded(u,a)){e.trigger(E.BUFFER_EOS,{type:"audio"}),this.state=N.ENDED;return}const f=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,W.MAIN),m=u.len,h=this.getMaxBufferLength(f==null?void 0:f.len),p=a.fragments,y=p[0].start;let g=this.flushing?this.getLoadPosition():u.end;if(d&&r){const T=this.getLoadPosition();c&&!Br(d.attrs,c.attrs)&&(g=T),a.PTSKnown&&T<y&&(u.end>y||u.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=y+.05)}if(m>=h&&!d&&g<p[p.length-1].start)return;let v=this.getNextFragment(g,a),x=!1;if(v&&this.isLoopLoading(v,g)&&(x=!!v.gap,v=this.getNextFragmentLoopLoading(v,a,u,W.MAIN,h)),!v){this.bufferFlushed=!0;return}const L=f&&v.start>f.end+a.targetduration;if(L||!(f!=null&&f.len)&&u.len){const T=this.getAppendedFrag(v.start,W.MAIN);if(T===null||(x||(x=!!T.gap||!!L&&f.len===0),L&&!x||x&&u.nextStart&&u.nextStart<T.end))return}this.loadFragment(v,o,g)}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.min(Math.max(t,e),this.config.maxMaxBufferLength):t}onMediaDetaching(){this.videoBuffer=null,this.bufferFlushed=this.flushing=!1,super.onMediaDetaching()}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(r=>new Ur(r))}onAudioTrackSwitching(e,t){const r=!!t.url;this.trackId=t.id;const{fragCurrent:s}=this;s&&(s.abortRequests(),this.removeUnbufferedFrags(s.start)),this.resetLoadingState(),r?this.setInterval(th):this.resetTransmuxer(),r?(this.switchingTrack=t,this.state=N.IDLE,this.flushAudioIfNeeded(t)):(this.switchingTrack=null,this.bufferedTrack=t,this.state=N.STOPPED),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=this.flushing=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(e,t){this.mainDetails=t.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(E.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(e,t){var r;if(this.mainDetails==null){this.cachedTrackLoadedData=t;return}const{levels:s}=this,{details:i,id:o}=t;if(!s){this.warn(`Audio tracks were reset while loading level ${o}`);return}this.log(`Audio track ${o} loaded [${i.startSN},${i.endSN}]${i.lastPartSn?`[part-${i.lastPartSn}-${i.lastPartIndex}]`:""},duration:${i.totalduration}`);const a=s[o];let l=0;if(i.live||(r=a.details)!=null&&r.live){this.checkLiveUpdate(i);const c=this.mainDetails;if(i.deltaUpdateFailed||!c)return;if(!a.details&&i.hasProgramDateTime&&c.hasProgramDateTime)ko(i,c),l=i.fragments[0].start;else{var u;l=this.alignPlaylists(i,a.details,(u=this.levelLastLoaded)==null?void 0:u.details)}}a.details=i,this.levelLastLoaded=a,!this.startFragRequested&&(this.mainDetails||!i.live)&&this.setStartPosition(this.mainDetails||i,l),this.state===N.WAITING_TRACK&&!this.waitForCdnTuneIn(i)&&(this.state=N.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:r,part:s,payload:i}=e,{config:o,trackId:a,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const u=l[a];if(!u){this.warn("Audio track is undefined on fragment load progress");return}const c=u.details;if(!c){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(r.start);return}const d=o.defaultAudioCodec||u.audioCodec||"mp4a.40.2";let f=this.transmuxer;f||(f=this.transmuxer=new e0(this.hls,W.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const m=this.initPTS[r.cc],h=(t=r.initSegment)==null?void 0:t.data;if(m!==void 0){const y=s?s.index:-1,g=y!==-1,v=new Ic(r.level,r.sn,r.stats.chunkCount,i.byteLength,y,g);f.push(i,h,d,"",r,s,c.totalduration,!1,v,m)}else{this.log(`Unknown video PTS for cc ${r.cc}, waiting for video PTS before demuxing audio frag ${r.sn} of [${c.startSN} ,${c.endSN}],track ${a}`);const{cache:p}=this.waitingData=this.waitingData||{frag:r,part:s,cache:new Ug,complete:!1};p.push(new Uint8Array(i)),this.waitingVideoCC=this.videoTrackCC,this.state=N.WAITING_INIT_PTS}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(e,t){const r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)}onFragBuffered(e,t){const{frag:r,part:s}=t;if(r.type!==W.AUDIO){if(!this.loadedmetadata&&r.type===W.MAIN){const i=this.videoBuffer||this.media;i&&le.getBuffered(i).length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${s?" p: "+s.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(r.sn!=="initSegment"){this.fragPrevious=r;const i=this.switchingTrack;i&&(this.bufferedTrack=i,this.switchingTrack=null,this.hls.trigger(E.AUDIO_TRACK_SWITCHED,Pe({},i)))}this.fragBufferedComplete(r,s)}onError(e,t){var r;if(t.fatal){this.state=N.ERROR;return}switch(t.details){case k.FRAG_GAP:case k.FRAG_PARSING_ERROR:case k.FRAG_DECRYPT_ERROR:case k.FRAG_LOAD_ERROR:case k.FRAG_LOAD_TIMEOUT:case k.KEY_LOAD_ERROR:case k.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(W.AUDIO,t);break;case k.AUDIO_TRACK_LOAD_ERROR:case k.AUDIO_TRACK_LOAD_TIMEOUT:case k.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===N.WAITING_TRACK&&((r=t.context)==null?void 0:r.type)===re.AUDIO_TRACK&&(this.state=N.IDLE);break;case k.BUFFER_APPEND_ERROR:case k.BUFFER_FULL_ERROR:if(!t.parent||t.parent!=="audio")return;if(t.details===k.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case k.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==ie.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==ie.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===N.ENDED&&(this.state=N.IDLE);const r=this.mediaBuffer||this.media;r&&(this.afterBufferFlushed(r,t,W.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const r="audio",{hls:s}=this,{remuxResult:i,chunkMeta:o}=e,a=this.getCurrentContext(o);if(!a){this.resetWhenMissingContext(o);return}const{frag:l,part:u,level:c}=a,{details:d}=c,{audio:f,text:m,id3:h,initSegment:p}=i;if(this.fragContextChanged(l)||!d){this.fragmentTracker.removeFragment(l);return}if(this.state=N.PARSING,this.switchingTrack&&f&&this.completeAudioSwitch(this.switchingTrack),p!=null&&p.tracks){const y=l.initSegment||l;this._bufferInitSegment(c,p.tracks,y,o),s.trigger(E.FRAG_PARSING_INIT_SEGMENT,{frag:y,id:r,tracks:p.tracks})}if(f){const{startPTS:y,endPTS:g,startDTS:v,endDTS:x}=f;u&&(u.elementaryStreams[ie.AUDIO]={startPTS:y,endPTS:g,startDTS:v,endDTS:x}),l.setElementaryStreamInfo(ie.AUDIO,y,g,v,x),this.bufferFragmentData(f,l,u,o)}if(h!=null&&(t=h.samples)!=null&&t.length){const y=Ae({id:r,frag:l,details:d},h);s.trigger(E.FRAG_PARSING_METADATA,y)}if(m){const y=Ae({id:r,frag:l,details:d},m);s.trigger(E.FRAG_PARSING_USERDATA,y)}}_bufferInitSegment(e,t,r,s){if(this.state!==N.PARSING)return;t.video&&delete t.video;const i=t.audio;if(!i)return;i.id="audio";const o=e.audioCodec;this.log(`Init audio buffer, container:${i.container}, codecs[level/parsed]=[${o}/${i.codec}]`),o&&o.split(",").length===1&&(i.levelCodec=o),this.hls.trigger(E.BUFFER_CODECS,t);const a=i.initSegment;if(a!=null&&a.byteLength){const l={type:"audio",frag:r,part:null,chunkMeta:s,parent:r.type,data:a};this.hls.trigger(E.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,t,r){const s=this.fragmentTracker.getState(e);if(this.fragCurrent=e,this.switchingTrack||s===be.NOT_LOADED||s===be.PARTIAL){var i;if(e.sn==="initSegment")this._loadInitSegment(e,t);else if((i=t.details)!=null&&i.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=N.WAITING_INIT_PTS;const o=this.mainDetails;o&&o.fragments[0].start!==t.details.fragments[0].start&&ko(t.details,o)}else this.startFragRequested=!0,super.loadFragment(e,t,r)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){const{media:t,bufferedTrack:r}=this,s=r==null?void 0:r.attrs,i=e.attrs;t&&s&&(s.CHANNELS!==i.CHANNELS||r.name!==e.name||r.lang!==e.lang)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null)}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(E.AUDIO_TRACK_SWITCHED,Pe({},e))}}class dL extends Cc{constructor(e){super(e,"[audio-track-controller]"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.MANIFEST_PARSED,this.onManifestParsed,this),e.on(E.LEVEL_LOADING,this.onLevelLoading,this),e.on(E.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(E.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(E.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.MANIFEST_PARSED,this.onManifestParsed,this),e.off(E.LEVEL_LOADING,this.onLevelLoading,this),e.off(E.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(E.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(E.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:r,groupId:s,details:i}=t,o=this.tracksInGroup[r];if(!o||o.groupId!==s){this.warn(`Audio track with id:${r} and group:${s} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Audio track ${r} "${o.name}" lang:${o.lang} group:${s} loaded [${i.startSN}-${i.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.audioGroups||null,s=this.groupIds;let i=this.currentTrack;if(!r||(s==null?void 0:s.length)!==(r==null?void 0:r.length)||r!=null&&r.some(a=>(s==null?void 0:s.indexOf(a))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(f=>!r||r.indexOf(f.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(f=>f.default)&&(this.selectDefaultTrack=!1),a.forEach((f,m)=>{f.id=m});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const l=this.hls.config.audioPreference;if(!i&&l){const f=jt(l,a,ir);if(f>-1)i=a[f];else{const m=jt(l,this.tracks);i=this.tracks[m]}}let u=this.findTrackId(i);u===-1&&i&&(u=this.findTrackId(null));const c={audioTracks:a};this.log(`Updating audio tracks, ${a.length} track(s) found in group(s): ${r==null?void 0:r.join(",")}`),this.hls.trigger(E.AUDIO_TRACKS_UPDATED,c);const d=this.trackId;if(u!==-1&&d===-1)this.setAudioTrack(u);else if(a.length&&d===-1){var o;const f=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${a.length}`);this.warn(f.message),this.hls.trigger(E.ERROR,{type:q.MEDIA_ERROR,details:k.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:f})}}else this.shouldReloadPlaylist(i)&&this.setAudioTrack(this.trackId)}onError(e,t){t.fatal||!t.context||t.context.type===re.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&(this.requestScheduled=-1,this.checkRetry(t))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const r=this.allAudioTracks;if(this.selectDefaultTrack=!1,r.length){const s=this.currentTrack;if(s&&Ir(e,s,ir))return s;const i=jt(e,this.tracksInGroup,ir);if(i>-1){const o=this.tracksInGroup[i];return this.setAudioTrack(i),o}else if(s){let o=t.loadLevel;o===-1&&(o=t.firstAutoLevel);const a=d1(e,t.levels,r,o,ir);if(a===-1)return null;t.nextLoadLevel=a}if(e.channels||e.audioCodec){const o=jt(e,r);if(o>-1)return r[o]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.clearTimer(),this.selectDefaultTrack=!1;const r=this.currentTrack,s=t[e],i=s.details&&!s.details.live;if(e===this.trackId&&s===r&&i||(this.log(`Switching to audio-track ${e} "${s.name}" lang:${s.lang} group:${s.groupId} channels:${s.channels}`),this.trackId=e,this.currentTrack=s,this.hls.trigger(E.AUDIO_TRACK_SWITCHING,Pe({},s)),i))return;const o=this.switchParams(s.url,r==null?void 0:r.details,s.details);this.loadPlaylist(o)}findTrackId(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const s=t[r];if(!(this.selectDefaultTrack&&!s.default)&&(!e||Ir(e,s,ir)))return r}if(e){const{name:r,lang:s,assocLang:i,characteristics:o,audioCodec:a,channels:l}=e;for(let u=0;u<t.length;u++){const c=t[u];if(Ir({name:r,lang:s,assocLang:i,characteristics:o,audioCodec:a,channels:l},c,ir))return u}for(let u=0;u<t.length;u++){const c=t[u];if(Br(e.attrs,c.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return u}for(let u=0;u<t.length;u++){const c=t[u];if(Br(e.attrs,c.attrs,["LANGUAGE"]))return u}}return-1}loadPlaylist(e){const t=this.currentTrack;if(this.shouldLoadPlaylist(t)&&t){super.loadPlaylist();const r=t.id,s=t.groupId;let i=t.url;if(e)try{i=e.addDirectives(i)}catch(o){this.warn(`Could not construct new URL with HLS Delivery Directives: ${o}`)}this.log(`loading audio-track playlist ${r} "${t.name}" lang:${t.lang} group:${s}`),this.clearTimer(),this.hls.trigger(E.AUDIO_TRACK_LOADING,{url:i,id:r,groupId:s,deliveryDirectives:e||null})}}}const nh=500;class fL extends kc{constructor(e,t,r){super(e,t,r,"[subtitle-stream-controller]",W.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}_registerListeners(){const{hls:e}=this;e.on(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.LEVEL_LOADED,this.onLevelLoaded,this),e.on(E.ERROR,this.onError,this),e.on(E.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(E.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(E.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(E.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(E.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(E.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.LEVEL_LOADED,this.onLevelLoaded,this),e.off(E.ERROR,this.onError,this),e.off(E.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(E.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(E.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(E.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(E.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(E.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(e){this.stopLoad(),this.state=N.IDLE,this.setInterval(nh),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:r,success:s}=t;if(this.fragPrevious=r,this.state=N.IDLE,!s)return;const i=this.tracksBuffered[this.currentTrackId];if(!i)return;let o;const a=r.start;for(let u=0;u<i.length;u++)if(a>=i[u].start&&a<=i[u].end){o=i[u];break}const l=r.start+r.duration;o?o.end=l:(o={start:a,end:l},i.push(o)),this.fragmentTracker.fragBuffered(r),this.fragBufferedComplete(r,null)}onBufferFlushing(e,t){const{startOffset:r,endOffset:s}=t;if(r===0&&s!==Number.POSITIVE_INFINITY){const i=s-1;if(i<=0)return;t.endOffsetSubtitles=Math.max(0,i),this.tracksBuffered.forEach(o=>{for(let a=0;a<o.length;){if(o[a].end<=i){o.shift();continue}else if(o[a].start<i)o[a].start=i;else break;a++}}),this.fragmentTracker.removeFragmentsInRange(r,i,W.SUBTITLE)}}onFragBuffered(e,t){if(!this.loadedmetadata&&t.frag.type===W.MAIN){var r;(r=this.media)!=null&&r.buffered.length&&(this.loadedmetadata=!0)}}onError(e,t){const r=t.frag;(r==null?void 0:r.type)===W.SUBTITLE&&(t.details===k.FRAG_GAP&&this.fragmentTracker.fragBuffered(r,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==N.STOPPED&&(this.state=N.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&t0(this.levels,t)){this.levels=t.map(r=>new Ur(r));return}this.tracksBuffered=[],this.levels=t.map(r=>{const s=new Ur(r);return this.tracksBuffered[s.id]=[],s}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,W.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var r;if(this.currentTrackId=t.id,!((r=this.levels)!=null&&r.length)||this.currentTrackId===-1){this.clearInterval();return}const s=this.levels[this.currentTrackId];s!=null&&s.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,s&&this.setInterval(nh)}onSubtitleTrackLoaded(e,t){var r;const{currentTrackId:s,levels:i}=this,{details:o,id:a}=t;if(!i){this.warn(`Subtitle tracks were reset while loading level ${a}`);return}const l=i[a];if(a>=i.length||!l)return;this.log(`Subtitle track ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let u=0;if(o.live||(r=l.details)!=null&&r.live){const d=this.mainDetails;if(o.deltaUpdateFailed||!d)return;const f=d.fragments[0];if(!l.details)o.hasProgramDateTime&&d.hasProgramDateTime?(ko(o,d),u=o.fragments[0].start):f&&(u=f.start,fu(o,u));else{var c;u=this.alignPlaylists(o,l.details,(c=this.levelLastLoaded)==null?void 0:c.details),u===0&&f&&(u=f.start,fu(o,u))}}l.details=o,this.levelLastLoaded=l,a===s&&(!this.startFragRequested&&(this.mainDetails||!o.live)&&this.setStartPosition(this.mainDetails||o,u),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===N.IDLE&&(Do(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:r}=e,s=t.decryptdata,i=this.hls;if(!this.fragContextChanged(t)&&r&&r.byteLength>0&&s!=null&&s.key&&s.iv&&s.method==="AES-128"){const o=performance.now();this.decrypter.decrypt(new Uint8Array(r),s.key.buffer,s.iv.buffer).catch(a=>{throw i.trigger(E.ERROR,{type:q.MEDIA_ERROR,details:k.FRAG_DECRYPT_ERROR,fatal:!1,error:a,reason:a.message,frag:t}),a}).then(a=>{const l=performance.now();i.trigger(E.FRAG_DECRYPTED,{frag:t,payload:a,stats:{tstart:o,tdecrypt:l}})}).catch(a=>{this.warn(`${a.name}: ${a.message}`),this.state=N.IDLE})}}doTick(){if(!this.media){this.state=N.IDLE;return}if(this.state===N.IDLE){const{currentTrackId:e,levels:t}=this,r=t==null?void 0:t[e];if(!r||!t.length||!r.details)return;const{config:s}=this,i=this.getLoadPosition(),o=le.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],i,s.maxBufferHole),{end:a,len:l}=o,u=this.getFwdBufferInfo(this.media,W.MAIN),c=r.details,d=this.getMaxBufferLength(u==null?void 0:u.len)+c.levelTargetDuration;if(l>d)return;const f=c.fragments,m=f.length,h=c.edge;let p=null;const y=this.fragPrevious;if(a<h){const g=s.maxFragLookUpTolerance,v=a>h-g?0:g;p=Do(y,f,Math.max(f[0].start,a),v),!p&&y&&y.start<f[0].start&&(p=f[0])}else p=f[m-1];if(!p)return;if(p=this.mapToInitFragWhenRequired(p),p.sn!=="initSegment"){const g=p.sn-c.startSN,v=f[g-1];v&&v.cc===p.cc&&this.fragmentTracker.getState(v)===be.NOT_LOADED&&(p=v)}this.fragmentTracker.getState(p)===be.NOT_LOADED&&this.loadFragment(p,r,a)}}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.max(t,e):t}loadFragment(e,t,r){this.fragCurrent=e,e.sn==="initSegment"?this._loadInitSegment(e,t):(this.startFragRequested=!0,super.loadFragment(e,t,r))}get mediaBufferTimeRanges(){return new hL(this.tracksBuffered[this.currentTrackId]||[])}}class hL{constructor(e){this.buffered=void 0;const t=(r,s,i)=>{if(s=s>>>0,s>i-1)throw new DOMException(`Failed to execute '${r}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${i})`);return e[s][r]};this.buffered={get length(){return e.length},end(r){return t("end",r,e.length)},start(r){return t("start",r,e.length)}}}}class mL extends Cc{constructor(e){super(e,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const r=Bi(this.media.textTracks);for(let i=0;i<r.length;i++)if(r[i].mode==="hidden")t=r[i];else if(r[i].mode==="showing"){t=r[i];break}const s=this.findTrackForTextTrack(t);this.subtitleTrack!==s&&this.setSubtitleTrack(s)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.MANIFEST_PARSED,this.onManifestParsed,this),e.on(E.LEVEL_LOADING,this.onLevelLoading,this),e.on(E.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(E.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(E.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.MANIFEST_PARSED,this.onManifestParsed,this),e.off(E.LEVEL_LOADING,this.onLevelLoading,this),e.off(E.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(E.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(E.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),Bi(this.media.textTracks).forEach(t=>{Sr(t)}),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:r,groupId:s,details:i}=t,o=this.tracksInGroup[r];if(!o||o.groupId!==s){this.warn(`Subtitle track with id:${r} and group:${s} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Subtitle track ${r} "${o.name}" lang:${o.lang} group:${s} loaded [${i.startSN}-${i.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.subtitleGroups||null,s=this.groupIds;let i=this.currentTrack;if(!r||(s==null?void 0:s.length)!==(r==null?void 0:r.length)||r!=null&&r.some(o=>(s==null?void 0:s.indexOf(o))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(c=>!r||r.indexOf(c.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(c=>c.default)&&(this.selectDefaultTrack=!1),o.forEach((c,d)=>{c.id=d});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const a=this.hls.config.subtitlePreference;if(!i&&a){this.selectDefaultTrack=!1;const c=jt(a,o);if(c>-1)i=o[c];else{const d=jt(a,this.tracks);i=this.tracks[d]}}let l=this.findTrackId(i);l===-1&&i&&(l=this.findTrackId(null));const u={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${r==null?void 0:r.join(",")}" group-id`),this.hls.trigger(E.SUBTITLE_TRACKS_UPDATED,u),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}else this.shouldReloadPlaylist(i)&&this.setSubtitleTrack(this.trackId)}findTrackId(e){const t=this.tracksInGroup,r=this.selectDefaultTrack;for(let s=0;s<t.length;s++){const i=t[s];if(!(r&&!i.default||!r&&!e)&&(!e||Ir(i,e)))return s}if(e){for(let s=0;s<t.length;s++){const i=t[s];if(Br(e.attrs,i.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return s}for(let s=0;s<t.length;s++){const i=t[s];if(Br(e.attrs,i.attrs,["LANGUAGE"]))return s}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const s=t[r];if(pu(s,e))return r}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===re.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const r=this.currentTrack;if(r&&Ir(e,r))return r;const s=jt(e,this.tracksInGroup);if(s>-1){const i=this.tracksInGroup[s];return this.setSubtitleTrack(s),i}else{if(r)return null;{const i=jt(e,t);if(i>-1)return t[i]}}}}return null}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;if(this.shouldLoadPlaylist(t)&&t){const r=t.id,s=t.groupId;let i=t.url;if(e)try{i=e.addDirectives(i)}catch(o){this.warn(`Could not construct new URL with HLS Delivery Directives: ${o}`)}this.log(`Loading subtitle playlist for id ${r}`),this.hls.trigger(E.SUBTITLE_TRACK_LOADING,{url:i,id:r,groupId:s,deliveryDirectives:e||null})}}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=Bi(e.textTracks),r=this.currentTrack;let s;if(r&&(s=t.filter(i=>pu(r,i))[0],s||this.warn(`Unable to find subtitle TextTrack with name "${r.name}" and language "${r.lang}"`)),[].slice.call(t).forEach(i=>{i.mode!=="disabled"&&i!==s&&(i.mode="disabled")}),s){const i=this.subtitleDisplay?"showing":"hidden";s.mode!==i&&(s.mode=i)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!G(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.clearTimer(),this.selectDefaultTrack=!1;const r=this.currentTrack,s=t[e]||null;if(this.trackId=e,this.currentTrack=s,this.toggleTrackModes(),!s){this.hls.trigger(E.SUBTITLE_TRACK_SWITCH,{id:e});return}const i=!!s.details&&!s.details.live;if(e===this.trackId&&s===r&&i)return;this.log(`Switching to subtitle-track ${e}`+(s?` "${s.name}" lang:${s.lang} group:${s.groupId}`:""));const{id:o,groupId:a="",name:l,type:u,url:c}=s;this.hls.trigger(E.SUBTITLE_TRACK_SWITCH,{id:o,groupId:a,name:l,type:u,url:c});const d=this.switchParams(s.url,r==null?void 0:r.details,s.details);this.loadPlaylist(d)}}class pL{constructor(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}append(e,t,r){const s=this.queues[t];s.push(e),s.length===1&&!r&&this.executeNext(t)}insertAbort(e,t){this.queues[t].unshift(e),this.executeNext(t)}appendBlocker(e){let t;const r=new Promise(i=>{t=i}),s={execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(s,e),r}executeNext(e){const t=this.queues[e];if(t.length){const r=t[0];try{r.execute()}catch(s){w.warn(`[buffer-operation-queue]: Exception executing "${e}" SourceBuffer operation: ${s}`),r.onError(s);const i=this.buffers[e];i!=null&&i.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues[e].shift(),this.executeNext(e)}current(e){return this.queues[e][0]}}const rh=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/;class gL{constructor(e){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendSource=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this.log=void 0,this.warn=void 0,this.error=void 0,this._onEndStreaming=r=>{this.hls&&this.hls.pauseBuffering()},this._onStartStreaming=r=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=()=>{const{media:r,mediaSource:s}=this;this.log("Media source opened"),r&&(r.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(E.MEDIA_ATTACHED,{media:r,mediaSource:s})),s&&s.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:r,_objectUrl:s}=this;r!==s&&w.error(`Media element src was set while attaching MediaSource (${s} > ${r})`)},this.hls=e;const t="[buffer-controller]";this.appendSource=AT(Zn(e.config.preferManagedMediaSource)),this.log=w.log.bind(w,t),this.warn=w.warn.bind(w,t),this.error=w.error.bind(w,t),this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null,this.hls=null}registerListeners(){const{hls:e}=this;e.on(E.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.MANIFEST_PARSED,this.onManifestParsed,this),e.on(E.BUFFER_RESET,this.onBufferReset,this),e.on(E.BUFFER_APPENDING,this.onBufferAppending,this),e.on(E.BUFFER_CODECS,this.onBufferCodecs,this),e.on(E.BUFFER_EOS,this.onBufferEos,this),e.on(E.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(E.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(E.FRAG_PARSED,this.onFragParsed,this),e.on(E.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:e}=this;e.off(E.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.MANIFEST_PARSED,this.onManifestParsed,this),e.off(E.BUFFER_RESET,this.onBufferReset,this),e.off(E.BUFFER_APPENDING,this.onBufferAppending,this),e.off(E.BUFFER_CODECS,this.onBufferCodecs,this),e.off(E.BUFFER_EOS,this.onBufferEos,this),e.off(E.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(E.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(E.FRAG_PARSED,this.onFragParsed,this),e.off(E.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new pL(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.appendErrors={audio:0,video:0,audiovideo:0},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,this.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(e,t){const r=this.media=t.media,s=Zn(this.appendSource);if(r&&s){var i;const o=this.mediaSource=new s;this.log(`created media source: ${(i=o.constructor)==null?void 0:i.name}`),o.addEventListener("sourceopen",this._onMediaSourceOpen),o.addEventListener("sourceended",this._onMediaSourceEnded),o.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(o.addEventListener("startstreaming",this._onStartStreaming),o.addEventListener("endstreaming",this._onEndStreaming));const a=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{r.removeAttribute("src");const l=self.ManagedMediaSource;r.disableRemotePlayback=r.disableRemotePlayback||l&&o instanceof l,sh(r),yL(r,a),r.load()}catch{r.src=a}else r.src=a;r.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:e,mediaSource:t,_objectUrl:r}=this;if(t){if(this.log("media source detaching"),t.readyState==="open")try{t.endOfStream()}catch(s){this.warn(`onMediaDetaching: ${s.message} while calling endOfStream`)}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(t.removeEventListener("startstreaming",this._onStartStreaming),t.removeEventListener("endstreaming",this._onEndStreaming)),e&&(e.removeEventListener("emptied",this._onMediaEmptied),r&&self.URL.revokeObjectURL(r),this.mediaSrc===r?(e.removeAttribute("src"),this.appendSource&&sh(e),e.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(E.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(e=>{this.resetBuffer(e)}),this._initSourceBuffer()}resetBuffer(e){const t=this.sourceBuffer[e];try{if(t){var r;this.removeBufferListeners(e),this.sourceBuffer[e]=void 0,(r=this.mediaSource)!=null&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(t)}}catch(s){this.warn(`onBufferReset ${e}`,s)}}onBufferCodecs(e,t){const r=this.getSourceBufferTypes().length,s=Object.keys(t);if(s.forEach(o=>{if(r){const l=this.tracks[o];if(l&&typeof l.buffer.changeType=="function"){var a;const{id:u,codec:c,levelCodec:d,container:f,metadata:m}=t[o],h=Af(l.codec,l.levelCodec),p=h==null?void 0:h.replace(rh,"$1");let y=Af(c,d);const g=(a=y)==null?void 0:a.replace(rh,"$1");if(y&&p!==g){o.slice(0,5)==="audio"&&(y=Ao(y,this.appendSource));const v=`${f};codecs=${y}`;this.appendChangeType(o,v),this.log(`switching codec ${h} to ${y}`),this.tracks[o]={buffer:l.buffer,codec:c,container:f,levelCodec:d,metadata:m,id:u}}}}else this.pendingTracks[o]=t[o]}),r)return;const i=Math.max(this.bufferCodecEventsExpected-1,0);this.bufferCodecEventsExpected!==i&&(this.log(`${i} bufferCodec event(s) expected ${s.join(",")}`),this.bufferCodecEventsExpected=i),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks()}appendChangeType(e,t){const{operationQueue:r}=this,s={execute:()=>{const i=this.sourceBuffer[e];i&&(this.log(`changing ${e} sourceBuffer type to ${t}`),i.changeType(t)),r.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:i=>{this.warn(`Failed to change ${e} SourceBuffer type`,i)}};r.append(s,e,!!this.pendingTracks[e])}onBufferAppending(e,t){const{hls:r,operationQueue:s,tracks:i}=this,{data:o,type:a,frag:l,part:u,chunkMeta:c}=t,d=c.buffering[a],f=self.performance.now();d.start=f;const m=l.stats.buffering,h=u?u.stats.buffering:null;m.start===0&&(m.start=f),h&&h.start===0&&(h.start=f);const p=i.audio;let y=!1;a==="audio"&&(p==null?void 0:p.container)==="audio/mpeg"&&(y=!this.lastMpegAudioChunk||c.id===1||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);const g=l.start,v={execute:()=>{if(d.executeStart=self.performance.now(),y){const x=this.sourceBuffer[a];if(x){const L=g-x.timestampOffset;Math.abs(L)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${g} (delta: ${L}) sn: ${l.sn})`),x.timestampOffset=g)}}this.appendExecutor(o,a)},onStart:()=>{},onComplete:()=>{const x=self.performance.now();d.executeEnd=d.end=x,m.first===0&&(m.first=x),h&&h.first===0&&(h.first=x);const{sourceBuffer:L}=this,T={};for(const A in L)T[A]=le.getBuffered(L[A]);this.appendErrors[a]=0,a==="audio"||a==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(E.BUFFER_APPENDED,{type:a,frag:l,part:u,chunkMeta:c,parent:l.type,timeRanges:T})},onError:x=>{const L={type:q.MEDIA_ERROR,parent:l.type,details:k.BUFFER_APPEND_ERROR,sourceBufferName:a,frag:l,part:u,chunkMeta:c,error:x,err:x,fatal:!1};if(x.code===DOMException.QUOTA_EXCEEDED_ERR)L.details=k.BUFFER_FULL_ERROR;else{const T=++this.appendErrors[a];L.details=k.BUFFER_APPEND_ERROR,this.warn(`Failed ${T}/${r.config.appendErrorMaxRetry} times to append segment in "${a}" sourceBuffer`),T>=r.config.appendErrorMaxRetry&&(L.fatal=!0)}r.trigger(E.ERROR,L)}};s.append(v,a,!!this.pendingTracks[a])}onBufferFlushing(e,t){const{operationQueue:r}=this,s=i=>({execute:this.removeExecutor.bind(this,i,t.startOffset,t.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(E.BUFFER_FLUSHED,{type:i})},onError:o=>{this.warn(`Failed to remove from ${i} SourceBuffer`,o)}});t.type?r.append(s(t.type),t.type):this.getSourceBufferTypes().forEach(i=>{r.append(s(i),i)})}onFragParsed(e,t){const{frag:r,part:s}=t,i=[],o=s?s.elementaryStreams:r.elementaryStreams;o[ie.AUDIOVIDEO]?i.push("audiovideo"):(o[ie.AUDIO]&&i.push("audio"),o[ie.VIDEO]&&i.push("video"));const a=()=>{const l=self.performance.now();r.stats.buffering.end=l,s&&(s.stats.buffering.end=l);const u=s?s.stats:r.stats;this.hls.trigger(E.FRAG_BUFFERED,{frag:r,part:s,stats:u,id:r.type})};i.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${r.type} level: ${r.level} sn: ${r.sn}`),this.blockBuffers(a,i)}onFragChanged(e,t){this.trimBuffers()}onBufferEos(e,t){this.getSourceBufferTypes().reduce((s,i)=>{const o=this.sourceBuffer[i];return o&&(!t.type||t.type===i)&&(o.ending=!0,o.ended||(o.ended=!0,this.log(`${i} sourceBuffer now EOS`))),s&&!!(!o||o.ended)},!0)&&(this.log("Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(i=>{const o=this.sourceBuffer[i];o&&(o.ending=!1)});const{mediaSource:s}=this;if(!s||s.readyState!=="open"){s&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${s.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),s.endOfStream()}))}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}trimBuffers(){const{hls:e,details:t,media:r}=this;if(!r||t===null||!this.getSourceBufferTypes().length)return;const i=e.config,o=r.currentTime,a=t.levelTargetDuration,l=t.live&&i.liveBackBufferLength!==null?i.liveBackBufferLength:i.backBufferLength;if(G(l)&&l>0){const u=Math.max(l,a),c=Math.floor(o/a)*a-u;this.flushBackBuffer(o,a,c)}if(G(i.frontBufferFlushThreshold)&&i.frontBufferFlushThreshold>0){const u=Math.max(i.maxBufferLength,i.frontBufferFlushThreshold),c=Math.max(u,a),d=Math.floor(o/a)*a+c;this.flushFrontBuffer(o,a,d)}}flushBackBuffer(e,t,r){const{details:s,sourceBuffer:i}=this;this.getSourceBufferTypes().forEach(a=>{const l=i[a];if(l){const u=le.getBuffered(l);if(u.length>0&&r>u.start(0)){if(this.hls.trigger(E.BACK_BUFFER_REACHED,{bufferEnd:r}),s!=null&&s.live)this.hls.trigger(E.LIVE_BACK_BUFFER_REACHED,{bufferEnd:r});else if(l.ended&&u.end(u.length-1)-e<t*2){this.log(`Cannot flush ${a} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(E.BUFFER_FLUSHING,{startOffset:0,endOffset:r,type:a})}}})}flushFrontBuffer(e,t,r){const{sourceBuffer:s}=this;this.getSourceBufferTypes().forEach(o=>{const a=s[o];if(a){const l=le.getBuffered(a),u=l.length;if(u<2)return;const c=l.start(u-1),d=l.end(u-1);if(r>c||e>=c&&e<=d)return;if(a.ended&&e-d<2*t){this.log(`Cannot flush ${o} front buffer while SourceBuffer is in ended state`);return}this.hls.trigger(E.BUFFER_FLUSHING,{startOffset:c,endOffset:1/0,type:o})}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")return;const{details:e,hls:t,media:r,mediaSource:s}=this,i=e.fragments[0].start+e.totalduration,o=r.duration,a=G(s.duration)?s.duration:0;e.live&&t.config.liveDurationInfinity?(s.duration=1/0,this.updateSeekableRange(e)):(i>a&&i>o||!G(o))&&(this.log(`Updating Media Source duration to ${i.toFixed(3)}`),s.duration=i)}updateSeekableRange(e){const t=this.mediaSource,r=e.fragments;if(r.length&&e.live&&t!=null&&t.setLiveSeekableRange){const i=Math.max(0,r[0].start),o=Math.max(i,i+e.totalduration);this.log(`Media Source duration is set to ${t.duration}. Setting seekable range to ${i}-${o}.`),t.setLiveSeekableRange(i,o)}}checkPendingTracks(){const{bufferCodecEventsExpected:e,operationQueue:t,pendingTracks:r}=this,s=Object.keys(r).length;if(s&&(!e||s===2||"audiovideo"in r)){this.createSourceBuffers(r),this.pendingTracks={};const i=this.getSourceBufferTypes();if(i.length)this.hls.trigger(E.BUFFER_CREATED,{tracks:this.tracks}),i.forEach(o=>{t.executeNext(o)});else{const o=new Error("could not create source buffer for media codec(s)");this.hls.trigger(E.ERROR,{type:q.MEDIA_ERROR,details:k.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:o,reason:o.message})}}}createSourceBuffers(e){const{sourceBuffer:t,mediaSource:r}=this;if(!r)throw Error("createSourceBuffers called when mediaSource was null");for(const i in e)if(!t[i]){var s;const o=e[i];if(!o)throw Error(`source buffer exists for track ${i}, however track does not`);let a=((s=o.levelCodec)==null?void 0:s.indexOf(","))===-1?o.levelCodec:o.codec;a&&i.slice(0,5)==="audio"&&(a=Ao(a,this.appendSource));const l=`${o.container};codecs=${a}`;this.log(`creating sourceBuffer(${l})`);try{const u=t[i]=r.addSourceBuffer(l),c=i;this.addBufferListener(c,"updatestart",this._onSBUpdateStart),this.addBufferListener(c,"updateend",this._onSBUpdateEnd),this.addBufferListener(c,"error",this._onSBUpdateError),this.appendSource&&this.addBufferListener(c,"bufferedchange",(d,f)=>{const m=f.removedRanges;m!=null&&m.length&&this.hls.trigger(E.BUFFER_FLUSHED,{type:i})}),this.tracks[i]={buffer:u,codec:a,container:o.container,levelCodec:o.levelCodec,metadata:o.metadata,id:o.id}}catch(u){this.error(`error while trying to add sourceBuffer: ${u.message}`),this.hls.trigger(E.ERROR,{type:q.MEDIA_ERROR,details:k.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:u,sourceBufferName:i,mimeType:l})}}}get mediaSrc(){var e;const t=((e=this.media)==null?void 0:e.firstChild)||this.media;return t==null?void 0:t.src}_onSBUpdateStart(e){const{operationQueue:t}=this;t.current(e).onStart()}_onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const{operationQueue:r}=this;r.current(e).onComplete(),r.shiftAndExecuteNext(e)}_onSBUpdateError(e,t){var r;const s=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(r=this.mediaSource)==null?void 0:r.readyState}`);this.error(`${s}`,t),this.hls.trigger(E.ERROR,{type:q.MEDIA_ERROR,details:k.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:s,fatal:!1});const i=this.operationQueue.current(e);i&&i.onError(s)}removeExecutor(e,t,r){const{media:s,mediaSource:i,operationQueue:o,sourceBuffer:a}=this,l=a[e];if(!s||!i||!l){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),o.shiftAndExecuteNext(e);return}const u=G(s.duration)?s.duration:1/0,c=G(i.duration)?i.duration:1/0,d=Math.max(0,t),f=Math.min(r,u,c);f>d&&(!l.ending||l.ended)?(l.ended=!1,this.log(`Removing [${d},${f}] from the ${e} SourceBuffer`),l.remove(d,f)):o.shiftAndExecuteNext(e)}appendExecutor(e,t){const r=this.sourceBuffer[t];if(!r){if(!this.pendingTracks[t])throw new Error(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);return}r.ended=!1,r.appendBuffer(e)}blockBuffers(e,t=this.getSourceBufferTypes()){if(!t.length){this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);return}const{operationQueue:r}=this,s=t.map(i=>r.appendBlocker(i));Promise.all(s).then(()=>{e(),t.forEach(i=>{const o=this.sourceBuffer[i];o!=null&&o.updating||r.shiftAndExecuteNext(i)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(e,t,r){const s=this.sourceBuffer[e];if(!s)return;const i=r.bind(this,e);this.listeners[e].push({event:t,listener:i}),s.addEventListener(t,i)}removeBufferListeners(e){const t=this.sourceBuffer[e];t&&this.listeners[e].forEach(r=>{t.removeEventListener(r.event,r.listener)})}}function sh(n){const e=n.querySelectorAll("source");[].slice.call(e).forEach(t=>{n.removeChild(t)})}function yL(n,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,n.appendChild(t)}const vL={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},n0=n=>String.fromCharCode(vL[n]||n),Lt=15,qt=100,xL={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},EL={17:2,18:4,21:6,22:8,23:10,19:13,20:15},SL={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},TL={25:2,26:4,29:6,30:8,31:10,27:13,28:15},LL=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class RL{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const r=typeof t=="function"?t():t;w.log(`${this.time} [${e}] ${r}`)}}}const On=function(e){const t=[];for(let r=0;r<e.length;r++)t.push(e[r].toString(16));return t};class r0{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let r=0;r<t.length;r++){const s=t[r];e.hasOwnProperty(s)&&(this[s]=e[s])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class AL{constructor(){this.uchar=" ",this.penState=new r0}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class wL{constructor(e){this.chars=[],this.pos=0,this.currPenState=new r0,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<qt;t++)this.chars.push(new AL);this.logger=e}equals(e){for(let t=0;t<qt;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<qt;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<qt;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>qt&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=qt)}moveCursor(e){const t=this.pos+e;if(e>1)for(let r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=n0(e);if(this.pos>=qt){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<qt;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let r=0;r<qt;r++){const s=this.chars[r].uchar;s!==" "&&(t=!1),e.push(s)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Ya{constructor(e){this.rows=[],this.currRow=Lt-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Lt;t++)this.rows.push(new wL(e));this.logger=e}reset(){for(let e=0;e<Lt;e++)this.rows[e].clear();this.currRow=Lt-1}equals(e){let t=!0;for(let r=0;r<Lt;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}copy(e){for(let t=0;t<Lt;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Lt;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+JSON.stringify(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let a=0;a<Lt;a++)this.rows[a].clear();const i=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const a=o.rows[i].cueStartTime,l=this.logger.time;if(a!==null&&l!==null&&a<l)for(let u=0;u<this.nrRollUpRows;u++)this.rows[t-this.nrRollUpRows+u+1].copy(o.rows[i+u])}}this.currRow=t;const r=this.rows[this.currRow];if(e.indent!==null){const i=e.indent,o=Math.max(i-1,0);r.setCursor(e.indent),e.color=r.chars[o].penState.foreground}const s={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(s)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let r="",s=-1;for(let i=0;i<Lt;i++){const o=this.rows[i].getTextString();o&&(s=i+1,e?t.push("Row "+s+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(e?r="["+t.join(" | ")+"]":r=t.join(`
`)),r}getTextAndFormat(){return this.rows}}class ih{constructor(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Ya(r),this.nonDisplayedMemory=new Ya(r),this.lastOutputScreen=new Ya(r),this.currRollUpRow=this.displayedMemory.rows[Lt-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Lt-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const r=Math.floor(e/2)-16,s=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=s[r]}this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class oh{constructor(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=IL(),this.logger=void 0;const s=this.logger=new RL;this.channels=[null,new ih(e,t,s),new ih(e+1,r,s)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let r=0;r<t.length;r+=2){const s=t[r]&127,i=t[r+1]&127;let o=!1,a=null;if(s===0&&i===0)continue;this.logger.log(3,()=>"["+On([t[r],t[r+1]])+"] -> ("+On([s,i])+")");const l=this.cmdHistory;if(s>=16&&s<=31){if(CL(s,i,l)){Ei(null,null,l),this.logger.log(3,()=>"Repeated command ("+On([s,i])+") is dropped");continue}Ei(s,i,this.cmdHistory),o=this.parseCmd(s,i),o||(o=this.parseMidrow(s,i)),o||(o=this.parsePAC(s,i)),o||(o=this.parseBackgroundAttributes(s,i))}else Ei(null,null,l);if(!o&&(a=this.parseChars(s,i),a)){const c=this.currentChannel;c&&c>0?this.channels[c].insertChars(a):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!a&&this.logger.log(2,()=>"Couldn't parse cleaned data "+On([s,i])+" orig: "+On([t[r],t[r+1]]))}}parseCmd(e,t){const r=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=33&&t<=35;if(!(r||s))return!1;const i=e===20||e===21||e===23?1:2,o=this.channels[i];return e===20||e===21||e===28||e===29?t===32?o.ccRCL():t===33?o.ccBS():t===34?o.ccAOF():t===35?o.ccAON():t===36?o.ccDER():t===37?o.ccRU(2):t===38?o.ccRU(3):t===39?o.ccRU(4):t===40?o.ccFON():t===41?o.ccRDC():t===42?o.ccTR():t===43?o.ccRTD():t===44?o.ccEDM():t===45?o.ccCR():t===46?o.ccENM():t===47&&o.ccEOC():o.ccTO(t-32),this.currentChannel=i,!0}parseMidrow(e,t){let r=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?r=1:r=2,r!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const s=this.channels[r];return s?(s.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+On([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let r;const s=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,i=(e===16||e===24)&&t>=64&&t<=95;if(!(s||i))return!1;const o=e<=23?1:2;t>=64&&t<=95?r=o===1?xL[e]:SL[e]:r=o===1?EL[e]:TL[e];const a=this.channels[o];return a?(a.setPAC(this.interpretPAC(r,t)),this.currentChannel=o,!0):!1}interpretPAC(e,t){let r;const s={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?r=t-96:r=t-64,s.underline=(r&1)===1,r<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(s.italics=!0,s.color="white"):s.indent=Math.floor((r-16)/2)*4,s}parseChars(e,t){let r,s=null,i=null;if(e>=25?(r=2,i=e-8):(r=1,i=e),i>=17&&i<=19){let o;i===17?o=t+80:i===18?o=t+112:o=t+144,this.logger.log(2,()=>"Special char '"+n0(o)+"' in channel "+r),s=[o]}else e>=32&&e<=127&&(s=t===0?[e]:[e,t]);return s&&this.logger.log(3,()=>"Char codes =  "+On(s).join(",")),s}parseBackgroundAttributes(e,t){const r=(e===16||e===24)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=45&&t<=47;if(!(r||s))return!1;let i;const o={};e===16||e===24?(i=Math.floor((t-32)/2),o.background=LL[i],t%2===1&&(o.background=o.background+"_semi")):t===45?o.background="transparent":(o.foreground="black",t===47&&(o.underline=!0));const a=e<=23?1:2;return this.channels[a].setBkgData(o),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Ei(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const r=this.channels[t];r&&r.cueSplitAtTime(e)}}}function Ei(n,e,t){t.a=n,t.b=e}function CL(n,e,t){return t.a===n&&t.b===e}function IL(){return{a:null,b:null}}class Si{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,r){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var Fc=function(){if(Mr!=null&&Mr.VTTCue)return self.VTTCue;const n=["","lr","rl"],e=["start","middle","end","left","right"];function t(a,l){if(typeof l!="string"||!Array.isArray(a))return!1;const u=l.toLowerCase();return~a.indexOf(u)?u:!1}function r(a){return t(n,a)}function s(a){return t(e,a)}function i(a,...l){let u=1;for(;u<arguments.length;u++){const c=arguments[u];for(const d in c)a[d]=c[d]}return a}function o(a,l,u){const c=this,d={enumerable:!0};c.hasBeenReset=!1;let f="",m=!1,h=a,p=l,y=u,g=null,v="",x=!0,L="auto",T="start",A=50,R="middle",I=50,M="middle";Object.defineProperty(c,"id",i({},d,{get:function(){return f},set:function(D){f=""+D}})),Object.defineProperty(c,"pauseOnExit",i({},d,{get:function(){return m},set:function(D){m=!!D}})),Object.defineProperty(c,"startTime",i({},d,{get:function(){return h},set:function(D){if(typeof D!="number")throw new TypeError("Start time must be set to a number.");h=D,this.hasBeenReset=!0}})),Object.defineProperty(c,"endTime",i({},d,{get:function(){return p},set:function(D){if(typeof D!="number")throw new TypeError("End time must be set to a number.");p=D,this.hasBeenReset=!0}})),Object.defineProperty(c,"text",i({},d,{get:function(){return y},set:function(D){y=""+D,this.hasBeenReset=!0}})),Object.defineProperty(c,"region",i({},d,{get:function(){return g},set:function(D){g=D,this.hasBeenReset=!0}})),Object.defineProperty(c,"vertical",i({},d,{get:function(){return v},set:function(D){const F=r(D);if(F===!1)throw new SyntaxError("An invalid or illegal string was specified.");v=F,this.hasBeenReset=!0}})),Object.defineProperty(c,"snapToLines",i({},d,{get:function(){return x},set:function(D){x=!!D,this.hasBeenReset=!0}})),Object.defineProperty(c,"line",i({},d,{get:function(){return L},set:function(D){if(typeof D!="number"&&D!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");L=D,this.hasBeenReset=!0}})),Object.defineProperty(c,"lineAlign",i({},d,{get:function(){return T},set:function(D){const F=s(D);if(!F)throw new SyntaxError("An invalid or illegal string was specified.");T=F,this.hasBeenReset=!0}})),Object.defineProperty(c,"position",i({},d,{get:function(){return A},set:function(D){if(D<0||D>100)throw new Error("Position must be between 0 and 100.");A=D,this.hasBeenReset=!0}})),Object.defineProperty(c,"positionAlign",i({},d,{get:function(){return R},set:function(D){const F=s(D);if(!F)throw new SyntaxError("An invalid or illegal string was specified.");R=F,this.hasBeenReset=!0}})),Object.defineProperty(c,"size",i({},d,{get:function(){return I},set:function(D){if(D<0||D>100)throw new Error("Size must be between 0 and 100.");I=D,this.hasBeenReset=!0}})),Object.defineProperty(c,"align",i({},d,{get:function(){return M},set:function(D){const F=s(D);if(!F)throw new SyntaxError("An invalid or illegal string was specified.");M=F,this.hasBeenReset=!0}})),c.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o}();class DL{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function s0(n){function e(r,s,i,o){return(r|0)*3600+(s|0)*60+(i|0)+parseFloat(o||0)}const t=n.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class kL{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,r){for(let s=0;s<r.length;++s)if(t===r[s]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}}function i0(n,e,t,r){const s=r?n.split(r):[n];for(const i in s){if(typeof s[i]!="string")continue;const o=s[i].split(t);if(o.length!==2)continue;const a=o[0],l=o[1];e(a,l)}}const gu=new Fc(0,0,""),Ti=gu.align==="middle"?"middle":"center";function bL(n,e,t){const r=n;function s(){const a=s0(n);if(a===null)throw new Error("Malformed timestamp: "+r);return n=n.replace(/^[^\sa-zA-Z-]+/,""),a}function i(a,l){const u=new kL;i0(a,function(f,m){let h;switch(f){case"region":for(let p=t.length-1;p>=0;p--)if(t[p].id===m){u.set(f,t[p].region);break}break;case"vertical":u.alt(f,m,["rl","lr"]);break;case"line":h=m.split(","),u.integer(f,h[0]),u.percent(f,h[0])&&u.set("snapToLines",!1),u.alt(f,h[0],["auto"]),h.length===2&&u.alt("lineAlign",h[1],["start",Ti,"end"]);break;case"position":h=m.split(","),u.percent(f,h[0]),h.length===2&&u.alt("positionAlign",h[1],["start",Ti,"end","line-left","line-right","auto"]);break;case"size":u.percent(f,m);break;case"align":u.alt(f,m,["start",Ti,"end","left","right"]);break}},/:/,/\s/),l.region=u.get("region",null),l.vertical=u.get("vertical","");let c=u.get("line","auto");c==="auto"&&gu.line===-1&&(c=-1),l.line=c,l.lineAlign=u.get("lineAlign","start"),l.snapToLines=u.get("snapToLines",!0),l.size=u.get("size",100),l.align=u.get("align",Ti);let d=u.get("position","auto");d==="auto"&&gu.position===50&&(d=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=d}function o(){n=n.replace(/^\s+/,"")}if(o(),e.startTime=s(),o(),n.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+r);n=n.slice(3),o(),e.endTime=s(),o(),i(n,e)}function o0(n){return n.replace(/<br(?: \/)?>/gi,`
`)}class _L{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new DL,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function r(){let i=t.buffer,o=0;for(i=o0(i);o<i.length&&i[o]!=="\r"&&i[o]!==`
`;)++o;const a=i.slice(0,o);return i[o]==="\r"&&++o,i[o]===`
`&&++o,t.buffer=i.slice(o),a}function s(i){i0(i,function(o,a){},/:/)}try{let i="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;i=r();const a=i.match(/^()?WEBVTT([ \t].*)?$/);if(!(a!=null&&a[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let o=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:i=r(),t.state){case"HEADER":/:/.test(i)?s(i):i||(t.state="ID");continue;case"NOTE":i||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){t.state="NOTE";break}if(!i)continue;if(t.cue=new Fc(0,0,""),t.state="CUE",i.indexOf("-->")===-1){t.cue.id=i;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{bL(i,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const a=i.indexOf("-->")!==-1;if(!i||a&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=i}continue;case"BADCUE":i||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const PL=/\r\n|\n\r|\n|\r/g,qa=function(e,t,r=0){return e.slice(r,r+t.length)===t},NL=function(e){let t=parseInt(e.slice(-3));const r=parseInt(e.slice(-6,-4)),s=parseInt(e.slice(-9,-7)),i=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!G(t)||!G(r)||!G(s)||!G(i))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*r,t+=60*1e3*s,t+=60*60*1e3*i,t},Xa=function(e){let t=5381,r=e.length;for(;r;)t=t*33^e.charCodeAt(--r);return(t>>>0).toString()};function Mc(n,e,t){return Xa(n.toString())+Xa(e.toString())+Xa(t)}const OL=function(e,t,r){let s=e[t],i=e[s.prevCC];if(!i||!i.new&&s.new){e.ccOffset=e.presentationOffset=s.start,s.new=!1;return}for(;(o=i)!=null&&o.new;){var o;e.ccOffset+=s.start-i.start,s.new=!1,s=i,i=e[s.prevCC]}e.presentationOffset=r};function FL(n,e,t,r,s,i,o){const a=new _L,l=Kt(new Uint8Array(n)).trim().replace(PL,`
`).split(`
`),u=[],c=e?Z1(e.baseTime,e.timescale):0;let d="00:00.000",f=0,m=0,h,p=!0;a.oncue=function(y){const g=t[r];let v=t.ccOffset;const x=(f-c)/9e4;if(g!=null&&g.new&&(m!==void 0?v=t.ccOffset=g.start:OL(t,r,x)),x){if(!e){h=new Error("Missing initPTS for VTT MPEGTS");return}v=x-t.presentationOffset}const L=y.endTime-y.startTime,T=ft((y.startTime+v-m)*9e4,s*9e4)/9e4;y.startTime=Math.max(T,0),y.endTime=Math.max(T+L,0);const A=y.text.trim();y.text=decodeURIComponent(encodeURIComponent(A)),y.id||(y.id=Mc(y.startTime,y.endTime,A)),y.endTime>0&&u.push(y)},a.onparsingerror=function(y){h=y},a.onflush=function(){if(h){o(h);return}i(u)},l.forEach(y=>{if(p)if(qa(y,"X-TIMESTAMP-MAP=")){p=!1,y.slice(16).split(",").forEach(g=>{qa(g,"LOCAL:")?d=g.slice(6):qa(g,"MPEGTS:")&&(f=parseInt(g.slice(7)))});try{m=NL(d)/1e3}catch(g){h=g}return}else y===""&&(p=!1);a.parse(y+`
`)}),a.flush()}const Qa="stpp.ttml.im1t",a0=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,l0=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,ML={left:"start",center:"center",right:"end",start:"start",end:"end"};function ah(n,e,t,r){const s=J(new Uint8Array(n),["mdat"]);if(s.length===0){r(new Error("Could not parse IMSC1 mdat"));return}const i=s.map(a=>Kt(a)),o=J1(e.baseTime,1,e.timescale);try{i.forEach(a=>t(UL(a,o)))}catch(a){r(a)}}function UL(n,e){const s=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("tt")[0];if(!s)throw new Error("Invalid ttml");const i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(i).reduce((d,f)=>(d[f]=s.getAttribute(`ttp:${f}`)||i[f],d),{}),a=s.getAttribute("xml:space")!=="preserve",l=lh(Ja(s,"styling","style")),u=lh(Ja(s,"layout","region")),c=Ja(s,"body","[begin]");return[].map.call(c,d=>{const f=u0(d,a);if(!f||!d.hasAttribute("begin"))return null;const m=el(d.getAttribute("begin"),o),h=el(d.getAttribute("dur"),o);let p=el(d.getAttribute("end"),o);if(m===null)throw uh(d);if(p===null){if(h===null)throw uh(d);p=m+h}const y=new Fc(m-e,p-e,f);y.id=Mc(y.startTime,y.endTime,y.text);const g=u[d.getAttribute("region")],v=l[d.getAttribute("style")],x=BL(g,v,l),{textAlign:L}=x;if(L){const T=ML[L];T&&(y.lineAlign=T),y.align=L}return Ae(y,x),y}).filter(d=>d!==null)}function Ja(n,e,t){const r=n.getElementsByTagName(e)[0];return r?[].slice.call(r.querySelectorAll(t)):[]}function lh(n){return n.reduce((e,t)=>{const r=t.getAttribute("xml:id");return r&&(e[r]=t),e},{})}function u0(n,e){return[].slice.call(n.childNodes).reduce((t,r,s)=>{var i;return r.nodeName==="br"&&s?t+`
`:(i=r.childNodes)!=null&&i.length?u0(r,e):e?t+r.textContent.trim().replace(/\s+/g," "):t+r.textContent},"")}function BL(n,e,t){const r="http://www.w3.org/ns/ttml#styling";let s=null;const i=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=n!=null&&n.hasAttribute("style")?n.getAttribute("style"):null;return o&&t.hasOwnProperty(o)&&(s=t[o]),i.reduce((a,l)=>{const u=Za(e,r,l)||Za(n,r,l)||Za(s,r,l);return u&&(a[l]=u),a},{})}function Za(n,e,t){return n&&n.hasAttributeNS(e,t)?n.getAttributeNS(e,t):null}function uh(n){return new Error(`Could not parse ttml timestamp ${n}`)}function el(n,e){if(!n)return null;let t=s0(n);return t===null&&(a0.test(n)?t=$L(n,e):l0.test(n)&&(t=jL(n,e))),t}function $L(n,e){const t=a0.exec(n),r=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+r/e.frameRate}function jL(n,e){const t=l0.exec(n),r=Number(t[1]);switch(t[2]){case"h":return r*3600;case"m":return r*60;case"ms":return r*1e3;case"f":return r/e.frameRate;case"t":return r/e.tickRate}return r}class GL{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=dh(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(E.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(E.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(E.FRAG_LOADING,this.onFragLoading,this),e.on(E.FRAG_LOADED,this.onFragLoaded,this),e.on(E.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(E.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(E.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(E.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(E.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(E.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(E.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(E.FRAG_LOADING,this.onFragLoading,this),e.off(E.FRAG_LOADED,this.onFragLoaded,this),e.off(E.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(E.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(E.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(E.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(E.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){if(this.config.enableCEA708Captions&&(!this.cea608Parser1||!this.cea608Parser2)){const e=new Si(this,"textTrack1"),t=new Si(this,"textTrack2"),r=new Si(this,"textTrack3"),s=new Si(this,"textTrack4");this.cea608Parser1=new oh(1,e,t),this.cea608Parser2=new oh(3,r,s)}}addCues(e,t,r,s,i){let o=!1;for(let a=i.length;a--;){const l=i[a],u=HL(l[0],l[1],t,r);if(u>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],r),o=!0,u/(r-t)>.5))return}if(o||i.push([t,r]),this.config.renderTextTracksNatively){const a=this.captionsTracks[e];this.Cues.newCue(a,t,r,s)}else{const a=this.Cues.newCue(null,t,r,s);this.hls.trigger(E.CUES_PARSED,{type:"captions",cues:a,track:e})}}onInitPtsFound(e,{frag:t,id:r,initPTS:s,timescale:i}){const{unparsedVttFrags:o}=this;r==="main"&&(this.initPTS[t.cc]={baseTime:s,timescale:i}),o.length&&(this.unparsedVttFrags=[],o.forEach(a=>{this.onFragLoaded(E.FRAG_LOADED,a)}))}getExistingTrack(e,t){const{media:r}=this;if(r)for(let s=0;s<r.textTracks.length;s++){const i=r.textTracks[s];if(ch(i,{name:e,lang:t,attrs:{}}))return i}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:r,media:s}=this,{label:i,languageCode:o}=t[e],a=this.getExistingTrack(i,o);if(a)r[e]=a,Sr(r[e]),Dg(r[e],s);else{const l=this.createTextTrack("captions",i,o);l&&(l[e]=!0,r[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const r=t.label,s={_id:e,label:r,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(E.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(e,t,r){const s=this.media;if(s)return s.addTextTrack(e,t,r)}onMediaAttaching(e,t){this.media=t.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:e}=this;Object.keys(e).forEach(t=>{Sr(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=dh(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let r=0;r<t.length;r++)Sr(t[r])}onSubtitleTracksUpdated(e,t){const r=t.subtitleTracks||[],s=r.some(i=>i.textCodec===Qa);if(this.config.enableWebVTT||s&&this.config.enableIMSC1){if(t0(this.tracks,r)){this.tracks=r;return}if(this.textTracks=[],this.tracks=r,this.config.renderTextTracksNatively){const o=this.media,a=o?Bi(o.textTracks):null;if(this.tracks.forEach((l,u)=>{let c;if(a){let d=null;for(let f=0;f<a.length;f++)if(a[f]&&ch(a[f],l)){d=a[f],a[f]=null;break}d&&(c=d)}if(c)Sr(c);else{const d=c0(l);c=this.createTextTrack(d,l.name,l.lang),c&&(c.mode="disabled")}c&&this.textTracks.push(c)}),a!=null&&a.length){const l=a.filter(u=>u!==null).map(u=>u.label);l.length&&w.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(a=>({label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}));this.hls.trigger(E.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(r=>{const s=/(?:CC|SERVICE)([1-4])/.exec(r.instreamId);if(!s)return;const i=`textTrack${s[1]}`,o=this.captionsProperties[i];o&&(o.label=r.name,r.lang&&(o.languageCode=r.lang),o.media=r)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===W.MAIN){var r,s;const{cea608Parser1:i,cea608Parser2:o,lastSn:a}=this,{cc:l,sn:u}=t.frag,c=(r=(s=t.part)==null?void 0:s.index)!=null?r:-1;i&&o&&(u!==a+1||u===a&&c!==this.lastPartIndex+1||l!==this.lastCc)&&(i.reset(),o.reset()),this.lastCc=l,this.lastSn=u,this.lastPartIndex=c}}onFragLoaded(e,t){const{frag:r,payload:s}=t;if(r.type===W.SUBTITLE)if(s.byteLength){const i=r.decryptdata,o="stats"in t;if(i==null||!i.encrypted||o){const a=this.tracks[r.level],l=this.vttCCs;l[r.cc]||(l[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),a&&a.textCodec===Qa?this._parseIMSC1(r,s):this._parseVTTs(t)}}else this.hls.trigger(E.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const r=this.hls;ah(t,this.initPTS[e.cc],s=>{this._appendCues(s,e.level),r.trigger(E.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},s=>{w.log(`Failed to parse IMSC1: ${s}`),r.trigger(E.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:s})})}_parseVTTs(e){var t;const{frag:r,payload:s}=e,{initPTS:i,unparsedVttFrags:o}=this,a=i.length-1;if(!i[r.cc]&&a===-1){o.push(e);return}const l=this.hls,u=(t=r.initSegment)!=null&&t.data?Et(r.initSegment.data,new Uint8Array(s)):s;FL(u,this.initPTS[r.cc],this.vttCCs,r.cc,r.start,c=>{this._appendCues(c,r.level),l.trigger(E.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},c=>{const d=c.message==="Missing initPTS for VTT MPEGTS";d?o.push(e):this._fallbackToIMSC1(r,s),w.log(`Failed to parse VTT cue: ${c}`),!(d&&a>r.cc)&&l.trigger(E.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:c})})}_fallbackToIMSC1(e,t){const r=this.tracks[e.level];r.textCodec||ah(t,this.initPTS[e.cc],()=>{r.textCodec=Qa,this._parseIMSC1(e,t)},()=>{r.textCodec="wvtt"})}_appendCues(e,t){const r=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[t];if(!s||s.mode==="disabled")return;e.forEach(i=>kg(s,i))}else{const s=this.tracks[t];if(!s)return;const i=s.default?"default":"subtitles"+t;r.trigger(E.CUES_PARSED,{type:"subtitles",cues:e,track:i})}}onFragDecrypted(e,t){const{frag:r}=t;r.type===W.SUBTITLE&&this.onFragLoaded(E.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){this.initCea608Parsers();const{cea608Parser1:r,cea608Parser2:s}=this;if(!this.enabled||!r||!s)return;const{frag:i,samples:o}=t;if(!(i.type===W.MAIN&&this.closedCaptionsForLevel(i)==="NONE"))for(let a=0;a<o.length;a++){const l=o[a].bytes;if(l){const u=this.extractCea608Data(l);r.addData(o[a].pts,u[0]),s.addData(o[a].pts,u[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:r,endOffsetSubtitles:s,type:i}){const{media:o}=this;if(!(!o||o.currentTime<r)){if(!i||i==="video"){const{captionsTracks:a}=this;Object.keys(a).forEach(l=>uu(a[l],t,r))}if(this.config.renderTextTracksNatively&&t===0&&s!==void 0){const{textTracks:a}=this;Object.keys(a).forEach(l=>uu(a[l],t,s))}}}extractCea608Data(e){const t=[[],[]],r=e[0]&31;let s=2;for(let i=0;i<r;i++){const o=e[s++],a=127&e[s++],l=127&e[s++];if(a===0&&l===0)continue;if((4&o)!==0){const c=3&o;(c===0||c===1)&&(t[c].push(a),t[c].push(l))}}return t}}function c0(n){return n.characteristics&&/transcribes-spoken-dialog/gi.test(n.characteristics)&&/describes-music-and-sound/gi.test(n.characteristics)?"captions":"subtitles"}function ch(n,e){return!!n&&n.kind===c0(e)&&pu(e,n)}function HL(n,e,t,r){return Math.min(e,r)-Math.max(n,t)}function dh(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}class Uc{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(E.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(E.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(E.MANIFEST_PARSED,this.onManifestParsed,this),e.on(E.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(E.BUFFER_CODECS,this.onBufferCodecs,this),e.on(E.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(E.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(E.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(E.MANIFEST_PARSED,this.onManifestParsed,this),e.off(E.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(E.BUFFER_CODECS,this.onBufferCodecs,this),e.off(E.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&G(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,r=this.getMaxLevel(e.length-1);r!==this.autoLevelCapping&&w.log(`Setting autoLevelCapping to ${r}: ${e[r].height}p@${e[r].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=r,t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const r=t.filter((s,i)=>this.isLevelAllowed(s)&&i<=e);return this.clientRect=null,Uc.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,!t.width&&!t.height&&(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return e}isLevelAllowed(e){return!this.restrictedLevels.some(r=>e.bitrate===r.bitrate&&e.width===r.width&&e.height===r.height)}static getMaxLevelByMediaSize(e,t,r){if(!(e!=null&&e.length))return-1;const s=(a,l)=>l?a.width!==l.width||a.height!==l.height:!0;let i=e.length-1;const o=Math.max(t,r);for(let a=0;a<e.length;a+=1){const l=e[a];if((l.width>=o||l.height>=o)&&s(l,e[a+1])){i=a;break}}return i}}class VL{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(E.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(E.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const r=this.hls.config;if(r.capLevelOnFPSDrop){const s=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=s,s&&typeof s.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}checkFPS(e,t,r){const s=performance.now();if(t){if(this.lastTime){const i=s-this.lastTime,o=r-this.lastDroppedFrames,a=t-this.lastDecodedFrames,l=1e3*o/i,u=this.hls;if(u.trigger(E.FPS_DROP,{currentDropped:o,currentDecoded:a,totalDroppedFrames:r}),l>0&&o>u.config.fpsDroppedMonitoringThreshold*a){let c=u.currentLevel;w.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=c)&&(c=c-1,u.trigger(E.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:u.currentLevel}),u.autoLevelCapping=c,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}const Li="[eme]";class Dr{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=Dr.CDMCleanupPromise?[Dr.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=w.debug.bind(w,Li),this.log=w.log.bind(w,Li),this.warn=w.warn.bind(w,Li),this.error=w.error.bind(w,Li),this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(E.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(E.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(E.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(E.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(E.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(E.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(E.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(E.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:r}=this.config,s=t[e];if(s)return s.licenseUrl;if(e===me.WIDEVINE&&r)return r;throw new Error(`no license server URL configured for key-system "${e}"`)}getServerCertificateUrl(e){const{drmSystems:t}=this.config,r=t[e];if(r)return r.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,r=(o,a,l)=>!!o&&l.indexOf(o)===a,s=t.map(o=>o.audioCodec).filter(r),i=t.map(o=>o.videoCodec).filter(r);return s.length+i.length===0&&i.push("avc1.42e01e"),new Promise((o,a)=>{const l=u=>{const c=u.shift();this.getMediaKeysPromise(c,s,i).then(d=>o({keySystem:c,mediaKeys:d})).catch(d=>{u.length?l(u):d instanceof dt?a(d):a(new dt({type:q.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_NO_ACCESS,error:d,fatal:!0},d.message))})};l(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:r}=this.config;if(typeof r!="function"){let s=`Configured requestMediaKeySystemAccess is not a function ${r}`;return gg===null&&self.location.protocol==="http:"&&(s=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(s))}return r(e,t)}getMediaKeysPromise(e,t,r){const s=QS(e,t,r,this.config.drmSystemOptions),i=this.keySystemAccessPromises[e];let o=i==null?void 0:i.keySystemAccess;if(!o){this.log(`Requesting encrypted media "${e}" key-system access with config: ${JSON.stringify(s)}`),o=this.requestMediaKeySystemAccess(e,s);const a=this.keySystemAccessPromises[e]={keySystemAccess:o};return o.catch(l=>{this.log(`Failed to obtain access to key-system "${e}": ${l}`)}),o.then(l=>{this.log(`Access for key-system "${l.keySystem}" obtained`);const u=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),a.mediaKeys=l.createMediaKeys().then(c=>(this.log(`Media-keys created for "${e}"`),u.then(d=>d?this.setMediaKeysServerCertificate(c,e,d):c))),a.mediaKeys.catch(c=>{this.error(`Failed to create media-keys for "${e}"}: ${c}`)}),a.mediaKeys})}return o.then(()=>i.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:r}){this.log(`Creating key-system session "${t}" keyId: ${Mt.hexDump(e.keyId||[])}`);const s=r.createSession(),i={decryptdata:e,keySystem:t,mediaKeys:r,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(i),i}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const r=this.createMediaKeySessionContext(e),s=this.getKeyIdString(t),i="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(r,i,t.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return Mt.hexDump(e.keyId)}updateKeySession(e,t){var r;const s=e.mediaKeysSession;return this.log(`Updating key-session "${s.sessionId}" for keyID ${Mt.hexDump(((r=e.decryptdata)==null?void 0:r.keyId)||[])}
      } (data length: ${t&&t.byteLength})`),s.update(t)}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){return new Promise((t,r)=>{const s=Fa(this.config),i=e.map(vf).filter(o=>!!o&&s.indexOf(o)!==-1);return this.getKeySystemSelectionPromise(i).then(({keySystem:o})=>{const a=xf(o);a?t(a):r(new Error(`Unable to find format for key-system "${o}"`))}).catch(r)})}loadKey(e){const t=e.keyInfo.decryptdata,r=this.getKeyIdString(t),s=`(keyId: ${r} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${s}`);let i=this.keyIdToKeySessionPromise[r];return i||(i=this.keyIdToKeySessionPromise[r]=this.getKeySystemForKeyPromise(t).then(({keySystem:o,mediaKeys:a})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${s}`),this.attemptSetMediaKeys(o,a).then(()=>{this.throwIfDestroyed();const l=this.createMediaKeySessionContext({keySystem:o,mediaKeys:a,decryptdata:t});return this.generateRequestWithPreferredKeySession(l,"cenc",t.pssh,"playlist-key")}))),i.catch(o=>this.handleError(o))),i}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof dt?this.hls.trigger(E.ERROR,e.data):this.hls.trigger(E.ERROR,{type:q.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),r=this.keyIdToKeySessionPromise[t];if(!r){const s=vf(e.keyFormat),i=s?[s]:Fa(this.config);return this.attemptKeySystemAccess(i)}return r}getKeySystemSelectionPromise(e){if(e.length||(e=Fa(this.config)),e.length===0)throw new dt({type:q.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}_onMediaEncrypted(e){const{initDataType:t,initData:r}=e;if(this.debug(`"${e.type}" event: init data type: "${t}"`),r===null)return;let s,i;if(t==="sinf"&&this.config.drmSystems[me.FAIRPLAY]){const c=we(new Uint8Array(r));try{const d=Lc(JSON.parse(c).sinf),f=Rg(new Uint8Array(d));if(!f)return;s=f.subarray(8,24),i=me.FAIRPLAY}catch{this.warn('Failed to parse sinf "encrypted" event message initData');return}}else{const c=TT(r);if(c===null)return;c.version===0&&c.systemId===pg.WIDEVINE&&c.data&&(s=c.data.subarray(8,24)),i=XS(c.systemId)}if(!i||!s)return;const o=Mt.hexDump(s),{keyIdToKeySessionPromise:a,mediaKeySessions:l}=this;let u=a[o];for(let c=0;c<l.length;c++){const d=l[c],f=d.decryptdata;if(f.pssh||!f.keyId)continue;const m=Mt.hexDump(f.keyId);if(o===m||f.uri.replace(/-/g,"").indexOf(o)!==-1){u=a[m],delete a[m],f.pssh=new Uint8Array(r),f.keyId=s,u=a[o]=u.then(()=>this.generateRequestWithPreferredKeySession(d,t,r,"encrypted-event-key-match"));break}}u||(u=a[o]=this.getKeySystemSelectionPromise([i]).then(({keySystem:c,mediaKeys:d})=>{var f;this.throwIfDestroyed();const m=new $s("ISO-23001-7",o,(f=xf(c))!=null?f:"");return m.pssh=new Uint8Array(r),m.keyId=s,this.attemptSetMediaKeys(c,d).then(()=>{this.throwIfDestroyed();const h=this.createMediaKeySessionContext({decryptdata:m,keySystem:c,mediaKeys:d});return this.generateRequestWithPreferredKeySession(h,t,r,"encrypted-event-no-match")})})),u.catch(c=>this.handleError(c))}_onWaitingForKey(e){this.log(`"${e.type}" event`)}attemptSetMediaKeys(e,t){const r=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const s=Promise.all(r).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.setMediaKeysQueue.push(s),s.then(()=>{this.log(`Media-keys set for "${e}"`),r.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(i=>r.indexOf(i)===-1)})}generateRequestWithPreferredKeySession(e,t,r,s){var i,o;const a=(i=this.config.drmSystems)==null||(o=i[e.keySystem])==null?void 0:o.generateRequest;if(a)try{const h=a.call(this.hls,t,r,e);if(!h)throw new Error("Invalid response from configured generateRequest filter");t=h.initDataType,r=e.decryptdata.pssh=h.initData?new Uint8Array(h.initData):null}catch(h){var l;if(this.warn(h.message),(l=this.hls)!=null&&l.config.debug)throw h}if(r===null)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(e);const u=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${s}": ${u} (init data type: ${t} length: ${r?r.byteLength:null})`);const c=new Oc,d=e._onmessage=h=>{const p=e.mediaKeysSession;if(!p){c.emit("error",new Error("invalid state"));return}const{messageType:y,message:g}=h;this.log(`"${y}" message event for session "${p.sessionId}" message size: ${g.byteLength}`),y==="license-request"||y==="license-renewal"?this.renewLicense(e,g).catch(v=>{this.handleError(v),c.emit("error",v)}):y==="license-release"?e.keySystem===me.FAIRPLAY&&(this.updateKeySession(e,au("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${y}"`)},f=e._onkeystatuseschange=h=>{if(!e.mediaKeysSession){c.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(e);const y=e.keyStatus;c.emit("keyStatus",y),y==="expired"&&(this.warn(`${e.keySystem} expired for key ${u}`),this.renewKeySession(e))};e.mediaKeysSession.addEventListener("message",d),e.mediaKeysSession.addEventListener("keystatuseschange",f);const m=new Promise((h,p)=>{c.on("error",p),c.on("keyStatus",y=>{y.startsWith("usable")?h():y==="output-restricted"?p(new dt({type:q.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):y==="internal-error"?p(new dt({type:q.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${y}"`)):y==="expired"?p(new Error("key expired while generating request")):this.warn(`unhandled key status change "${y}"`)})});return e.mediaKeysSession.generateRequest(t,r).then(()=>{var h;this.log(`Request generated for key-session "${(h=e.mediaKeysSession)==null?void 0:h.sessionId}" keyId: ${u}`)}).catch(h=>{throw new dt({type:q.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_NO_SESSION,error:h,fatal:!1},`Error generating key-session request: ${h}`)}).then(()=>m).catch(h=>{throw c.removeAllListeners(),this.removeSession(e),h}).then(()=>(c.removeAllListeners(),e))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach((t,r)=>{this.log(`key status change "${t}" for keyStatuses keyId: ${Mt.hexDump("buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r))} session keyId: ${Mt.hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t})}fetchServerCertificate(e){const t=this.config,r=t.loader,s=new r(t),i=this.getServerCertificateUrl(e);return i?(this.log(`Fetching server certificate for "${e}"`),new Promise((o,a)=>{const l={responseType:"arraybuffer",url:i},u=t.certLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,m,h,p)=>{o(f.data)},onError:(f,m,h,p)=>{a(new dt({type:q.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:h,response:Pe({url:l.url,data:void 0},f)},`"${e}" certificate request failed (${i}). Status: ${f.code} (${f.text})`))},onTimeout:(f,m,h)=>{a(new dt({type:q.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:h,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${i})`))},onAbort:(f,m,h)=>{a(new Error("aborted"))}};s.load(l,c,d)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,r){return new Promise((s,i)=>{e.setServerCertificate(r).then(o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${r==null?void 0:r.byteLength}) on "${t}"`),s(e)}).catch(o=>{i(new dt({type:q.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:o,fatal:!0},o.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(r=>this.updateKeySession(e,new Uint8Array(r)).catch(s=>{throw new dt({type:q.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:s,fatal:!0},s.message)}))}unpackPlayReadyKeyMessage(e,t){const r=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!r.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const s=new DOMParser().parseFromString(r,"application/xml"),i=s.querySelectorAll("HttpHeader");if(i.length>0){let c;for(let d=0,f=i.length;d<f;d++){var o,a;c=i[d];const m=(o=c.querySelector("name"))==null?void 0:o.textContent,h=(a=c.querySelector("value"))==null?void 0:a.textContent;m&&h&&e.setRequestHeader(m,h)}}const l=s.querySelector("Challenge"),u=l==null?void 0:l.textContent;if(!u)throw new Error("Cannot find <Challenge> in key message");return au(atob(u))}setupLicenseXHR(e,t,r,s){const i=this.config.licenseXhrSetup;return i?Promise.resolve().then(()=>{if(!r.decryptdata)throw new Error("Key removed");return i.call(this.hls,e,t,r,s)}).catch(o=>{if(!r.decryptdata)throw o;return e.open("POST",t,!0),i.call(this.hls,e,t,r,s)}).then(o=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:o||s})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:s}))}requestLicense(e,t){const r=this.config.keyLoadPolicy.default;return new Promise((s,i)=>{const o=this.getLicenseServerUrl(e.keySystem);this.log(`Sending license request to URL: ${o}`);const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return i(new Error("invalid state"));if(a.readyState===4)if(a.status===200){this._requestLicenseFailureCount=0;let l=a.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const u=this.config.licenseResponseCallback;if(u)try{l=u.call(this.hls,a,o,e)}catch(c){this.error(c)}s(l)}else{const l=r.errorRetry,u=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>u||a.status>=400&&a.status<500)i(new dt({type:q.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:a,response:{url:o,data:void 0,code:a.status,text:a.statusText}},`License Request XHR failed (${o}). Status: ${a.status} (${a.statusText})`));else{const c=u-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${c} attempts left`),this.requestLicense(e,t).then(s,i)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=a,this.setupLicenseXHR(a,o,e,t).then(({xhr:l,licenseChallenge:u})=>{e.keySystem==me.PLAYREADY&&(u=this.unpackPlayReadyKeyMessage(l,u)),l.send(u)})})}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const r=t.media;this.media=r,r.addEventListener("encrypted",this.onMediaEncrypted),r.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media,t=this.mediaKeySessions;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},$s.clearKeyUriToKeyIdMap();const r=t.length;Dr.CDMCleanupPromise=Promise.all(t.map(s=>this.removeSession(s)).concat(e==null?void 0:e.setMediaKeys(null).catch(s=>{this.log(`Could not clear media keys: ${s}`)}))).then(()=>{r&&(this.log("finished closing key sessions and clearing media keys"),t.length=0)}).catch(s=>{this.log(`Could not close sessions and clear media keys: ${s}`)})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const r=t.reduce((s,i)=>(s.indexOf(i.keyFormat)===-1&&s.push(i.keyFormat),s),[]);this.log(`Selecting key-system from session-keys ${r.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(r)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:r}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const s=this.mediaKeySessions.indexOf(e);return s>-1&&this.mediaKeySessions.splice(s,1),t.remove().catch(i=>{this.log(`Could not remove session: ${i}`)}).then(()=>t.close()).catch(i=>{this.log(`Could not close session: ${i}`)})}}}Dr.CDMCleanupPromise=void 0;class dt extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}var Ge;(function(n){n.MANIFEST="m",n.AUDIO="a",n.VIDEO="v",n.MUXED="av",n.INIT="i",n.CAPTION="c",n.TIMED_TEXT="tt",n.KEY="k",n.OTHER="o"})(Ge||(Ge={}));var yu;(function(n){n.DASH="d",n.HLS="h",n.SMOOTH="s",n.OTHER="o"})(yu||(yu={}));var Gn;(function(n){n.OBJECT="CMCD-Object",n.REQUEST="CMCD-Request",n.SESSION="CMCD-Session",n.STATUS="CMCD-Status"})(Gn||(Gn={}));const KL={[Gn.OBJECT]:["br","d","ot","tb"],[Gn.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[Gn.SESSION]:["cid","pr","sf","sid","st","v"],[Gn.STATUS]:["bs","rtp"]};class $r{constructor(e,t){this.value=void 0,this.params=void 0,Array.isArray(e)&&(e=e.map(r=>r instanceof $r?r:new $r(r))),this.value=e,this.params=t}}class d0{constructor(e){this.description=void 0,this.description=e}}const zL="Dict";function WL(n){return Array.isArray(n)?JSON.stringify(n):n instanceof Map?"Map{}":n instanceof Set?"Set{}":typeof n=="object"?JSON.stringify(n):String(n)}function YL(n,e,t,r){return new Error(`failed to ${n} "${WL(e)}" as ${t}`,{cause:r})}const fh="Bare Item",qL="Boolean",XL="Byte Sequence",QL="Decimal",JL="Integer";function ZL(n){return n<-999999999999999||999999999999999<n}const eR=/[\x00-\x1f\x7f]+/,tR="Token",nR="Key";function zt(n,e,t){return YL("serialize",n,e,t)}function rR(n){if(typeof n!="boolean")throw zt(n,qL);return n?"?1":"?0"}function sR(n){return btoa(String.fromCharCode(...n))}function iR(n){if(ArrayBuffer.isView(n)===!1)throw zt(n,XL);return`:${sR(n)}:`}function f0(n){if(ZL(n))throw zt(n,JL);return n.toString()}function oR(n){return`@${f0(n.getTime()/1e3)}`}function h0(n,e){if(n<0)return-h0(-n,e);const t=Math.pow(10,e);if(Math.abs(n*t%1-.5)<Number.EPSILON){const s=Math.floor(n*t);return(s%2===0?s:s+1)/t}else return Math.round(n*t)/t}function aR(n){const e=h0(n,3);if(Math.floor(Math.abs(e)).toString().length>12)throw zt(n,QL);const t=e.toString();return t.includes(".")?t:`${t}.0`}const lR="String";function uR(n){if(eR.test(n))throw zt(n,lR);return`"${n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function cR(n){return n.description||n.toString().slice(7,-1)}function hh(n){const e=cR(n);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw zt(e,tR);return e}function vu(n){switch(typeof n){case"number":if(!G(n))throw zt(n,fh);return Number.isInteger(n)?f0(n):aR(n);case"string":return uR(n);case"symbol":return hh(n);case"boolean":return rR(n);case"object":if(n instanceof Date)return oR(n);if(n instanceof Uint8Array)return iR(n);if(n instanceof d0)return hh(n);default:throw zt(n,fh)}}function xu(n){if(/^[a-z*][a-z0-9\-_.*]*$/.test(n)===!1)throw zt(n,nR);return n}function Bc(n){return n==null?"":Object.entries(n).map(([e,t])=>t===!0?`;${xu(e)}`:`;${xu(e)}=${vu(t)}`).join("")}function m0(n){return n instanceof $r?`${vu(n.value)}${Bc(n.params)}`:vu(n)}function dR(n){return`(${n.value.map(m0).join(" ")})${Bc(n.params)}`}function fR(n,e={whitespace:!0}){if(typeof n!="object")throw zt(n,zL);const t=n instanceof Map?n.entries():Object.entries(n),r=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([s,i])=>{i instanceof $r||(i=new $r(i));let o=xu(s);return i.value===!0?o+=Bc(i.params):(o+="=",Array.isArray(i.value)?o+=dR(i):o+=m0(i)),o}).join(`,${r}`)}function hR(n,e){return fR(n,e)}const mR=n=>n==="ot"||n==="sf"||n==="st",pR=n=>typeof n=="number"?G(n):n!=null&&n!==""&&n!==!1;function gR(n,e){const t=new URL(n),r=new URL(e);if(t.origin!==r.origin)return n;const s=t.pathname.split("/").slice(1),i=r.pathname.split("/").slice(1,-1);for(;s[0]===i[0];)s.shift(),i.shift();for(;i.length;)i.shift(),s.unshift("..");return s.join("/")}function yR(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const i=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(s=="x"?i:i&3|8).toString(16)})}}}const Ki=n=>Math.round(n),vR=(n,e)=>(e!=null&&e.baseUrl&&(n=gR(n,e.baseUrl)),encodeURIComponent(n)),Ri=n=>Ki(n/100)*100,xR={br:Ki,d:Ki,bl:Ri,dl:Ri,mtp:Ri,nor:vR,rtp:Ri,tb:Ki};function ER(n,e){const t={};if(n==null||typeof n!="object")return t;const r=Object.keys(n).sort(),s=Ae({},xR,e==null?void 0:e.formatters),i=e==null?void 0:e.filter;return r.forEach(o=>{if(i!=null&&i(o))return;let a=n[o];const l=s[o];l&&(a=l(a,e)),!(o==="v"&&a===1)&&(o=="pr"&&a===1||pR(a)&&(mR(o)&&typeof a=="string"&&(a=new d0(a)),t[o]=a))}),t}function p0(n,e={}){return n?hR(ER(n,e),Ae({whitespace:!1},e)):""}function SR(n,e={}){if(!n)return{};const t=Object.entries(n),r=Object.entries(KL).concat(Object.entries((e==null?void 0:e.customHeaderMap)||{})),s=t.reduce((i,o)=>{var a,l;const[u,c]=o,d=((a=r.find(f=>f[1].includes(u)))==null?void 0:a[0])||Gn.REQUEST;return(l=i[d])!=null||(i[d]={}),i[d][u]=c,i},{});return Object.entries(s).reduce((i,[o,a])=>(i[o]=p0(a,e),i),{})}function TR(n,e,t){return Ae(n,SR(e,t))}const LR="CMCD";function RR(n,e={}){if(!n)return"";const t=p0(n,e);return`${LR}=${encodeURIComponent(t)}`}const mh=/CMCD=[^&#]+/;function AR(n,e,t){const r=RR(e,t);if(!r)return n;if(mh.test(n))return n.replace(mh,r);const s=n.includes("?")?"&":"?";return`${n}${s}${r}`}class wR{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=s=>{try{this.apply(s,{ot:Ge.MANIFEST,su:!this.initialized})}catch(i){w.warn("Could not generate manifest CMCD data.",i)}},this.applyFragmentData=s=>{try{const i=s.frag,o=this.hls.levels[i.level],a=this.getObjectType(i),l={d:i.duration*1e3,ot:a};(a===Ge.VIDEO||a===Ge.AUDIO||a==Ge.MUXED)&&(l.br=o.bitrate/1e3,l.tb=this.getTopBandwidth(a)/1e3,l.bl=this.getBufferLength(a)),this.apply(s,l)}catch(i){w.warn("Could not generate segment CMCD data.",i)}},this.hls=e;const t=this.config=e.config,{cmcd:r}=t;r!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||yR(),this.cid=r.contentId,this.useHeaders=r.useHeaders===!0,this.includeKeys=r.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(E.MEDIA_DETACHED,this.onMediaDetached,this),e.on(E.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(E.MEDIA_DETACHED,this.onMediaDetached,this),e.off(E.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var r,s;this.audioBuffer=(r=t.tracks.audio)==null?void 0:r.buffer,this.videoBuffer=(s=t.tracks.video)==null?void 0:s.buffer}createData(){var e;return{v:1,sf:yu.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Ae(t,this.createData());const r=t.ot===Ge.INIT||t.ot===Ge.VIDEO||t.ot===Ge.MUXED;this.starved&&r&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:s}=this;s&&(t=Object.keys(t).reduce((i,o)=>(s.includes(o)&&(i[o]=t[o]),i),{})),this.useHeaders?(e.headers||(e.headers={}),TR(e.headers,t)):e.url=AR(e.url,t)}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Ge.TIMED_TEXT;if(e.sn==="initSegment")return Ge.INIT;if(t==="audio")return Ge.AUDIO;if(t==="main")return this.hls.audioTracks.length?Ge.VIDEO:Ge.MUXED}getTopBandwidth(e){let t=0,r;const s=this.hls;if(e===Ge.AUDIO)r=s.audioTracks;else{const i=s.maxAutoLevel,o=i>-1?i+1:s.levels.length;r=s.levels.slice(0,o)}for(const i of r)i.bitrate>t&&(t=i.bitrate);return t>0?t:NaN}getBufferLength(e){const t=this.hls.media,r=e===Ge.AUDIO?this.audioBuffer:this.videoBuffer;return!r||!t?NaN:le.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,r=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new r(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,o,a){t(i),this.loader.load(i,o,a)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,r=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new r(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,o,a){t(i),this.loader.load(i,o,a)}}}}const CR=3e5;class IR{constructor(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=w.log.bind(w,"[content-steering]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(E.MANIFEST_PARSED,this.onManifestParsed,this),e.on(E.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(E.MANIFEST_PARSED,this.onManifestParsed,this),e.off(E.ERROR,this.onError,this))}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(r=>r!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:r}=t;r!==null&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:r}=t;if((r==null?void 0:r.action)===Fe.SendAlternateToPenaltyBox&&r.flags===Tt.MoveAllAlternatesMatchingHost){const s=this.levels;let i=this.pathwayPriority,o=this.pathwayId;if(t.context){const{groupId:a,pathwayId:l,type:u}=t.context;a&&s?o=this.getPathwayForGroupId(a,u,o):l&&(o=l)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!i&&s&&(i=s.reduce((a,l)=>(a.indexOf(l.pathwayId)===-1&&a.push(l.pathwayId),a),[])),i&&i.length>1&&(this.updatePathwayPriority(i),r.resolved=this.pathwayId!==o),r.resolved||w.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${o} levels: ${s&&s.length} priorities: ${JSON.stringify(i)} penalized: ${JSON.stringify(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const r=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${r}"`),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length?(this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t):e}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this.pathwayPriority=e;let t;const r=this.penalizedPathways,s=performance.now();Object.keys(r).forEach(i=>{s-r[i]>CR&&delete r[i]});for(let i=0;i<e.length;i++){const o=e[i];if(o in r)continue;if(o===this.pathwayId)return;const a=this.hls.nextLoadLevel,l=this.hls.levels[a];if(t=this.getLevelsForPathway(o),t.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,Ng(t),this.hls.trigger(E.LEVELS_UPDATED,{levels:t});const u=this.hls.levels[a];l&&u&&this.levels&&(u.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&u.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${u.bitrate}`),this.hls.nextLoadLevel=a);break}}}getPathwayForGroupId(e,t,r){const s=this.getLevelsForPathway(r).concat(this.levels||[]);for(let i=0;i<s.length;i++)if(t===re.AUDIO_TRACK&&s[i].hasAudioGroup(e)||t===re.SUBTITLE_TRACK&&s[i].hasSubtitleGroup(e))return s[i].pathwayId;return r}clonePathways(e){const t=this.levels;if(!t)return;const r={},s={};e.forEach(i=>{const{ID:o,"BASE-ID":a,"URI-REPLACEMENT":l}=i;if(t.some(c=>c.pathwayId===o))return;const u=this.getLevelsForPathway(a).map(c=>{const d=new pe(c.attrs);d["PATHWAY-ID"]=o;const f=d.AUDIO&&`${d.AUDIO}_clone_${o}`,m=d.SUBTITLES&&`${d.SUBTITLES}_clone_${o}`;f&&(r[d.AUDIO]=f,d.AUDIO=f),m&&(s[d.SUBTITLES]=m,d.SUBTITLES=m);const h=g0(c.uri,d["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),p=new Ur({attrs:d,audioCodec:c.audioCodec,bitrate:c.bitrate,height:c.height,name:c.name,url:h,videoCodec:c.videoCodec,width:c.width});if(c.audioGroups)for(let y=1;y<c.audioGroups.length;y++)p.addGroupId("audio",`${c.audioGroups[y]}_clone_${o}`);if(c.subtitleGroups)for(let y=1;y<c.subtitleGroups.length;y++)p.addGroupId("text",`${c.subtitleGroups[y]}_clone_${o}`);return p});t.push(...u),ph(this.audioTracks,r,l,o),ph(this.subtitleTracks,s,l,o)})}loadSteeringManifest(e){const t=this.hls.config,r=t.loader;this.loader&&this.loader.destroy(),this.loader=new r(t);let s;try{s=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(s.protocol!=="data:"){const c=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;s.searchParams.set("_HLS_pathway",this.pathwayId),s.searchParams.set("_HLS_throughput",""+c)}const i={responseType:"json",url:s.href},o=t.steeringManifestLoadPolicy.default,a=o.errorRetry||o.timeoutRetry||{},l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},u={onSuccess:(c,d,f,m)=>{this.log(`Loaded steering manifest: "${s}"`);const h=c.data;if(h.VERSION!==1){this.log(`Steering VERSION ${h.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=h.TTL;const{"RELOAD-URI":p,"PATHWAY-CLONES":y,"PATHWAY-PRIORITY":g}=h;if(p)try{this.uri=new self.URL(p,s).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${p}`);return}this.scheduleRefresh(this.uri||f.url),y&&this.clonePathways(y);const v={steeringManifest:h,url:s.toString()};this.hls.trigger(E.STEERING_MANIFEST_LOADED,v),g&&this.updatePathwayPriority(g)},onError:(c,d,f,m)=>{if(this.log(`Error loading steering manifest: ${c.code} ${c.text} (${d.url})`),this.stopLoad(),c.code===410){this.enabled=!1,this.log(`Steering manifest ${d.url} no longer available`);return}let h=this.timeToLoad*1e3;if(c.code===429){const p=this.loader;if(typeof(p==null?void 0:p.getResponseHeader)=="function"){const y=p.getResponseHeader("Retry-After");y&&(h=parseFloat(y)*1e3)}this.log(`Steering manifest ${d.url} rate limited`);return}this.scheduleRefresh(this.uri||d.url,h)},onTimeout:(c,d,f)=>{this.log(`Timeout loading steering manifest (${d.url})`),this.scheduleRefresh(this.uri||d.url)}};this.log(`Requesting steering manifest: ${s}`),this.loader.load(i,l,u)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var r;const s=(r=this.hls)==null?void 0:r.media;if(s&&!s.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function ph(n,e,t,r){n&&Object.keys(e).forEach(s=>{const i=n.filter(o=>o.groupId===s).map(o=>{const a=Ae({},o);return a.details=void 0,a.attrs=new pe(a.attrs),a.url=a.attrs.URI=g0(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),a.groupId=a.attrs["GROUP-ID"]=e[s],a.attrs["PATHWAY-ID"]=r,a});n.push(...i)})}function g0(n,e,t,r){const{HOST:s,PARAMS:i,[t]:o}=r;let a;e&&(a=o==null?void 0:o[e],a&&(n=a));const l=new self.URL(n);return s&&!a&&(l.host=s),i&&Object.keys(i).sort().forEach(u=>{u&&l.searchParams.set(u,i[u])}),l.href}const DR=/^age:\s*[\d.]+\s*$/im;class y0{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new ta,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const r=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0,s.aborted=!1;const i=this.xhrSetup;i?Promise.resolve().then(()=>{if(!(this.loader!==r||this.stats.aborted))return i(r,t.url)}).catch(o=>{if(!(this.loader!==r||this.stats.aborted))return r.open("GET",t.url,!0),i(r,t.url)}).then(()=>{this.loader!==r||this.stats.aborted||this.openAndSendXhr(r,t,e)}).catch(o=>{this.callbacks.onError({code:r.status,text:o.message},t,r,s)}):this.openAndSendXhr(r,t,e)}openAndSendXhr(e,t,r){e.readyState||e.open("GET",t.url,!0);const s=t.headers,{maxTimeToFirstByteMs:i,maxLoadTimeMs:o}=r.loadPolicy;if(s)for(const a in s)e.setRequestHeader(a,s[a]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=i&&G(i)?i:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:r}=this;if(!e||!t)return;const s=t.readyState,i=this.config;if(!r.aborted&&s>=2&&(r.loading.first===0&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),i.timeout!==i.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),i.timeout=i.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),s===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const o=t.status,a=t.responseType!=="text";if(o>=200&&o<300&&(a&&t.response||t.responseText!==null)){r.loading.end=Math.max(self.performance.now(),r.loading.first);const l=a?t.response:t.responseText,u=t.responseType==="arraybuffer"?l.byteLength:l.length;if(r.loaded=r.total=u,r.bwEstimate=r.total*8e3/(r.loading.end-r.loading.first),!this.callbacks)return;const c=this.callbacks.onProgress;if(c&&c(r,e,l,t),!this.callbacks)return;const d={url:t.responseURL,data:l,code:o};this.callbacks.onSuccess(d,r,e,t)}else{const l=i.loadPolicy.errorRetry,u=r.retry,c={url:e.url,data:void 0,code:o};Io(l,u,!1,c)?this.retry(l):(w.error(`${o} while loading ${e.url}`),this.callbacks.onError({code:o,text:t.statusText},e,t,r))}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(Io(e,t,!0))this.retry(e);else{var r;w.warn(`timeout while loading ${(r=this.context)==null?void 0:r.url}`);const s=this.callbacks;s&&(this.abortInternal(),s.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:r}=this;this.retryDelay=wc(e,r.retry),r.retry++,w.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${r.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&DR.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}function kR(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const bR=/(\d+)-(\d+)\/(\d+)/;class gh{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||OR,this.controller=new self.AbortController,this.stats=new ta}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,r){const s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();const i=_R(e,this.controller.signal),o=r.onProgress,a=e.responseType==="arraybuffer",l=a?"byteLength":"length",{maxTimeToFirstByteMs:u,maxLoadTimeMs:c}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,i),self.clearTimeout(this.requestTimeout),t.timeout=u&&G(u)?u:c,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),r.onTimeout(s,e,this.response)},t.timeout),self.fetch(this.request).then(d=>{this.response=this.loader=d;const f=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=c,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),r.onTimeout(s,e,this.response)},c-(f-s.loading.start)),!d.ok){const{status:m,statusText:h}=d;throw new FR(h||"fetch, bad network response",m,d)}return s.loading.first=f,s.total=NR(d.headers)||s.total,o&&G(t.highWaterMark)?this.loadProgressively(d,s,e,t.highWaterMark,o):a?d.arrayBuffer():e.responseType==="json"?d.json():d.text()}).then(d=>{const f=this.response;if(!f)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);const m=d[l];m&&(s.loaded=s.total=m);const h={url:f.url,data:d,code:f.status};o&&!G(t.highWaterMark)&&o(s,e,d,f),r.onSuccess(h,s,e,f)}).catch(d=>{if(self.clearTimeout(this.requestTimeout),s.aborted)return;const f=d&&d.code||0,m=d?d.message:null;r.onError({code:f,text:m},e,d?d.details:null,s)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,r,s=0,i){const o=new Ug,a=e.body.getReader(),l=()=>a.read().then(u=>{if(u.done)return o.dataLength&&i(t,r,o.flush(),e),Promise.resolve(new ArrayBuffer(0));const c=u.value,d=c.length;return t.loaded+=d,d<s||o.dataLength?(o.push(c),o.dataLength>=s&&i(t,r,o.flush(),e)):i(t,r,c,e),l()}).catch(()=>Promise.reject());return l()}}function _R(n,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Ae({},n.headers))};return n.rangeEnd&&t.headers.set("Range","bytes="+n.rangeStart+"-"+String(n.rangeEnd-1)),t}function PR(n){const e=bR.exec(n);if(e)return parseInt(e[2])-parseInt(e[1])+1}function NR(n){const e=n.get("Content-Range");if(e){const r=PR(e);if(G(r))return r}const t=n.get("Content-Length");if(t)return parseInt(t)}function OR(n,e){return new self.Request(n.url,e)}class FR extends Error{constructor(e,t,r){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=r}}const MR=/\s/,UR={newCue(n,e,t,r){const s=[];let i,o,a,l,u;const c=self.VTTCue||self.TextTrackCue;for(let f=0;f<r.rows.length;f++)if(i=r.rows[f],a=!0,l=0,u="",!i.isEmpty()){var d;for(let p=0;p<i.chars.length;p++)MR.test(i.chars[p].uchar)&&a?l++:(u+=i.chars[p].uchar,a=!1);i.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;const m=o0(u.trim()),h=Mc(e,t,m);n!=null&&(d=n.cues)!=null&&d.getCueById(h)||(o=new c(e,t,m),o.id=h,o.line=f+1,o.align="left",o.position=10+Math.min(80,Math.floor(l*8/32)*10),s.push(o))}return n&&s.length&&(s.sort((f,m)=>f.line==="auto"||m.line==="auto"?0:f.line>8&&m.line>8?m.line-f.line:f.line-m.line),s.forEach(f=>kg(n,f))),s}},BR={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},v0=Pe(Pe({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:y0,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:f1,bufferController:gL,capLevelController:Uc,errorController:e1,fpsController:VL,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:gg,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,useMediaCapabilities:!0,certLoadPolicy:{default:BR},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},$R()),{},{subtitleStreamController:fL,subtitleTrackController:mL,timelineController:GL,audioStreamController:cL,audioTrackController:dL,emeController:Dr,cmcdController:wR,contentSteeringController:IR});function $R(){return{cueHandler:UR,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function jR(n,e){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const t=Eu(n),r=["manifest","level","frag"],s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return r.forEach(i=>{const o=`${i==="level"?"playlist":i}LoadPolicy`,a=e[o]===void 0,l=[];s.forEach(u=>{const c=`${i}Loading${u}`,d=e[c];if(d!==void 0&&a){l.push(c);const f=t[o].default;switch(e[o]={default:f},u){case"TimeOut":f.maxLoadTimeMs=d,f.maxTimeToFirstByteMs=d;break;case"MaxRetry":f.errorRetry.maxNumRetry=d,f.timeoutRetry.maxNumRetry=d;break;case"RetryDelay":f.errorRetry.retryDelayMs=d,f.timeoutRetry.retryDelayMs=d;break;case"MaxRetryTimeout":f.errorRetry.maxRetryDelayMs=d,f.timeoutRetry.maxRetryDelayMs=d;break}}}),l.length&&w.warn(`hls.js config: "${l.join('", "')}" setting(s) are deprecated, use "${o}": ${JSON.stringify(e[o])}`)}),Pe(Pe({},t),e)}function Eu(n){return n&&typeof n=="object"?Array.isArray(n)?n.map(Eu):Object.keys(n).reduce((e,t)=>(e[t]=Eu(n[t]),e),{}):n}function GR(n){const e=n.loader;e!==gh&&e!==y0?(w.log("[config]: Custom loader detected, cannot enable progressive streaming"),n.progressive=!1):kR()&&(n.loader=gh,n.progressive=!0,n.enableSoftwareAES=!0,w.log("[config]: Progressive streaming enabled, using FetchLoader"))}let tl;class HR extends Cc{constructor(e,t){super(e,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(E.LEVEL_LOADED,this.onLevelLoaded,this),e.on(E.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(E.FRAG_BUFFERED,this.onFragBuffered,this),e.on(E.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(E.LEVEL_LOADED,this.onLevelLoaded,this),e.off(E.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(E.FRAG_BUFFERED,this.onFragBuffered,this),e.off(E.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const r=this.hls.config.preferManagedMediaSource,s=[],i={},o={};let a=!1,l=!1,u=!1;t.levels.forEach(c=>{var d,f;const m=c.attrs;let{audioCodec:h,videoCodec:p}=c;((d=h)==null?void 0:d.indexOf("mp4a.40.34"))!==-1&&(tl||(tl=/chrome|firefox/i.test(navigator.userAgent)),tl&&(c.audioCodec=h=void 0)),h&&(c.audioCodec=h=Ao(h,r)),((f=p)==null?void 0:f.indexOf("avc1"))===0&&(p=c.videoCodec=DT(p));const{width:y,height:g,unknownCodecs:v}=c;if(a||(a=!!(y&&g)),l||(l=!!p),u||(u=!!h),v!=null&&v.length||h&&!$a(h,"audio",r)||p&&!$a(p,"video",r))return;const{CODECS:x,"FRAME-RATE":L,"HDCP-LEVEL":T,"PATHWAY-ID":A,RESOLUTION:R,"VIDEO-RANGE":I}=m,D=`${`${A||"."}-`}${c.bitrate}-${R}-${L}-${x}-${I}-${T}`;if(i[D])if(i[D].uri!==c.url&&!c.attrs["PATHWAY-ID"]){const F=o[D]+=1;c.attrs["PATHWAY-ID"]=new Array(F+1).join(".");const Y=new Ur(c);i[D]=Y,s.push(Y)}else i[D].addGroupId("audio",m.AUDIO),i[D].addGroupId("text",m.SUBTITLES);else{const F=new Ur(c);i[D]=F,o[D]=1,s.push(F)}}),this.filterAndSortMediaOptions(s,t,a,l,u)}filterAndSortMediaOptions(e,t,r,s,i){let o=[],a=[],l=e;if((r||s)&&i&&(l=l.filter(({videoCodec:h,videoRange:p,width:y,height:g})=>(!!h||!!(y&&g))&&GT(p))),l.length===0){Promise.resolve().then(()=>{if(this.hls){t.levels.length&&this.warn(`One or more CODECS in variant not supported: ${JSON.stringify(t.levels[0].attrs)}`);const h=new Error("no level with compatible codecs found in manifest");this.hls.trigger(E.ERROR,{type:q.MEDIA_ERROR,details:k.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:h,reason:h.message})}});return}if(t.audioTracks){const{preferManagedMediaSource:h}=this.hls.config;o=t.audioTracks.filter(p=>!p.audioCodec||$a(p.audioCodec,"audio",h)),yh(o)}t.subtitles&&(a=t.subtitles,yh(a));const u=l.slice(0);l.sort((h,p)=>{if(h.attrs["HDCP-LEVEL"]!==p.attrs["HDCP-LEVEL"])return(h.attrs["HDCP-LEVEL"]||"")>(p.attrs["HDCP-LEVEL"]||"")?1:-1;if(r&&h.height!==p.height)return h.height-p.height;if(h.frameRate!==p.frameRate)return h.frameRate-p.frameRate;if(h.videoRange!==p.videoRange)return wo.indexOf(h.videoRange)-wo.indexOf(p.videoRange);if(h.videoCodec!==p.videoCodec){const y=Rf(h.videoCodec),g=Rf(p.videoCodec);if(y!==g)return g-y}if(h.uri===p.uri&&h.codecSet!==p.codecSet){const y=Ro(h.codecSet),g=Ro(p.codecSet);if(y!==g)return g-y}return h.averageBitrate!==p.averageBitrate?h.averageBitrate-p.averageBitrate:0});let c=u[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==u.length)){for(let h=0;h<u.length;h++)if(u[h].pathwayId===l[0].pathwayId){c=u[h];break}}this._levels=l;for(let h=0;h<l.length;h++)if(l[h]===c){var d;this._firstLevel=h;const p=c.bitrate,y=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${l.length} level(s) found, first bitrate: ${p}`),((d=this.hls.userConfig)==null?void 0:d.abrEwmaDefaultEstimate)===void 0){const g=Math.min(p,this.hls.config.abrEwmaDefaultEstimateMax);g>y&&y===v0.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=g)}break}const f=i&&!s,m={levels:l,audioTracks:o,subtitleTracks:a,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:i,video:s,altAudio:!f&&o.some(h=>!!h.url)};this.hls.trigger(E.MANIFEST_PARSED,m),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return this._levels.length===0?null:this._levels}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const c=new Error("invalid level idx"),d=e<0;if(this.hls.trigger(E.ERROR,{type:q.OTHER_ERROR,details:k.LEVEL_SWITCH_ERROR,level:e,fatal:d,error:c,reason:c.message}),d)return;e=Math.min(e,t.length-1)}const r=this.currentLevelIndex,s=this.currentLevel,i=s?s.attrs["PATHWAY-ID"]:void 0,o=t[e],a=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,r===e&&o.details&&s&&i===a)return;this.log(`Switching to level ${e} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${a?" with Pathway "+a:""} from level ${r}${i?" with Pathway "+i:""}`);const l={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(E.LEVEL_SWITCHING,l);const u=o.details;if(!u||u.live){const c=this.switchParams(o.uri,s==null?void 0:s.details,u);this.loadPlaylist(c)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}onError(e,t){t.fatal||!t.context||t.context.type===re.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===W.MAIN){const r=t.elementaryStreams;if(!Object.keys(r).some(i=>!!r[i]))return;const s=this._levels[t.level];s!=null&&s.loadError&&(this.log(`Resetting level error count of ${s.loadError} on frag buffered`),s.loadError=0)}}onLevelLoaded(e,t){var r;const{level:s,details:i}=t,o=this._levels[s];if(!o){var a;this.warn(`Invalid level index ${s}`),(a=t.deliveryDirectives)!=null&&a.skip&&(i.deltaUpdateFailed=!0);return}s===this.currentLevelIndex?(o.fragmentError===0&&(o.loadError=0),this.playlistLoaded(s,t,o.details)):(r=t.deliveryDirectives)!=null&&r.skip&&(i.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist();const t=this.currentLevelIndex,r=this.currentLevel;if(r&&this.shouldLoadPlaylist(r)){let s=r.uri;if(e)try{s=e.addDirectives(s)}catch(o){this.warn(`Could not construct new URL with HLS Delivery Directives: ${o}`)}const i=r.attrs["PATHWAY-ID"];this.log(`Loading level index ${t}${(e==null?void 0:e.msn)!==void 0?" at sn "+e.msn+" part "+e.part:""} with${i?" Pathway "+i:""} ${s}`),this.clearTimer(),this.hls.trigger(E.LEVEL_LOADING,{url:s,level:t,pathwayId:r.attrs["PATHWAY-ID"],id:0,deliveryDirectives:e||null})}}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;const r=this._levels.filter((s,i)=>i!==e?!0:(this.steering&&this.steering.removeLevel(s),s===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,s.details&&s.details.fragments.forEach(o=>o.level=-1)),!1));Ng(r),this._levels=r,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.hls.trigger(E.LEVELS_UPDATED,{levels:r})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:r}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(E.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:r}))}}function yh(n){const e={};n.forEach(t=>{const r=t.groupId||"";t.id=e[r]=e[r]||0,e[r]++})}class VR{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const r in this.keyUriToKeyInfo){const s=this.keyUriToKeyInfo[r].loader;if(s){var t;if(e&&e!==((t=s.context)==null?void 0:t.frag.type))return;s.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=k.KEY_LOAD_ERROR,r,s,i){return new Qt({type:q.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:i,error:r,networkDetails:s})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){const{sn:r,cc:s}=e;for(let i=0;i<t.length;i++){const o=t[i];if(s<=o.cc&&(r==="initSegment"||o.sn==="initSegment"||r<o.sn)){this.emeController.selectKeySystemFormat(o).then(a=>{o.setKeyFormat(a)});break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var r,s;t&&e.setKeyFormat(t);const i=e.decryptdata;if(!i){const u=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,k.KEY_LOAD_ERROR,u))}const o=i.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,k.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));let a=this.keyUriToKeyInfo[o];if((r=a)!=null&&r.decryptdata.key)return i.key=a.decryptdata.key,Promise.resolve({frag:e,keyInfo:a});if((s=a)!=null&&s.keyLoadPromise){var l;switch((l=a.mediaKeySessionContext)==null?void 0:l.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return a.keyLoadPromise.then(u=>(i.key=u.keyInfo.decryptdata.key,{frag:e,keyInfo:a}))}}switch(a=this.keyUriToKeyInfo[o]={decryptdata:i,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},i.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return i.keyFormat==="identity"?this.loadKeyHTTP(a,e):this.loadKeyEME(a,e);case"AES-128":return this.loadKeyHTTP(a,e);default:return Promise.reject(this.createKeyLoadError(e,k.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${i.method}"`)))}}loadKeyEME(e,t){const r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const s=this.emeController.loadKey(r);if(s)return(e.keyLoadPromise=s.then(i=>(e.mediaKeySessionContext=i,r))).catch(i=>{throw e.keyLoadPromise=null,i})}return Promise.resolve(r)}loadKeyHTTP(e,t){const r=this.config,s=r.loader,i=new s(r);return t.keyLoader=e.loader=i,e.keyLoadPromise=new Promise((o,a)=>{const l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},u=r.keyLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,m,h,p)=>{const{frag:y,keyInfo:g,url:v}=h;if(!y.decryptdata||g!==this.keyUriToKeyInfo[v])return a(this.createKeyLoadError(y,k.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),p));g.decryptdata.key=y.decryptdata.key=new Uint8Array(f.data),y.keyLoader=null,g.loader=null,o({frag:y,keyInfo:g})},onError:(f,m,h,p)=>{this.resetLoader(m),a(this.createKeyLoadError(t,k.KEY_LOAD_ERROR,new Error(`HTTP Error ${f.code} loading key ${f.text}`),h,Pe({url:l.url,data:void 0},f)))},onTimeout:(f,m,h)=>{this.resetLoader(m),a(this.createKeyLoadError(t,k.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),h))},onAbort:(f,m,h)=>{this.resetLoader(m),a(this.createKeyLoadError(t,k.INTERNAL_ABORTED,new Error("key loading aborted"),h))}};i.load(l,c,d)})}resetLoader(e){const{frag:t,keyInfo:r,url:s}=e,i=r.loader;t.keyLoader===i&&(t.keyLoader=null,r.loader=null),delete this.keyUriToKeyInfo[s],i&&i.destroy()}}function x0(){return self.SourceBuffer||self.WebKitSourceBuffer}function E0(){if(!Zn())return!1;const e=x0();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function KR(){if(!E0())return!1;const n=Zn();return typeof(n==null?void 0:n.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>n.isTypeSupported(js(e,"video")))||["mp4a.40.2","fLaC"].some(e=>n.isTypeSupported(js(e,"audio"))))}function zR(){var n;const e=x0();return typeof(e==null||(n=e.prototype)==null?void 0:n.changeType)=="function"}const WR=250,zi=2,YR=.1,qR=.05;class XR{constructor(e,t,r,s){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=r,this.hls=s}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(e,t){const{config:r,media:s,stalled:i}=this;if(s===null)return;const{currentTime:o,seeking:a}=s,l=this.seeking&&!a,u=!this.seeking&&a;if(this.seeking=a,o!==e){if(this.moved=!0,a||(this.nudgeRetry=0),i!==null){if(this.stallReported){const y=self.performance.now()-i;w.warn(`playback not stuck anymore @${o}, after ${Math.round(y)}ms`),this.stallReported=!1}this.stalled=null}return}if(u||l){this.stalled=null;return}if(s.paused&&!a||s.ended||s.playbackRate===0||!le.getBuffered(s).length){this.nudgeRetry=0;return}const c=le.bufferInfo(s,o,0),d=c.nextStart||0;if(a){const y=c.len>zi,g=!d||t&&t.start<=o||d-o>zi&&!this.fragmentTracker.getPartialFragment(o);if(y||g)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var f;if(!(c.len>0)&&!d)return;const g=Math.max(d,c.start||0)-o,v=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,L=(v==null||(f=v.details)==null?void 0:f.live)?v.details.targetduration*2:zi,T=this.fragmentTracker.getPartialFragment(o);if(g>0&&(g<=L||T)){s.paused||this._trySkipBufferHole(T);return}}const m=self.performance.now();if(i===null){this.stalled=m;return}const h=m-i;if(!a&&h>=WR&&(this._reportStall(c),!this.media))return;const p=le.bufferInfo(s,o,r.maxBufferHole);this._tryFixBufferStall(p,h)}_tryFixBufferStall(e,t){const{config:r,fragmentTracker:s,media:i}=this;if(i===null)return;const o=i.currentTime,a=s.getPartialFragment(o);a&&(this._trySkipBufferHole(a)||!this.media)||(e.len>r.maxBufferHole||e.nextStart&&e.nextStart-o<r.maxBufferHole)&&t>r.highBufferWatchdogPeriod*1e3&&(w.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(e){const{hls:t,media:r,stallReported:s}=this;if(!s&&r){this.stallReported=!0;const i=new Error(`Playback stalling at @${r.currentTime} due to low buffer (${JSON.stringify(e)})`);w.warn(i.message),t.trigger(E.ERROR,{type:q.MEDIA_ERROR,details:k.BUFFER_STALLED_ERROR,fatal:!1,error:i,buffer:e.len})}}_trySkipBufferHole(e){const{config:t,hls:r,media:s}=this;if(s===null)return 0;const i=s.currentTime,o=le.bufferInfo(s,i,0),a=i<o.start?o.start:o.nextStart;if(a){const l=o.len<=t.maxBufferHole,u=o.len>0&&o.len<1&&s.readyState<3,c=a-i;if(c>0&&(l||u)){if(c>t.maxBufferHole){const{fragmentTracker:f}=this;let m=!1;if(i===0){const h=f.getAppendedFrag(0,W.MAIN);h&&a<h.end&&(m=!0)}if(!m){const h=e||f.getAppendedFrag(i,W.MAIN);if(h){let p=!1,y=h.end;for(;y<a;){const g=f.getPartialFragment(y);if(g)y+=g.duration;else{p=!0;break}}if(p)return 0}}}const d=Math.max(a+qR,i+YR);if(w.warn(`skipping hole, adjusting currentTime from ${i} to ${d}`),this.moved=!0,this.stalled=null,s.currentTime=d,e&&!e.gap){const f=new Error(`fragment loaded with buffer holes, seeking from ${i} to ${d}`);r.trigger(E.ERROR,{type:q.MEDIA_ERROR,details:k.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:f,reason:f.message,frag:e})}return d}}return 0}_tryNudgeBuffer(){const{config:e,hls:t,media:r,nudgeRetry:s}=this;if(r===null)return;const i=r.currentTime;if(this.nudgeRetry++,s<e.nudgeMaxRetry){const o=i+(s+1)*e.nudgeOffset,a=new Error(`Nudging 'currentTime' from ${i} to ${o}`);w.warn(a.message),r.currentTime=o,t.trigger(E.ERROR,{type:q.MEDIA_ERROR,details:k.BUFFER_NUDGE_ON_STALL,error:a,fatal:!1})}else{const o=new Error(`Playhead still not moving while enough data buffered @${i} after ${e.nudgeMaxRetry} nudges`);w.error(o.message),t.trigger(E.ERROR,{type:q.MEDIA_ERROR,details:k.BUFFER_STALLED_ERROR,error:o,fatal:!0})}}}const QR=100;class JR extends kc{constructor(e,t,r){super(e,t,r,"[stream-controller]",W.MAIN),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.MANIFEST_PARSED,this.onManifestParsed,this),e.on(E.LEVEL_LOADING,this.onLevelLoading,this),e.on(E.LEVEL_LOADED,this.onLevelLoaded,this),e.on(E.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(E.ERROR,this.onError,this),e.on(E.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(E.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(E.BUFFER_CREATED,this.onBufferCreated,this),e.on(E.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(E.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(E.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.MANIFEST_PARSED,this.onManifestParsed,this),e.off(E.LEVEL_LOADED,this.onLevelLoaded,this),e.off(E.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(E.ERROR,this.onError,this),e.off(E.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(E.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(E.BUFFER_CREATED,this.onBufferCreated,this),e.off(E.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(E.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(E.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying()}startLoad(e){if(this.levels){const{lastCurrentTime:t,hls:r}=this;if(this.stopLoad(),this.setInterval(QR),this.level=-1,!this.startFragRequested){let s=r.startLevel;s===-1&&(r.config.testBandwidth&&this.levels.length>1?(s=0,this.bitrateTest=!0):s=r.firstAutoLevel),r.nextLoadLevel=s,this.level=r.loadLevel,this.loadedmetadata=!1}t>0&&e===-1&&(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t),this.state=N.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=N.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case N.WAITING_LEVEL:{const{levels:t,level:r}=this,s=t==null?void 0:t[r],i=s==null?void 0:s.details;if(i&&(!i.live||this.levelLastLoaded===s)){if(this.waitForCdnTuneIn(i))break;this.state=N.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=N.IDLE;break}break}case N.FRAG_LOADING_WAITING_RETRY:{var e;const t=self.performance.now(),r=this.retryDate;if(!r||t>=r||(e=this.media)!=null&&e.seeking){const{levels:s,level:i}=this,o=s==null?void 0:s[i];this.resetStartWhenNotLoaded(o||null),this.state=N.IDLE}}break}this.state===N.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:r,media:s}=this;if(t===null||!s&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const i=e.nextLoadLevel;if(!(r!=null&&r[i]))return;const o=r[i],a=this.getMainFwdBufferInfo();if(a===null)return;const l=this.getLevelDetails();if(l&&this._streamEnded(a,l)){const p={};this.altAudio&&(p.type="video"),this.hls.trigger(E.BUFFER_EOS,p),this.state=N.ENDED;return}e.loadLevel!==i&&e.manualLevel===-1&&this.log(`Adapting to level ${i} from level ${this.level}`),this.level=e.nextLoadLevel=i;const u=o.details;if(!u||this.state===N.WAITING_LEVEL||u.live&&this.levelLastLoaded!==o){this.level=i,this.state=N.WAITING_LEVEL;return}const c=a.len,d=this.getMaxBufferLength(o.maxBitrate);if(c>=d)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const f=this.backtrackFragment?this.backtrackFragment.start:a.end;let m=this.getNextFragment(f,u);if(this.couldBacktrack&&!this.fragPrevious&&m&&m.sn!=="initSegment"&&this.fragmentTracker.getState(m)!==be.OK){var h;const y=((h=this.backtrackFragment)!=null?h:m).sn-u.startSN,g=u.fragments[y-1];g&&m.cc===g.cc&&(m=g,this.fragmentTracker.removeFragment(g))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(m&&this.isLoopLoading(m,f)){if(!m.gap){const y=this.audioOnly&&!this.altAudio?ie.AUDIO:ie.VIDEO,g=(y===ie.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;g&&this.afterBufferFlushed(g,y,W.MAIN)}m=this.getNextFragmentLoopLoading(m,u,a,W.MAIN,d)}m&&(m.initSegment&&!m.initSegment.data&&!this.bitrateTest&&(m=m.initSegment),this.loadFragment(m,o,f))}loadFragment(e,t,r){const s=this.fragmentTracker.getState(e);this.fragCurrent=e,s===be.NOT_LOADED||s===be.PARTIAL?e.sn==="initSegment"?this._loadInitSegment(e,t):this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):(this.startFragRequested=!0,super.loadFragment(e,t,r)):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,W.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let r;const s=this.getAppendedFrag(t.currentTime);s&&s.start>1&&this.flushMainBuffer(0,s.start-1);const i=this.getLevelDetails();if(i!=null&&i.live){const a=this.getMainFwdBufferInfo();if(!a||a.len<i.targetduration*2)return}if(!t.paused&&e){const a=this.hls.nextLoadLevel,l=e[a],u=this.fragLastKbps;u&&this.fragCurrent?r=this.fragCurrent.duration*l.maxBitrate/(1e3*u)+1:r=0}else r=0;const o=this.getBufferedFrag(t.currentTime+r);if(o){const a=this.followingBufferedFrag(o);if(a){this.abortCurrentFrag();const l=a.maxStartPTS?a.maxStartPTS:a.start,u=a.duration,c=Math.max(o.end,l+Math.min(Math.max(u-this.config.maxFragLookUpTolerance,u*(this.couldBacktrack?.5:.125)),u*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(c,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case N.KEY_LOADING:case N.FRAG_LOADING:case N.FRAG_LOADING_WAITING_RETRY:case N.PARSING:case N.PARSED:this.state=N.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const r=t.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),r.addEventListener("playing",this.onvplaying),r.addEventListener("seeked",this.onvseeked),this.gapController=new XR(this.config,r,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:e}=this;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const e=this.media,t=e?e.currentTime:null;G(t)&&this.log(`Media seeked to ${t.toFixed(3)}`);const r=this.getMainFwdBufferInfo();if(r===null||r.len===0){this.warn(`Main forward buffer length on "seeked" event ${r?r.len:"empty"})`);return}this.tick()}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(E.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=this.fragLastKbps=0,this.levels=this.fragPlaying=this.backtrackFragment=this.levelLastLoaded=null,this.altAudio=this.audioOnly=this.startFragRequested=!1}onManifestParsed(e,t){let r=!1,s=!1;t.levels.forEach(i=>{const o=i.audioCodec;o&&(r=r||o.indexOf("mp4a.40.2")!==-1,s=s||o.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=r&&s&&!zR(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:r}=this;if(!r||this.state!==N.IDLE)return;const s=r[t.level];(!s.details||s.details.live&&this.levelLastLoaded!==s||this.waitForCdnTuneIn(s.details))&&(this.state=N.WAITING_LEVEL)}onLevelLoaded(e,t){var r;const{levels:s}=this,i=t.level,o=t.details,a=o.totalduration;if(!s){this.warn(`Levels were reset while loading level ${i}`);return}this.log(`Level ${i} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""}, cc [${o.startCC}, ${o.endCC}] duration:${a}`);const l=s[i],u=this.fragCurrent;u&&(this.state===N.FRAG_LOADING||this.state===N.FRAG_LOADING_WAITING_RETRY)&&u.level!==t.level&&u.loader&&this.abortCurrentFrag();let c=0;if(o.live||(r=l.details)!=null&&r.live){var d;if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;c=this.alignPlaylists(o,l.details,(d=this.levelLastLoaded)==null?void 0:d.details)}if(l.details=o,this.levelLastLoaded=l,this.hls.trigger(E.LEVEL_UPDATED,{details:o,level:i}),this.state===N.WAITING_LEVEL){if(this.waitForCdnTuneIn(o))return;this.state=N.IDLE}this.startFragRequested?o.live&&this.synchronizeToLiveEdge(o):this.setStartPosition(o,c),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:r,part:s,payload:i}=e,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const a=o[r.level],l=a.details;if(!l){this.warn(`Dropping fragment ${r.sn} of level ${r.level} after level details were reset`),this.fragmentTracker.removeFragment(r);return}const u=a.videoCodec,c=l.PTSKnown||!l.live,d=(t=r.initSegment)==null?void 0:t.data,f=this._getAudioCodec(a),m=this.transmuxer=this.transmuxer||new e0(this.hls,W.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),h=s?s.index:-1,p=h!==-1,y=new Ic(r.level,r.sn,r.stats.chunkCount,i.byteLength,h,p),g=this.initPTS[r.cc];m.push(i,d,f,u,r,s,l.totalduration,c,y,g)}onAudioTrackSwitching(e,t){const r=this.altAudio;if(!!!t.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const i=this.hls;r&&(i.trigger(E.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),i.trigger(E.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const r=t.id,s=!!this.hls.audioTracks[r].url;if(s){const i=this.videoBuffer;i&&this.mediaBuffer!==i&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=s,this.tick()}onBufferCreated(e,t){const r=t.tracks;let s,i,o=!1;for(const a in r){const l=r[a];if(l.id==="main"){if(i=a,s=l,a==="video"){const u=r[a];u&&(this.videoBuffer=u.buffer)}}else o=!0}o&&s?(this.log(`Alternate track found, use ${i}.buffered to schedule main fragment loading`),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:r,part:s}=t;if(r&&r.type!==W.MAIN)return;if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${s?" p: "+s.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}`),this.state===N.PARSED&&(this.state=N.IDLE);return}const i=s?s.stats:r.stats;this.fragLastKbps=Math.round(8*i.total/(i.buffering.end-i.loading.first)),r.sn!=="initSegment"&&(this.fragPrevious=r),this.fragBufferedComplete(r,s)}onError(e,t){var r;if(t.fatal){this.state=N.ERROR;return}switch(t.details){case k.FRAG_GAP:case k.FRAG_PARSING_ERROR:case k.FRAG_DECRYPT_ERROR:case k.FRAG_LOAD_ERROR:case k.FRAG_LOAD_TIMEOUT:case k.KEY_LOAD_ERROR:case k.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(W.MAIN,t);break;case k.LEVEL_LOAD_ERROR:case k.LEVEL_LOAD_TIMEOUT:case k.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===N.WAITING_LEVEL&&((r=t.context)==null?void 0:r.type)===re.LEVEL&&(this.state=N.IDLE);break;case k.BUFFER_APPEND_ERROR:case k.BUFFER_FULL_ERROR:if(!t.parent||t.parent!=="main")return;if(t.details===k.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case k.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}checkBuffer(){const{media:e,gapController:t}=this;if(!(!e||!t||!e.readyState)){if(this.loadedmetadata||!le.getBuffered(e).length){const r=this.state!==N.IDLE?this.fragCurrent:null;t.poll(this.lastCurrentTime,r)}this.lastCurrentTime=e.currentTime}}onFragLoadEmergencyAborted(){this.state=N.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==ie.AUDIO||this.audioOnly&&!this.altAudio){const r=(t===ie.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(r,t,W.MAIN),this.tick()}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let r=this.startPosition;if(r>=0&&t<r){if(e.seeking){this.log(`could not seek to ${r}, already seeking at ${t}`);return}const s=le.getBuffered(e),o=(s.length?s.start(0):0)-r;o>0&&(o<this.config.maxBufferHole||o<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${o} to match buffer start`),r+=o,this.startPosition=r),this.log(`seek to target start position ${r} from current time ${t}`),e.currentTime=r}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(r=>{const{hls:s}=this;if(!r||this.fragContextChanged(e))return;t.fragmentError=0,this.state=N.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const i=e.stats;i.parsing.start=i.parsing.end=i.buffering.start=i.buffering.end=self.performance.now(),s.trigger(E.FRAG_LOADED,r),e.bitrateTest=!1})}_handleTransmuxComplete(e){var t;const r="main",{hls:s}=this,{remuxResult:i,chunkMeta:o}=e,a=this.getCurrentContext(o);if(!a){this.resetWhenMissingContext(o);return}const{frag:l,part:u,level:c}=a,{video:d,text:f,id3:m,initSegment:h}=i,{details:p}=c,y=this.altAudio?void 0:i.audio;if(this.fragContextChanged(l)){this.fragmentTracker.removeFragment(l);return}if(this.state=N.PARSING,h){if(h!=null&&h.tracks){const x=l.initSegment||l;this._bufferInitSegment(c,h.tracks,x,o),s.trigger(E.FRAG_PARSING_INIT_SEGMENT,{frag:x,id:r,tracks:h.tracks})}const g=h.initPTS,v=h.timescale;G(g)&&(this.initPTS[l.cc]={baseTime:g,timescale:v},s.trigger(E.INIT_PTS_FOUND,{frag:l,id:r,initPTS:g,timescale:v}))}if(d&&p&&l.sn!=="initSegment"){const g=p.fragments[l.sn-1-p.startSN],v=l.sn===p.startSN,x=!g||l.cc>g.cc;if(i.independent!==!1){const{startPTS:L,endPTS:T,startDTS:A,endDTS:R}=d;if(u)u.elementaryStreams[d.type]={startPTS:L,endPTS:T,startDTS:A,endDTS:R};else if(d.firstKeyFrame&&d.independent&&o.id===1&&!x&&(this.couldBacktrack=!0),d.dropped&&d.independent){const I=this.getMainFwdBufferInfo(),M=(I?I.end:this.getLoadPosition())+this.config.maxBufferHole,D=d.firstKeyFramePTS?d.firstKeyFramePTS:L;if(!v&&M<D-this.config.maxBufferHole&&!x){this.backtrack(l);return}else x&&(l.gap=!0);l.setElementaryStreamInfo(d.type,l.start,T,l.start,R,!0)}else v&&L>zi&&(l.gap=!0);l.setElementaryStreamInfo(d.type,L,T,A,R),this.backtrackFragment&&(this.backtrackFragment=l),this.bufferFragmentData(d,l,u,o,v||x)}else if(v||x)l.gap=!0;else{this.backtrack(l);return}}if(y){const{startPTS:g,endPTS:v,startDTS:x,endDTS:L}=y;u&&(u.elementaryStreams[ie.AUDIO]={startPTS:g,endPTS:v,startDTS:x,endDTS:L}),l.setElementaryStreamInfo(ie.AUDIO,g,v,x,L),this.bufferFragmentData(y,l,u,o)}if(p&&m!=null&&(t=m.samples)!=null&&t.length){const g={id:r,frag:l,details:p,samples:m.samples};s.trigger(E.FRAG_PARSING_METADATA,g)}if(p&&f){const g={id:r,frag:l,details:p,samples:f.samples};s.trigger(E.FRAG_PARSING_USERDATA,g)}}_bufferInitSegment(e,t,r,s){if(this.state!==N.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;const{audio:i,video:o,audiovideo:a}=t;if(i){let l=e.audioCodec;const u=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){l&&(l.indexOf("mp4a.40.5")!==-1?l="mp4a.40.2":l="mp4a.40.5");const c=i.metadata;c&&"channelCount"in c&&(c.channelCount||1)!==1&&u.indexOf("firefox")===-1&&(l="mp4a.40.5")}l&&l.indexOf("mp4a.40.5")!==-1&&u.indexOf("android")!==-1&&i.container!=="audio/mpeg"&&(l="mp4a.40.2",this.log(`Android: force audio codec to ${l}`)),e.audioCodec&&e.audioCodec!==l&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${l}"`),i.levelCodec=l,i.id="main",this.log(`Init audio buffer, container:${i.container}, codecs[selected/level/parsed]=[${l||""}/${e.audioCodec||""}/${i.codec}]`)}o&&(o.levelCodec=e.videoCodec,o.id="main",this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${o.codec}]`)),a&&this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${e.codecs}/${a.codec}]`),this.hls.trigger(E.BUFFER_CODECS,t),Object.keys(t).forEach(l=>{const c=t[l].initSegment;c!=null&&c.byteLength&&this.hls.trigger(E.BUFFER_APPENDING,{type:l,data:c,frag:r,part:null,chunkMeta:s,parent:r.type})}),this.tickImmediate()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,W.MAIN)}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=N.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const r=e.currentTime;if(le.isBuffered(e,r)?t=this.getAppendedFrag(r):le.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;const s=this.fragPlaying,i=t.level;(!s||t.sn!==s.sn||s.level!==i)&&(this.fragPlaying=t,this.hls.trigger(E.FRAG_CHANGED,{frag:t}),(!s||s.level!==i)&&this.hls.trigger(E.LEVEL_SWITCHED,{level:i}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){const e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}get currentProgramDateTime(){const e=this.media;if(e){const t=e.currentTime,r=this.currentFrag;if(r&&G(t)&&G(r.programDateTime)){const s=r.programDateTime+(t-r.start)*1e3;return new Date(s)}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class Gt{static get version(){return"1.5.11"}static isMSESupported(){return E0()}static isSupported(){return KR()}static getMediaSource(){return Zn()}static get Events(){return E}static get ErrorTypes(){return q}static get ErrorDetails(){return k}static get DefaultConfig(){return Gt.defaultConfig?Gt.defaultConfig:v0}static set DefaultConfig(e){Gt.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this.started=!1,this._emitter=new Oc,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,this.triggeringException=void 0,$S(e.debug||!1,"Hls instance");const t=this.config=jR(Gt.DefaultConfig,e);this.userConfig=e,t.progressive&&GR(t);const{abrController:r,bufferController:s,capLevelController:i,errorController:o,fpsController:a}=t,l=new o(this),u=this.abrController=new r(this),c=this.bufferController=new s(this),d=this.capLevelController=new i(this),f=new a(this),m=new NT(this),h=new BT(this),p=t.contentSteeringController,y=p?new p(this):null,g=this.levelController=new HR(this,y),v=new m1(this),x=new VR(this.config),L=this.streamController=new JR(this,v,x);d.setStreamController(L),f.setStreamController(L);const T=[m,g,L];y&&T.splice(1,0,y),this.networkControllers=T;const A=[u,c,d,f,h,v];this.audioTrackController=this.createController(t.audioTrackController,T);const R=t.audioStreamController;R&&T.push(new R(this,v,x)),this.subtitleTrackController=this.createController(t.subtitleTrackController,T);const I=t.subtitleStreamController;I&&T.push(new I(this,v,x)),this.createController(t.timelineController,A),x.emeController=this.emeController=this.createController(t.emeController,A),this.cmcdController=this.createController(t.cmcdController,A),this.latencyController=this.createController($T,A),this.coreComponents=A,T.push(l);const M=l.onErrorOut;typeof M=="function"&&this.on(E.ERROR,M,l)}createController(e,t){if(e){const r=new e(this);return t&&t.push(r),r}return null}on(e,t,r=this){this._emitter.on(e,t,r)}once(e,t,r=this){this._emitter.once(e,t,r)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,r=this,s){this._emitter.off(e,t,r,s)}listeners(e){return this._emitter.listeners(e)}emit(e,t,r){return this._emitter.emit(e,t,r)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(r){if(w.error("An internal error happened while handling event "+e+'. Error message: "'+r.message+'". Here is a stacktrace:',r),!this.triggeringException){this.triggeringException=!0;const s=e===E.ERROR;this.trigger(E.ERROR,{type:q.OTHER_ERROR,details:k.INTERNAL_EXCEPTION,fatal:s,event:e,error:r}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){w.log("destroy"),this.trigger(E.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){w.log("attachMedia"),this._media=e,this.trigger(E.MEDIA_ATTACHING,{media:e})}detachMedia(){w.log("detachMedia"),this.trigger(E.MEDIA_DETACHING,void 0),this._media=null}loadSource(e){this.stopLoad();const t=this.media,r=this.url,s=this.url=Tc.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,w.log(`loadSource:${s}`),t&&r&&(r!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(E.MANIFEST_LOADING,{url:e})}startLoad(e=-1){w.log(`startLoad(${e})`),this.started=!0,this.networkControllers.forEach(t=>{t.startLoad(e)})}stopLoad(){w.log("stopLoad"),this.started=!1,this.networkControllers.forEach(e=>{e.stopLoad()})}resumeBuffering(){this.started&&this.networkControllers.forEach(e=>{"fragmentLoader"in e&&e.startLoad(-1)})}pauseBuffering(){this.networkControllers.forEach(e=>{"fragmentLoader"in e&&e.stopLoad()})}swapAudioCodec(){w.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){w.log("recoverMediaError");const e=this._media;this.detachMedia(),e&&this.attachMedia(e)}removeLevel(e){this.levelController.removeLevel(e)}get levels(){const e=this.levelController.levels;return e||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){w.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){w.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){w.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){w.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){w.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(w.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){jT(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const r=e.length;for(let s=0;s<r;s++)if(e[s].maxBitrate>=t)return s;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:r}=this;let s;if(t===-1&&e!=null&&e.length?s=e.length-1:s=t,r)for(let i=s;i--;){const o=e[i].attrs["HDCP-LEVEL"];if(o&&o<=r)return i}return s}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}setAudioOption(e){var t;return(t=this.audioTrackController)==null?void 0:t.setAudioOption(e)}setSubtitleOption(e){var t;return(t=this.subtitleTrackController)==null||t.setSubtitleOption(e),null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}Gt.defaultConfig=void 0;function ZR(){var y;const n=Wt(),e=n.state,t=(y=n.state)==null?void 0:y.preplayer,[r,s]=_.useState(e[0]),[i,o]=_.useState([]),[a,l]=_.useState(""),u=_.useRef(null),c=_.useRef(null);_.useEffect(()=>{(async()=>{if(t){let v=`/anime/gogoanime/watch/${t}`;console.log(`Fetching data for preplay ID: ${t}`);const x=await rt.get(v,{params:{server:"gogocdn"}});console.log(x.data);const L=x.data.sources;if(L&&L.length>0){const T=L.find(A=>A.quality==="default")||L[0];o(L),l(T.quality),d(T.url)}}else e.length,s(e[0])})()},[e,t]),_.useEffect(()=>{if(r){let g=`/anime/gogoanime/watch/${r.id}`;console.log(`Fetching data for episode ID: ${r.id}`),(async()=>{const x=await rt.get(g,{params:{server:"gogocdn"}});console.log(x.data);const L=x.data.sources;if(L&&L.length>0){const T=L.find(A=>A.quality==="default")||L[L.length-3];o(L),l(T.quality),d(T.url)}})()}},[r]);const d=g=>{console.log("Setting up HLS with URL:",g),c.current&&c.current.destroy(),Gt.isSupported()?(c.current=new Gt({capLevelToPlayerSize:!0,autoLevelCapping:-1}),c.current.loadSource(g),c.current.attachMedia(u.current),c.current.on(Gt.Events.MANIFEST_PARSED,()=>{c.current.autoLevelEnabled=!0}),c.current.on(Gt.Events.LEVEL_SWITCHED,(v,x)=>{const L=i[x.level].quality;l(L)})):u.current.canPlayType("application/vnd.apple.mpegurl")&&(u.current.src=g)},f=g=>{s(g),console.log(`Selected episode: ${g.title}`)},m=g=>{console.log("Selected quality:",g);const v=i.find(x=>x.quality===g);console.log("Selected quality object:",v),l(g),v&&d(v.url)},h=()=>{const g=e.findIndex(v=>v.id===r.id);g>0&&s(e[g-1])},p=()=>{const g=e.findIndex(v=>v.id===r.id);g<e.length-1&&s(e[g+1])};return S.jsxs("div",{className:"flex flex-col md:flex-row h-screen bg-gray-900",children:[S.jsxs("div",{className:"md:w-1/4 bg-gray-800 text-white p-4 overflow-y-auto",children:[S.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Episodes"}),S.jsx("div",{className:"flex flex-col space-y-2",children:e.length>1&&e.map((g,v)=>S.jsxs("div",{className:"py-2 px-4 bg-gray-700 hover:bg-gray-600 rounded cursor-pointer",onClick:()=>f(g),children:[S.jsxs("p",{className:"text-lg font-semibold",children:["Episode ",g.number]}),S.jsx("p",{className:"text-sm text-gray-300",children:g.title})]},v))})]}),S.jsx("div",{className:"md:w-3/4 flex flex-col items-center justify-center",children:i.length>0?S.jsxs(S.Fragment,{children:[S.jsxs("div",{className:"relative w-full h-0",style:{paddingBottom:"56.25%"},children:[S.jsx("video",{ref:u,autoPlay:!0,controls:!0,width:"100%",height:"100%",className:"absolute top-0 left-0 w-full h-full rounded-md shadow-lg"}),S.jsx("div",{className:"absolute top-0 right-0 p-2 flex space-x-2 bg-gray-800 bg-opacity-75 rounded-bl-md",children:i.filter(g=>g.quality!=="default"&&g.quality!=="backup").map((g,v)=>S.jsx("button",{onClick:()=>m(g.quality),className:`bg-gray-700 text-white py-1 px-2 rounded text-sm ${a===g.quality?"ring-2 ring-white":""}`,children:g.quality},v))})]}),S.jsxs("div",{className:"flex justify-between w-full mt-4 px-4",children:[r!==e[0]&&S.jsx("button",{onClick:h,disabled:r===e[0],className:"bg-gray-700 text-white py-2 px-4 rounded hover:bg-gray-600 disabled:bg-gray-500",children:"Previous"}),r!==e[e.length-1]&&S.jsx("button",{onClick:p,disabled:r===e[e.length-1],className:"bg-gray-700 text-white py-2 px-4 rounded hover:bg-gray-600 disabled:bg-gray-500",children:"Next"})]})]}):S.jsx(_t,{})})]})}function eA(){const[n,e]=_.useState([]),[t,r]=_.useState([]),[s,i]=_.useState([]),[o,a]=_.useState(""),[l,u]=_.useState(!1),c=ct();if(_.useEffect(()=>{u(!0),(async()=>{try{const p=await rt.get("/movies/flixhq/recent-movies");e(p.data);const y=await rt.get("/movies/flixhq/trending");r(y.data);const g=await rt.get("/movies/flixhq/recent-shows");i(g.data)}catch(p){console.error("Error fetching data",p)}u(!1)})()},[]),l)return S.jsx(_t,{});const d=async()=>{o.trim()!==""&&c(`/movie/search/${o}`)},f=h=>{h.key==="Enter"&&d()},m=h=>S.jsx("div",{className:"flex flex-wrap justify-center",children:h.map(p=>S.jsxs("div",{className:"m-4 w-64",children:[S.jsx("img",{src:p.image,alt:p.title,className:"w-full h-96 object-cover rounded-md shadow-lg"}),S.jsxs("div",{className:"mt-2",children:[S.jsx("h3",{className:"text-lg font-semibold",children:p.title}),S.jsxs("p",{className:"text-sm text-gray-500",children:["Release Date: ",p.releaseDate]}),S.jsxs("p",{className:"text-sm text-gray-500",children:["Duration: ",p.duration]}),S.jsx("a",{href:p.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:"Watch Now"})]})]},p.id))});return S.jsxs("div",{className:"p-4",children:[S.jsx("h1",{className:"text-3xl font-bold mb-4 text-center",children:"Movie Home"}),S.jsxs("div",{className:"mb-8 flex justify-center",children:[S.jsx("input",{type:"text",value:o,onChange:h=>a(h.target.value),onKeyPress:f,className:"border rounded-l-md text-black px-4 py-2 w-full max-w-md",placeholder:"Search for movies or shows..."}),S.jsx("button",{onClick:d,className:"bg-blue-500 text-white px-4 py-2 rounded-r-md",children:"Search"})]}),S.jsxs("section",{className:"mb-8",children:[S.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Recent Movies"}),n.length>0?m(n):S.jsx("p",{children:"Loading..."})]}),S.jsxs("section",{className:"mb-8",children:[S.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Recent Shows"}),s.length>0?m(s):S.jsx("p",{children:"Loading..."})]})]})}function tA(){const n=Kr(),[e,t]=_.useState(!1),[r,s]=_.useState([]),i=ct();return _.useEffect(()=>{if(!n||n===void 0||n==="")return;console.log(n),(async()=>{try{t(!0);const a=await rt.get(`/movies/flixhq/${n.id}`);console.log(a.data),s(a.data.results)}catch(a){console.error("Error searching data",a)}t(!1)})()},[n]),!n||n===void 0||n===""?S.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen text-gray-800",children:[S.jsx("h1",{className:"text-6xl font-bold",children:"404"}),S.jsx("h2",{className:"text-4xl",children:"Oops! Page not found."}),S.jsx("p",{className:"mt-4 text-xl",children:"We can't find the page you're looking for."}),S.jsx("p",{className:"mt-4 text-xl",children:"But don't worry, Here's solution put query in url."}),S.jsx("img",{className:"w-64 h-64 mt-8",src:"https://i.imgur.com/qIufhof.png",alt:"Cute cat stating: I have no idea what I'm doing"})]}):e?S.jsx(_t,{}):S.jsx(S.Fragment,{children:r.length>0?S.jsx("div",{className:"flex flex-wrap justify-center",children:r.map(o=>S.jsxs("div",{onClick:()=>{i(`/movie/info?Id=${o.id}`)},className:"m-4 w-64",children:[S.jsx("img",{src:o.image,alt:o.title,className:"w-full h-96 object-cover rounded-md shadow-lg"}),S.jsxs("div",{className:"mt-2",children:[S.jsx("h1",{className:"text-xl font-bold",children:o.title}),S.jsxs("p",{className:"text-xl text-black",children:["Year: ",o.releaseDate]}),S.jsxs("p",{className:"text-xl text-black",children:["Type : ",o.type]})]})]},o.id))}):S.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen text-gray-800",children:S.jsx("h1",{className:"text-6xl font-bold",children:"No contents Found maybe not exists "})})})}function nA(){const[n]=Gp(),[e,t]=_.useState(!1),[r,s]=_.useState(null),i=n.get("Id");if(ct(),_.useEffect(()=>{console.log(i),(async()=>{try{t(!0);const y=await rt.get(`/movies/flixhq/info?id=${i}`);console.log(y.data),s(y.data)}catch(y){console.error("Error fetching data",y)}t(!1)})()},[i]),i==="undefined")return S.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen text-gray-800",children:[S.jsx("h1",{className:"text-6xl font-bold",children:"404"}),S.jsx("h2",{className:"text-4xl",children:"Oops! Page not found maybe you skipped a step."}),S.jsx("p",{className:"mt-4 text-xl",children:"We are legally blind."}),S.jsx("p",{className:"mt-4 text-xl",children:"But don't worry, here's the solution: put a query in the URL."}),S.jsx("img",{className:"w-64 h-64 mt-8",src:"https://i.imgur.com/qIufhof.png",alt:"Cute cat stating: I have no idea what I'm doing"})]});if(e)return S.jsx(_t,{});if(!r)return S.jsx("div",{children:"No data found."});const{title:o,description:a,image:l,cover:u,rating:c,duration:d,releaseDate:f,genres:m,casts:h}=r;return S.jsxs("div",{className:"container mx-auto p-4",children:[S.jsxs("div",{className:"flex flex-col md:flex-row",children:[S.jsx("img",{src:u,alt:o,className:"w-full md:w-1/3 rounded-lg"}),S.jsxs("div",{className:"md:ml-8 mt-4 md:mt-0 flex-1",children:[S.jsx("h1",{className:"text-3xl font-bold",children:o}),S.jsx("p",{className:"mt-2 ",children:a}),S.jsxs("p",{className:"mt-4",children:[S.jsx("strong",{children:"Rating:"})," ",c]}),S.jsxs("p",{className:"mt-2",children:[S.jsx("strong",{children:"Duration:"})," ",d]}),S.jsxs("p",{className:"mt-2",children:[S.jsx("strong",{children:"Release Date:"})," ",f]}),S.jsxs("p",{className:"mt-2",children:[S.jsx("strong",{children:"Genres:"})," ",m.join(", ")]}),S.jsxs("p",{className:"mt-2",children:[S.jsx("strong",{children:"Cast:"})," ",h.join(", ")]})]})]}),S.jsxs("div",{className:"mt-8",children:[S.jsx("h2",{className:"text-2xl font-bold",children:"Recommendations"}),S.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4 mt-4",children:r.recommendations.map(p=>S.jsxs("div",{className:" p-2 rounded-lg",children:[S.jsx("img",{src:p.image,alt:p.title,className:"rounded-lg"}),S.jsx("p",{className:"mt-2 text-center",children:p.title}),S.jsxs("span",{className:"text-center text-sm",children:[" Type : ",p.type]})]},p.id))})]})]})}function rA(){return Kr(),S.jsx("div",{children:"WatchMovie"})}function sA(){const[n,e]=_.useState(!1);return S.jsx("div",{className:n?"dark":"",children:S.jsxs(Kx,{children:[S.jsx(bS,{darkMode:n,setDarkMode:e}),S.jsx("div",{className:"bg-white dark:bg-black text-black dark:text-white min-h-screen",children:S.jsxs(Mx,{children:[S.jsx(je,{index:!0,path:"/",element:S.jsx(SS,{})}),S.jsx(je,{path:"/search/:anime?",element:S.jsx(TS,{})}),S.jsx(je,{path:"/anime/artwork",element:S.jsx(AS,{})}),S.jsx(je,{path:"/anime/:id?",element:S.jsx(RS,{})}),S.jsx(je,{path:"/episodes",element:S.jsx(ZR,{})}),S.jsx(je,{path:"/manga/chapters",element:S.jsx(DS,{})}),S.jsx(je,{path:"/manga/read",element:S.jsx(kS,{})}),S.jsx(je,{path:"/searchmanga/:manga?",element:S.jsx(CS,{})}),S.jsx(je,{path:"/mangainfo/:manga?",element:S.jsx(IS,{})}),S.jsx(je,{path:"/Manga",element:S.jsx(wS,{})}),S.jsx(je,{path:"/movie",element:S.jsx(eA,{})}),S.jsx(je,{path:"/movie/search/:id?",element:S.jsx(tA,{})}),S.jsx(je,{path:"/movie/info",element:S.jsx(nA,{})}),S.jsx(je,{path:"/movie/watch/:id",element:S.jsx(rA,{})}),S.jsx(je,{path:"*",element:S.jsx(LS,{})})]})})]})})}nl.createRoot(document.getElementById("root")).render(S.jsx(Ih.StrictMode,{children:S.jsx(sA,{})}));
